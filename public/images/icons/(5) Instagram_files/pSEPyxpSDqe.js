;/*FB_PKG_DELIM*/

__d("EBDBConsistencyApi",["$InternalEnum","EBDB","FBLogger","I64","QPLUserFlow","ReQL","asyncToGeneratorRuntime","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=["encrypted_backups_virtual_devices","secure_encrypted_backups_recovery_code_status","device_metadata","secure_encrypted_backups_epochs","secure_encrypted_backups_client_state","encrypted_backups","experiences_shared_state","auto_restore_opt_out"],j=null;function a(){return j}function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{var e=(yield d("EBDB").getEBDB()),g=BigInt((h||(h=d("I64"))).to_string(b));yield e.runInTransaction(["device_state"],"readwrite",function(b){return b.stores.device_state.bulkPut([{deviceId:g,env:a}])},"EBDB - AddDevice",f.id+":53");j=g}catch(a){c("FBLogger")("wmi_eb").catching(a).mustfix("Error on EBDB - AddDevice")}});return l.apply(this,arguments)}function m(a){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state)).then(function(a){return a==null?void 0:a.deviceId})}function e(a,b,c){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,d){if(d!=null)return k(b,d);try{d=(yield m(a));if(d==null)return;return k(b,d)}catch(a){c("FBLogger")("wmi_eb").catching(a).mustfix("Error on fetching secure_encrypted_backups_client_state")}});return n.apply(this,arguments)}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){c("QPLUserFlow").addPoint(e,"track_overprompting_start");try{var g=(yield d("EBDB").getEBDB()),h=!1;yield g.runInTransaction(["device_state"],"readwrite",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=(yield b.stores.device_state.get(a));(b==null?void 0:b.deviceId)!=null&&(h=!0)});return function(a){return c.apply(this,arguments)}}(),"EBDB - AddDevice",f.id+":104");c("QPLUserFlow").addAnnotations(e,{bool:{overprompting:h}});c("QPLUserFlow").addPoint(e,"track_overprompting_end")}catch(a){c("QPLUserFlow").addPoint(e,"track_overprompting_fail"),c("FBLogger")("wmi_eb").catching(a).mustfix("Error on track overpropting")}});return p.apply(this,arguments)}var q=b("$InternalEnum")({Disabled:0,EbsmInconsistent:1,EbdbInconsistent:2,Enabled:3,Inconsistent:4});function r(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield m(a));a=a!=null?BigInt((h||(h=d("I64"))).to_string(a)):null;if(a==null&&j==null)return q.Disabled;else if(a==null&&j!=null)return q.EbsmInconsistent;else if(a!=null&&j==null)return q.EbdbInconsistent;else if(a===j)return q.Enabled;else return q.Inconsistent});return s.apply(this,arguments)}function t(a,b,c,d){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,d,e){var f=1/c("justknobx")._("3914");if(Math.random()>=f)return;f=c("qpl")._(521471316,"2831");try{c("QPLUserFlow").start(f);a=(yield r(a));e!=null&&c("QPLUserFlow").addAnnotations(f,e());c("QPLUserFlow").endSuccess(f,{annotations:{"int":{consistency:a,env:b,operation:d}}})}catch(a){c("QPLUserFlow").endFailure(f,"error"),c("FBLogger")("wmi_eb").catching(a).mustfix("Error on trackConsistency in %s",b)}});return u.apply(this,arguments)}function v(){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("EBDB").clearDeviceState(),j=null});return w.apply(this,arguments)}var x;function y(a,b){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){x!=null&&x();yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.encrypted_backups)).then(function(a){a!=null&&((a==null?void 0:a.backupId)==null||(a==null?void 0:a.isUserOptedOut)===!0)&&void v()})["catch"](function(a){c("FBLogger")("wmi_eb").catching(a).mustfix("EBDBApi: EBLS error on fetching data from encrypted_backups")});x=a.tables.encrypted_backups.subscribe(function(a,b){b.operation!=="delete"&&((b.value.backupId==null||b.value.isUserOptedOut===!0)&&void v())});var e=(yield d("EBDB").getEBDB()),g=(yield e.runInTransaction(["device_state"],"readonly",function(a){return a.stores.device_state.get(b)},"EBDB - readDeviceState",f.id+":245")["catch"](function(a){c("FBLogger")("wmi_eb").catching(a).mustfix("EBDB error: fetching device_state")}));j=A(g==null?void 0:g.deviceId);if(j==null){g=(yield m(a));if(g==null)return;var i=BigInt((h||(h=d("I64"))).to_string(g));j=i;yield e.runInTransaction(["device_state"],"readwrite",function(a){return a.stores.device_state.bulkPut([{deviceId:i,env:b}])},"EBDB - writeDeviceState",f.id+":267")["catch"](function(a){c("FBLogger")("wmi_eb").catching(a).mustfix("EBDB error: write device_state")})}});return z.apply(this,arguments)}function A(a){if(a==null)return;if(typeof a==="bigint")return a;if(typeof a==="number")return BigInt(a);if(typeof a==="string")try{return BigInt(a)}catch(a){c("FBLogger")("wmi_eb").catching(a).mustfix("EBDBApi: Parsing string as BigInt");void v();return}if(Array.isArray(a))try{return BigInt((h||(h=d("I64"))).to_string(a))}catch(a){c("FBLogger")("wmi_eb").catching(a).mustfix("EBDBApi: Parsing I64 as BigInt");void v();return}c("FBLogger")("wmi_eb").mustfix("EBDBApi: Parsing unknown as BigInt %s",String(a));void v()}g.EB_STORES=i;g.getDeviceId=a;g.addNewDevice=e;g.trackOverprompting=o;g.EBConsistencyResult=q;g.checkRegistrationConsistency=r;g.trackConsistency=t;g.clearDeviceState=v;g.startListeningDeviceRegistrations=y}),98);
__d("EBEpochChangeListener",["EBIsEbEnabled","EBIsEbEnabledSubscriber","Promise","ReQL","WAPubSub","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(){function a(a){this.$1=d("WAPubSub").simplePubSub(),this.$3=a}var c=a.prototype;c.initialize=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this;(yield d("EBIsEbEnabled").isEbEnabledLS(this.$3.tables))&&this.$4(this.$3);yield d("EBIsEbEnabledSubscriber").isEbEnabledSubscriber().then(function(b){b.subscribe(function(b){b?a.$4(a.$3):a.$2==null||a.$2()})})});function c(){return a.apply(this,arguments)}return c}();c.$4=function(a){var b=this;this.$2==null&&(this.$2=d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_epochs).subscribe(function(a,c){b.$1.publish(c)}));return this.$2};c.subscribe=function(a){return this.$1.subscribe(a)};return a}(),j;function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(j!=null)return(h||(h=b("Promise"))).resolve();j=new i(a);yield j.initialize()});return k.apply(this,arguments)}function e(a){if(j==null)throw c("err")("EBEpochChangeListener is not initialized");return j.subscribe(a)}g.initEBEpochChangeListener=a;g.subscribeToEpochChanges=e}),98);
__d("EBMinosWasmDeriveMailboxAuthKeypair",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WACreateWasmFunction","WAResultOrError","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.getWasmModule,f=d("EBMinosLogger").minosLogger.TAGS(["derive-mailbox-auth-key-pair"]);function g(a){var b=a.mailboxAuthPrivateKey;a=a.mailboxAuthPublicKey;return d("WAResultOrError").makeResult({pk:d("EBMinosTypes").unsafeCastToMailboxAuthPK(a),sk:d("EBMinosTypes").unsafeCastToMailboxAuthSK(b)})}return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.epochNumber;a=a.exportRootKey;if(c("gkx")("12911")){var h=(yield d("EBMinosWasmReactorSingleton").createMinosReactorCommand({InputSpec:d("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:d("EBMinosWasm.pb").DeriveMailboxAuthKeypairResultSpec,validateResult:g}));return h({deriveMailboxAuthKeypair:{epochNumber:b,exportRootKey:a}})}else{h=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").DeriveMailboxAuthKeypairInputSpec,ResultSpec:d("EBMinosWasm.pb").DeriveMailboxAuthKeypairResultSpec,cli:"minos_cli",command:"derive-mailbox-auth-key-pair",getWasmModule:e,logger:f,validateResult:g});h=(yield h({epochNumber:b,exportRootKey:a}));return h}});function h(b){return a.apply(this,arguments)}return h}()}e=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.deriveMailboxAuthKeypair=e}),98);
__d("EBMinosWasmEncryptMekForDistribution",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WACreateWasmFunction","WALongInt","WAResultOrError","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.getWasmModule,f=d("EBMinosLogger").minosLogger.TAGS(["encrypt-mek-for-distribution"]);function g(a){var b=a.ciphertext;a=a.version;a=d("WALongInt").maybeNumberOrThrowIfTooLarge(a);return a==null?d("WAResultOrError").makeError("missing-mek-encryption-version"):d("WAResultOrError").makeResult({encryptedMek:d("EBMinosTypes").unsafeCastToEncryptedMek(b),mekEncryptionVersion:d("EBMinosTypes").unsafeCastToEncryptedMekVersion(a)})}return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.fromKeypair,h=a.mek,i=a.senderEpochHead,j=a.toEpochHead;a=a.toMailboxPk;if(c("gkx")("12911")){var k=(yield d("EBMinosWasmReactorSingleton").createMinosReactorCommand({InputSpec:d("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:d("EBMinosWasm.pb").EncryptMekForDistributionResultSpec,validateResult:g}));return k({encryptMekForDistribution:{fromKeypair:b,mek:h,senderEpochHead:i,toEpochHead:j,toMailboxPk:a}})}else{k=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").EncryptMekForDistributionInputSpec,ResultSpec:d("EBMinosWasm.pb").EncryptMekForDistributionResultSpec,cli:"minos_cli",command:"encrypt-mek-for-distribution",getWasmModule:e,logger:f,validateResult:g});j=(yield k({fromKeypair:b,mek:h,senderEpochHead:i,toMailboxPk:a}));if(!j.success)return j;k=j.value;b=k.encryptedMek;h=k.mekEncryptionVersion;return d("WAResultOrError").makeResult({encryptedMek:b,mekEncryptionVersion:h})}});function h(b){return a.apply(this,arguments)}return h}()}e=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.encryptMekForDistribution=e}),98);
__d("EBMinosWasmEncryptMeksForDistributionFromTransportSender",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WACreateWasmFunction","WALongInt","WAResultOrError","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.getWasmModule,f=d("EBMinosLogger").minosLogger.TAGS(["encrypt-meks-for-distribution-from-transport-sender"]);function g(a){var b=a.encryptedMeks,c=a.ephemeralEncryptionPk,e=a.signature,f=a.signingPk;a=a.version;a=d("WALongInt").maybeNumberOrThrowIfTooLarge(a);return a==null?d("WAResultOrError").makeError("missing-mek-encryption-version"):d("WAResultOrError").makeResult({encryptedMeks:b.map(d("EBMinosTypes").unsafeCastToEncryptedMek),encryptedMekVersion:d("EBMinosTypes").unsafeCastToEncryptedMekVersion(a),ephemeralEncryptionPk:d("EBMinosTypes").unsafeCastToTransportSenderEphemeralPK(c),signature:d("EBMinosTypes").unsafeCastToTransportSenderEphemeralKeySig(e),signingPk:d("EBMinosTypes").unsafeCastToTransportSigningPK(f)})}return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.mek,h=a.recipientEpochHeads,i=a.recipientMailboxEncryptionPks;a=a.transportSigningKp;if(c("gkx")("12911")){var j=(yield d("EBMinosWasmReactorSingleton").createMinosReactorCommand({InputSpec:d("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:d("EBMinosWasm.pb").EncryptMeksForDistributionFromTransportSenderResultSpec,validateResult:g}));return j({encryptMeksForDistributionFromTransportSender:{mek:b,recipientEpochHeads:h,recipientMailboxEncryptionPks:i,transportSigningKp:a}})}else{j=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").EncryptMeksForDistributionFromTransportSenderInputSpec,ResultSpec:d("EBMinosWasm.pb").EncryptMeksForDistributionFromTransportSenderResultSpec,cli:"minos_cli",command:"encrypt-meks-for-distribution-from-transport-sender",getWasmModule:e,logger:f,validateResult:g});j=(yield j({mek:b,recipientEpochHeads:h,recipientMailboxEncryptionPks:i,transportSigningKp:a}));return j}});function h(b){return a.apply(this,arguments)}return h}()}e=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.createMinosWasmEncryptMeksForDistributionFromTransportSender=a;g.encryptMeksForDistributionFromTransportSender=e}),98);
__d("EBMinosWasmGenerateMek",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WACreateWasmFunction","WAResultOrError","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.getWasmModule,f=d("EBMinosLogger").minosLogger.TAGS(["generate-mek"]);function g(a){a=a.mek;return d("WAResultOrError").makeResult({key:d("EBMinosTypes").unsafeCastMekKey(a.key),mekId:d("EBMinosTypes").unsafeCastToMekId(a.mekId),rosterHash:d("EBMinosTypes").unsafeCastMekRosterHash(a.rosterHash)})}return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.epochHeads;if(c("gkx")("12911")){var b=(yield d("EBMinosWasmReactorSingleton").createMinosReactorCommand({InputSpec:d("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:d("EBMinosWasm.pb").GenerateMekResultSpec,validateResult:g}));return b({generateMek:{epochHeads:a}})}else{b=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").GenerateMekInputSpec,ResultSpec:d("EBMinosWasm.pb").GenerateMekResultSpec,cli:"minos_cli",command:"generate-mek",getWasmModule:e,logger:f,validateResult:g});b=(yield b({epochHeads:a}));return b}});function h(b){return a.apply(this,arguments)}return h}()}e=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.generateMek=e}),98);
__d("WAPromiseMap",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c){return(g||(g=b("Promise"))).resolve(a).then(function(a){return(g||(g=b("Promise"))).all(a.map(function(a,b){return c(a,b)}))})}f.promiseMap=a}),66);
__d("EBGenerateAndUploadMek",["EBMinosWasmDeriveMailboxAuthKeypair","EBMinosWasmEncryptMekForDistribution","EBMinosWasmEncryptMeksForDistributionFromTransportSender","EBMinosWasmGenerateMek","WAErrorMessage","WAPromiseMap","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=["mekEnvelopes"],i,j,k,l,m,n,o,p,q,r,s,t;function a(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.actThreadId,e=a.io,f=a.logger,g=a.msgUploadQpl,q=a.participantMailboxes;a=a.transportSigningKeypair;f.DEV(i||(i=babelHelpers.taggedTemplateLiteralLoose(["start generate and upload mek"])));g.addPoint("generate_mek_start");var r=q.map(function(a){a=a.epochHead;return a});r=(yield d("EBMinosWasmGenerateMek").generateMek({epochHeads:r}));if(!r.success){f.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["mek generated error: ",""])),r.error);return d("WAResultOrError").makeError("generate-mek-error")}g.addPoint("generate_mek_end");g.addPoint("get_minos_mailbox_key_start");var s=(yield e.loadMostRecentSelfMinosEpoch().then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a==null)return d("WAResultOrError").makeError("unable-to-get-latest-epoch");var b=(yield d("EBMinosWasmDeriveMailboxAuthKeypair").deriveMailboxAuthKeypair({epochNumber:a.epochNumber,exportRootKey:a.exportRootKey}));if(!b.success){f.ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Unable to get mailbox auth key pair for sender - failed with exception ",""])),b.error);return d("WAResultOrError").makeError("unable-to-get-sender-mailbox-auth-key-pair")}return d("WAResultOrError").makeResult({epochFbId:a.epochFbId,epochHead:a.epochHead,mailboxAuthKeyPair:b.value})});return function(b){return a.apply(this,arguments)}}()));s=s.success?{fromKeypair:s.value.mailboxAuthKeyPair,senderEpochFbId:s.value.epochFbId,senderEpochHead:s.value.epochHead,senderType:"Minos"}:{senderType:"Transport",transportSigningKp:a};f.DEV(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Sender type: ",". Epoch FBID: ",""])),s.senderType,s.senderEpochFbId);g.addPoint("get_minos_mailbox_key_end",{string:{senderType:s.senderType}});f.DEV(m||(m=babelHelpers.taggedTemplateLiteralLoose(["start encrypy mek. senderType: ",""])),s.senderType);g.addPoint("encrypt_mek_envelopes_start");a=r.value;r=(yield s.senderType==="Minos"?v({fromKeypair:s.fromKeypair,logger:f,mek:a,participantMailboxes:q,senderEpochFbId:s.senderEpochFbId,senderEpochHead:s.senderEpochHead}):x({logger:f,mek:a,participantMailboxes:q,transportSigningKp:s.transportSigningKp}));if(!r.success){g.addPoint("encrypt_mek_envelopes_fail");return d("WAResultOrError").makeError("encrypt-mek-error")}g.addPoint("encrypt_mek_envelopes_end");q=r.value;s=q.mekEnvelopes;r=babelHelpers.objectWithoutPropertiesLoose(q,h);g.addPoint("register_mek_gql_start");q=(yield e.registerMinosMessageEncryptionKey({actThreadId:c,instanceKey:g.getInstanceKey(),mekEnvelopes:s,mekId:a.mekId,mekRosterHash:a.rosterHash,sender:r})["catch"](function(a){var b=d("WAErrorMessage").maybeGetMessageFromError(a);f.ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["upload mek runtime-error: ",". ",""])),b,a);return d("WAResultOrError").makeError({errorName:"runtime-error",failReason:b})}));if(q.success!==!0){e=q.error;c=e.errorName;s=e.failReason;f.ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["upload mek error: ",". Reason: ",""])),c,s);g.addPoint("register_mek_gql_fail");return d("WAResultOrError").makeError("distribute-mek-error")}g.addPoint("register_mek_gql_end");f.DEV(p||(p=babelHelpers.taggedTemplateLiteralLoose(["register minos message encryption key success"])));return d("WAResultOrError").makeResult({mek:a,mekFbid:q.value.mekFbid,miThreadFbid:q.value.miThreadFbid})});return u.apply(this,arguments)}function v(a){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.fromKeypair,e=a.logger,f=a.mek,g=a.participantMailboxes,h=a.senderEpochFbId,i=a.senderEpochHead;a=(yield d("WAPromiseMap").promiseMap(g,function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.epochHead,g=a.mailboxKey,h=a.mailboxKeyFbid;a=a.participantId;b=(yield d("EBMinosWasmEncryptMekForDistribution").encryptMekForDistribution({fromKeypair:c,mek:f,senderEpochHead:i,toEpochHead:b,toMailboxPk:g}));if(!b.success){e.ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["mek encryption error: ",""])),b.error);return null}return{encryptedMek:b.value.encryptedMek,encryptedMekVersion:b.value.mekEncryptionVersion,mailboxKey:g,mailboxKeyFbid:h,participantId:a}});return function(b){return a.apply(this,arguments)}}()));g=a.filter(Boolean);if(g.length===0){e.ERROR(r||(r=babelHelpers.taggedTemplateLiteralLoose(["no successful mek encryption results"])));return d("WAResultOrError").makeError("encrypt-mek-error")}return d("WAResultOrError").makeResult({epochFbId:h,mekEnvelopes:g,senderType:"Minos"})});return w.apply(this,arguments)}function x(a){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.logger,c=a.mek,e=a.participantMailboxes;a=a.transportSigningKp;var f=(yield d("EBMinosWasmEncryptMeksForDistributionFromTransportSender").encryptMeksForDistributionFromTransportSender({mek:c,recipientEpochHeads:e.map(function(a){a=a.epochHead;return a}),recipientMailboxEncryptionPks:e.map(function(a){a=a.mailboxKey;return a}),transportSigningKp:a}));if(!f.success){b.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["mek encryption error: ",""])),f.error);return d("WAResultOrError").makeError("encrypt-mek-error")}if(f.value.encryptedMeks.length!==e.length){b.ERROR(t||(t=babelHelpers.taggedTemplateLiteralLoose(["number of encrypted meks does not match number of participants"])));return d("WAResultOrError").makeError("encrypt-mek-error")}c=e.map(function(a,b){return{encryptedMek:f.value.encryptedMeks[b],encryptedMekVersion:f.value.encryptedMekVersion,mailboxKey:a.mailboxKey,mailboxKeyFbid:a.mailboxKeyFbid,participantId:a.participantId}});return d("WAResultOrError").makeResult({ephemeralEncryptionPk:f.value.ephemeralEncryptionPk,mekEnvelopes:c,senderType:"Transport",signature:f.value.signature,signingPk:f.value.signingPk})});return y.apply(this,arguments)}g.generateAndUploadMek=a}),98);
__d("EBMinosWasmDeriveAttachmentAccessTokenSecret",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WACreateWasmFunction","WAResultOrError","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.getWasmModule,f=d("EBMinosLogger").minosLogger.TAGS(["derive-attachment-access-token-secret"]);function g(a){a=a.attachmentAccessTokenSecret;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastToAttachmentAccessTokenSecret(a))}return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.mediaKey;if(c("gkx")("12911")){var b=(yield d("EBMinosWasmReactorSingleton").createMinosReactorCommand({InputSpec:d("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:d("EBMinosWasm.pb").DeriveAttachmentAccessTokenSecretResultSpec,validateResult:g}));return b({deriveAttachmentAccessTokenSecret:{mediaKey:a}})}else{b=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").DeriveAttachmentAccessTokenSecretInputSpec,ResultSpec:d("EBMinosWasm.pb").DeriveAttachmentAccessTokenSecretResultSpec,cli:"minos_cli",command:"derive-attachment-access-token-secret",getWasmModule:e,logger:f,validateResult:g});b=(yield b({mediaKey:a}));return b}});function h(b){return a.apply(this,arguments)}return h}()}e=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.deriveAttachmentAccessTokenSecret=e}),98);
__d("EBMinosWasmDeriveAttachmentPrimaryKeySecret",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WACreateWasmFunction","WAResultOrError","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.getWasmModule,f=d("EBMinosLogger").minosLogger.TAGS(["derive-attachment-primary-key-secret"]);function g(a){a=a.attachmentPrimaryKeySecret;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastToAttachmentPrimaryKeySecret(a))}return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.mediaKey;if(c("gkx")("12911")){var b=(yield d("EBMinosWasmReactorSingleton").createMinosReactorCommand({InputSpec:d("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:d("EBMinosWasm.pb").DeriveAttachmentPrimaryKeySecretResultSpec,validateResult:g}));return b({deriveAttachmentPrimaryKeySecret:{mediaKey:a}})}else{b=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").DeriveAttachmentPrimaryKeySecretInputSpec,ResultSpec:d("EBMinosWasm.pb").DeriveAttachmentPrimaryKeySecretResultSpec,cli:"minos_cli",command:"derive-attachment-primary-key-secret",getWasmModule:e,logger:f,validateResult:g});b=(yield b({mediaKey:a}));return b}});function h(b){return a.apply(this,arguments)}return h}()}e=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.deriveAttachmentPrimaryKeySecret=e}),98);
__d("EBGetMinosAttachmentPayloadFromMpsMessage",["EBMinosTypes","EBMinosWasmDeriveAttachmentAccessTokenSecret","EBMinosWasmDeriveAttachmentPrimaryKeySecret","MpsMessageToBridgeWrapper","Promise","WAMediaUtils","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n;function a(a){var c,e=a.logger,f=a.message;a=a.qplFlow;f=d("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(f);f=f.deserialize();c=(c=f.encryptedTransportMessage())==null?void 0:c.consumerMessage();if(c!=null)return o({consumerApplication:c,logger:e,qplFlow:a});f=(c=f.encryptedTransportMessage())==null||(c=c.armadillo())==null?void 0:c.extendedContentMessage();return f!=null?q({extendedContentMessage:f,logger:e,qplFlow:a}):(n||(n=b("Promise"))).resolve([])}function o(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b,c,e,f,g,h,i=a.consumerApplication,j=a.logger;a=a.qplFlow;b=(b=(b=(b=(b=i.audioMessage())!=null?b:i.documentMessage())!=null?b:i.imageMessage())!=null?b:i.stickerMessage())!=null?b:i.videoMessage();if(b==null)return[];i=b.kind;b=b.payload.integral;c=(c=b==null||(e=b.transport)==null?void 0:e.integral)!=null?c:{};c=c.mediaKey;f=(f=b==null||(g=b.transport)==null?void 0:g.ancillary)!=null?f:{};f=f.objectId;c=(yield s({logger:j,maybeMediaKey:c,maybeObjectId:f}));f=b==null||(h=b.transport)==null||(h=h.ancillary)==null||(h=h.thumbnail)==null?void 0:h.downloadableThumbnail;b=f==null?null:yield s({logger:j,maybeMediaKey:f.mediaKey,maybeObjectId:f.objectId});j=a.getInstanceKey().toString();return[c.success===!0?babelHelpers["extends"]({},c.value,{attachmentTraceId:j,mediaType:u(i)}):null,(b==null?void 0:b.success)===!0?babelHelpers["extends"]({},b.value,{attachmentTraceId:j,mediaType:d("EBMinosTypes").MinosAttachmentMediaType.MESSENGER_PREVIEW}):null].filter(Boolean)});return p.apply(this,arguments)}function q(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.extendedContentMessage,e=a.logger,f=a.qplFlow;a=[c.favicon(),c.headerImage()].concat(c.previews()).filter(Boolean);if(a.length===0)return[];c=(yield (n||(n=b("Promise"))).all(a.map(function(a){var b;return s({logger:e,maybeMediaKey:(b=a.integral)==null||(b=b.transport)==null||(b=b.integral)==null?void 0:b.mediaKey,maybeObjectId:(b=a.integral)==null||(b=b.transport)==null||(b=b.ancillary)==null?void 0:b.objectId})})));a=c.filter(function(a){return a.success===!0});c=c.filter(function(a){return a.success===!1});c.forEach(function(a){e.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to parse an attachment in XMA message: ",""])),a.error)});a.length===0&&e.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Failed to parse all attachments in XMA message"])));return a.map(function(a){return babelHelpers["extends"]({},a.value,{attachmentTraceId:f.getInstanceKey().toString(),mediaType:d("EBMinosTypes").MinosAttachmentMediaType.XMA})})});return r.apply(this,arguments)}function s(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.logger,c=a.maybeMediaKey;a=a.maybeObjectId;if(c==null){b.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Missing mediaKey in media message protobuf"])));return d("WAResultOrError").makeError("missing-media-key")}if(a==null){b.ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Missing objectId in media message protobuf"])));return d("WAResultOrError").makeError("missing-object-id")}c=d("WAMediaUtils").castToMediaKey(c);var e=(yield d("EBMinosWasmDeriveAttachmentPrimaryKeySecret").deriveAttachmentPrimaryKeySecret({mediaKey:c}));if(!e.success){b.ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Failed to derive attachment primary key secret"])));return d("WAResultOrError").makeError("derive-primary-key-secret-error")}c=(yield d("EBMinosWasmDeriveAttachmentAccessTokenSecret").deriveAttachmentAccessTokenSecret({mediaKey:c}));if(!c.success){b.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Failed to derive attachment access token secret"])));return d("WAResultOrError").makeError("derive-access-token-secret-error")}return d("WAResultOrError").makeResult({accessTokenSecret:c.value,primaryKeySecret:e.value,zippyObjectId:d("WAMediaUtils").stringToDeliveryObjectId(a)})});return t.apply(this,arguments)}function u(a){switch(a){case"audioTransport":return d("EBMinosTypes").MinosAttachmentMediaType.PTT;case"imageTransport":return d("EBMinosTypes").MinosAttachmentMediaType.IMAGE;case"videoTransport":return d("EBMinosTypes").MinosAttachmentMediaType.VIDEO;case"stickerTransport":return d("EBMinosTypes").MinosAttachmentMediaType.STICKER;default:a;return d("EBMinosTypes").MinosAttachmentMediaType.DOCUMENT}}g.getMinosAttachmentPayloadFromMpsMessage=a}),98);
__d("EBGraphQLRestoreDefinition",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}f.toMpsMessageQueryForGraphQLQuery=a}),66);
__d("EBSMProperties",[],(function(a,b,c,d,e,f){"use strict";a=["encrypted_backups_virtual_devices","secure_encrypted_backups_recovery_code_status","device_metadata","secure_encrypted_backups_epochs","secure_encrypted_backups_client_state","encrypted_backups","experiences_shared_state","auto_restore_opt_out"];b=new Set(["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"]);c={dbVersion:5,mandatoryTables:b,persistedTables:new Set(a),persistedTablesArray:a};d=c;f["default"]=d}),66);
__d("MWEncryptedBackupsFirstRestoreUpsellTime",["EBAPIWorkerCheck","FBLogger","WebStorage","getErrorSafe","getMWEncryptedBackupsIsLocalStorageSupported"],(function(a,b,c,d,e,f,g){"use strict";var h,i="mw_encrypted_backups_restore_upsell_first_impression_time_key";function a(){var a=Date.now().toString();if(d("EBAPIWorkerCheck").runningInWorker())return k(a);if(!d("getMWEncryptedBackupsIsLocalStorageSupported").getMWEncryptedBackupsIsLocalStorageSupported())return a;try{var b;b=(b=(h||(h=c("WebStorage"))).getLocalStorage())==null?void 0:b.getItem(i);if(b==null){var e;(e=(h||(h=c("WebStorage"))).getLocalStorage())==null||e.setItem(i,a);return a}return b}catch(b){c("FBLogger")("wmi_eb").warn("[labyrinth][web] Failed to set EB session identifier due to %s",c("getErrorSafe")(b).message);return a}}var j=null;function k(a){j==null&&(j=a);return j}g.getFirstRestoreUpsellTime=a;g.getFirstRestoreUpsellTimeForEBLS=k}),98);
__d("QPLMemoryUtils",["MemoryUtils","QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("MemoryUtils").getCurrentMemory();b=b.usedJSHeapSize;c("QPLUserFlow").addAnnotations(a,{"int":{usedJSHeapSizeStart:b}})}function b(a){var b=d("MemoryUtils").getCurrentMemory();b=b.usedJSHeapSize;c("QPLUserFlow").addAnnotations(a,{"int":{usedJSHeapSizeEnd:b}})}g.logMemoryForQPLStart=a;g.logMemoryForQPLEnd=b}),98);
__d("createReStoreEBSMTablesPersistence",["CurrentMessengerUser","EBLogger","MAWUnrecoverableDbErrors","MWEBODSCategory","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","MWEBUseLocalStorage","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsLocalStorageEntryEnum","ODS","Promise","QPLMemoryUtils","QPLUserFlow","Random","ReStorePersistence","ReStoreTabNotifier","WebSession","asyncToGeneratorRuntime","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;e=d("CurrentMessengerUser").getIDorEIMU();var l=c("ReStoreTabNotifier")==null?void 0:c("ReStoreTabNotifier")("mwChat-"+e),m=null,n=!1,o=!1,p=d("EBLogger").EBLogger().tags(["EBSM","Pesistence","MainThread"]);function q(a,b,c){return(a.has(b)?a:a.set(b,c())).get(b)}function a(a){var e=(k||(k=b("Promise"))).resolve(),f="flushChangesV2",g=new Map();function r(a){return q(g,a,function(){return new Map()})}var s=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").start(c("qpl")._(521481876,"1407"),{annotations:{string:{ebSessionIdentifier:s,sessionTabId:d("WebSession").getId()}}});(j||(j=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_HYDRATION,c("MWEBODSEntityKey.enum").START);d("QPLMemoryUtils").logMemoryForQPLStart(c("qpl")._(521481876,"1407"));function t(){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield a.rehydrateEBSMFromEBDB(r),d("QPLMemoryUtils").logMemoryForQPLEnd(c("qpl")._(521481876,"1407")),c("QPLUserFlow").endSuccess(c("qpl")._(521481876,"1407")),(j||(j=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_HYDRATION,c("MWEBODSEntityKey.enum").SUCCESS)}catch(a){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_FAILED"),p.MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["An error occured in EBSM hydration when loading EB data: ",""])),a),c("QPLUserFlow").endFailure(c("qpl")._(521481876,"1407"),"Hydration failed."),(j||(j=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_HYDRATION,c("MWEBODSEntityKey.enum").FAIL)}});return u.apply(this,arguments)}m=t();l==null||l.onEventReceive("flushChangesV2",function(b){b=b.changeSet;var e=new Map();b.forEach(function(a,b){e.set(b,{toAdd:[],toDelete:[]});var c=r(b);a.forEach(function(a,f){if(d("ReStorePersistence").isDeletedValue(a,d("ReStorePersistence").sentinelDeleted)){var g;(g=e.get(b))==null||g.toDelete.push(c.get(f))}else{(g=e.get(b))==null||g.toAdd.push(a)}})});if(a.updateEBSM==null){p.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["ebdbEbsmApi.updateEBSM is not defined"])));return}c("promiseDone")(a.updateEBSM(e,f))});return{flush:function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,e){var g;if(b.size===0)return;b.size>0&&b.forEach(function(a,c){a.size===0&&b["delete"](c)});if(b.size===0)return;e=((g=e.actionSource)==null?void 0:g.type)==="user_initiated"&&((g=e.actionSource)==null?void 0:g.source)===f;if(e){b.forEach(function(a,b){var c=r(b);a.forEach(function(a,b){d("ReStorePersistence").isDeletedValue(a,d("ReStorePersistence").sentinelDeleted)?c["delete"](b):c.set(b,a)})});return}var h=new Map();b.forEach(function(a,b){h.set(b,{toAdd:[],toDelete:[]});var c=r(b);a.forEach(function(a,e){if(d("ReStorePersistence").isDeletedValue(a,d("ReStorePersistence").sentinelDeleted)){var f;(f=h.get(b))==null||f.toDelete.push(c.get(e));c["delete"](e)}else{(f=h.get(b))==null||f.toAdd.push(a);c.set(e,a)}})});l==null||l.postMessage("flushChangesV2",{changeSet:b,fromVersion:"",sentinelDeleted:d("ReStorePersistence").sentinelDeleted,version:""});g=d("Random").uint32();e=Array.from(b.keys());c("QPLUserFlow").start(c("qpl")._(521485383,"2200"),{annotations:{bool:{ebsmv2:!0},string_array:{tables:e}},instanceKey:g});yield m;yield a.flushEBSMtoEBDB(h)["catch"](function(){})});function g(a,b){return e.apply(this,arguments)}return g}(),get:function(a,c,d){var e=r(c);if(n)return e.get(d);return m==null?(k||(k=b("Promise"))).reject("rehydration is not complete"):m.then(function(){n=!0;return e.get(d)})},logError:function(b,e,f,g){(j||(j=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_RESTORE_PERSISTENCE_ERROR,b);if(f==="dbCorruption"){(j||(j=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_CORRUPTION,b);f="Got unexpected undefined in ebsm, mode: "+e+", table: "+b+", id: "+((f=g==null?void 0:g.id)!=null?f:"")+", deletedInThisTxn: "+((e=g==null?void 0:g.deletedInThisTxn)!=null?e:"")+". Deleting EBSM db";p.mustfix(f);g=d("Random").uint32();d("MAWUnrecoverableDbErrors").setError(new(d("MAWUnrecoverableDbErrors").EbsmHydrationError)(f,!0,g,b),function(){c("promiseDone")(a.clearEbStores(),function(){(j||(j=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_CORRUPTION,"db_deleted.main_thread")})});o||(o=!0,d("MWEBUseLocalStorage").mwEBCreateLocalStorageEntry(c("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE,"full"))}},queueCommitWork:void 0,runExclusively:function(a){return new(k||(k=b("Promise")))(function(c,d){e=e.then(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield a()),e=b[0];b[1];try{c(yield e())}catch(a){d(a)}}))})},shouldApplySync:function(){return!1},shouldInline:function(a,b){return!1},shouldSync:function(a,b){return a==="notifyInMemoryTable"?!1:!0},tabTablesNotifier:function(){return l},types:["ephemeral"],uniqueId:""}}g["default"]=a}),98);
__d("createReStoreTableNameAllowListPersistence",["Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c,d){var e;return{clearCache:function(){a.clearCache==null||a.clearCache(),c.clearCache==null||c.clearCache()},close:function(){a.close==null||a.close(),c.close==null||c.close()},flush:function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e,f){var h=new Map(),i=new Map();e.forEach(function(a,b){d.has(b)?i.set(b,a):h.set(b,a)});yield (g||(g=b("Promise"))).all([a.flush(h,f),c.flush(i,f)])});function f(a,b){return e.apply(this,arguments)}return f}(),get:function(b,e,f,g){return d.has(e)?c.get(b,e,f,g):a.get(b,e,f,g)},isClosed:function(){return(a.isClosed==null?void 0:a.isClosed())||!1},isPersistenceSupported:a.isPersistenceSupported,logError:function(b,e,f,g){d.has(b)?c.logError==null||c.logError(b,e,f,g):a.logError==null||a.logError(b,e,f,g)},permitsSynchronousIO:function(b){if(d.has(b)){var e;return(e=c.permitsSynchronousIO==null?void 0:c.permitsSynchronousIO(b))!=null?e:!1}else{return(e=a.permitsSynchronousIO==null?void 0:a.permitsSynchronousIO(b))!=null?e:!1}},runExclusively:function(d,e){return a.runExclusively(function(){return new(g||(g=b("Promise")))(function(a,f){var h=c.runExclusively(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var c=(yield d()),e=c[0],f=c[1],i=new(g||(g=b("Promise")))(function(b){a([function(){b();return h},f])});return[b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield i;return e()}),f]}),e);h["catch"](f)})},e)},shouldApplySync:function(b,e){if(d.has(e))return c.shouldApplySync(b,e);else return a.shouldApplySync(b,e)},shouldInline:function(b,e){return d.has(b)?c.shouldInline(b,e):a.shouldInline(b,e)},shouldSync:function(b,e){if(d.has(e))return c.shouldSync(b,e);else return a.shouldSync(b,e)},tabTablesNotifier:(e=a.tabTablesNotifier)!=null?e:c.tabTablesNotifier,types:[].concat(a.types,c.types),uniqueId:c.uniqueId+a.uniqueId}}f["default"]=a}),66);
__d("LSJSEBInMemoryStorage",["EBSMProperties","createLSReStoreEphemeralPersistence","createReStoreEBSMTablesPersistence","createReStoreTableNameAllowListPersistence"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=c("createReStoreTableNameAllowListPersistence")(d("createLSReStoreEphemeralPersistence").createLSReStoreEphemeralPersistence(),c("createReStoreEBSMTablesPersistence")(a),c("EBSMProperties").persistedTables);return a}g.makeReStorePersistence=a}),98);
__d("EBWorkerAddDeviceUtils",["EBDB","EBDBEbsmApi","EBSMProperties","I64","LSAuthorityLevel","LSIntEnum","LSJSEBInMemoryStorage","LSMetadata","LSReStoreWrapper","MAWLSVaultingHooks","Promise","ReQL","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var g=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(e.tables.secure_encrypted_backups_client_state)));if(g!=null)return"dest_table_not_empty";g={clearEbStores:d("EBDB").clearEbStores,flushEBSMtoEBDB:d("EBDBEbsmApi").flushEBSMtoEBDB,rehydrateEBSMFromEBDB:d("EBDBEbsmApi").rehydrateEBSMFromEBDB,updateEBSM:function(){return(j||(j=b("Promise"))).resolve()}};g=(yield d("LSJSEBInMemoryStorage").makeReStorePersistence(g));if(g==null)throw c("err")("persistence is null");g=d("LSReStoreWrapper").createLSReStore(g,d("LSMetadata").schema,[c("MAWLSVaultingHooks")],void 0);var k=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(g.tables.secure_encrypted_backups_epochs)));return k.filter(function(a){return(h||(h=d("I64"))).equal(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))}).length===0?"source_epoch_not_authoritative":g.runInTransaction(function(c){return e.runInTransaction(function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(d){var e=(yield (j||(j=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=c[a];b=b.entries(new WeakMap());var e=(yield b.next());if(e.done)return"source_table_empty";a=d[a];while(!e.done){var f=e.value,g=f[0];f=f[1];yield a.upsert(g,f);e=(yield b.next())}return"success"});return function(b){return a.apply(this,arguments)}}())));e=new Set(e);if(e.has("source_table_empty"))return"source_table_empty";else if(e.has("success")&&e.size===1)return"success";return"fail"});return function(a){return d.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":91")},"readonly",void 0,void 0,f.id+":89")});return k.apply(this,arguments)}function e(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield a.runInTransaction(function(a){return(j||(j=b("Promise"))).all(c("EBSMProperties").persistedTablesArray.map(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=a[b];var c=b.entries(new WeakMap()),d=(yield c.next());while(!d.done)yield b["delete"].apply(b,d.value[0]),d=(yield c.next())});return function(a){return c.apply(this,arguments)}}()))},"readwrite",void 0,void 0,f.id+":132")});return l.apply(this,arguments)}g.copyEBStateTablesFromMainthreadToWorker=a;g.clearLSEBSMTables=e}),98);
__d("LSDedicatedMqttChannel",["FBMqttChannel","cr:1232"],(function(a,b,c,d,e,f,g){"use strict";function a(){b("cr:1232")!=null&&b("cr:1232").shutdownAndClear()}function d(a,d,e,f,g,h){return function(i){if(b("cr:1232")!=null)return b("cr:1232").getInstance(i,a,d,e,f,g,h);else return c("FBMqttChannel")}}g.shutdownAndClear=a;g.getInstance=d}),98);
__d("EBSMAPI",["EBDeps","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){if(i!=null)return i;i=d("EBDeps").getDeps().getEBSMAPI();return i}a={addDeviceWithEBKeys:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;return(a=(yield j())).addDeviceWithEBKeys.apply(a,arguments)});function c(){return a.apply(this,arguments)}return c}(),addDeviceWithRecoveryCode:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;return(a=(yield j())).addDeviceWithRecoveryCode.apply(a,arguments)});function c(){return a.apply(this,arguments)}return c}(),deleteMailbox:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;return(a=(yield j())).deleteMailbox.apply(a,arguments)});function c(){return a.apply(this,arguments)}return c}(),fetchBackupIds:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;return(a=(yield j())).fetchBackupIds.apply(a,arguments)});function c(){return a.apply(this,arguments)}return c}(),generateRecoveryCode:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;return(a=(yield j())).generateRecoveryCode.apply(a,arguments)});function c(){return a.apply(this,arguments)}return c}(),getEBState:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return(yield j()).getEBState()});function c(){return a.apply(this,arguments)}return c}(),getLSVirtualDevices:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return(yield j()).getLSVirtualDevices(a)});function c(b){return a.apply(this,arguments)}return c}(),initializeBackup:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;return(a=(yield j())).initializeBackup.apply(a,arguments)});function c(){return a.apply(this,arguments)}return c}(),isEbEnabled:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;return(a=(yield j())).isEbEnabled.apply(a,arguments)});function c(){return a.apply(this,arguments)}return c}(),optOutOfBackup:function(){return(h||(h=b("Promise"))).resolve()},otcAddDevice:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;return(a=(yield j())).otcAddDevice.apply(a,arguments)});function c(){return a.apply(this,arguments)}return c}(),syncEpochs:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return(yield j()).syncEpochs()});function c(){return a.apply(this,arguments)}return c}()};c=a;g["default"]=c}),98);
__d("LSIssueNewEbTaskAndGetTaskIDV2",["LSIssueNewTaskAndGetTaskID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),a[0],a[1],a[2],void 0,void 0,c.i64.cast([0,0]),a[3],a[4],void 0,a[5],a[7]).then(function(a){return a=a,d[0]=a[0],a})},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueNewEbTaskAndGetTaskIDV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSFetchBackupIds",["LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFetchBackupIdsStoredProcedure] Beginning execution."),d[11]=c.i64.cast([0,0]),d[7]=d[11],d[8]=new c.Map(),d[8].set("backup_tenancy",a[0]),d[8].set("trace_id",void 0),d[9]=c.toJSON(d[8]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",c.i64.cast([0,50008]),d[9],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,d[7]).then(function(a){return a=a,d[10]=a[0],a})},function(a){return d[1]=c.i64.of_float(Date.now()),d[2]=c.i64.random(),d[4]="Finishing execution. Execution time: ",d[5]=c.i64.to_string(c.i64.sub(d[1],d[0])),d[6]=" ms",d[3]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsFetchBackupIdsStoredProcedure] ",d[3],d[4],d[3],d[5],d[3],d[6]].join("")),c.i64.eq(c.i64.mod_(d[2],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[7]=",",d[8]=c.createArray(),void 0!==void 0?d[9]=(d[8].push(void 0),d[8]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFetchBackupIdsStoredProcedure",[d[4],d[7],d[5],d[7],d[6]].join(""),d[8],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsFetchBackupIdsStoredProcedure";a.__tables__=["encrypted_backups"];e.exports=a}),null);
__d("LSFetchBackupIdsStoredProcedure",["LSFetchBackupIds","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSFetchBackupIds"),e.backupTenancy,e.traceId,e.isUiBlocking);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSLoadThreadPkFromThreadId",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadThreadPkFromThreadId] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(173).fetch(),function(b){return c.i64.to_string(b.jid)===a[0]}).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,100])),d[13].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[13].set("error_message",""),e=[void 0,d[13]],d[2]=e[0],d[3]=e[1]):(b=a.item,e=[b.clientThreadPk,void 0],d[2]=e[0],d[3]=e[1])})},function(a){return c.i64.neq(d[2],void 0)?(a=[d[2],d[3]],d[5]=a[0],d[6]=a[1],a):(d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,7])),d[13].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[13].set("error_message",""),c.i64.neq(void 0,void 0)?(a=[void 0,d[13]],d[14]=a[0],d[15]=a[1],a):(d[16]=new c.Map(),d[16].set("error_code",c.i64.cast([0,100])),d[16].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[16].set("error_message",""),a=[void 0,d[16]],d[14]=a[0],d[15]=a[1]),a=[d[14],d[15]],d[5]=a[0],d[6]=a[1]),d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[10]="Finishing execution. Execution time: ",d[11]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadThreadPkFromThreadId] ",d[9],d[10],d[9],d[11],d[9],d[12]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[13]=",",d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadThreadPkFromThreadId",[d[10],d[13],d[11],d[13],d[12]].join(""),d[14],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[5],d[6]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure";a.__tables__=["mi_act_mapping_table"];e.exports=a}),null);
__d("LSIssueMessageRangeQueryTask",["LSArrayGetObjectAt","LSBase64Encode.nop","LSIsEncryptionVersionSecure","LSIssueNewTask","LSLoadThreadPkFromThreadId","LSLogMebClientEvent.nop","LSQplAnnotateString.nop","LSQplMarkPoint.nop","LSQplStartTrace.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][issueMessageRangeQueryTask] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[11]=c.i64.gt(a[1],c.i64.cast([0,0]))&&c.i64.gt(a[5],c.i64.cast([0,0])),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[15]=new c.Map(),d[15].set("error_msg","Expected a nonempty query result"),d[15].set("code",c.i64.cast([0,3])),d[15].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[16]=c.createArray(),d[17]=(d[16].push(d[15]),d[16]),e=[void 0,d[16]],d[2]=e[0],d[3]=e[1]):(b=a.item,d[15]=new c.Map(),d[15].set("backup_id",b.backupId),d[15].set("device_public_key_blob",b.devicePublicKeyBlob),d[15].set("device_private_key_blob",b.devicePrivateKeyBlob),d[15].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[15].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[15].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[15].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[15].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[15].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[15].set("orf_client_state_v2_blob",void 0),d[15].set("orf_v2_authority_level",void 0),d[15].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[15].set("device_id",b.deviceId),d[15].set("backup_tenancy",b.backupTenancy),d[15].set("encryption_version",b.encryptionVersion),d[15].set("revision_version",b.revisionVersion),d[15].set("initialize_restore_result",void 0),d[15].set("device_creation_timestamp_sec",void 0),d[15].set("authority_level",b.authorityLevel),e=[d[15],void 0],d[2]=e[0],d[3]=e[1])})},function(e){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(e){return d[15]=d[6].get("backup_id"),d[16]=d[6].get("device_public_key_blob"),d[17]=d[6].get("device_private_key_blob"),d[18]=d[6].get("epoch_storage_public_key_blob"),d[19]=d[6].get("epoch_storage_private_key_blob"),d[20]=d[6].get("epoch_auth_public_key_blob"),d[21]=d[6].get("epoch_auth_private_key_blob"),d[22]=d[6].get("mailbox_root_key_blob"),d[23]=d[6].get("ocmf_client_state_blob"),d[24]=d[6].get("orf_client_state_v2_blob"),d[25]=d[6].get("orf_v2_authority_level"),d[26]=d[6].get("oblivious_validation_token_blob"),d[27]=d[6].get("device_id"),d[28]=d[6].get("backup_tenancy"),d[29]=d[6].get("encryption_version"),d[30]=d[6].get("revision_version"),d[31]=d[6].get("initialize_restore_result"),d[32]=d[6].get("device_creation_timestamp_sec"),d[33]=d[6].get("authority_level"),c.i64.neq(d[27],void 0)?c.sequence([function(a){return d[35]=void 0,c.i64.neq(d[35],void 0)?c.resolve(d[36]=d[35]):c.sequence([function(a){return d[41]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[42]=a[0],a})},function(a){return d[42]?d[51]=(d[41].push(c.i64.cast([0,0])),d[41]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[43]?d[51]=(d[41].push(c.i64.cast([0,2])),d[41]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[44]?d[51]=(d[41].push(c.i64.cast([0,3])),d[41]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[45]?d[51]=(d[41].push(c.i64.cast([0,4])),d[41]):0,d[46]=c.createArray(),d[47]=c.i64.of_int32(d[41].length),c.i64.gt(d[47],c.i64.cast([0,0]))?c.loopAsync(d[47],function(a){return d[51]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[41],d[51]).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],a})},function(a){return d[54]=(d[46].push(d[52]),d[46])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[51]=c.createArray(),d[52]=c.i64.of_int32(d[46].length),c.i64.gt(d[52],c.i64.cast([0,0]))?c.loopAsync(d[52],function(a){return d[54]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[46],d[54]).then(function(a){return a=a,d[55]=a[0],d[56]=a[1],a})},function(a){return d[57]=(d[51].push(c.i64.to_string(d[55])),d[51])}])}):c.resolve()},function(a){return d[53]=d[51].join(","),d[48]=d[53]}])},function(a){return d[46].some(function(a){return c.i64.eq(d[29],a)})?d[49]=d[29]:d[49]=void 0,c.i64.neq(d[49],void 0)?d[50]=d[49]:d[50]=void 0,d[36]=d[50]}])},function(e){return c.i64.neq(d[36],void 0)?d[37]=d[36]:d[37]=c.i64.cast([0,0]),c.i64.neq(d[28],void 0)?d[38]=d[28]:d[38]=c.i64.cast([0,1]),c.storedProcedure(b("LSLoadThreadPkFromThreadId"),a[0]).then(function(a){return a=a,d[39]=a[0],d[40]=a[1],a})},function(e){return c.i64.neq(d[39],void 0)?d[11]?c.sequence([function(a){return d[41]=c.i64.random(),d[42]=void 0==null?c.i64.to_string(d[41]):void 0,d[42]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,679677570]),d[42],!0,void 0):c.resolve()},function(a){return d[42]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,679677570]),d[42],"issue_task"):c.resolve()},function(a){return d[42]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,679677570]),d[42],"request_type","ENCRYPTED_BACKUPS_MESSAGE_SURROUNDING_QUERY"):c.resolve()},function(e){return c.i64.eq(d[38],c.i64.cast([0,3]))?d[43]=c.i64.cast([0,4]):d[43]=c.i64.cast([0,0]),d[44]=new c.Map(),d[44].set("act_thread_id",a[0]),d[44].set("request_id",d[42]),d[44].set("tam_thread_subtype",d[43]),d[44].set("source",a[6]),c.nativeOperation(b("LSBase64Encode.nop"),d[23]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[22]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[47]=new c.Map(),d[47].set("ocmf_client_state_blob",d[45]==null?"":d[45]),d[47].set("mailbox_root_key",d[46]==null?"":d[46]),d[48]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[59]=(d[48].push(a.epochId),d[48])})},function(a){return d[57]="Queried locally available epochs. Count: ",d[49]=c.i64.of_int32(d[48].length),d[58]=c.i64.to_string(d[49]),d[50]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[50],d[57],d[50],d[58]].join("")),c.resolve()},function(e){return d[51]=new c.Map(),d[51].set("device_id",d[27]),d[51].set("raw_tokens",d[47]),d[51].set("locally_available_epochs",d[48]),d[52]=new c.Map(),d[52].set("reference_timestamp",a[2]),d[52].set("server_thread_key",void 0),d[52].set("device_context",d[51]),d[52].set("source",a[6]),d[53]=new c.Map(),d[53].set("restore_context",d[44]),d[53].set("success",d[52]),d[54]=d[53].get("restore_context"),d[55]=d[54].get("act_thread_id"),d[56]=c.toJSON(d[53]),c.storedProcedure(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[55]].join(""),c.i64.cast([0,50031]),d[56],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.i64.gt(a[1],c.i64.cast([0,0]))?c.sequence([function(e){return a[4]!==void 0?c.sequence([function(e){return[c.i64.cast([0,21]),c.i64.cast([0,83]),c.i64.cast([0,87])].some(function(b){return c.i64.eq(a[6],b)})?c.resolve(d[59]=a[4]):c.sequence([function(a){return d[60]=c.i64.random(),d[61]=void 0==null?c.i64.to_string(d[60]):void 0,d[61]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,679677570]),d[61],!0,void 0):c.resolve()},function(a){return d[61]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,679677570]),d[61],"issue_task"):c.resolve()},function(a){return d[61]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,679677570]),d[61],"request_type","ENCRYPTED_BACKUPS_MESSAGE_RANGE_QUERY"):c.resolve()},function(a){return d[59]=d[61]}])},function(a){return d[41]=d[59]}]):c.sequence([function(a){return d[59]=c.i64.random(),d[60]=void 0==null?c.i64.to_string(d[59]):void 0,d[60]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,679677570]),d[60],!0,void 0):c.resolve()},function(a){return d[60]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,679677570]),d[60],"issue_task"):c.resolve()},function(a){return d[60]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,679677570]),d[60],"request_type","ENCRYPTED_BACKUPS_MESSAGE_RANGE_QUERY"):c.resolve()},function(a){return d[41]=d[60]}])},function(e){return c.i64.eq(d[38],c.i64.cast([0,3]))?d[42]=c.i64.cast([0,4]):d[42]=c.i64.cast([0,0]),a[7]===!0?d[43]=!0:d[43]=!1,d[44]=new c.Map(),d[44].set("act_thread_id",a[0]),d[44].set("request_id",d[41]),d[44].set("tam_thread_subtype",d[42]),d[44].set("reference_id",void 0),d[44].set("source",a[6]),c.nativeOperation(b("LSBase64Encode.nop"),d[23]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[22]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[47]=new c.Map(),d[47].set("ocmf_client_state_blob",d[45]==null?"":d[45]),d[47].set("mailbox_root_key",d[46]==null?"":d[46]),d[48]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[59]=(d[48].push(a.epochId),d[48])})},function(a){return d[57]="Queried locally available epochs. Count: ",d[49]=c.i64.of_int32(d[48].length),d[58]=c.i64.to_string(d[49]),d[50]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[50],d[57],d[50],d[58]].join("")),c.resolve()},function(e){return d[51]=new c.Map(),d[51].set("device_id",d[27]),d[51].set("raw_tokens",d[47]),d[51].set("locally_available_epochs",d[48]),d[52]=new c.Map(),d[52].set("reference_timestamp",a[2]),d[52].set("direction",c.i64.cast([0,1])),d[52].set("server_thread_key",void 0),d[52].set("device_context",d[51]),d[52].set("source",a[6]),d[52].set("include_offset",d[43]),d[53]=new c.Map(),d[53].set("restore_context",d[44]),d[53].set("success",d[52]),d[53].set("queue_name",void 0),d[54]=d[53].get("queue_name"),d[54]!==void 0?d[55]=d[54]:(d[59]=d[53].get("restore_context"),d[60]=d[59].get("act_thread_id"),d[55]=["encrypted_backups_restore",":",d[60]].join("")),d[56]=c.toJSON(d[53]),c.storedProcedure(b("LSIssueNewTask"),d[55],c.i64.cast([0,50030]),d[56],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.sequence([function(e){return a[4]!==void 0?c.sequence([function(e){return[c.i64.cast([0,21]),c.i64.cast([0,83]),c.i64.cast([0,87])].some(function(b){return c.i64.eq(a[6],b)})?c.resolve(d[59]=a[4]):c.sequence([function(a){return d[60]=c.i64.random(),d[61]=void 0==null?c.i64.to_string(d[60]):void 0,d[61]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,679677570]),d[61],!0,void 0):c.resolve()},function(a){return d[61]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,679677570]),d[61],"issue_task"):c.resolve()},function(a){return d[61]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,679677570]),d[61],"request_type","ENCRYPTED_BACKUPS_MESSAGE_RANGE_QUERY"):c.resolve()},function(a){return d[59]=d[61]}])},function(a){return d[41]=d[59]}]):c.sequence([function(a){return d[59]=c.i64.random(),d[60]=void 0==null?c.i64.to_string(d[59]):void 0,d[60]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,679677570]),d[60],!0,void 0):c.resolve()},function(a){return d[60]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,679677570]),d[60],"issue_task"):c.resolve()},function(a){return d[60]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,679677570]),d[60],"request_type","ENCRYPTED_BACKUPS_MESSAGE_RANGE_QUERY"):c.resolve()},function(a){return d[41]=d[60]}])},function(e){return c.i64.eq(d[38],c.i64.cast([0,3]))?d[42]=c.i64.cast([0,4]):d[42]=c.i64.cast([0,0]),a[7]===!0?d[43]=!0:d[43]=!1,d[44]=new c.Map(),d[44].set("act_thread_id",a[0]),d[44].set("request_id",d[41]),d[44].set("tam_thread_subtype",d[42]),d[44].set("reference_id",void 0),d[44].set("source",a[6]),c.nativeOperation(b("LSBase64Encode.nop"),d[23]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[22]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[47]=new c.Map(),d[47].set("ocmf_client_state_blob",d[45]==null?"":d[45]),d[47].set("mailbox_root_key",d[46]==null?"":d[46]),d[48]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[59]=(d[48].push(a.epochId),d[48])})},function(a){return d[57]="Queried locally available epochs. Count: ",d[49]=c.i64.of_int32(d[48].length),d[58]=c.i64.to_string(d[49]),d[50]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[50],d[57],d[50],d[58]].join("")),c.resolve()},function(e){return d[51]=new c.Map(),d[51].set("device_id",d[27]),d[51].set("raw_tokens",d[47]),d[51].set("locally_available_epochs",d[48]),d[52]=new c.Map(),d[52].set("reference_timestamp",a[2]),d[52].set("direction",c.i64.cast([0,2])),d[52].set("server_thread_key",void 0),d[52].set("device_context",d[51]),d[52].set("source",a[6]),d[52].set("include_offset",d[43]),d[53]=new c.Map(),d[53].set("restore_context",d[44]),d[53].set("success",d[52]),d[53].set("queue_name",void 0),d[54]=d[53].get("queue_name"),d[54]!==void 0?d[55]=d[54]:(d[59]=d[53].get("restore_context"),d[60]=d[59].get("act_thread_id"),d[55]=["encrypted_backups_restore",":",d[60]].join("")),d[56]=c.toJSON(d[53]),c.storedProcedure(b("LSIssueNewTask"),d[55],c.i64.cast([0,50030]),d[56],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.sequence([function(e){return d[11]?(d[43]=new c.Map(),d[43].set("error_code",c.i64.cast([0,100])),d[43].set("error_message",""),d[43].set("stored_procedure","issueMessageRangeQueryTask"),d[44]=new c.Map(),d[44].set("act_thread_id",a[0]),d[45]=new c.Map(),d[45].set("restore_context",d[44]),d[45].set("failure",d[43]),d[46]=d[45].get("restore_context"),d[47]=d[46].get("act_thread_id"),d[48]=c.toJSON(d[45]),c.storedProcedure(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[47]].join(""),c.i64.cast([0,50031]),d[48],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[55]=new c.Map(),d[55].set("error_msg","Expected a nonempty query result"),d[55].set("code",c.i64.cast([0,3])),d[55].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[56]=c.createArray(),d[57]=(d[56].push(d[55]),d[56]),e=[void 0,d[56]],d[43]=e[0],d[44]=e[1]):(b=a.item,d[55]=new c.Map(),d[55].set("backup_id",b.backupId),d[55].set("device_public_key_blob",b.devicePublicKeyBlob),d[55].set("device_private_key_blob",b.devicePrivateKeyBlob),d[55].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[55].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[55].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[55].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[55].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[55].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[55].set("orf_client_state_v2_blob",void 0),d[55].set("orf_v2_authority_level",void 0),d[55].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[55].set("device_id",b.deviceId),d[55].set("backup_tenancy",b.backupTenancy),d[55].set("encryption_version",b.encryptionVersion),d[55].set("revision_version",b.revisionVersion),d[55].set("initialize_restore_result",void 0),d[55].set("device_creation_timestamp_sec",void 0),d[55].set("authority_level",b.authorityLevel),e=[d[55],void 0],d[43]=e[0],d[44]=e[1])})},function(a){return d[46]=new c.Map(),d[46].set("value",d[43]),d[46].set("errors",d[44]),d[47]=d[46].get("value"),d[47]!==void 0?c.sequence([function(a){return d[55]=d[47].get("backup_id"),d[56]=d[47].get("device_public_key_blob"),d[57]=d[47].get("device_private_key_blob"),d[58]=d[47].get("epoch_storage_public_key_blob"),d[59]=d[47].get("epoch_storage_private_key_blob"),d[60]=d[47].get("epoch_auth_public_key_blob"),d[61]=d[47].get("epoch_auth_private_key_blob"),d[62]=d[47].get("mailbox_root_key_blob"),d[63]=d[47].get("ocmf_client_state_blob"),d[64]=d[47].get("orf_client_state_v2_blob"),d[65]=d[47].get("orf_v2_authority_level"),d[66]=d[47].get("oblivious_validation_token_blob"),d[67]=d[47].get("device_id"),d[68]=d[47].get("backup_tenancy"),d[69]=d[47].get("encryption_version"),d[70]=d[47].get("revision_version"),d[71]=d[47].get("initialize_restore_result"),d[72]=d[47].get("device_creation_timestamp_sec"),d[73]=d[47].get("authority_level"),c.i64.neq(d[67],void 0)?c.sequence([function(a){return d[75]=void 0,c.i64.neq(d[75],void 0)?c.resolve(d[76]=d[75]):c.sequence([function(a){return d[79]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[80]=a[0],a})},function(a){return d[80]?d[89]=(d[79].push(c.i64.cast([0,0])),d[79]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[81]?d[89]=(d[79].push(c.i64.cast([0,2])),d[79]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[82]=a[0],a})},function(a){return d[82]?d[89]=(d[79].push(c.i64.cast([0,3])),d[79]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[83]=a[0],a})},function(a){return d[83]?d[89]=(d[79].push(c.i64.cast([0,4])),d[79]):0,d[84]=c.createArray(),d[85]=c.i64.of_int32(d[79].length),c.i64.gt(d[85],c.i64.cast([0,0]))?c.loopAsync(d[85],function(a){return d[89]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[79],d[89]).then(function(a){return a=a,d[90]=a[0],d[91]=a[1],a})},function(a){return d[92]=(d[84].push(d[90]),d[84])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[89]=c.createArray(),d[90]=c.i64.of_int32(d[84].length),c.i64.gt(d[90],c.i64.cast([0,0]))?c.loopAsync(d[90],function(a){return d[92]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[84],d[92]).then(function(a){return a=a,d[93]=a[0],d[94]=a[1],a})},function(a){return d[95]=(d[89].push(c.i64.to_string(d[93])),d[89])}])}):c.resolve()},function(a){return d[91]=d[89].join(","),d[86]=d[91]}])},function(a){return d[84].some(function(a){return c.i64.eq(d[69],a)})?d[87]=d[69]:d[87]=void 0,c.i64.neq(d[87],void 0)?d[88]=d[87]:d[88]=void 0,d[76]=d[88]}])},function(a){return c.i64.neq(d[76],void 0)?d[77]=d[76]:d[77]=c.i64.cast([0,0]),c.i64.neq(d[68],void 0)?d[78]=d[68]:d[78]=c.i64.cast([0,1]),d[74]=d[67]}]):c.resolve(d[74]=void 0)},function(a){return d[48]=d[74]}]):c.resolve((d[55]=d[46].get("errors"),d[56]=d[46].get("errors"),d[48]=void 0))},function(e){return d[49]=new c.Map(),d[49].set("error_code",c.i64.cast([0,100])),d[49].set("error_message",void 0==null?"":void 0),d[49].set("stored_procedure","issueMessageRangeQueryTask"),d[50]=new c.Map(),d[50].set("act_thread_id",a[0]),d[50].set("source",a[6]),d[50].set("restore_operation_type",c.i64.cast([0,2])),d[50].set("request_id",a[4]),d[50].set("device_id",d[48]),d[51]=new c.Map(),d[51].set("restore_context",d[50]),d[51].set("failure",d[49]),d[52]=d[51].get("queue_name"),d[52]!==void 0?d[53]=d[52]:(d[55]=d[51].get("restore_context"),d[56]=d[55].get("act_thread_id"),d[53]=["encrypted_backups_restore",":",d[56]].join("")),d[54]=c.toJSON(d[51]),c.storedProcedure(b("LSIssueNewTask"),d[53],c.i64.cast([0,50030]),d[54],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(e){return d[42]="threak pk not found for jid",d[42]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",d[42]].join("")),d[43]=c.createArray(),a[4]!==void 0?d[44]=(d[43].push(a[4]),d[43]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",d[42],d[43],c.i64.cast([0,3]))):c.resolve()},function(a){return d[11]?d[41]=c.i64.cast([0,5]):d[41]=c.i64.cast([0,2])}])},function(a){return d[34]=!0}]):c.sequence([function(e){return d[11]?(d[37]=new c.Map(),d[37].set("error_code",c.i64.cast([0,1])),d[37].set("error_message",""),d[37].set("stored_procedure","issueMessageRangeQueryTask"),d[38]=new c.Map(),d[38].set("act_thread_id",a[0]),d[39]=new c.Map(),d[39].set("restore_context",d[38]),d[39].set("failure",d[37]),d[40]=d[39].get("restore_context"),d[41]=d[40].get("act_thread_id"),d[42]=c.toJSON(d[39]),c.storedProcedure(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[41]].join(""),c.i64.cast([0,50031]),d[42],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[49]=new c.Map(),d[49].set("error_msg","Expected a nonempty query result"),d[49].set("code",c.i64.cast([0,3])),d[49].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[50]=c.createArray(),d[51]=(d[50].push(d[49]),d[50]),e=[void 0,d[50]],d[37]=e[0],d[38]=e[1]):(b=a.item,d[49]=new c.Map(),d[49].set("backup_id",b.backupId),d[49].set("device_public_key_blob",b.devicePublicKeyBlob),d[49].set("device_private_key_blob",b.devicePrivateKeyBlob),d[49].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[49].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[49].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[49].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[49].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[49].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[49].set("orf_client_state_v2_blob",void 0),d[49].set("orf_v2_authority_level",void 0),d[49].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[49].set("device_id",b.deviceId),d[49].set("backup_tenancy",b.backupTenancy),d[49].set("encryption_version",b.encryptionVersion),d[49].set("revision_version",b.revisionVersion),d[49].set("initialize_restore_result",void 0),d[49].set("device_creation_timestamp_sec",void 0),d[49].set("authority_level",b.authorityLevel),e=[d[49],void 0],d[37]=e[0],d[38]=e[1])})},function(a){return d[40]=new c.Map(),d[40].set("value",d[37]),d[40].set("errors",d[38]),d[41]=d[40].get("value"),d[41]!==void 0?c.sequence([function(a){return d[49]=d[41].get("backup_id"),d[50]=d[41].get("device_public_key_blob"),d[51]=d[41].get("device_private_key_blob"),d[52]=d[41].get("epoch_storage_public_key_blob"),d[53]=d[41].get("epoch_storage_private_key_blob"),d[54]=d[41].get("epoch_auth_public_key_blob"),d[55]=d[41].get("epoch_auth_private_key_blob"),d[56]=d[41].get("mailbox_root_key_blob"),d[57]=d[41].get("ocmf_client_state_blob"),d[58]=d[41].get("orf_client_state_v2_blob"),d[59]=d[41].get("orf_v2_authority_level"),d[60]=d[41].get("oblivious_validation_token_blob"),d[61]=d[41].get("device_id"),d[62]=d[41].get("backup_tenancy"),d[63]=d[41].get("encryption_version"),d[64]=d[41].get("revision_version"),d[65]=d[41].get("initialize_restore_result"),d[66]=d[41].get("device_creation_timestamp_sec"),d[67]=d[41].get("authority_level"),c.i64.neq(d[61],void 0)?c.sequence([function(a){return d[69]=void 0,c.i64.neq(d[69],void 0)?c.resolve(d[70]=d[69]):c.sequence([function(a){return d[73]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[74]=a[0],a})},function(a){return d[74]?d[83]=(d[73].push(c.i64.cast([0,0])),d[73]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[75]=a[0],a})},function(a){return d[75]?d[83]=(d[73].push(c.i64.cast([0,2])),d[73]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[76]=a[0],a})},function(a){return d[76]?d[83]=(d[73].push(c.i64.cast([0,3])),d[73]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[77]=a[0],a})},function(a){return d[77]?d[83]=(d[73].push(c.i64.cast([0,4])),d[73]):0,d[78]=c.createArray(),d[79]=c.i64.of_int32(d[73].length),c.i64.gt(d[79],c.i64.cast([0,0]))?c.loopAsync(d[79],function(a){return d[83]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[73],d[83]).then(function(a){return a=a,d[84]=a[0],d[85]=a[1],a})},function(a){return d[86]=(d[78].push(d[84]),d[78])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[83]=c.createArray(),d[84]=c.i64.of_int32(d[78].length),c.i64.gt(d[84],c.i64.cast([0,0]))?c.loopAsync(d[84],function(a){return d[86]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[78],d[86]).then(function(a){return a=a,d[87]=a[0],d[88]=a[1],a})},function(a){return d[89]=(d[83].push(c.i64.to_string(d[87])),d[83])}])}):c.resolve()},function(a){return d[85]=d[83].join(","),d[80]=d[85]}])},function(a){return d[78].some(function(a){return c.i64.eq(d[63],a)})?d[81]=d[63]:d[81]=void 0,c.i64.neq(d[81],void 0)?d[82]=d[81]:d[82]=void 0,d[70]=d[82]}])},function(a){return c.i64.neq(d[70],void 0)?d[71]=d[70]:d[71]=c.i64.cast([0,0]),c.i64.neq(d[62],void 0)?d[72]=d[62]:d[72]=c.i64.cast([0,1]),d[68]=d[61]}]):c.resolve(d[68]=void 0)},function(a){return d[42]=d[68]}]):c.resolve((d[49]=d[40].get("errors"),d[50]=d[40].get("errors"),d[42]=void 0))},function(e){return d[43]=new c.Map(),d[43].set("error_code",c.i64.cast([0,1])),d[43].set("error_message",void 0==null?"":void 0),d[43].set("stored_procedure","issueMessageRangeQueryTask"),d[44]=new c.Map(),d[44].set("act_thread_id",a[0]),d[44].set("source",a[6]),d[44].set("restore_operation_type",c.i64.cast([0,2])),d[44].set("request_id",a[4]),d[44].set("device_id",d[42]),d[45]=new c.Map(),d[45].set("restore_context",d[44]),d[45].set("failure",d[43]),d[46]=d[45].get("queue_name"),d[46]!==void 0?d[47]=d[46]:(d[49]=d[45].get("restore_context"),d[50]=d[49].get("act_thread_id"),d[47]=["encrypted_backups_restore",":",d[50]].join("")),d[48]=c.toJSON(d[45]),c.storedProcedure(b("LSIssueNewTask"),d[47],c.i64.cast([0,50030]),d[48],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(e){return d[36]="backup not found",d[36]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",d[36]].join("")),d[37]=c.createArray(),a[4]!==void 0?d[38]=(d[37].push(a[4]),d[37]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",d[36],d[37],c.i64.cast([0,3]))):c.resolve()},function(a){return d[11]?d[35]=c.i64.cast([0,5]):d[35]=c.i64.cast([0,2]),d[34]=!1}])},function(a){return d[7]=d[34]}]):c.sequence([function(e){return d[15]=d[5].get("errors"),d[16]=d[5].get("errors"),d[11]?(d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,1])),d[19].set("error_message",""),d[19].set("stored_procedure","issueMessageRangeQueryTask"),d[20]=new c.Map(),d[20].set("act_thread_id",a[0]),d[21]=new c.Map(),d[21].set("restore_context",d[20]),d[21].set("failure",d[19]),d[22]=d[21].get("restore_context"),d[23]=d[22].get("act_thread_id"),d[24]=c.toJSON(d[21]),c.storedProcedure(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[23]].join(""),c.i64.cast([0,50031]),d[24],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[31]=new c.Map(),d[31].set("error_msg","Expected a nonempty query result"),d[31].set("code",c.i64.cast([0,3])),d[31].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[32]=c.createArray(),d[33]=(d[32].push(d[31]),d[32]),e=[void 0,d[32]],d[19]=e[0],d[20]=e[1]):(b=a.item,d[31]=new c.Map(),d[31].set("backup_id",b.backupId),d[31].set("device_public_key_blob",b.devicePublicKeyBlob),d[31].set("device_private_key_blob",b.devicePrivateKeyBlob),d[31].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[31].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[31].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[31].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[31].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[31].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[31].set("orf_client_state_v2_blob",void 0),d[31].set("orf_v2_authority_level",void 0),d[31].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[31].set("device_id",b.deviceId),d[31].set("backup_tenancy",b.backupTenancy),d[31].set("encryption_version",b.encryptionVersion),d[31].set("revision_version",b.revisionVersion),d[31].set("initialize_restore_result",void 0),d[31].set("device_creation_timestamp_sec",void 0),d[31].set("authority_level",b.authorityLevel),e=[d[31],void 0],d[19]=e[0],d[20]=e[1])})},function(a){return d[22]=new c.Map(),d[22].set("value",d[19]),d[22].set("errors",d[20]),d[23]=d[22].get("value"),d[23]!==void 0?c.sequence([function(a){return d[31]=d[23].get("backup_id"),d[32]=d[23].get("device_public_key_blob"),d[33]=d[23].get("device_private_key_blob"),d[34]=d[23].get("epoch_storage_public_key_blob"),d[35]=d[23].get("epoch_storage_private_key_blob"),d[36]=d[23].get("epoch_auth_public_key_blob"),d[37]=d[23].get("epoch_auth_private_key_blob"),d[38]=d[23].get("mailbox_root_key_blob"),d[39]=d[23].get("ocmf_client_state_blob"),d[40]=d[23].get("orf_client_state_v2_blob"),d[41]=d[23].get("orf_v2_authority_level"),d[42]=d[23].get("oblivious_validation_token_blob"),d[43]=d[23].get("device_id"),d[44]=d[23].get("backup_tenancy"),d[45]=d[23].get("encryption_version"),d[46]=d[23].get("revision_version"),d[47]=d[23].get("initialize_restore_result"),d[48]=d[23].get("device_creation_timestamp_sec"),d[49]=d[23].get("authority_level"),c.i64.neq(d[43],void 0)?c.sequence([function(a){return d[51]=void 0,c.i64.neq(d[51],void 0)?c.resolve(d[52]=d[51]):c.sequence([function(a){return d[55]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[56]=a[0],a})},function(a){return d[56]?d[65]=(d[55].push(c.i64.cast([0,0])),d[55]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[57]=a[0],a})},function(a){return d[57]?d[65]=(d[55].push(c.i64.cast([0,2])),d[55]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[58]=a[0],a})},function(a){return d[58]?d[65]=(d[55].push(c.i64.cast([0,3])),d[55]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[59]=a[0],a})},function(a){return d[59]?d[65]=(d[55].push(c.i64.cast([0,4])),d[55]):0,d[60]=c.createArray(),d[61]=c.i64.of_int32(d[55].length),c.i64.gt(d[61],c.i64.cast([0,0]))?c.loopAsync(d[61],function(a){return d[65]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[55],d[65]).then(function(a){return a=a,d[66]=a[0],d[67]=a[1],a})},function(a){return d[68]=(d[60].push(d[66]),d[60])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[65]=c.createArray(),d[66]=c.i64.of_int32(d[60].length),c.i64.gt(d[66],c.i64.cast([0,0]))?c.loopAsync(d[66],function(a){return d[68]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[60],d[68]).then(function(a){return a=a,d[69]=a[0],d[70]=a[1],a})},function(a){return d[71]=(d[65].push(c.i64.to_string(d[69])),d[65])}])}):c.resolve()},function(a){return d[67]=d[65].join(","),d[62]=d[67]}])},function(a){return d[60].some(function(a){return c.i64.eq(d[45],a)})?d[63]=d[45]:d[63]=void 0,c.i64.neq(d[63],void 0)?d[64]=d[63]:d[64]=void 0,d[52]=d[64]}])},function(a){return c.i64.neq(d[52],void 0)?d[53]=d[52]:d[53]=c.i64.cast([0,0]),c.i64.neq(d[44],void 0)?d[54]=d[44]:d[54]=c.i64.cast([0,1]),d[50]=d[43]}]):c.resolve(d[50]=void 0)},function(a){return d[24]=d[50]}]):c.resolve((d[31]=d[22].get("errors"),d[32]=d[22].get("errors"),d[24]=void 0))},function(e){return d[25]=new c.Map(),d[25].set("error_code",c.i64.cast([0,1])),d[25].set("error_message",void 0==null?"":void 0),d[25].set("stored_procedure","issueMessageRangeQueryTask"),d[26]=new c.Map(),d[26].set("act_thread_id",a[0]),d[26].set("source",a[6]),d[26].set("restore_operation_type",c.i64.cast([0,2])),d[26].set("request_id",a[4]),d[26].set("device_id",d[24]),d[27]=new c.Map(),d[27].set("restore_context",d[26]),d[27].set("failure",d[25]),d[28]=d[27].get("queue_name"),d[28]!==void 0?d[29]=d[28]:(d[31]=d[27].get("restore_context"),d[32]=d[31].get("act_thread_id"),d[29]=["encrypted_backups_restore",":",d[32]].join("")),d[30]=c.toJSON(d[27]),c.storedProcedure(b("LSIssueNewTask"),d[29],c.i64.cast([0,50030]),d[30],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(e){return d[18]="backup not found",d[18]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",d[18]].join("")),d[19]=c.createArray(),a[4]!==void 0?d[20]=(d[19].push(a[4]),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",d[18],d[19],c.i64.cast([0,3]))):c.resolve()},function(a){return d[11]?d[17]=c.i64.cast([0,5]):d[17]=c.i64.cast([0,2]),d[7]=!1}])},function(a){return d[8]=c.i64.of_float(Date.now()),d[9]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[8],d[0])),d[14]=" ms",d[10]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageRangeQueryTask] ",d[10],d[12],d[10],d[13],d[10],d[14]].join("")),c.i64.eq(c.i64.mod_(d[9],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"issueMessageRangeQueryTask",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSIssueMessageRangeQueryTaskStoredProcedure",["LSIssueMessageRangeQueryTask","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSIssueMessageRangeQueryTask"),e.threadId,e.numMessages,e.startSortKey,e.isPointQuery,e.traceId,e.newerNumMessages,e.source,e.includeOffset);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MWChatEncryptedBackupsLogging",["MWEBODSCategory","MWEBODSEntityKey.enum","ODS","QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){var b=a.cancelEndPoint,d=a.event,e=a.instanceKey;a=a.source;a!=null&&c("QPLUserFlow").addAnnotations(d,{string:{source:a}},{instanceKey:e});c("QPLUserFlow").addPoint(d,"cancel",{instanceKey:e});c("QPLUserFlow").addAnnotations(d,{string:{cancel_end_point:b}},{instanceKey:e});c("QPLUserFlow").endCancel(d,{instanceKey:e})}function a(a){var b=a.event,d=a.instanceKey,e=a.onClose;a=a.source;a!=null&&c("QPLUserFlow").addAnnotations(b,{string:{source:a}},{instanceKey:d});i({cancelEndPoint:"dialog_x_button",event:b,instanceKey:d});e()}function b(a){var b=a.annotations,e=a.event,f=a.instanceKey;a=a.odsEntityName;c("QPLUserFlow").addPoint(e,"success",{instanceKey:f});c("QPLUserFlow").endSuccess(e,{annotations:b,instanceKey:f});a&&(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),a,c("MWEBODSEntityKey.enum").SUCCESS)}function e(a){var b=a.annotations,e=a.errorName,f=a.event,g=a.instanceKey,i=a.odsEntityKey;a=a.odsEntityName;c("QPLUserFlow").addPoint(f,"failure",{instanceKey:g});c("QPLUserFlow").endFailure(f,e,{annotations:b,instanceKey:g});a&&(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),a,i!=null?i:c("MWEBODSEntityKey.enum").FAIL)}g.cancelFlow=i;g.closeDialogCancelFlow=a;g.endSuccess=b;g.endFailure=e}),98);
__d("LSProcessBackupIds",["LSAppendDataTraceAddon","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsProcessBackupIdsStoredProcedure] Beginning execution."),c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1487]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[12]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[12]].join("")),d[11]=c.createArray(),void 0!==void 0?d[13]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[12],d[11],c.i64.cast([0,3]))):c.resolve()}])},function(e){return c.db.table(172).fetch([[[c.i64.cast([0,1])]]]).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1488]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[12]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[12]].join("")),d[11]=c.createArray(),void 0!==void 0?d[13]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[12],d[11],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[1]=c.i64.cast([0,0])}]):(f=e.item,c.sequence([function(e){return d[11]=f.backupId,d[10]=f.authorityLevel,c.i64.eq(d[10],c.i64.cast([0,20]))?c.resolve(d[9]=c.i64.cast([0,1])):c.sequence([function(e){return c.i64.eq(d[10],c.i64.cast([0,80]))?c.sequence([function(e){return c.i64.eq(d[11],void 0)?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1492]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[14]=a[0],a})},function(a){return d[14]?d[15]=!0:d[15]=!1,d[15]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[17]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[17]].join("")),d[16]=c.createArray(),void 0!==void 0?d[18]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[17],d[16],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[13]=c.i64.cast([0,2])}]):c.sequence([function(e){return c.i64.eq(d[11],c.i64.cast([-1,4294967295]))?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1489]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[15]=a[0],a})},function(a){return d[15]?d[16]=!0:d[16]=!1,d[16]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[18]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[18]].join("")),d[17]=c.createArray(),void 0!==void 0?d[19]=(d[17].push(void 0),d[17]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[18],d[17],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[14]=c.i64.cast([-1,4294967295])}]):c.sequence([function(e){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.backupId,d[11])&&c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(e,f){f=e.done;e=e.value;return f?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1490]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[17]?d[18]=!0:d[18]=!1,d[18]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[20]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[20]].join("")),d[19]=c.createArray(),void 0!==void 0?d[21]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[20],d[19],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[15]=c.i64.cast([0,4])}]):(e.item,c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1491]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[17]?d[18]=!0:d[18]=!1,d[18]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[20]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[20]].join("")),d[19]=c.createArray(),void 0!==void 0?d[21]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[20],d[19],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[15]=c.i64.cast([0,3])}]))})},function(a){return d[14]=d[15]}])},function(a){return d[13]=d[14]}])},function(a){return d[12]=d[13]}]):c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1489]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[13]=a[0],a})},function(a){return d[13]?d[14]=!0:d[14]=!1,d[14]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[16]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[16]].join("")),d[15]=c.createArray(),void 0!==void 0?d[17]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[16],d[15],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[12]=c.i64.cast([-1,4294967295])}])},function(a){return d[9]=d[12]}])},function(a){return d[1]=d[9]}]))})},function(a){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.random(),d[6]="Finishing execution. Execution time: ",d[7]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsProcessBackupIdsStoredProcedure] ",d[5],d[6],d[5],d[7],d[5],d[8]].join("")),c.i64.eq(c.i64.mod_(d[4],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[9]=",",d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsProcessBackupIdsStoredProcedure",[d[6],d[9],d[7],d[9],d[8]].join(""),d[10],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[1]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsProcessBackupIdsStoredProcedure";a.__tables__=["encrypted_backups","secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSProcessBackupIdsStoredProcedure",["LSProcessBackupIds","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e===void 0&&(e={});a=a.storedProcedure(c("LSProcessBackupIds"),e.traceId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MWEncryptedBackupsProcessBackupIdsDEPRECATED",["FBLogger","LSFactory","LSIntEnum","LSProcessBackupIdsStoredProcedure","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","Promise","QPLEvent","QPLUserFlow","ReQL","WebSession","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("gkx")("23914");function l(a){if(k){var e=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").getActiveFlowIDs().includes((i||(i=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent))||c("QPLUserFlow").start(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:e,processBackupIdsVersion:"msys",sessionTabId:d("WebSession").getId()}}});return a.runInTransaction(function(a){return c("LSProcessBackupIdsStoredProcedure")(c("LSFactory")(a))},"readwrite",void 0,void 0,f.id+":53").then(function(a){a=(j||(j=d("LSIntEnum"))).unwrapIntEnum(a[0]);c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent,"EB_STATE_"+a+".");d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent});return a})}else return(h||(h=b("Promise"))).resolve(0)}function a(a,b){return a.tables.encrypted_backups.subscribe(function(){c("promiseDone")(d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.encrypted_backups)),function(d){if(d!=null){c("promiseDone")(l(a),b,function(a){c("FBLogger")("wmi_eb").catching(a).info("Error in db transaction")});return}})})}g.processBackupIdsStoredProcedure=l;g.subscribeToEncryptedBackupsRow=a}),98);
__d("MWEncryptedBackupsListenForChangesToBackupStateInitPath",["EBAPIWorkerCheck","EBSMAPI","I64","LSAuthorityLevel","LSEncryptedBackupsBackupTenancy","LSFactory","LSFetchBackupIdsStoredProcedure","LSIntEnum","LSIssueMessageRangeQueryTaskStoredProcedure","LSMEBTaskCreationSource","MAWEBRestoreTrackingUtils","MAWMainTraceUtils","MAWOfflineQueueStatus","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsProcessBackupIdsDEPRECATED","Promise","QPLEvent","QPLUserFlow","ReQL","WAJids","WATagsLogger","WebSession","gkx","isInstamadilloEB","promiseDone","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=c("gkx")("23961"),n=c("qex")._("121")===!0;function a(a){function b(){c("promiseDone")(c("EBSMAPI").fetchBackupIds("MWEncryptedBackupsListenForChangesToBackupStateInitPath"),function(){return p(a)})}function e(){var b=d("ReQL").fromTableAscending(a.tables.encrypted_backups),e=b.subscribe(function(a,b){if(b.operation==="delete"||!(j||(j=d("I64"))).equal(b.value.authorityLevel,(k||(k=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE)))return;e();c("QPLUserFlow").getActiveFlowIDs().includes((l||(l=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent))&&d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent})});b=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").getActiveFlowIDs().includes((l||(l=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent))||c("QPLUserFlow").start(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:b,fetchBackupIdsVersion:"msys",sessionTabId:d("WebSession").getId()}}});c("promiseDone")(a.runInTransaction(function(a){return c("LSFetchBackupIdsStoredProcedure")(c("LSFactory")(a),{backupTenancy:(k||(k=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION),isUiBlocking:!1})},"readwrite",void 0,void 0,f.id+":103"),function(){return p(a)})}b=b;(n||c("isInstamadilloEB")())&&(b=e,b());e=d("ReQL").fromTableAscending(a.tables.encrypted_backups_status_trigger);return e.subscribe(b)}function o(a){return a.runInTransaction(function(a){var e=d("MAWOfflineQueueStatus").getAllThreadsWithOfflineQueueIncomplete();return(i||(i=b("Promise"))).all(e.map(function(b){var e=d("WAJids").threadIdForChatJid(b),f=d("MAWMainTraceUtils").createTraceId();e={isPointQuery:!1,newerNumMessages:(j||(j=d("I64"))).zero,numMessages:j.of_int32(20),source:(k||(k=d("LSIntEnum"))).ofNumber(c("LSMEBTaskCreationSource").UNKNOWN),threadId:e,traceId:f};d("WATagsLogger").TAGS(["labyrinth_web","eb_prefetch",f]).LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[EB Prefetch] Issuing message range query for thread "," with params ",""])),b,JSON.stringify(e));d("MAWEBRestoreTrackingUtils").markEBRestoreFrontloaded(c("LSMEBTaskCreationSource").UNKNOWN,f,!1);return c("LSIssueMessageRangeQueryTaskStoredProcedure")(c("LSFactory")(a),e)}))},"readonly",void 0,void 0,f.id+":135")}function p(a){var b=d("MAWOfflineQueueStatus").isOfflineQueueComplete();m&&!b&&c("promiseDone")(d("MWEncryptedBackupsProcessBackupIdsDEPRECATED").processBackupIdsStoredProcedure(a),function(b){if(d("EBAPIWorkerCheck").runningInWorker())return;b===3&&c("promiseDone")(o(a))})}e={listenForChangesToBackupState:a,preloadEBData:p};g["default"]=e}),98);
__d("EBLS",["EBDB","EBDBEbsmApi","EBEpochChangeListener","EBIsEbEnabled","EBIsEbEnabledSubscriber","EBLogger","EBReadyNotifier","EBReenrollmentTriggerListener","EBWorkerAddDeviceUtils","I64","LSAuthorityLevel","LSDataTraceFlushDeferred","LSDatascriptEvaluatorMaybeDeferred","LSDedicatedMqttChannel","LSDefaultSyncGroups","LSDeleteAllAndInsertConnectivityStatusStoredProcedure","LSEncryptedBackupsBackupTenancy","LSFactory","LSIntEnum","LSInternetConnectionState","LSJSEBInMemoryStorage","LSMetadata","LSPlatformDeviceId","LSPlatformMessengerSyncParams","LSPlatformMqttRealtimeTransport","LSPlatformRealtimeTransport","LSPlatformTaskSystemTransport","LSReStoreWrapper","LSVersion","MAWBridge","MAWEBLSInWorkerSwitch","MAWLSVaultingHooks","MAWODSProxy","MAWVaultMaterialsStorage","MWEncryptedBackupsListenForChangesToBackupStateInitPath","MWPlatformTaskSystem","MqttEnv","Promise","QPLUserFlow","ReQL","ServerAppID","WAAssertUnreachable","WAOdsEnums","WAPromiseDelays","WAResolvable","WAWaitForUserUnblocked","asyncToGeneratorRuntime","cr:7533","emptyFunction","err","getMWLSRegion","nullthrows","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=d("EBLogger").EBLogger().tags(["EBLS"]),H=c("qpl")._(521478817,"2806");function a(){return L()}var I,J,K;function L(){return I?I.promise:M({copyKeys:!0,getNewDB:!1}).promise}function M(a){I!=null&&!I.isSettled&&I.reject(c("err")("LSClient is not settled"));J!=null&&!J.isSettled&&J.reject(c("err")("LSDBStorage is not settled"));var b=new(d("WAResolvable").Resolvable)();I=b;J=null;void P(a).then(function(a){b.resolve(a)},function(a){b.reject(a)});return b}function N(){return O.apply(this,arguments)}function O(){O=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){c("QPLUserFlow").addPoint(H,"offline_queue_wait_start"),yield d("WAWaitForUserUnblocked").waitForUserUnblocked(),c("QPLUserFlow").addPoint(H,"offline_queue_wait_end")});return O.apply(this,arguments)}function P(a){return Q.apply(this,arguments)}function Q(){Q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e;a=a.getNewDB;d("EBReadyNotifier").resetEBReady();(e=c("QPLUserFlow")).start(H,{timeoutInMs:6e4});e.addPoint(H,"ls_storage_creation_start");a=(yield R(a));e.addPoint(H,"ls_storage_creation_end");e.addPoint(H,"eb_worker_add_device_skipped");e.endSuccess(H);d("EBReadyNotifier").markEBReady();G.DEBUG(q||(q=babelHelpers.taggedTemplateLiteralLoose(["Initialised db"])));e={appId:c("nullthrows")(c("ServerAppID").app_id),executeGraphQLLightSpeedRequest:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];var e=(yield d("MAWBridge").getBridge().sendAndReceive("event","executeGraphQLLightSpeedRequest",{args:b}));return e});function c(){return a.apply(this,arguments)}return c}(),getDb:R,getEval:function(){return c("LSDatascriptEvaluatorMaybeDeferred")()},platformName:"Messenger",realtimeUnderylingTransport:function(){return(F||(F=b("Promise"))).resolve(function(b,a){return c("LSPlatformMqttRealtimeTransport")(c("LSVersion"),a,{getInstance:d("LSDedicatedMqttChannel").getInstance(function(){return!0},(b={},b[d("MqttEnv").MqttGkNames.mqttweb_global_connection_counter]=!1,b),function(a,b){return b},c("emptyFunction")),shutdownAndClear:d("LSDedicatedMqttChannel").shutdownAndClear})})},region:c("getMWLSRegion")(),schemaVersion:c("LSVersion"),sendHardcodedInitSync:!1,syncParams:c("LSPlatformMessengerSyncParams")};G.DEBUG(r||(r=babelHelpers.taggedTemplateLiteralLoose(["created config"])));c("QPLUserFlow").addAnnotations(H,{string:{appId:e.appId}});var f=d("LSPlatformDeviceId").getDeviceIdForProviderType("ephemeral");c("QPLUserFlow").addPoint(H,"platform_client_init_start");e=(yield W(a,e,f));c("QPLUserFlow").addPoint(H,"platform_client_init_end");K=Y(a);yield d("EBIsEbEnabledSubscriber").initIsEbEnabledPubSub(a);yield d("EBEpochChangeListener").initEBEpochChangeListener(a);yield d("EBReenrollmentTriggerListener").initEBReenrollmentTriggerListener(a);G.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["finished init successfully"])));return e});return Q.apply(this,arguments)}function R(a){return S.apply(this,arguments)}function S(){S=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a=!1);if(!a&&J!=null)return J.promise;a=new(d("WAResolvable").Resolvable)();J=a;yield d("MAWVaultMaterialsStorage").setupVaultMaterials();var e={clearEbStores:d("EBDB").clearEbStores,flushEBSMtoEBDB:d("EBDBEbsmApi").flushEBSMtoEBDB,rehydrateEBSMFromEBDB:d("EBDBEbsmApi").rehydrateEBSMFromEBDB},g=(yield d("LSJSEBInMemoryStorage").makeReStorePersistence(e));g=d("LSReStoreWrapper").createLSReStore(g,d("LSMetadata").schema,[c("MAWLSVaultingHooks")],void 0);e.updateEBSM=d("EBDBEbsmApi").updateEBSM(g);yield g.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("LSDefaultSyncGroups").seedDb(a,void 0)});return function(b){return a.apply(this,arguments)}}(),"readwrite","ui",void 0,f.id+":236");a.resolve(g);return g});return S.apply(this,arguments)}function e(){return T.apply(this,arguments)}function T(){T=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(b("cr:7533")!=null||I==null)return;yield d("EBWorkerAddDeviceUtils").clearLSEBSMTables(yield R())});return T.apply(this,arguments)}function U(a){var b=c("MWEncryptedBackupsListenForChangesToBackupStateInitPath").listenForChangesToBackupState(a);return function(){b&&b()}}function V(a,b){var e=b==="Connected"?(D||(D=d("LSIntEnum"))).ofNumber(c("LSInternetConnectionState").CONNECTED):(D||(D=d("LSIntEnum"))).ofNumber(c("LSInternetConnectionState").NOT_CONNECTED);G.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync connection status: ",""])),b);c("promiseDone")(a.runInTransaction(function(a){return c("LSDeleteAllAndInsertConnectivityStatusStoredProcedure")(c("LSFactory")(a),{internetConnectionState:e})},"readwrite",void 0,void 0,f.id+":276"),function(){G.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync connection status set successfully"])))},function(a){G.MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync connection status set failed: ",""])),a==null?void 0:a.message);throw a})}function W(a,b,c){return X.apply(this,arguments)}function X(){X=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){G.DEBUG(t||(t=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync starting..."])));var g=(yield e.getEval());G.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Getting datascript evaluator success"])));var h=g()(a);G.DEBUG(v||(v=babelHelpers.taggedTemplateLiteralLoose(["Clearing epoch before resume sync..."])));G.DEBUG(w||(w=babelHelpers.taggedTemplateLiteralLoose(["Starting realtime transport"])));g=(yield e.realtimeUnderylingTransport());var i=d("LSPlatformRealtimeTransport").LSPlatformRealtimeTransport(g,e.appId,f);G.DEBUG(x||(x=babelHelpers.taggedTemplateLiteralLoose(["Starting task system"])));var j=new(c("MWPlatformTaskSystem"))(a,new(c("LSPlatformTaskSystemTransport"))(a,i,h,e.schemaVersion));G.DEBUG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["Starting backup state listeners"])));var k=null;b("cr:7533")!=null?c("promiseDone")(N().then(function(a){return b("cr:7533")()}),function(b){c("QPLUserFlow").addPoint(H,"sync_system_creation_start"),k=b(a,i,h,e.schemaVersion,f,e.executeGraphQLLightSpeedRequest),c("QPLUserFlow").addPoint(H,"sync_system_creation_end")}):c("QPLUserFlow").addPoint(H,"sync_system_creation_skipped");var l=U(a);G.DEBUG(z||(z=babelHelpers.taggedTemplateLiteralLoose(["Watching for expired traces"])));var m;c("promiseDone")(d("LSDataTraceFlushDeferred").watchForExpiredTraces(a).then(function(a){m=a}));G.DEBUG(A||(A=babelHelpers.taggedTemplateLiteralLoose(["Subscribing to mqtt sync status change events"])));i.onConnectionStatusChange(function(b){V(a,b)});G.DEBUG(B||(B=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync starting sucess"])));return{cleanup:function(){var a;G.DEBUG(C||(C=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync cleaning up"])));j==null||j.cleanup();i.cleanup();(a=k)==null||a.cleanup();l();m==null||m();K.forEach(function(a){return a()})},db:a}});return X.apply(this,arguments)}function Y(a){var b=[];a=Z(a);b.push(a);return b}function Z(a){var e=null;function f(a){var f=e===null?"null":String(e),g=String(a);d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"ebls_switch.state_transition."+f+"_to_"+g});G.DEBUG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["EBLS Switch state transition: "," -> ",""])),f,g);e===!0&&a===!1&&(G.DEBUG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["EBLS Switch detected true->false transition, setting timeout to check self-correction"]))),void d("WAPromiseDelays").delayMs(1e3).then(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("EBIsEbEnabled").isEBEnabled()),b=a===!0;G.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["EBLS Switch true->false correction check: corrected=",", current_state=",""])),String(b),String(a));d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"ebls_switch.true_to_false_correction."+(b?"corrected":"not_corrected")});b=c("MAWEBLSInWorkerSwitch").isEnabled();a=a===b?"match":"mismatch";d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"ebls_switch.true_to_false_check."+a})}))["catch"](function(a){G.catching(a).MUSTFIX(n||(n=babelHelpers.taggedTemplateLiteralLoose(["EBLS Switch failed to check true->false correction"])))}));c("MAWEBLSInWorkerSwitch").set(a);e=a}d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state)).then(function(a){a!=null?f($(a)):f(!1)})["catch"](function(a){G.catching(a).MUSTFIX(o||(o=babelHelpers.taggedTemplateLiteralLoose(["Failed to get initial state for EBLS Switch"])))});return a.tables.secure_encrypted_backups_client_state.subscribe(function(a,b){G.DEBUG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["EBLS Switch state changed. operation: ",""])),b.operation);switch(b.operation){case"delete":f(!1);break;case"add":case"put":f($(b.value));break;default:b.operation;throw c("WAAssertUnreachable")(b.operation)}})}function $(a){var b=a.authorityLevel;a=a.backupTenancy;if(b==null)return!1;a=a!=null?a:(D||(D=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION);return(E||(E=d("I64"))).equal(a,(D||(D=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION))&&(E||(E=d("I64"))).equal(b,(D||(D=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))}g.init=a;g.genLSClient=L;g.getLSStorage=R;g.clearEBSMStorage=e;g.platformClientInit=W}),98);
__d("EBMessageEncryptionKeyStorage",["WABase64","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){return d("WABase64").encodeB64(a)+"|"+d("WABase64").encodeB64(b)}function a(a){var c=a.io,d=a.logger,e=new Map();a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.minosThreadId;a=a.rosterHash;var f=i(a,b),g=e.get(f);if(g!=null)return{cacheStatus:"cached-by-memory",registeredMek:g};g=(yield c.loadMessageEncryptionKey(b,a)["catch"](function(a){d.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["loadMessageEncryptionKey runtime-error: ",""])),a);return null}));if(g!=null){e.set(f,g);return{cacheStatus:"cached-by-db",registeredMek:g}}return null});return function(b){return a.apply(this,arguments)}}();var f=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.minosThreadId,d=a.registeredMek;a=a.rosterHash;a=i(a,b);e.set(a,d);yield c.saveNewMessageEncryptionKey(b,d.mek,d.mekFbid,d.miThreadFbid)});return function(b){return a.apply(this,arguments)}}();return{getMessageEncryptionKey:a,setNewMessageEncryptionKey:f}}g.createMessageEncryptionKeyStorage=a}),98);
__d("EBMessagePointQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="24594254596922524"}),null);
__d("EBMessagePointQuery.graphql",["EBMessagePointQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"app_id"},c={defaultValue:!1,kind:"LocalArgument",name:"minos_gk_enabled"},d={defaultValue:null,kind:"LocalArgument",name:"restore_payload_string"},e={defaultValue:null,kind:"LocalArgument",name:"restore_type"},f=[{kind:"Variable",name:"app_id",variableName:"app_id"},{kind:"Variable",name:"restore_payload_string",variableName:"restore_payload_string"},{kind:"Variable",name:"restore_type",variableName:"restore_type"}],g={alias:null,args:null,kind:"ScalarField",name:"encryption_version",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf_stanza",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp_ms",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"sk_ciphertext",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"supplemental_key",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"supplemental_otid",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"actor_token",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf",storageKey:null},q={alias:null,args:null,kind:"ScalarField",name:"mek_fbid",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"mek_id",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"transport_sender_signing_pk",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"transport_sender_message_signature",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"franking_tag",storageKey:null},w={alias:null,args:null,kind:"ScalarField",name:"reporting_tag",storageKey:null},x={alias:null,args:null,kind:"ScalarField",name:"message_encryption_version",storageKey:null},y=[h,i],z={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[a,c,d,e],kind:"Fragment",metadata:null,name:"EBMessagePointQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:f,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages_point_restore",plural:!1,selections:[{args:[{kind:"Variable",name:"minos_gk_enabled",variableName:"minos_gk_enabled"}],kind:"FragmentSpread",name:"handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages"}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[d,e,a,c],kind:"Operation",name:"EBMessagePointQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:f,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages_point_restore",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMessage",kind:"LinkedField",name:"encrypted_messages",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEchoDocument",kind:"LinkedField",name:"echo_document",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"echo_document_string",storageKey:null},g,h,i,{alias:null,args:null,kind:"ScalarField",name:"epoch_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"otid",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanzas",kind:"LinkedField",name:"protobuf_stanzas",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"message_tags",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"top_level_protobuf",plural:!1,selections:[j,g,h,i,k,l],storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs",plural:!0,selections:[j,g,h,i,k,l,m,n],storageKey:null},{condition:"minos_gk_enabled",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"XFBMinosProtobufStanza",kind:"LinkedField",name:"top_level_protobuf_v2",plural:!1,selections:[o,p,q,r,s,t,u,v,w,x],storageKey:null},{alias:null,args:null,concreteType:"XFBMinosProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs_v2",plural:!0,selections:[o,p,s,q,r,m,n,t,u,v,w,x],storageKey:null}]}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},{alias:null,args:null,concreteType:"XFBMessageRangeInfo",kind:"LinkedField",name:"message_range_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_more_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_more_after",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_after",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_delete_mailbox",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"thread_not_found",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochDerivationSet",kind:"LinkedField",name:"epoch_derivation_set",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupsEpochEdge",kind:"LinkedField",name:"epoch_edges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"backward_edge",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochForwardEdge",kind:"LinkedField",name:"forward_edge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"auth_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_entropy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entropy_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"psk_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"from_epoch",plural:!1,selections:y,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"to_epoch",plural:!1,selections:y,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"from_epoch_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"to_epoch_fingerprint",storageKey:null}],storageKey:null}],storageKey:null},{condition:"minos_gk_enabled",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"XFBMinosDecryptionKeyMap",kind:"LinkedField",name:"minos_decryption_keys",plural:!0,selections:[z,{alias:null,args:null,concreteType:"XFBMinosDecryptionKeys",kind:"LinkedField",name:"keys",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBMinosMekInfo",kind:"LinkedField",name:"mek_info",plural:!1,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"roster_hash",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_mek",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"mek_encryption_version",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBMinosRecipientInfo",kind:"LinkedField",name:"recipient_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"epoch_fbid",storageKey:null},h],storageKey:null},{alias:null,args:null,concreteType:"XFBMekCreatorInfo",kind:"LinkedField",name:"mek_creator_info",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBMinosEncryptionKeys",kind:"LinkedField",name:"minos_keys",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"sender_auth_pk",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"sender_epoch_head",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBMinosTransportKeys",kind:"LinkedField",name:"transport_keys",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ephm_hpke_pk",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ephm_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"mek_creator_transport_signing_pk",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}]}],storageKey:null}],storageKey:null},z],storageKey:null}],storageKey:null}]},params:{id:b("EBMessagePointQuery_facebookRelayOperation"),metadata:{},name:"EBMessagePointQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("EBgenerateMPSMessageQuery",["EBGraphQLRestoreDefinition"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return{__typename:"MPSMessageQuery",ctx:{__typename:"MPSQueryContext",caller:"HISTORY_RESTORE"},query:{__typename:"MPSMessagePointQuery",include_deleted:!1,otids:b,thread_id:a}}}function a(a,b){return d("EBGraphQLRestoreDefinition").toMpsMessageQueryForGraphQLQuery(JSON.stringify(h(a,b)))}g.generateMPSMessageQuery=h;g.generateMPSMessageQueryForGraphQLQuery=a}),98);
__d("MAWConvertEchoMessagesToEBProtobufs",["MAWHandleEBRestoreWithHIM"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWHandleEBRestoreWithHIM").convertEchoMessagesToEBProtobufs(a,b)}g.convertEchoMessagesToEBProtobufs=a}),98);
__d("EBMessagePointQuery",["Base64Utils","EBAPIConvertNativeToLS","EBAPIDecryptionModule","EBAPIQPLPoints","EBAPIWorkerCheck","EBDedupeLabyrinthMessages","EBDeriveAndStoreEpochs","EBGetClientState","EBLS","EBMessagePointQuery.graphql","EBMinosCheckWasmFeatureSupport","EBgenerateMPSMessageQuery","FBLogger","I64","LSMEBTaskCreationSource","LSVec","MAWConvertEchoMessagesToEBProtobufs","MAWCurrentUser","MAWEncryptedBackupUtils","MAWJobDefinitions","MpsTypes","QPLFlow","WAHashStringToNumber","WAJids","WAResultOrError","WorkerRelay","WorkerRelayNetwork","asyncToGeneratorRuntime","cr:3487","cr:3767","cr:4434","cr:5935","cr:6130","getErrorSafe","gkx","handleRestoreMessagesGraphQLResponse","qpl","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=b("cr:3767")||b("cr:6130"),k=h!==void 0?h:h=b("EBMessagePointQuery.graphql");function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.chatJid,f=a.instanceKey,g=a.messageIds;a=a.source;var h=c("qpl")._(521474469,"2612");f=f!=null?f:d("WAHashStringToNumber").hashStringToNumber(c("uuidv4")());var l=(yield d("EBMinosCheckWasmFeatureSupport").checkWasFeatureSupportAndGK());h=d("QPLFlow").startQPLFlow(h,{annotations:{bool:{m2_2_enabled:c("gkx")("2760"),occam_only_mailbox_users:c("gkx")("16674"),repl_enabled:c("gkx")("12911"),wmi_lb11_dyi:c("gkx")("10542")},"int":{source:a!=null?a:c("LSMEBTaskCreationSource").UNKNOWN}},instanceKey:f});try{var m,n,o;if(!d("EBAPIWorkerCheck").runningInWorker()){h.endFail(d("EBAPIQPLPoints").EBAPIQPLCommonErrorPoints.UNSUPPORTED_CONTEXT);return d("WAResultOrError").makeError("unsupported-context")}a=(yield d("EBLS").init()).db;h.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.LSDB_SINGLETON_RETRIEVED);f=(yield d("EBGetClientState").getClientState(a));h.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.CLIENT_STATE_RETRIEVED,{string:{device_id:(i||(i=d("I64"))).to_string((m=f==null?void 0:f.device_id)!=null?m:(i||(i=d("I64"))).zero)}});if(f==null){h.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE}});return d("WAResultOrError").makeError("no-client-state")}m=d("WAJids").threadIdForChatJid(e);var p=f.backupId,q=f.device_id,r=f.locally_available_epochs,s=f.mailboxRootKey;f=f.ocmfClientStateBlob;if(p==null||q==null||s==null||f==null){h.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE}});return d("WAResultOrError").makeError("invalid-client-state")}n=""+((n=d("MAWCurrentUser").getAppID())!=null?n:0);q={restore_context:{act_thread_id:m,site:"www",tam_thread_subtype:0},success:{device_context:{device_id:i.to_string(q),locally_available_epochs:r,raw_tokens:{mailbox_root_key:d("Base64Utils").fromArrayBuffer(s),ocmf_client_state_blob:d("Base64Utils").fromArrayBuffer(f)}},mps_message_query:d("EBgenerateMPSMessageQuery").generateMPSMessageQueryForGraphQLQuery(m,[].concat(g))}};r={app_id:n,minos_gk_enabled:l,restore_payload_string:JSON.stringify(q),restore_type:"MESSAGE_QUERY_RESTORE"};h.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.CREATE_WORKER_NETWORK_EXECUTE_START);yield d("WorkerRelayNetwork").createWorkerNetworkExecute();h.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.CREATE_WORKER_NETWORK_EXECUTE_END);h.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_START);s=(yield d("WorkerRelay").createWorkerQuery(k,r));h.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_END);f=s==null||(o=s.viewer)==null||(o=o.encrypted_backup)==null||(o=o.mailbox)==null?void 0:o.messages_point_restore;if(f==null){h.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}});return d("WAResultOrError").makeError("invalid-graphql-response")}if((f==null?void 0:f.encrypted_messages)==null){h.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}});return d("WAResultOrError").makeError("invalid-graphql-response")}g=f.backup_id;n=f.encrypted_messages;q=f.epoch_derivation_set;r=f.exception_string;s=f.minos_decryption_keys;if(r!=null){h.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,exception:r}});return d("WAResultOrError").makeError("server-side-exception")}g==null&&h.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.BACKUP_ID_NULL);h.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_START);h.addAnnotations({bool:{hasEpochs:q!=null&&q.epoch_edges.length>0}});yield d("EBDeriveAndStoreEpochs").deriveAndStoreEpochsNonLS(a,q);h.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_END);h.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_MINOS_PROTOBUF_START);f=b("cr:5935")!=null&&l?b("cr:5935").processMinosMessages(n):[];r=j!=null&&l?yield j.minosDecryptAndValidateMessages({encryptedMinosMessages:f,minosDecryptionKeys:s,qplFlow:h,threadId:d("MpsTypes").toThreadId(e)}):d("WAResultOrError").makeResult({decryptionResult:new Map(),errorMessages:[]});q=r.success===!0&&r.value.decryptionResult.size>0?r.value.decryptionResult:null;s=r.success===!0?r.value.errorMessages:[(f=r.error)!=null?f:"unknown-error"];h.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_MINOS_PROTOBUF_END,{bool:{minos_decrypt_success:s.length===0},string_array:{minos_decrypt_errors:s}});f=b("cr:3487")!=null&&q!=null&&l?b("cr:3487").dedupeEncryptedLabyrinthMessages(n,q):n;s=d("handleRestoreMessagesGraphQLResponse").processMessageArray(f,g!=null?g:(i||(i=d("I64"))).to_string(p));n=s.encryptedNonLSEchoMessages;f=s.encryptedNonLSProtobufs;h.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_LABYRINTH10_MESSAGES_START);g=(yield d("EBAPIDecryptionModule").decryptUsingNativeJS(a,m,f,n));if(!g.success){h.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_LABYRINTH10_MESSAGES_FAILURE);return d("WAResultOrError").makeError("native-decryption-error")}h.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_LABYRINTH10_MESSAGES_END,{bool:{labyrinth_10_toplevel_decrypt_success:g.value.decryptedEchoMessages.length===n.length&&g.value.decryptedProtobufs.length===f.length}});p=g.value.decryptedEchoMessages;s=g.value.decryptedProtobufs;a=l?d("EBDedupeLabyrinthMessages").dedupeLabyrinthMessages(s,q):s;m=d("EBAPIConvertNativeToLS").convertNativeDecryptionResponseToDecryptedMessageType(p,a);b("cr:4434")!=null&&l&&b("cr:4434").compareDecryptedMessagesCallNative(g,r,h);n=c("LSVec").toArray(m.echo);f=m.protobuf;q=n.map(function(a){return d("MAWJobDefinitions").toEncodedEchoMessage(a)});s=[];p.length>0?s=d("MAWConvertEchoMessagesToEBProtobufs").convertEchoMessagesToEBProtobufs(q,e):s=d("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(f);h.endSuccess({bool:{isEcho:p.length>0,isProtobuf:a.length>0}});return d("WAResultOrError").makeResult(s)}catch(a){l=c("getErrorSafe")(a);h.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,{string:{error_description:l.message,errorStackTrace:(g=l.stack)!=null?g:""}});c("FBLogger")("wmi_eb").catching(l).mustfix("Runtime error performing messagePointQuery: %s",l.message);return d("WAResultOrError").DEPRECATED_makeError("runtime-error")}});return l.apply(this,arguments)}g.messagePointQuery=a}),98);
__d("EBProbe",["FBLogger","MAWODSProxy","Promise","WAOdsEnums","WAShiftTimer","WATimeUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(){function a(a,b,c){this.$5=!1,this.$1=a,this.$2=b,this.$3=c}var e=a.prototype;e.sample=function(a){a=this.$1.sample(a);a&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.EB_MESSAGE_PROBE,key:"sampled"});return a};e.start=function(){var a=this;if(this.$4!=null)return;this.$4=new(d("WAShiftTimer").ShiftTimer)(function(){void a.$6()});this.$4.onOrBefore(this.$3.validationIntervalMs,void 0)};e.stop=function(){this.$4!=null&&(this.$4.cancel(),this.$4=null)};e.hasStarted=function(){return this.$4!=null};e.$6=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield this.$7(),this.$4!=null&&this.$4.onOrBefore(this.$3.validationIntervalMs,void 0)});function c(){return a.apply(this,arguments)}return c}();e.$7=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(this.$5)return;this.$5=!0;try{var a=d("WATimeUtils").castToMillisTime(Date.now()-this.$3.sampleAgeThresholdMs);a=this.$2.fetchOlderThan({consume:!0,cutOffTimestamp:a});if(a.length>0)try{d("MAWODSProxy").odsBumpEntityKey({amount:a.length,entity:d("WAOdsEnums").Entity.EB_MESSAGE_PROBE,key:"validated"}),yield this.validateSamples(a)}catch(b){a=b instanceof Error?b:c("err")(String(b));c("FBLogger")("wmi_eb").catching(a).MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Exception in validateSamples()"])))}}finally{this.$5=!1}});function e(){return a.apply(this,arguments)}return e}();e.addMarkerToItem=function(a,b,c){return!1};e.updateSample=function(a,b){var c=this.getSamplingDB();if(c==null)return!1;c=c.getItemByPrimaryKey(a);if(c==null)return!1;b(c);return!0};e.getConfig=function(){return this.$3};e.getSamplingDB=function(){return this.$2};e.validateSamples=function(a){return(i||(i=b("Promise"))).reject(c("err")("validateSamples() must be implemented by concrete probe classes"))};return a}();g.EBProbe=a}),98);
__d("EBSampler",["Random"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b,c,d){this.$1=a,this.$2=b,this.$3=c,this.$4=d}var b=a.prototype;b.sample=function(a){var b=this.$3(a);b=((b=this.$2.get(b))!=null?b:0)*this.$1;var c=d("Random").random();c=c<b;c&&this.$4.append(a);return c};b.setSamplingMultipler=function(a,b){this.$2.set(a,b)};b.setSamplingRate=function(a){this.$1=a};return a}();g.EBSampler=a}),98);
__d("EBMinosDisableLabyrinth10Uploads",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("16675")}g.disableLabyrinth10Uploads=a}),98);
__d("EncryptedBackupsUploadQueue",["EBMinosDisableLabyrinth10Uploads","EncryptedBackupsUploadEntity","MWEBODSEntityName.enum","MWEBODSUtils","PersistedQueueApi","Promise","QPLUserFlow","WAPersistedQueue","WATagsLogger","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=d("WATagsLogger").TAGS(["EbUploadQueue"]),l=null;function m(){return l==null?n():l}function n(){l!=null&&k.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["EB Upload Queue is already initialized"])));var a=d("WAPersistedQueue").initPersistedQueue("ebUploadQueue",d("PersistedQueueApi").persistedQueueApi());l=a;return a}function a(a){if(a.length===0||d("EBMinosDisableLabyrinth10Uploads").disableLabyrinth10Uploads())return(j||(j=b("Promise"))).resolve();d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload.api.put",a.length);var e=m();return e.addAndCommit(a.map(d("EncryptedBackupsUploadEntity").asEBUploadEntity)).then(function(){a.forEach(function(a){(a==null?void 0:a.instanceKey)!=null&&c("QPLUserFlow").endSuccess(c("qpl")._(521477113,"2698"),{instanceKey:a.instanceKey})})})["catch"](function(a){k.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Failed to write to ebUploadQueue ",""])),a);return(j||(j=b("Promise"))).reject(a)})}g.logger=k;g.ebUploadQueue=m;g.initEbUploadQueue=n;g.putMsgsToEbUpload=a}),98);
__d("InMemorySamplingDB",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b){this.$1=[],this.$4=new Map(),this.$2=a,this.$3=b}var b=a.prototype;b.append=function(a){var b=this.$3(a);this.$1.push([this.$2(a),a]);this.$4.set(b,a)};b.fetchOlderThan=function(a){var b=a.consume;b=b===void 0?!1:b;var c=a.cutOffTimestamp;a=a.limit;a=a===void 0?50:a;var d=[];if(a<=0)return d;var e=0,f=[];for(var g of this.$1){var h=g[0],i=g[1];h<=c&&(d.push(i),b===!0&&(e++,f.push(i)));if(d.length>=a)break}if(b===!0&&e>0){this.$1.splice(0,e);for(h of f){i=this.$3(h);this.$4["delete"](i)}}return d};b.getItemByPrimaryKey=function(a){return(a=this.$4.get(a))!=null?a:null};b.size=function(){return this.$1.length};b.pruneOlderThan=function(a){var b=[];this.$1=this.$1.filter(function(c){var d=c[0];c=c[1];if(d<=a){b.push(c);return!1}return!0});for(var c of b){var d=this.$3(c);this.$4["delete"](d)}};b.purgeAll=function(){this.$1=[],this.$4.clear()};return a}();f.InMemorySamplingDB=a}),66);
__d("EBMessageProbe",["EBMessagePointQuery","EBProbe","EBSampler","EncryptedBackupsUploadQueue","FBLogger","InMemorySamplingDB","MAWEBLSInWorkerSwitch","MpsTypes","Promise","QPLFlow","WAHashStringToNumber","WATimeUtils","asyncToGeneratorRuntime","getErrorSafe","gkx","justknobx","qpl","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b){var c={};for(a of a){var d=b(a);c[d]==null&&(c[d]=[]);c[d].push(a)}return c}var k={qplEvent:c("qpl")._(521475573,"3232"),sampleAgeThresholdMs:1e3,validationIntervalMs:5e3},l=(a=c("justknobx"))._("3573"),m=new Map([["text",a._("3952")],["image",a._("3957")],["video",a._("3969")],["audio",a._("3970")],["document",a._("3973")],["sticker",a._("3977")],["gif",a._("3981")]]),n=function(a){return a.timestampMs},o=function(a){return a.messageType},p=function(){return new(d("InMemorySamplingDB").InMemorySamplingDB)(n,function(a){return a.messageId})},q=function(a){return new(d("EBSampler").EBSampler)(l,m,o,a)};e=function(a){function e(b,c,d){d===void 0&&(d=k);return a.call(this,b,c,d)||this}babelHelpers.inheritsLoose(e,a);e.getInstance=function(){if(!e.$EBMessageProbe$p_1){var a=p(),b=q(a);e.$EBMessageProbe$p_1=new e(b,a,k)}return e.$EBMessageProbe$p_1};e.reset=function(){e.$EBMessageProbe$p_1=null};var f=e.prototype;f.addMarkerToItem=function(a,b,c){return this.addMarker(a,b,c)};f.addMarker=function(a,b,c){var e=this.getSamplingDB();if(e==null)return!1;e=e.getItemByPrimaryKey(a);if(e==null)return!1;a={event:b,metadata:c,timestampMs:d("WATimeUtils").castToMillisTime(Date.now())};e.markers.push(a);return!0};f.getMarkersForMessage=function(a){var b=this.getSamplingDB();if(b==null)return null;b=b.getItemByPrimaryKey(a);return b==null?null:[].concat(b.markers)};f.getMessageSample=function(a){var b=this.getSamplingDB();return b==null?null:b.getItemByPrimaryKey(a)};f.$EBMessageProbe$p_2=function(a){return a.length===0?"":a.map(function(a){return a.event}).join(",")};f.$EBMessageProbe$p_3=function(a){var b={bool:{},"int":{},string:{}};for(a of a){var c=a.metadata;if(c!=null)for(c of Object.entries(c)){var d=c[0],e=c[1];typeof e==="string"?b.string!=null&&(b.string[d]=e):typeof e==="number"?b["int"]!=null&&(b["int"][d]=e):typeof e==="boolean"&&(b.bool!=null&&(b.bool[d]=e))}}return b};f.validateSamples=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return;var e=d("EncryptedBackupsUploadQueue").ebUploadQueue(),f=new Set(),g=[];for(var k of a){var l=k.chatJid+"_"+k.messageId;if(f.has(l))continue;f.add(l);l=d("WAHashStringToNumber").hashStringToNumber(c("uuidv4")());var m=Date.now()-k.timestampMs,n=m/(1e3*60),o=function(a){if(a<5)return"<5min";else if(a>=5&&a<10)return"5-10min";else return">10min"},p=void 0,q=void 0;if(k.queueId!=null){var r,s=(yield e.get(k.queueId));p=s!=null;if((s==null||(r=s.msgId)==null?void 0:r.externalId)!=null){var t;q=d("MpsTypes").toMessageId(s==null||(t=s.msgId)==null?void 0:t.externalId)===k.messageId}}p=d("QPLFlow").startQPLFlow(this.getConfig().qplEvent,{annotations:babelHelpers["extends"]({},this.$EBMessageProbe$p_3(k.markers),{bool:{eb_state:c("MAWEBLSInWorkerSwitch").isEnabled(),isProtobufOnlyUpload:c("gkx")("18095"),queueItemExists:p,queueItemMessageIdMatches:q},"int":{markerCount:k.markers.length,queueId:(s=k.queueId)!=null?s:-1,sampleSize:a.length,sampleTimestampMs:k.timestampMs,validationIntervalMs:m,validationTimestampMs:Date.now()},string:{chatJid:k.chatJid,markerEvents:this.$EBMessageProbe$p_2(k.markers),messageId:k.messageId,messageType:k.messageType,validationIntervalBucket:o(n)}}),instanceKey:l});g.push({qplFlow:p,sample:k})}try{q=j(g,function(a){return a.sample.chatJid});s=Object.entries(q).map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a[0];a=a[1];var b=a.map(function(a){return a.sample.messageId}),c=a[0].sample.chatJid;b={chatJid:c,messageIds:b};a.forEach(function(a){a=a.qplFlow;a!=null&&a.addPoint("point_query_start")});b=(yield d("EBMessagePointQuery").messagePointQuery(b));a.forEach(function(a){a=a.qplFlow;a!=null&&a.addPoint("point_query_end")});return{chatJid:c,result:b,samplesWithQplFlow:a}});return function(b){return a.apply(this,arguments)}}());m=(yield (i||(i=b("Promise"))).all(s));for(o of m){n=o.result;l=o.samplesWithQplFlow;if(n.success){p=new Set(n.value.map(function(a){return a.otid}));for(k of l){a=k.qplFlow;a!=null&&(p.has(k.sample.messageId)?a.endSuccess({bool:{messageFound:!0}}):a.endFail("message_not_found",{bool:{messageFound:!1},string:{error:"message-not-found"}}))}}else for(f of l){e=f.qplFlow;if(e!=null){e.endFail("query_failed",{bool:{messageFound:!1},string:{error:(q=n.error)!=null?q:"unknown-query-failure"}})}}}}catch(b){s=c("getErrorSafe")(b);c("FBLogger")("wmi").catching(s).MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to validate samples"])));for(m of g){m.qplFlow.endFail("validation_exception",{bool:{messageFound:!1},string:{error:(a=s.message)!=null?a:"unknown-validation-exception"}})}}});function e(b){return a.apply(this,arguments)}return e}();return e}(d("EBProbe").EBProbe);f=e.getInstance;a=e.reset;g.EBMessageProbe=e;g.getEBMessageProbeInstance=f;g.resetEBMessageProbeInstance=a}),98);
__d("EBMinosWasmDecryptAndVerifyMessage",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WACreateWasmFunction","WAResultOrError","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.getWasmModule,f=d("EBMinosLogger").minosLogger.TAGS(["minos-decrypt-and-verify-message"]);function g(a){a=a.plaintext;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastToDecryptedMessage(a))}return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.cipherText,h=a.mekKey,i=a.messageEncryptionVersion,j=a.metadata,k=a.signature;a=a.transportSigningPK;if(c("gkx")("12911")){var l=(yield d("EBMinosWasmReactorSingleton").createMinosReactorCommand({InputSpec:d("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:d("EBMinosWasm.pb").MinosDecryptAndVerifyMessageResultSpec,validateResult:g}));return l({decryptAndVerifyMessage:{encryptedMessageCiphertext:b,encryptedMessageSignature:k,mek:h,messageEncryptionVersion:i,metadata:j,transportSigningPk:a}})}else{l=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").MinosDecryptAndVerifyMessageInputSpec,ResultSpec:d("EBMinosWasm.pb").MinosDecryptAndVerifyMessageResultSpec,cli:"minos_cli",command:"minos-decrypt-and-verify-message",getWasmModule:e,logger:f,validateResult:g});return l({encryptedMessageCiphertext:b,encryptedMessageSignature:k,mek:h,messageEncryptionVersion:i,metadata:j,transportSigningPk:a})}});function h(b){return a.apply(this,arguments)}return h}()}e=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.decryptAndVerifyMessage=e}),98);
__d("EBMinosWasmDecryptMekForDistribution",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WACreateWasmFunction","WAResultOrError","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.getWasmModule,f=d("EBMinosLogger").minosLogger.TAGS(["decrypt-mek-for-distribution"]);function g(a){a=a.mek;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastMekKey(a))}return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.encryptedMek,h=a.mailboxAuthPk,i=a.mailboxEncSk,j=a.mekEncryptionVersion,k=a.mekId,l=a.recipientEpochHead,m=a.rosterHash;a=a.senderEpochHead;if(c("gkx")("12911")){var n=(yield d("EBMinosWasmReactorSingleton").createMinosReactorCommand({InputSpec:d("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:d("EBMinosWasm.pb").DecryptMekForDistributionResultSpec,validateResult:g}));return n({decryptMekForDistribution:{ciphertext:b,fromPk:h,mekEncryptionVersion:j,mekId:k,rosterHash:m,senderEpochHead:a,toEpochHead:l,toMailboxSk:i}})}else{n=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").DecryptMekForDistributionInputSpec,ResultSpec:d("EBMinosWasm.pb").DecryptMekForDistributionResultSpec,cli:"minos_cli",command:"decrypt-mek-for-distribution",getWasmModule:e,logger:f,validateResult:g});return n({ciphertext:b,fromPk:h,mekEncryptionVersion:j,mekId:k,rosterHash:m,senderEpochHead:a,toMailboxSk:i})}});function h(b){return a.apply(this,arguments)}return h}()}e=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.decryptMekForDistribution=e}),98);
__d("EBMinosWasmDecryptMekForDistributionFromTransportSender",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WACreateWasmFunction","WAResultOrError","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.getWasmModule,f=d("EBMinosLogger").minosLogger.TAGS(["decrypt-mek-for-distribution-from-transport-sender"]);function g(a){a=a.mek;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastMekKey(a))}return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.mekDistribution,h=a.mekEncryptionVersion,i=a.mekId,j=a.recipientEncSk;a=a.rosterHash;if(c("gkx")("12911")){var k=(yield d("EBMinosWasmReactorSingleton").createMinosReactorCommand({InputSpec:d("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:d("EBMinosWasm.pb").DecryptMekForDistributionFromTransportSenderResultSpec,validateResult:g}));return k({decryptMekForDistributionFromTransportSender:{mekDistribution:b,mekId:i,recipientEncSk:j,rosterHash:a,version:h}})}else{k=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").DecryptMekForDistributionFromTransportSenderInputSpec,ResultSpec:d("EBMinosWasm.pb").DecryptMekForDistributionFromTransportSenderResultSpec,cli:"minos_cli",command:"decrypt-mek-for-distribution-from-transport-sender",getWasmModule:e,logger:f,validateResult:g});k=(yield k({mekDistribution:b,mekId:i,recipientEncSk:j,rosterHash:a,version:h}));return k}});function h(b){return a.apply(this,arguments)}return h}()}e=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.createMinosWasmDecryptMekForDistributionFromTransportSender=a;g.decryptMekForDistributionFromTransportSender=e}),98);
__d("EBMinosWasmDeriveMailboxEncryptionKeypair",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WACreateWasmFunction","WAResultOrError","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.getWasmModule,f=d("EBMinosLogger").minosLogger.TAGS(["derive-mailbox-encryption-key-pair"]);function g(a){var b=a.mailboxEncryptionPrivateKey;a=a.mailboxEncryptionPublicKey;return d("WAResultOrError").makeResult({pk:d("EBMinosTypes").unsafeCastToMailboxEncryptionPK(a),sk:d("EBMinosTypes").unsafeCastToMailboxEncryptionSK(b)})}return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.epochNumber;a=a.exportRootKey;if(c("gkx")("12911")){var h=(yield d("EBMinosWasmReactorSingleton").createMinosReactorCommand({InputSpec:d("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:d("EBMinosWasm.pb").DeriveMailboxEncryptionKeypairResultSpec,validateResult:g}));return h({deriveMailboxEncryptionKeypair:{epochNumber:b,exportRootKey:a}})}else{h=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").DeriveMailboxEncryptionKeypairInputSpec,ResultSpec:d("EBMinosWasm.pb").DeriveMailboxEncryptionKeypairResultSpec,cli:"minos_cli",command:"derive-mailbox-encryption-key-pair",getWasmModule:e,logger:f,validateResult:g});h=(yield h({epochNumber:b,exportRootKey:a}));return h}});function h(b){return a.apply(this,arguments)}return h}()}e=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.deriveMailboxEncryptionKeypair=e}),98);
__d("EBMinosWasmEncryptAndSignMessage",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WACreateWasmFunction","WAResultOrError","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.getWasmModule,f=d("EBMinosLogger").minosLogger.TAGS(["encrypt-and-sign-message"]);function g(a){var b=a.ciphertext,c=a.signature;a=a.version;return d("WAResultOrError").makeResult({encryptedMsg:d("EBMinosTypes").unsafeCastToEncryptedMessage(b),signature:d("EBMinosTypes").unsafeCastToEncryptedMessageSignature(c),version:d("EBMinosTypes").unsafeCastToMessageEncryptionVersion(a)})}return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.mekKey,h=a.metadata,i=a.plaintext;a=a.transportSigningSK;if(c("gkx")("12911")){var j=(yield d("EBMinosWasmReactorSingleton").createMinosReactorCommand({InputSpec:d("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:d("EBMinosWasm.pb").MinosEncryptAndSignMessageResultSpec,validateResult:g}));return j({encryptAndSignMessage:{mek:b,metadata:h,plaintext:i,transportSigningSk:a}})}else{j=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").MinosEncryptAndSignMessageInputSpec,ResultSpec:d("EBMinosWasm.pb").MinosEncryptAndSignMessageResultSpec,cli:"minos_cli",command:"minos-encrypt-and-sign-message",getWasmModule:e,logger:f,validateResult:g});return j({mek:b,metadata:h,plaintext:i,transportSigningSk:a})}});function h(b){return a.apply(this,arguments)}return h}()}e=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.encryptAndSignMessage=e}),98);
__d("EBMinosWasmGenerateMekRosterHash",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WACreateWasmFunction","WAResultOrError","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.getWasmModule,f=d("EBMinosLogger").minosLogger.TAGS(["generate-mek-roster-hash"]);function g(a){a=a.rosterHash;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastMekRosterHash(a))}return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.epochHeads;if(c("gkx")("12911")){var b=(yield d("EBMinosWasmReactorSingleton").createMinosReactorCommand({InputSpec:d("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:d("EBMinosWasm.pb").GenerateMekRosterHashResultSpec,validateResult:g}));return b({generateMekRosterHash:{epochHeads:a}})}else{b=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").GenerateMekRosterHashInputSpec,ResultSpec:d("EBMinosWasm.pb").GenerateMekRosterHashResultSpec,cli:"minos_cli",command:"generate-mek-roster-hash",getWasmModule:e,logger:f,validateResult:g});b=(yield b({epochHeads:a}));return b}});function h(b){return a.apply(this,arguments)}return h}()}e=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.generateMekRosterHash=e}),98);
__d("EBMinosWasmWrapTransportSigningPublicKey",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WACreateWasmFunction","WAResultOrError","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.getWasmModule,f=d("EBMinosLogger").minosLogger.TAGS(["wrap-transport-signing-public-key"]);function g(a){a=a.prefixedKey;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastToTransportSigningPK(a))}return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.signalIdentityPublicKey;if(c("gkx")("12911")){var b=(yield d("EBMinosWasmReactorSingleton").createMinosReactorCommand({InputSpec:d("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:d("EBMinosWasm.pb").WrapTransportSigningPublicKeyResultSpec,validateResult:g}));return b({wrapTransportSigningPublicKey:{keyBytes:a}})}else{b=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").WrapTransportSigningPublicKeyInputSpec,ResultSpec:d("EBMinosWasm.pb").WrapTransportSigningPublicKeyResultSpec,cli:"minos_cli",command:"wrap-transport-signing-public-key",getWasmModule:e,logger:f,validateResult:g});b=(yield b({keyBytes:a}));return b}});function h(b){return a.apply(this,arguments)}return h}()}e=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.wrapTransportSigningPublicKey=e}),98);
__d("EBMinosWasmWrapTransportSigningSecretKey",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WACreateWasmFunction","WAResultOrError","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.getWasmModule,f=d("EBMinosLogger").minosLogger.TAGS(["wrap-transport-signing-secret-key"]);function g(a){a=a.prefixedKey;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastToTransportSigningSK(a))}return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.signalIdentityPrivateKey;if(c("gkx")("12911")){var b=(yield d("EBMinosWasmReactorSingleton").createMinosReactorCommand({InputSpec:d("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:d("EBMinosWasm.pb").WrapTransportSigningSecretKeyResultSpec,validateResult:g}));return b({wrapTransportSigningSecretKey:{keyBytes:a}})}else{b=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").WrapTransportSigningSecretKeyInputSpec,ResultSpec:d("EBMinosWasm.pb").WrapTransportSigningSecretKeyResultSpec,cli:"minos_cli",command:"wrap-transport-signing-secret-key",getWasmModule:e,logger:f,validateResult:g});b=(yield b({keyBytes:a}));return b}});function h(b){return a.apply(this,arguments)}return h}()}e=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.wrapTransportSigningSecretKey=e}),98);
__d("EBMinosWrapTransportSigningKeypair",["EBMinosLogger","EBMinosWasmWrapTransportSigningPublicKey","EBMinosWasmWrapTransportSigningSecretKey","WAByteArray","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.privateKey;a=a.publicKey;a=d("EBMinosWasmWrapTransportSigningPublicKey").wrapTransportSigningPublicKey({signalIdentityPublicKey:d("WAByteArray").uint8ArrayToBuffer(a)});a=(yield a);b=d("EBMinosWasmWrapTransportSigningSecretKey").wrapTransportSigningSecretKey({signalIdentityPrivateKey:d("WAByteArray").uint8ArrayToBuffer(b)});b=(yield b);if(!a.success){d("EBMinosLogger").minosLogger.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to wrap transport signing public key"])));return d("WAResultOrError").makeError("minos-wrap-transport-signing-keypair-error")}if(!b.success){d("EBMinosLogger").minosLogger.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Failed to wrap transport signing secret key"])));return d("WAResultOrError").makeError("minos-wrap-transport-signing-keypair-error")}a={pk:a.value,sk:b.value};return d("WAResultOrError").makeResult(a)});return j.apply(this,arguments)}g.wrapTransportSigningKeypair=a}),98);
__d("EBMinosWasmMinosThreadIdFromActThreadId",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WACreateWasmFunction","WAResultOrError","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.getWasmModule,f=d("EBMinosLogger").minosLogger.TAGS(["minos-thread-id-from-act-thread-id"]);function g(a){a=a.threadId;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastToMinosThreadId(a))}return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.actThreadId;if(c("gkx")("12911")){var b=(yield d("EBMinosWasmReactorSingleton").createMinosReactorCommand({InputSpec:d("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:d("EBMinosWasm.pb").MinosThreadIdFromActThreadIdResultSpec,validateResult:g}));return b({minosThreadIdFromActThreadId:{actThreadId:a}})}else{b=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").MinosThreadIdFromActThreadIdInputSpec,ResultSpec:d("EBMinosWasm.pb").MinosThreadIdFromActThreadIdResultSpec,cli:"minos_cli",command:"minos-thread-id-from-act-thread-id",getWasmModule:e,logger:f,validateResult:g});b=(yield b({actThreadId:a}));return b}});function h(b){return a.apply(this,arguments)}return h}()}e=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.minosThreadIdFromActThreadId=e}),98);
__d("EBMinosWasmMinosThreadIdFromOneToOneThread",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WACreateWasmFunction","WAResultOrError","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.getWasmModule,f=d("EBMinosLogger").minosLogger.TAGS(["minos-thread-id-from-one-to-one-thread"]);function g(a){a=a.threadId;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastToMinosThreadId(a))}return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.actThreadId;a=a.selfFbid;if(c("gkx")("12911")){var h=(yield d("EBMinosWasmReactorSingleton").createMinosReactorCommand({InputSpec:d("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:d("EBMinosWasm.pb").MinosThreadIdFromOneToOneThreadResultSpec,validateResult:g}));return h({minosThreadIdFromOneToOneThread:{actThreadId:b,selfFbid:a}})}else{h=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").MinosThreadIdFromOneToOneThreadInputSpec,ResultSpec:d("EBMinosWasm.pb").MinosThreadIdFromOneToOneThreadResultSpec,cli:"minos_cli",command:"minos-thread-id-from-one-to-one-thread",getWasmModule:e,logger:f,validateResult:g});h=(yield h({actThreadId:b,selfFbid:a}));return h}});function h(b){return a.apply(this,arguments)}return h}()}e=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.minosThreadIdFromOneToOneThread=e}),98);
__d("MpsThreadIdToMinosThreadId",["EBMinosLogger","EBMinosWasmMinosThreadIdFromActThreadId","EBMinosWasmMinosThreadIdFromOneToOneThread","Promise","WAJids","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,c){var e=d("WAJids").validateUserJid(a);if(e!=null){e=d("WAJids").userIdFromJid(e);return d("EBMinosWasmMinosThreadIdFromOneToOneThread").minosThreadIdFromOneToOneThread({actThreadId:e,selfFbid:c}).then(function(a){if(a.success)return d("WAResultOrError").makeResult(a.value);d("EBMinosLogger").minosLogger.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["mpsThreadIdToMinosThreadId UserJid error: ",""])),a.error);return d("WAResultOrError").makeError("create-minos-thread-id-error")})}e=d("WAJids").validateGroupJid(a);if(e!=null){c=d("WAJids").groupIdFromJid(e);return d("EBMinosWasmMinosThreadIdFromActThreadId").minosThreadIdFromActThreadId({actThreadId:c}).then(function(a){if(a.success)return d("WAResultOrError").makeResult(a.value);d("EBMinosLogger").minosLogger.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["mpsThreadIdToMinosThreadId GroupJid error: ",""])),a.error);return d("WAResultOrError").makeError("create-minos-thread-id-error")})}return(j||(j=b("Promise"))).resolve(d("WAResultOrError").makeError("invalid-mps-thread-id"))}g.mpsThreadIdToMinosThreadId=a}),98);
__d("MpsThreadIdToWaThreadId",["WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("WAJids").validateUserJid(a);if(b!=null)return d("WAJids").userIdFromJid(b);b=d("WAJids").validateGroupJid(a);return b!=null?d("WAJids").groupIdFromJid(b):null}g.mpsThreadIdToWaThreadId=a}),98);
__d("EBMinosCryptoLibrary",["EBGenerateAndUploadMek","EBGetMinosAttachmentPayloadFromMpsMessage","EBMessageEncryptionKeyStorage","EBMinosLogger","EBMinosTypes","EBMinosWasmDecryptAndVerifyMessage","EBMinosWasmDecryptMekForDistribution","EBMinosWasmDecryptMekForDistributionFromTransportSender","EBMinosWasmDeriveMailboxEncryptionKeypair","EBMinosWasmEncryptAndSignMessage","EBMinosWasmGenerateMekRosterHash","EBMinosWrapTransportSigningKeypair","MAWProtobufDeserializers","MpsThreadIdToMinosThreadId","MpsThreadIdToWaThreadId","MpsTypes","WAFrankingTypes","WAGlobals","WAResultOrError","asyncToGeneratorRuntime","err","gkx","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;function a(a){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.io,f=e.loadMessageEncryptionKey,g=e.loadMostRecentSelfMinosEpoch,h=e.loadSelfMinosEpochForDecryption,i=e.registerMinosMessageEncryptionKey;e=e.saveNewMessageEncryptionKey;var j=a.logger;a=a.transportSigningKeypair;j.DEV(k||(k=babelHelpers.taggedTemplateLiteralLoose(["gk wmi_lb11_dyi: ",""])),c("gkx")("10542"));j.DEV(l||(l=babelHelpers.taggedTemplateLiteralLoose(["gk wmi_lb11_m2_2: ",""])),c("gkx")("2760"));var x=d("EBMessageEncryptionKeyStorage").createMessageEncryptionKeyStorage({io:{loadMessageEncryptionKey:f,saveNewMessageEncryptionKey:e},logger:j});f=(yield d("EBMinosWrapTransportSigningKeypair").wrapTransportSigningKeypair(a));if(f.success===!1)return d("WAResultOrError").makeError("transport-signing-keypair-error");var y=f.value;e=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.qplFlow;a=a.uploadEntity;var e=a.deletionOfflineThreadingId,f=a.directive,h=a.mailboxKeys,k=a.messageId,l=a.payload,t=a.senderId,u=a.supplementalOpToken,v=a.tags,w=a.threadId;a=a.timestampMs;b.addPoint("generate_mek_roster_hash_start");var z=h.map(function(a){a=a.epochHead;return a});z=(yield d("EBMinosWasmGenerateMekRosterHash").generateMekRosterHash({epochHeads:z}));if(!z.success){b.addPoint("generate_mek_roster_hash_fail");return d("WAResultOrError").makeError("generate-mek-roster-hash-error")}z=z.value;b.addPoint("generate_mek_roster_hash_end");b.addPoint("get_or_generate_mek_start");var B=d("EBMinosTypes").userJidToUserFbId(d("WAGlobals").getMyUserJid());if(B==null){j.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["selfFbid is invalid"])));return d("WAResultOrError").makeError("invalid-self-fbid")}B=(yield d("MpsThreadIdToMinosThreadId").mpsThreadIdToMinosThreadId(w,B));if(!B.success){j.ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["mpsThreadIdToMinosThreadId error: ",""])),B.error);return d("WAResultOrError").makeError("create-minos-thread-id-error")}B=B.value;h=(yield A({actThreadId:c("nullthrows")(d("MpsThreadIdToWaThreadId").mpsThreadIdToWaThreadId(w),"invalid MPS threadId"),io:{loadMostRecentSelfMinosEpoch:g,registerMinosMessageEncryptionKey:i},logger:j,mailboxKeys:h,mekStorage:x,minosThreadId:B,msgUploadQpl:b,rosterHash:z,transportSigningKeypair:y}));if(!h.success){j.ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["get or generate mek error: ",""])),h.error);b.addPoint("get_or_generate_mek_fail");return d("WAResultOrError").makeError("get-mek-error")}b.addPoint("get_or_generate_mek_end",{string:{mekCacheStatus:h.value.cacheStatus}});z=h.value.registeredMek;h=z.mek;var C=z.mekFbid;z=z.miThreadFbid;b.addPoint("encrypt_message_start");B=(yield d("EBMinosWasmEncryptAndSignMessage").encryptAndSignMessage({mekKey:h.key,metadata:{mekId:h.mekId,messageId:k,threadId:B,timestamp:a},plaintext:new Uint8Array(l),transportSigningSK:y.sk}));if(!B.success){j.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["message encryption error: ",""])),B.error);b.addPoint("encrypt_message_fail");return d("WAResultOrError").makeError("encrypt-message-error")}b.addPoint("encrypt_message_end");t=(yield d("EBGetMinosAttachmentPayloadFromMpsMessage").getMinosAttachmentPayloadFromMpsMessage({logger:j,message:{messageId:k,payload:l,senderId:t,threadId:w,timestampMs:a},qplFlow:b}));j.DEV(q||(q=babelHelpers.taggedTemplateLiteralLoose([""," attchmentSecrets generated"])),t.length);b=d("MAWProtobufDeserializers").DeserializedBackupMessage.create(l);l=(l=b.proto.metadata)==null||(l=l.frankingMetadata)==null?void 0:l.frankingTag;var D=null;l==null?d("EBMinosLogger").minosLogger.ERROR(r||(r=babelHelpers.taggedTemplateLiteralLoose(["missing frankingTag in upload"]))):D=d("WAFrankingTypes").castToFrankingTag(new Uint8Array(l));b=(l=b.proto.metadata)==null||(l=l.frankingMetadata)==null?void 0:l.reportingTag;l=null;b==null?d("EBMinosLogger").minosLogger.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["missing reportingTag in upload"]))):l=d("WAFrankingTypes").castToReportingTag(new Uint8Array(b));return d("WAResultOrError").makeResult({attachmentPayload:t,backupActionType:f.actionType,deletionOfflineThreadingId:e,encryptedMsg:B.value.encryptedMsg,encryptedMsgSignature:B.value.signature,frankingTag:D,mekFbid:C,mekId:h.mekId,messageEncryptionVersion:B.value.version,messageTimestampMs:a,miThreadFbid:z,otid:k,reportingTag:l,supplementalOpToken:u,tags:v,toplevelOfflineThreadingId:d("MpsTypes").toMessageId(f.originalMsgProtocolId.externalId),transportSigningPK:y.pk,waThreadId:w})});return function(b){return a.apply(this,arguments)}}();a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.encryptedMessage,c=a.encryptedMsgSignature,e=a.mekCreatorInfo,f=a.mekInfo,g=a.messageEncryptionVersion,i=a.messageInfo,k=a.recipientInfo;a=a.transportSigningPK;var l=(yield h(k.epochFbId));if(!l.success){j.ERROR(t||(t=babelHelpers.taggedTemplateLiteralLoose(["epoch decryption error: ",""])),l.error);return l}k=(yield d("EBMinosWasmDeriveMailboxEncryptionKeypair").deriveMailboxEncryptionKeypair({epochNumber:k.epochAnonId,exportRootKey:l.value.exportRootKey}));if(!k.success){j.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["mailbox encryption key pair derivation error: ",""])),k.error);return d("WAResultOrError").makeError("derive-mailbox-keys-error")}k=k.value.sk;k=e.senderType==="Transport"?yield d("EBMinosWasmDecryptMekForDistributionFromTransportSender").decryptMekForDistributionFromTransportSender({mekDistribution:{encryptedMek:f.encryptedMek,ephemeralEncryptionPk:e.transportSenderEphemeralPK,recipEpochHead:l.value.exportEpochHead,signature:e.transportSenderEphemeralKeySig,signingPk:a},mekEncryptionVersion:f.mekEncryptionVersion,mekId:f.mekId,recipientEncSk:k,rosterHash:f.mekRosterHash}):yield d("EBMinosWasmDecryptMekForDistribution").decryptMekForDistribution({encryptedMek:f.encryptedMek,mailboxAuthPk:e.senderMailboxAuthPK,mailboxEncSk:k,mekEncryptionVersion:f.mekEncryptionVersion,mekId:f.mekId,recipientEpochHead:l.value.exportEpochHead,rosterHash:f.mekRosterHash,senderEpochHead:e.senderEpochHead});if(!k.success){j.ERROR(v||(v=babelHelpers.taggedTemplateLiteralLoose(["mek decryption error: ",""])),k.error);return d("WAResultOrError").makeError("decrypt-mek-error")}l=(yield d("EBMinosWasmDecryptAndVerifyMessage").decryptAndVerifyMessage({cipherText:b,mekKey:k.value,messageEncryptionVersion:g,metadata:{mekId:f.mekId,messageId:i.messageId,threadId:i.threadId,timestamp:i.timestamp},signature:c,transportSigningPK:a}));if(!l.success){j.ERROR(w||(w=babelHelpers.taggedTemplateLiteralLoose(["message decryption error: ",""])),l.error);return d("WAResultOrError").makeError("decrypt-message-error")}return d("WAResultOrError").makeResult(l.value)});return function(b){return a.apply(this,arguments)}}();return d("WAResultOrError").makeResult({decryptMessage:a,encryptMessage:e})});return y.apply(this,arguments)}var z=null;function e(a){if(z!=null){d("EBMinosLogger").minosLogger.DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Minos crypto library is already set"])));return}d("EBMinosLogger").minosLogger.DEV(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Minos crypto library is initialized"])));z=a}function f(){if(z==null){d("EBMinosLogger").minosLogger.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Minos crypto library is not set"])));throw c("err")("Minos crypto library is not set")}return z}function A(a){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.actThreadId,c=a.io,e=a.logger,f=a.mailboxKeys,g=a.mekStorage,h=a.minosThreadId,i=a.msgUploadQpl,j=a.rosterHash;a=a.transportSigningKeypair;var k=(yield g.getMessageEncryptionKey({minosThreadId:h,rosterHash:j}));if(k!=null)return d("WAResultOrError").makeResult(k);k=(yield d("EBGenerateAndUploadMek").generateAndUploadMek({actThreadId:b,io:{loadMostRecentSelfMinosEpoch:c.loadMostRecentSelfMinosEpoch,registerMinosMessageEncryptionKey:c.registerMinosMessageEncryptionKey},logger:e,msgUploadQpl:i,participantMailboxes:f,transportSigningKeypair:a}));if(!k.success){e.ERROR(x||(x=babelHelpers.taggedTemplateLiteralLoose(["mek register error: ",""])),k.error);return d("WAResultOrError").makeError("register-mek-error")}b={mek:k.value.mek,mekFbid:k.value.mekFbid,miThreadFbid:k.value.miThreadFbid};yield g.setNewMessageEncryptionKey({minosThreadId:h,registeredMek:b,rosterHash:j});return d("WAResultOrError").makeResult({cacheStatus:"new",registeredMek:b})});return B.apply(this,arguments)}g.createMinosCryptoLibrary=a;g.setMinosCryptoLibrary=e;g.getMinosCryptoLibrary=f}),98);
__d("EBSenderUploadQueue",["EBMinosLogger","PersistedQueueApi","Promise","WAPersistedQueue","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;c=function(a){return a};var k=null;function l(){return k==null?m():k}function m(){k!=null&&d("EBMinosLogger").minosLogger.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["EB Upload Queue is already initialized"])));var a=d("WAPersistedQueue").initPersistedQueue("ebSenderUploadQueueV3",d("PersistedQueueApi").persistedQueueApi());k=a;return a}function a(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return(j||(j=b("Promise"))).resolve();try{var c=l();yield c.addAndCommit(a)}catch(a){d("EBMinosLogger").minosLogger.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Failed to write to ebSenderUploadQueue ",""])),a);return(j||(j=b("Promise"))).reject(a)}});return n.apply(this,arguments)}g.toSendersQueueId=c;g.ebSenderUploadQueue=l;g.enqueueMessages=a}),98);
__d("EBWorkerEBDBApi",["EBDB","EBDBConsistencyApi","EBLS","LSAuthorityLevel","LSEncryptedBackupsBackupTenancy","WALogger","WAResolvable","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new(d("WAResolvable").Resolvable)();function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("EBLS").genLSClient());try{yield d("EBDBConsistencyApi").startListeningDeviceRegistrations(a.db,d("EBDB").EBDBEnvironment.Worker)}catch(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Error on EBDB init in Worker: ",""])),a)}finally{i.resolve(a.db)}});return j.apply(this,arguments)}function e(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield i.promise);yield d("EBDBConsistencyApi").addNewDevice(b,d("EBDB").EBDBEnvironment.Worker,a)});return k.apply(this,arguments)}function f(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield i.promise);void d("EBDBConsistencyApi").trackConsistency(b,d("EBDB").EBDBEnvironment.Worker,a);return d("EBDBConsistencyApi").getDeviceId()});return l.apply(this,arguments)}function m(){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("EBDB").getEBDB());a=(yield a.store("secure_encrypted_backups_client_state").readAll());return a[0]});return n.apply(this,arguments)}function o(){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("EBDB").getEBDB());a=(yield a.store("secure_encrypted_backups_client_state").readAll());if((a==null?void 0:a.length)===0)return!1;a=a[0];var b=a.authorityLevel;a=a.backupTenancy;if(b==null)return!1;a=a!=null?a:c("LSEncryptedBackupsBackupTenancy").PRODUCTION;return Number(a)===c("LSEncryptedBackupsBackupTenancy").PRODUCTION&&Number(b)===c("LSAuthorityLevel").AUTHORITATIVE});return p.apply(this,arguments)}g.startListeningEBDeviceRegistrations=a;g.addNewDevice=e;g.trackConsistency=f;g.getSecureEBClientState=m;g.isEBEnabledEBDB=o}),98);
__d("EncryptedBackupTaskFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5725");b=d("FalcoLoggerInternal").create("encrypted_backup_task_failure",a);e=b;g["default"]=e}),98);
__d("LSEBPayloadSerializerError",[],(function(a,b,c,d,e,f){a=Object.freeze({INVALID_BACKUP_OPERATION:-7,INVALID_CONTENT_TYPE:-6,INVALID_PAYLOAD_FORMAT:-5,CQL_DB_ERROR:-4,REQUIRED_COLUMN_NOT_PRESENT_ON_CLIENT:-3,DEPRECATED_SPROC:-2,UNKNOWN_ERROR:-1,NOT_AN_ERROR:0,BACKUP_NOT_FOUND:1,REQUIRED_TABLE_NOT_FOUND:2,NATIVE_OP_NOT_FOUND:3,BACKUP_UPLOAD_KILLSWITCHED:4,TASK_ID_NOT_FOUND:5,NOT_IMPLEMENTED:6,NOT_SUPPORTED_ON_WEB:7,DUPLICATE_TASK:8,CLIENT_STATE_NOT_LOADED:9,RECOVERY_CODE_NOT_FOUND:10,EPOCH_KEYS_NOT_FOUND:11,DEVICE_PAYLOAD_NOT_CREATED:12,NULL_DEVICE_PAYLOAD:13,EPOCH_PAYLOAD_NOT_CREATED:14,NULL_EPOCH_PAYLOAD:15,VIRTUAL_DEVICE_PAYLOAD_NOT_CREATED:16,NULL_VIRTUAL_DEVICE_PAYLOAD:17,DEVICE_METADATA_NOT_FOUND:18,NO_MATCHING_DEVICE_PUBLIC_KEY:19,NULL_MAILBOX_ROOT_KEY:20,NULL_ENCRYPTION_VERSION:21,NULL_OCMF_KEY:22,NULL_EPOCH_KEYS:23,NULL_DEVICE_ID:24,OPE_KEY_DERIVATION_FAILED:25,MESSAGE_KEY_DERIVATION_FAILED:26,NULL_MAILBOX_ROOT_KEY_V2:27,ECHO_DOCUMENT_ENCODING_FAILED:30,ECHO_PAYLOAD_CREATION_DISABLED:31,ECHO_DOCUMENT_ENCODING_SKIPPED:32,MESSAGE_PAYLOAD_ENCRYPTION_FAILED:40,SERVER_THREAD_ID_NOT_FOUND_FOR_JID:52,UNKNOWN_PROTOBUF_TYPE:60,SUPPLEMENTARY_DATA_KEY_UNEXPECTED:61,PROTOBUF_ENCRYPTION_FAILED:62,PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE:63,PROTOBUF_NOT_FOUND_IN_SUPPLEMENTAL_TABLE:64,SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE:65,SUPPLEMENTAL_ENCRYPTION_FAILED:66,PROTOBUF_CONTEXT_ROW_NOT_FOUND:67,PROTOBUF_FORMATTING_FAILED:68,SUPPLEMENTAL_FORMATTING_FAILED:69,PROTOBUF_ALREADY_DELETED:70,PROTOBUF_NOT_FOUND_IN_DELETED_MESSAGES_TABLE:71,DELETION_PROTOBUF_IS_NULL:72,PROTOBUF_PAYLOAD_IN_CONTEXT_ROW_IS_NOT_FOUND:73,PROTOBUF_ENCRYPTION_FAILED_RETRYABLE:74,VALUE_SECRET_REF_INVALID:75,MINOS_ENCRYPTION_RESULT_NULL:76,SUPPLEMENTAL_OTID_NOT_SET_IN_CONTEXT_TABLE:77,SNAPSHOT_NOT_FOUND_FAILURE:78,THREAD_PK_NOT_FOUND_FOR_JID:100,MESSAGE_DECRYPTION_FAILED:101,EPOCH_KEY_FETCH_FAILED:102,TOO_MANY_OPEN_EPOCHS:103,MESSAGE_RANGE_PREPARE_FAILURE:104,ECHO_DOCUMENT_RESTORE_FAILED:105,MISMATCH_POINT_QUERY_MESSAGE_AND_RANGE_LENGTH:106,INITIAL_THREADS_FETCH_FOR_RESTORE_FAILED:107,MISSING_SUPPLEMENTAL_KEY_CIPHERTEXT:108,SUPPLEMENTAL_KEY_DECRYPTION_FAILURE:109,DEVICE_ID_MISMATCH:110,RESTORE_TO_TAM_INFO:111,MISSING_SERVER_THREAD_KEY:112,EB_ADD_DEVICE_FOUND_NO_LOCAL_THREADS:113,EB_MORE_THREADS_IN_MAPPING_TABLE:114,RESTORE_INTEGRITY_CHECK_FAILED:115,RESTORE_TOP_LEVEL_PROTOBUF_NULL:116,DECRYPT_MINOS_PROTOBUF_FAILURE:117,MESSAGE_PK_NOT_FOUND_IN_CLIENT_MESSAGES:200,OTID_NOT_FOUND_IN_ACT_MESSAGES:201,THREAD_ID_NOT_FOUND_IN_ACT_THREADS:202,THREAD_PK_NOT_FOUND_IN_CLIENT_THREADS:203,FAILED_TO_GET_THREAD_SORT_KEY:204,MEDIA_INFO_INVALID:205,REVERB_DB_NOT_ENABLED_FOR_INSTAMADILLO:206,SKIPPED_EB_DISABLED:300,SKIPPED_THREAD_NOT_ELIGIBLE:301,SKIPPED_MESSAGE_NOT_ELIGIBLE:302,NO_EPOCHS_FOUND:400,LATEST_EPOCH_QUERY_BY_ID_FAILED:401,FOUND_EPOCH_WITH_NULL_ROOT_KEY:402,FOUND_EPOCH_WITH_NULL_ANON_ID:403,NO_RECOVERY_CODE:501,NO_ERROR:601,ERROR_GENERAL:602,UNKNOWN:603,ONBOARDING_MATERIAL_DERIVATION_FAILURE:604,NULL_DEVICE_HMAC:605,MISSING_LATEST_EPOCH_AT_ONBOARDING:606,NO_THREADS_TO_COMPARE:701,START_SORT_KEY_FAILURE:702,END_SORT_KEY_FAILURE:703,LOOPING_UPLOAD_PAYLOAD_NOT_FOUND:704,NULL_ECHO_IDENTIFIERS:705,ECHO_TIMESTAMP_CONVERSION_FAILED:706,ECHO_PROTOBUF_THREAD_ID_MISMATCH:707,ECHO_PROTOBUF_TIMESTAMP_MISMATCH:708,ECHO_PROTOBUF_OTID_MISMATCH:709,NULL_ECHO_DOCUMENT:710,INVALID_PROTOBUF_BACKUP_ACTION:711,EMPTY_ENCODED_ECHO_DOCUMENT:712,LOOPING_UPLOAD_TASK_QUEUE_FULL:713,ECHO_DOCUMENT_ENCODING_UNKNOWN_ENCODING_ERROR:750,ECHO_DOCUMENT_ENCODING_MESSAGE_PK_NOT_FOUND_ERROR:751,ECHO_DOCUMENT_ENCODING_DISK_WRITE_CHECK_FAILED:752,ECHO_DOCUMENT_ENCODING_THREAD_TRANSPORT_ID_FETCH_FAILED:753,ECHO_DOCUMENT_ENCODING_FILE_WRITE_FAILED:754,ECHO_DOCUMENT_ENCODING_DISK_WRITE_DISABLED:755,ECHO_DOCUMENT_ENCODING_SHOULD_NOT_PERSIST:756,MISSING_SUPPLEMENTAL_DATA:757,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_REPLY_PROXY_ERROR:758,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_EDIT_MESSAGE_QUERY_ERROR:759,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_EDIT_MESSAGE_ERROR:760,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_RECEIPTS_ERROR:761,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_REACTIONS_ERROR:762,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_VISUAL_MESSAGE_ACTIONS_ERROR:763,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_POLLS_ERROR:764,READ_CLIENT_STATE_FROM_MAIN_DB_ERROR:801,NOT_SUPPORTED_ON_MAIN_DB:802,SKIP_MPS_WRITE_DUE_TO_HIGHER_TIMESTAMP_AVAILABILITY:851,MESSAGE_ALREADY_DELETED:852});f["default"]=a}),66);
__d("WADbTransactor",["MAWDexie","MAWIndexedDb","MAWTransactionMode","WAExceededStorageQuota","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){var e=Object.keys(a),f=e.some(function(b){return a[b]===d("MAWTransactionMode").READWRITE})?d("MAWTransactionMode").READWRITE:d("MAWTransactionMode").READONLY;return function(){for(var a=arguments.length,g=new Array(a),i=0;i<a;i++)g[i]=arguments[i];return d("MAWIndexedDb").getSignalDB(b).then(function(a){return h(f,e,function(){return c(a.stores).apply(void 0,g)})}).then(function(a){return a})["catch"](function(a){throw k(a,b)})}}function h(a,b,e){if(c("MAWDexie").currentTransaction!=null)throw c("err")("protocolDB transactor %s cannot be called within another transaction");return d("MAWIndexedDb").getSignalDB().then(function(c){return c.transact(a,b,e)})}function i(a){if(a instanceof Error)return a;else if(typeof a==="string")return c("err")(a);else return null}function e(a,b,c,d){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=a+"_"+e,g=(yield d("MAWIndexedDb").getDB(f));return g.transact(b,[a],function(){return c(g.stores[a])}).then(function(a){return a})["catch"](function(a){throw k(a,f)})});return j.apply(this,arguments)}function k(a,b){var e;d("WAExceededStorageQuota").checkQuotaExceededError(a);a=i(a);if(!a)return c("err")("[unknown error] Error performing %s transaction "+b);a.message="["+((e=a==null?void 0:a.toString())!=null?e:"unknown error")+"] Error performing %s transaction "+b;return a}g.makeSignalTransactor=a;g.persistedQueueTransactor=e}),98);
__d("WAClearSignalStores",["MAWDexieTable","MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({tasks:d("MAWTransactionMode").READWRITE},"clearSignalStores",function(a){return function(){return d("MAWDexieTable").dexieAll([a.tasks.clear()]).then(function(){})}});g.clearSignalStores=a}),98);
__d("WAHandleFailureUtils",["FBLogger","ODS","Promise","WABridge","WAOdsEnums","asyncToGeneratorRuntime","getErrorSafe","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("MAWClearSignalAndTempStores").__setRef("WAHandleFailureUtils");f={GENERIC_FAILURE:"400",NOT_AUTHORIZED:"401",TEMP_BANNED:"402",BANNED:"403",CAT_EXPIRED:"413",CAT_INVALID:"414",NOT_FOUND:"415",CAT_SESSION_INVALID:"418",INTERNAL_ERROR:"500",SERVER_UNAVAILABLE:"503"};function k(){return new(i||(i=b("Promise")))(function(a,b){j.onReady(function(d){c("promiseDone")(d.clearSignalAndTempStores(),function(){return a()},function(a){a=c("getErrorSafe")(a);c("FBLogger")("wmi").catching(a).mustfix("Failed to clear signal and temp stores");b(a)})})})}function a(){return k().then(function(){d("WABridge").getBridge().fireAndForget("event","logout",{})})}function e(){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield k(),(h||(h=d("ODS"))).bumpEntityKey(3185,d("WAOdsEnums").Entity.WA_REREGISTRATION,"reregister_phone"),d("WABridge").getBridge().fireAndForget("event","reregisterDevice",{})});return l.apply(this,arguments)}g.FAILURE_CODES=f;g.clearRegistrationAndTempData=k;g.deregisterPhone=a;g.reregisterPhone=e}),98);
__d("WASignalDB",["BrowserLockManager","QPLFlow","WAHandleFailureUtils","WAHex","WAIDBTypes","WALogger","WAResolvable","Worm","WormEAR","WormIDbDriver","WormIDbUtils","asyncToGeneratorRuntime","err","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i={identity:{primaryKey:"deviceJid",indexes:{userJid:{fields:["userJid"],unique:!1}}},contacts:{primaryKey:"contactJid",indexes:{}},session:{indexes:{},primaryKey:"id"},senderKeySessions:{primaryKey:"id",indexes:{groupJid:{fields:["groupJid"],unique:!1},userJid:{fields:["userJid"],unique:!1}}},prekey:{indexes:{},primaryKey:"keyId"},prekeyGeneration:{indexes:{},primaryKey:"generationId"},signedPrekey:{indexes:{},primaryKey:"keyId"},meta:{indexes:{},primaryKey:"key"},plaintextMeta:{indexes:{},primaryKey:"key",secure:!1},icdcFails:{indexes:{},primaryKey:"contactJid"},personalSenderKeyStatuses:{indexes:{},primaryKey:"groupJid"}},j,k=new(d("WAResolvable").Resolvable)();function a(a,b,c,d,e,f){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,l,m){var o=m!=null?d("QPLFlow").startQPLFlow(m,{timeoutInMs:c("justknobx")._("3415"),annotations:{string:{operationType:"initDb"}}}):null;try{yield n(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=d("WAHex").parseHex(e),c="signalDb";b=new(d("WormEAR").WormEAR)(i,c,b);c=new(d("Worm").WormDatabase)(new(d("WormIDbDriver").WormIDbDriver)(a,c,i,b,l,{blockingErrorThreshold:f,onBlockingError:g,safeToDeleteStores:new Set(["stanzaQueue","danglingQueue","migration"]),onTransactionError:function(b){if(b instanceof d("WormEAR").DecryptionError){b=b;if(b.store==="icdcFails")return;void d("WormIDbUtils").promisifyIDbRequest(d("WAIDBTypes").idb().deleteDatabase(a)).then(function(){return d("WAHandleFailureUtils").reregisterPhone()})}}}),m);j=c;yield c.init({eventFlow:o});k.resolve(c);o==null||o.endSuccess()}))}catch(a){o==null||o.endFail("error");d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[WORM] Error performing initDb: ",""])),a);throw a}});return l.apply(this,arguments)}function e(){if(j==null)throw c("err")("Signal Db v3 is not initialized");return j}function f(){return k.promise}function m(a){return"Signal - "+a}function n(a){return c("BrowserLockManager")!=null?c("BrowserLockManager").request("wajs_make_signal_v3_db",a):a()}g.makeSignalDb=a;g.getDb=e;g.getDbPromise=f;g.signalOp=m}),98);
__d("WAClearSignalStoresV2",["Promise","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){return d("WASignalDB").getDb().runInTransaction(["identity","contacts","meta","prekey","prekeyGeneration","senderKeySessions","session","signedPrekey","personalSenderKeyStatuses"],"readwrite",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield (h||(h=b("Promise"))).all([a.stores.identity.clear(),a.stores.contacts.clear(),a.stores.meta.clear(),a.stores.prekey.clear(),a.stores.prekeyGeneration.clear(),a.stores.senderKeySessions.clear(),a.stores.session.clear(),a.stores.signedPrekey.clear(),a.stores.personalSenderKeyStatuses.clear()])});return function(b){return a.apply(this,arguments)}}(),d("WASignalDB").signalOp("clearSignalStores"))};g.clearSignalStores=a}),98);
__d("MAWClearSignalAndTempStores",["MAWDeleteOldLogsFromDisk","MAWJobActionsV2","MAWJobsIndexedDb","MAWLoggingSwitches","MAWTransactionMode","Promise","WAClearSignalStores","WAClearSignalStoresV2","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("MAWJobsIndexedDb").makeJobsTransactor("jobs",d("MAWTransactionMode").READWRITE,"clearJob")(d("MAWJobActionsV2").clearJobs);a=function(){return(h||(h=b("Promise"))).all([d("MAWLoggingSwitches").removeLoggingFromBridge&&d("MAWDeleteOldLogsFromDisk").clearLogs(),d("WAClearSignalStores").clearSignalStores(),i(),d("WAClearSignalStoresV2").clearSignalStores()]).then(c("emptyFunction"))};g.clearSignalAndTempStores=a}),98);
__d("MAWTraceUtils",["LSDataTraceTag","LSRequestId","MAWMsgType"],(function(a,b,c,d,e,f,g){"use strict";f="backup_upload";var h="media_backup",i="vesta_registration",j="vesta_login";function a(){return c("LSRequestId").generate()}function b(a){return a}function e(a){switch(a){case d("MAWMsgType").MSG_TYPE.TEXT:return d("LSDataTraceTag").messageTypeText;case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:return d("LSDataTraceTag").messageTypeFutureproof;case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:return d("LSDataTraceTag").messageTypeCiphertext;case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:return d("LSDataTraceTag").messageTypeUnavailable;case d("MAWMsgType").MSG_TYPE.IMAGE:return d("LSDataTraceTag").messageTypeImage;case d("MAWMsgType").MSG_TYPE.VIDEO:return d("LSDataTraceTag").messageTypeVideo;case d("MAWMsgType").MSG_TYPE.PTT:return d("LSDataTraceTag").messageTypePtt;case d("MAWMsgType").MSG_TYPE.ADMIN:return d("LSDataTraceTag").messageTypeAdmin;case d("MAWMsgType").MSG_TYPE.REVOKED:return d("LSDataTraceTag").messageTypeRevoked;case d("MAWMsgType").MSG_TYPE.GIF:return d("LSDataTraceTag").messageTypeGif;case d("MAWMsgType").MSG_TYPE.STICKER:return d("LSDataTraceTag").messageTypeSticker;case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:return d("LSDataTraceTag").messageTypeExpiredEphemeral;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:return d("LSDataTraceTag").messageTypeEphemeralSettingAdmin;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:return d("LSDataTraceTag").messageTypeEphemeralSyncResponse;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:return d("LSDataTraceTag").messageTypeEphemeralScreenshotAction;case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:return d("LSDataTraceTag").messageTypeDeleteForMe;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:return d("LSDataTraceTag").messageTypeEphemeralSettingChangeFromCurrentDevice;case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:return d("LSDataTraceTag").messageTypeAlertICDC;case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:return d("LSDataTraceTag").messageTypeGroupInvite;case d("MAWMsgType").MSG_TYPE.XMA:return d("LSDataTraceTag").messageTypeXMA;case d("MAWMsgType").MSG_TYPE.REACTION:return d("LSDataTraceTag").messageTypeReaction;case d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION:return d("LSDataTraceTag").messageTypeSenderKeyDistribution;default:return d("LSDataTraceTag").messageTypeNone}}g.CONTEXT_BACKUP_UPLOAD=f;g.CONTEXT_MEDIA_BACKUP=h;g.CONTEXT_VESTA_REGISTRATION=i;g.CONTEXT_VESTA_LOGIN=j;g.createTraceId=a;g.stringToTraceId=b;g.getTagForMsgType=e}),98);
__d("WAAbPropsHelpers",["WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=86400,m=600,n=604800;function a(a){return a==null?l:Math.max(m,Math.min(n,a))}function o(a){var b=[];Object.keys(a).forEach(function(c){var d=a[c],e=d[0];d[1];d=d[2];if(typeof e!=="number")return;b.push({configName:c,configCode:e,configDefault:d})});return b}function b(a,b){a=a[b][0];return typeof a==="number"?a:null}function p(a,b){switch(typeof b){case"boolean":return a==="1";case"number":return parseFloat(a);case"string":return a;default:d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["parseValue: unsure how to read ",""])),a);return null}}function c(a,b){var c=new Map();b.forEach(function(a){var b=a.configCode,d=a.configValue;a=a.configExpoKey;c.set(b,{configValue:d,configExpoKey:a})});var d={},e={};o(a).forEach(function(a){var b=a.configName,f=a.configCode;a=a.configDefault;var g=c.get(f);if(g==null)return;var h=g.configValue;g=g.configExpoKey;h=p(h,a);h!=null&&(d[b]=h);e[f]=g!=null?g:null});return{values:d,expoKeys:e}}function e(a,b,c){var e=babelHelpers["extends"]({},b,a),f={};Object.keys(e).forEach(function(a){if(c[a]==null){d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["maybeUpdatePropValues: deleting config ",""])),a);return}f[a]=e[a]});return f}function f(a,b,c){var e=babelHelpers["extends"]({},b,a),f={};a=o(c).map(function(a){return a.configCode});var g=new Set(a),h=new Set();Object.keys(e).forEach(function(a){a=parseInt(a,10);var c=b?b[a]:null;!g.has(a)?(d("WALogger").LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["maybeUpdateExpoKeys: deleting config_expo_key ",""])),a),c!=null&&c.trim()&&h.add(c)):(e[a]!==c&&(d("WALogger").LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["maybeUpdateExpoKeys: config_expo_key "," changed"])),a),c!=null&&c.trim()&&h.add(c)),f[a]=e[a])});return{propExpoKeys:f,expoKeysToDelete:h}}function q(a,b){if(b==null)return;var c=b;a.forEach(function(a){c["delete"](a)});if(c.size===0)return;return{internalExpoKeys:c,expoKeyStr:Array.from(c).join(",")}}g.maybeUpdateRefresh=a;g.asAbList=o;g.asAbCode=b;g.parseAbProps=c;g.maybeUpdatePropValues=e;g.maybeUpdateExpoKeys=f;g.maybeUpdateInternalExpoKeys=q}),98);
__d("WAAbProps",["WAAbPropsHelpers","err"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function i(a){if(h)return h;else throw c("err")("abProps::"+a+" called before startAbProps")}function a(a,b){h==null&&(h={config:b,db:a})}function b(){return i("getHash").db.getHash()}function e(){return i("getRefreshSecs").db.getRefreshSecs().then(function(a){return d("WAAbPropsHelpers").maybeUpdateRefresh(a)})}function f(){return i("getConfig").config}function j(){return i("getAbProps").db.getAbProps()}function k(a){return i("getAbProps").db.setAbProps(a)}g.startAbProps=a;g.getHash=b;g.getRefreshSecs=e;g.getConfig=f;g.getAbProps=j;g.setAbProps=k}),98);
__d("WAAppData",[],(function(a,b,c,d,e,f){"use strict";a=1;b=2;f.EPOCH_STATUS_OPEN=a;f.EPOCH_STATUS_CLOSE=b}),66);
__d("WAArmadilloICDC.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.name="ICDCIdentityList";a.internalSpec={seq:[1,(c=d("WAProtoConst")).TYPES.INT32],timestamp:[2,c.TYPES.INT64],devices:[3,c.FLAGS.REPEATED|c.TYPES.BYTES],signingDeviceIndex:[4,c.TYPES.INT32]};b.name="SignedICDCIdentityList";b.internalSpec={details:[1,c.TYPES.BYTES],signature:[2,c.TYPES.BYTES]};g.ICDCIdentityListSpec=a;g.SignedICDCIdentityListSpec=b}),98);
__d("WAArrayChunk",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c,d){c===void 0&&(c=!1);var e=0,f=[];while(e<a.length){var g=[],h=0;while(e<a.length){var i=a[e],j=d?d(i):1;if(!c&&h===0||h+j<=b)h+=j,g.push(i),e++;else{c&&j>b&&e++;break}}g.length>0&&f.push(g)}return f}f.chunk=a}),66);
__d("WACryptoPkcs7",["WACryptoDependencies","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=new Uint8Array(1);do d("WACryptoDependencies").getCrypto().getRandomValues(b);while(b[0]===0);h(a,b[0])}function b(a){var b=new Uint8Array(1);d("WACryptoDependencies").getCrypto().getRandomValues(b);h(a,(b[0]&15)+1)}function h(a,b){for(var c=0;c<b;c++)a.writeUint8(b)}function e(a){if(a.length===0)throw c("err")("unpadPkcs7 given empty bytes");var b=a[a.length-1];if(b>a.length)throw c("err")("unpadPkcs7 given "+a.length+" bytes, but pad is "+b);return new Uint8Array(a.buffer,a.byteOffset,a.length-b)}g.writeRandomPad=a;g.writeRandomPadMax16=b;g.writePad=h;g.unpadPkcs7=e}),98);
__d("WAMsgTransport.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={NOOP:0,UPSERT:1,DELETE:2,UPSERT_AND_DELETE:3};b={};c={};e={};f={};var i={},j={},k={},l={},m={},n={},o={};b.name="MessageTransport";b.internalSpec={payload:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,c],protocol:[2,h.TYPES.MESSAGE,e]};c.name="MessageTransport$Payload";c.internalSpec={applicationPayload:[1,h.TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec],futureProof:[3,h.TYPES.ENUM,d("WACommon.pb").FUTURE_PROOF_BEHAVIOR]};e.name="MessageTransport$Protocol";e.internalSpec={integral:[1,h.TYPES.MESSAGE,m],ancillary:[2,h.TYPES.MESSAGE,f]};f.name="MessageTransport$Protocol$Ancillary";f.internalSpec={skdm:[2,h.TYPES.MESSAGE,l],deviceListMetadata:[3,h.TYPES.MESSAGE,o],icdc:[4,h.TYPES.MESSAGE,j],backupDirective:[5,h.TYPES.MESSAGE,i]};i.name="MessageTransport$Protocol$Ancillary$BackupDirective";i.internalSpec={messageId:[1,h.TYPES.STRING],actionType:[2,h.TYPES.ENUM,a],supplementalKey:[3,h.TYPES.STRING]};j.name="MessageTransport$Protocol$Ancillary$ICDCParticipantDevices";j.internalSpec={senderIdentity:[1,h.TYPES.MESSAGE,k],recipientIdentities:[2,h.FLAGS.REPEATED|h.TYPES.MESSAGE,k],recipientUserJids:[3,h.FLAGS.REPEATED|h.TYPES.STRING]};k.name="MessageTransport$Protocol$Ancillary$ICDCParticipantDevices$ICDCIdentityListDescription";k.internalSpec={seq:[1,h.TYPES.INT32],signingDevice:[2,h.TYPES.BYTES],unknownDevices:[3,h.FLAGS.REPEATED|h.TYPES.BYTES],unknownDeviceIds:[4,h.FLAGS.REPEATED|h.TYPES.INT32]};l.name="MessageTransport$Protocol$Ancillary$SenderKeyDistributionMessage";l.internalSpec={groupId:[1,h.TYPES.STRING],axolotlSenderKeyDistributionMessage:[2,h.TYPES.BYTES]};m.name="MessageTransport$Protocol$Integral";m.internalSpec={padding:[1,h.TYPES.BYTES],dsm:[2,h.TYPES.MESSAGE,n]};n.name="MessageTransport$Protocol$Integral$DeviceSentMessage";n.internalSpec={destinationJid:[1,h.TYPES.STRING],phash:[2,h.TYPES.STRING]};o.name="DeviceListMetadata";o.internalSpec={senderKeyHash:[1,h.TYPES.BYTES],senderTimestamp:[2,h.TYPES.UINT64],recipientKeyHash:[8,h.TYPES.BYTES],recipientTimestamp:[9,h.TYPES.UINT64]};g.MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE=a;g.MessageTransportSpec=b;g.MessageTransport$PayloadSpec=c;g.MessageTransport$ProtocolSpec=e;g.MessageTransport$Protocol$AncillarySpec=f;g.MessageTransport$Protocol$Ancillary$BackupDirectiveSpec=i;g.MessageTransport$Protocol$Ancillary$ICDCParticipantDevicesSpec=j;g.MessageTransport$Protocol$Ancillary$ICDCParticipantDevices$ICDCIdentityListDescriptionSpec=k;g.MessageTransport$Protocol$Ancillary$SenderKeyDistributionMessageSpec=l;g.MessageTransport$Protocol$IntegralSpec=m;g.MessageTransport$Protocol$Integral$DeviceSentMessageSpec=n;g.DeviceListMetadataSpec=o}),98);
__d("WAAsMessageTransport",["WABinary","WACryptoPkcs7","WAJids","WAMsgTransport.pb"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a.type){case"text":return{actionType:d("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE.UPSERT,messageId:a.externalId,supplementalKey:null};case"media":return{actionType:d("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE.UPSERT,messageId:a.externalId,supplementalKey:null};case"reaction":return{actionType:d("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE.UPSERT,messageId:a.originalMsgExternalId,supplementalKey:"reaction:"+d("WAJids").extractChatId__DANGEROUS(a.chatJid)};case"edit":return{actionType:d("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE.UPSERT,messageId:a.originalMsgExternalId,supplementalKey:"edit:"+d("WAJids").extractChatId__DANGEROUS(a.chatJid)+":"+(a.timestamp*1e3).toString()}}}function b(a,b,c,e,f,g){g===void 0&&(g=2);var h;b!=null&&(h={destinationJid:b});var i;a!=null&&(i={applicationPayload:{payload:a,version:g}});b=new(d("WABinary").Binary)();d("WACryptoPkcs7").writeRandomPadMax16(b);return{payload:i,protocol:{integral:{padding:b.readBuffer(),dsm:h},ancillary:{skdm:c==null?void 0:c,icdc:e==null?void 0:e,backupDirective:f==null?void 0:{actionType:f.actionType,messageId:f.messageId,supplementalKey:f.supplementalKey}}}}}g.backupDirectiveActionType=d("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE;g.constructBackupDirective=a;g.asMessageTransport=b}),98);
__d("WAConvertRegistrationIdMixin",["WAParsableXmlNode"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("WAParsableXmlNode").convertBytesToUint(a.registrationElementValue,4)}g.registrationIdMixin=a}),98);
__d("WAConvertSignedPreKeyMixin",["WAParsableXmlNode"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return{id:d("WAParsableXmlNode").convertBytesToUint(a.skeyIdKeyIDMixin.elementValue,3),pubkey:a.skeyValueKeyDataMixin.elementValue,signature:a.skeySignatureElementValue}}g.convertSignedPreKeyMixin=a}),98);
__d("WASmaxInPreKeysIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInPreKeysIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInPreKeysIQErrorFallbackClientMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"code",400,499);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFallbackClientMixin=a}),98);
__d("WASmaxInPreKeysIQErrorNoValidJIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-acceptable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",406);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorNoValidJIDMixin=a}),98);
__d("WASmaxInPreKeysRequestErrorsFetch",["WAResultOrError","WASmaxInPreKeysIQErrorBadRequestMixin","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorNoValidJIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInPreKeysIQErrorNoValidJIDMixin").parseIQErrorNoValidJIDMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorNoValidJID",value:c.value});var e=d("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return e.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorNoValidJID","IQErrorFallbackClient"],[b,c,e])}g.parseRequestErrorsFetch=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrorsFetch","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrorsFetch").parseRequestErrorsFetch(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrorsFetch:b.value}))}g.parseFetchKeyBundlesResponseRequestError=a}),98);
__d("WASmaxInPreKeysIQErrorFallbackServerMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"code",500,599);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFallbackServerMixin=a}),98);
__d("WASmaxInPreKeysIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","service-unavailable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",503);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorServiceUnavailableMixin=a}),98);
__d("WASmaxInPreKeysServerErrors",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackServerMixin","WASmaxInPreKeysIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:b.value});var c=d("WASmaxInPreKeysIQErrorFallbackServerMixin").parseIQErrorFallbackServerMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackServer",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorServiceUnavailable","IQErrorFallbackServer"],[b,c])}g.parseServerErrors=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseFetchKeyBundlesResponseServerError=a}),98);
__d("WASmaxInPreKeysEnums",["WAJids"],(function(a,b,c,d,e,f,g){b={validators:[(a=d("WAJids")).validateDeviceJid,a.validateDeviceJid],typeName:"DeviceJid|DeviceJid"};c={validators:[a.validateDeviceJid,a.validateDeviceJid,a.validateInteropDeviceJid,a.validateInteropDeviceJid],typeName:"DeviceJid|DeviceJid|InteropDeviceJid|InteropDeviceJid"};e={validators:[a.validateDeviceJid,a.validateDomainJid],typeName:"DeviceJid|DomainJid"};f={validators:[a.validateUserJid,a.validateUserJid],typeName:"UserJid|UserJid"};g.DEVICEJID_DEVICEJID=b;g.DEVICEJID_DEVICEJID_INTEROPDEVICEJID_INTEROPDEVICEJID=c;g.DEVICEJID_DOMAINJID=e;g.USERJID_USERJID=f}),98);
__d("WASmaxInPreKeysIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInPreKeysResponsePaddingMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"iq");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"padding");if(!b.success)return b;a=d("WASmaxParseUtils").contentBytesRange(b.value,0,524288);return!a.success?a:d("WAResultOrError").makeResult({paddingElementValue:a.value})}g.parseResponsePaddingMixin=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(b.value,"text");if(!a.success)return a;b=d("WASmaxParseUtils").attrIntRange(b.value,"code",500,599);return!b.success?b:d("WAResultOrError").makeResult({errorText:a.value,errorCode:b.value})}g.parseFetchKeyBundlesUserErrorFallbackMixin=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(b.value,"text");if(!a.success)return a;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,b.value,"code",500);return!b.success?b:d("WAResultOrError").makeResult({errorText:a.value,errorCode:b.value})}g.parseFetchKeyBundlesUserErrorMixin=a}),98);
__d("WASmaxInPreKeysDeviceIdentityMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"device-identity");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytes(a.value);return!a.success?a:d("WAResultOrError").makeResult({deviceIdentityElementValue:a.value})}g.parseDeviceIdentityMixin=a}),98);
__d("WASmaxInPreKeysKeyDataMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").contentBytesRange(a,32,32);return!a.success?a:d("WAResultOrError").makeResult({elementValue:a.value})}g.parseKeyDataMixin=a}),98);
__d("WASmaxInPreKeysIdentityKeyMixin",["WASmaxInPreKeysKeyDataMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"identity");if(!a.success)return a;a=d("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(a.value);return!a.success?a:a}g.parseIdentityKeyMixin=a}),98);
__d("WASmaxInPreKeysKeyTypeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"type");if(!a.success)return a;a=d("WASmaxParseUtils").contentLiteralBytes(a.value,new Uint8Array([5]));return!a.success?a:d("WAResultOrError").makeResult({typeElementValue:a.value})}g.parseKeyTypeMixin=a}),98);
__d("WASmaxInPreKeysKeyIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"id");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytesRange(a,3,3);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}g.parseKeyIDMixin=a}),98);
__d("WASmaxInPreKeysPreKeyMixin",["WAResultOrError","WASmaxInPreKeysKeyDataMixin","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"key");if(!a.success)return a;var b=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"id");if(!b.success)return b;a=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"value");if(!a.success)return a;b=d("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(b.value);if(!b.success)return b;a=d("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(a.value);return!a.success?a:d("WAResultOrError").makeResult({keyIdKeyIDMixin:b.value,keyValueKeyDataMixin:a.value})}g.parsePreKeyMixin=a}),98);
__d("WASmaxInPreKeysRegistrationIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"registration");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,4,4);return!a.success?a:d("WAResultOrError").makeResult({registrationElementValue:a.value})}g.parseRegistrationIDMixin=a}),98);
__d("WASmaxInPreKeysSignedPreKeyMixin",["WAResultOrError","WASmaxInPreKeysKeyDataMixin","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"skey");if(!a.success)return a;var b=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"id");if(!b.success)return b;var c=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"value");if(!c.success)return c;a=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"signature");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,64,64);if(!a.success)return a;b=d("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(b.value);if(!b.success)return b;c=d("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(c.value);return!c.success?c:d("WAResultOrError").makeResult({skeySignatureElementValue:a.value,skeyIdKeyIDMixin:b.value,skeyValueKeyDataMixin:c.value})}g.parseSignedPreKeyMixin=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin",["WAResultOrError","WASmaxInPreKeysDeviceIdentityMixin","WASmaxInPreKeysIdentityKeyMixin","WASmaxInPreKeysKeyTypeMixin","WASmaxInPreKeysPreKeyMixin","WASmaxInPreKeysRegistrationIDMixin","WASmaxInPreKeysSignedPreKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,a,"is_cloud_api","true");if(!c.success)return c;var e=d("WASmaxInPreKeysRegistrationIDMixin").parseRegistrationIDMixin(a);if(!e.success)return e;var f=d("WASmaxInPreKeysKeyTypeMixin").parseKeyTypeMixin(a),g=d("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(a);if(!g.success)return g;var h=d("WASmaxInPreKeysPreKeyMixin").parsePreKeyMixin(a),i=d("WASmaxInPreKeysSignedPreKeyMixin").parseSignedPreKeyMixin(a);if(!i.success)return i;a=d("WASmaxInPreKeysDeviceIdentityMixin").parseDeviceIdentityMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({t:b.value,isCloudApi:c.value},e.value,{keyTypeMixin:f.success?f.value:null},g.value,{preKeyMixin:h.success?h.value:null},i.value,{deviceIdentityMixin:a.success?a.value:null}))}g.parseFetchKeyBundlesUserSuccessMixin=a}),98);
__d("WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup",["WAResultOrError","WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin","WASmaxInPreKeysFetchKeyBundlesUserErrorMixin","WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin").parseFetchKeyBundlesUserSuccessMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"FetchKeyBundlesUserSuccess",value:b.value});var c=d("WASmaxInPreKeysFetchKeyBundlesUserErrorMixin").parseFetchKeyBundlesUserErrorMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"FetchKeyBundlesUserError",value:c.value});var e=d("WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin").parseFetchKeyBundlesUserErrorFallbackMixin(a);return e.success?d("WAResultOrError").makeResult({name:"FetchKeyBundlesUserErrorFallback",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["UserSuccess","UserError","UserErrorFallback"],[b,c,e])}g.parseUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseSuccess",["WAResultOrError","WASmaxInPreKeysEnums","WASmaxInPreKeysIQResultResponseMixin","WASmaxInPreKeysResponsePaddingMixin","WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseJid").attrJidEnum(a,"jid",d("WASmaxInPreKeysEnums").DEVICEJID_DEVICEJID);if(!b.success)return b;a=d("WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup").parseUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup(a);return!a.success?a:d("WAResultOrError").makeResult({jid:b.value,userFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup:a.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"list");if(!c.success)return c;b=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!b.success)return b;a=d("WASmaxInPreKeysResponsePaddingMixin").parseResponsePaddingMixin(a);c=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"user",0,1e5,h);return!c.success?c:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{responsePaddingMixin:a.success?a.value:null,listUser:c.value}))}g.parseFetchKeyBundlesResponseSuccessListUser=h;g.parseFetchKeyBundlesResponseSuccess=a}),98);
__d("WASmaxAttrs",["WAWap"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b==null)return d("WAWap").DROP_ATTR;else return a(b)}function b(a,b){if(b)return a;else return d("WAWap").DROP_ATTR}g.OPTIONAL=a;g.OPTIONAL_LITERAL=b}),98);
__d("WASmaxChildren",["WADeepEquals"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b==null)return null;else return a(b)}function b(a,b){if(b==null)return null;else if(b)return a()}function c(a,b){if(b)for(var c=1;c<b.length;c++)if(!d("WADeepEquals").deepEqual(b[c],b[0]))throw new Error("expected all homogeneous children to be equal, but they were not");c=h(a,b,0,Infinity);return c}function e(a,b){return i(a,b,0,Infinity)}function h(a,b,c,d){if(b==null){if(c>0)throw new Error("expected at least "+c+" children, but none provided");return[]}var e=b.length;if(e<c)throw new Error("expected at least "+c+" children, but found "+e);else if(e>d)throw new Error("expected at most "+d+" children, but found "+e);return b.map(function(b){return a(b)})}function i(a,b,c,d){if(b===0){if(c>0)throw new Error("expected at least "+c+" children, but none provided");return[]}if(b<c)throw new Error("expected at least "+c+" children, but found "+b);else if(b>d)throw new Error("expected at most "+d+" children, but found "+b);c=[];for(d=0;d<b;d++)c.push(a());return c}g.OPTIONAL_CHILD=a;g.HAS_OPTIONAL_CHILD=b;g.HOMOGENEOUS_CHILD=c;g.HOMOGENEOUS_CHILD_COUNT=e;g.REPEATED_CHILD=h;g.REPEATED_CHILD_COUNT=i}),98);
__d("WASmaxOutPreKeysClientRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),xmlns:"encrypt",to:d("WAWap").S_WHATSAPP_NET});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeClientRequestMixin=a}),98);
__d("WASmaxOutPreKeysFetchKeyBundlesRequest",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.userJid;a=a.hasUserReasonIdentity;b=d("WASmaxJsx").smax("user",{jid:d("WAWap").JID(b),reason:d("WASmaxAttrs").OPTIONAL_LITERAL("identity",a)});return b}function a(a){a=a.userArgs;a=d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"get"},d("WASmaxJsx").smax("key",null,d("WASmaxChildren").REPEATED_CHILD(h,a,1,1e5))));return a}g.makeFetchKeyBundlesRequestKeyUser=h;g.makeFetchKeyBundlesRequest=a}),98);
__d("WASmaxParsingFailure",[],(function(a,b,c,d,e,f){"use strict";a=function(a){function b(b){var c;c=a.call(this,"SmaxParsingFailure: "+b)||this;c.name="SmaxParsingFailure";c.reason=b;return c}babelHelpers.inheritsLoose(b,a);var c=b.prototype;c.toString=function(){return"SmaxParsingFailure: "+this.reason};return b}(babelHelpers.wrapNativeSuper(Error));f.SmaxParsingFailure=a}),66);
__d("WASmaxRpcUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=Object.keys(b).map(function(a){var c=a==="Request"?"<request>":'<response name="'+a+'">';return"Tried "+c+", but failed with "+b[a].error+"."}).join(" ");return'Failed to parse incoming stanza of <rpc name="'+a+'">. '+c}f.errorMessageRpcParsing=a}),66);
__d("WASmaxPreKeysFetchKeyBundlesRPC",["WAComms","WASmaxInPreKeysFetchKeyBundlesResponseRequestError","WASmaxInPreKeysFetchKeyBundlesResponseServerError","WASmaxInPreKeysFetchKeyBundlesResponseSuccess","WASmaxOutPreKeysFetchKeyBundlesRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WASmaxOutPreKeysFetchKeyBundlesRequest").makeFetchKeyBundlesRequest(a);b=(yield d("WAComms").sendSmaxStanza(a,b));var c=d("WASmaxInPreKeysFetchKeyBundlesResponseSuccess").parseFetchKeyBundlesResponseSuccess(b,a);if(c.success)return{name:"FetchKeyBundlesResponseSuccess",value:c.value};var e=d("WASmaxInPreKeysFetchKeyBundlesResponseRequestError").parseFetchKeyBundlesResponseRequestError(b,a);if(e.success)return{name:"FetchKeyBundlesResponseRequestError",value:e.value};b=d("WASmaxInPreKeysFetchKeyBundlesResponseServerError").parseFetchKeyBundlesResponseServerError(b,a);if(b.success)return{name:"FetchKeyBundlesResponseServerError",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("FetchKeyBundles",{Success:c,RequestError:e,ServerError:b}))});return h.apply(this,arguments)}g.sendFetchKeyBundlesRPC=a}),98);
__d("WAFetchPreKeyBundlesProtocol",["WAConvertRegistrationIdMixin","WAConvertSignedPreKeyMixin","WAParsableXmlNode","WAResultOrError","WASignalKeys","WASmaxPreKeysFetchKeyBundlesRPC","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=d("WATagsLogger").TAGS(["fetchPreKeyBundlesProtocol"]);function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){l.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["start fetching prekey of ","..."])),a.join(", "));a=(yield d("WASmaxPreKeysFetchKeyBundlesRPC").sendFetchKeyBundlesRPC({userArgs:a.map(function(a){return{userJid:a,hasUserReasonIdentity:!1}})}));switch(a.name){case"FetchKeyBundlesResponseSuccess":l.LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["fetched prekey successfully"])));var b=new Map();a.value.listUser.map(function(a){var c=a.userFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup;c.name==="FetchKeyBundlesUserSuccess"&&b.set(a.jid,n(c.value))});return d("WAResultOrError").makeResult(b);case"FetchKeyBundlesResponseServerError":var c=a.value.errorServerErrors.name;l.WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["ServerError: ",""])),c);return d("WAResultOrError").makeError({type:"server-error",payload:c});case"FetchKeyBundlesResponseRequestError":c=a.value.errorRequestErrorsFetch.name;l.ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["RequestError: ",""])),c);return d("WAResultOrError").makeError({type:"request-error",payload:c})}});return m.apply(this,arguments)}function n(a){var b=d("WAConvertRegistrationIdMixin").registrationIdMixin(a),c=d("WASignalKeys").serializeIdentity(a.elementValue),e=d("WAConvertSignedPreKeyMixin").convertSignedPreKeyMixin(a),f=a.preKeyMixin?o(a.preKeyMixin):null;a=d("WATimeUtils").castToUnixTime(a.t||0);return{keys:{regId:b,identity:c,oneTimeKey:f,signedKey:{id:e.id,signature:e.signature,publicKey:d("WASignalKeys").serializeIdentity(e.pubkey)}},timestamp:a}}function o(a){return{id:d("WAParsableXmlNode").convertBytesToUint(a.keyIdKeyIDMixin.elementValue,3),publicKey:d("WASignalKeys").serializeIdentity(a.keyValueKeyDataMixin.elementValue)}}g.fetchPreKeyBundlesProtocol=a}),98);
__d("WABulkRequestKeys",["WAFetchPreKeyBundlesProtocol","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAFetchPreKeyBundlesProtocol").fetchPreKeyBundlesProtocol(a));return!a.success?d("WAResultOrError").makeError("errRequestKeysParsingFailed"):d("WAResultOrError").makeResult(a.value)});return h.apply(this,arguments)}g.bulkRequestKeys=a}),98);
__d("WALock",["Promise","WAResolvable","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){return{lock:function(c,e){var f=new(d("WAResolvable").Resolvable)(),g=c.map(function(a){return[a,new(d("WAResolvable").Resolvable)()]});(i||(i=b("Promise"))).all(g.map(function(b){var c=b[0],d=b[1];return a.enqueue(c,function(){d.resolve();return f.promise})}))["catch"](function(){d("WATagsLogger").TAGS(["WALock"]).ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Lock failed for ",""])),c)});return i.all(g.map(function(a){a[0];a=a[1];return a.promise})).then(function(){return e()})["finally"](function(){f.resolve()})},wait:function(b){return a.wait(b)}}}g.makeLock=a}),98);
__d("WALockMap",["WALock","WAPromiseQueue"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a===void 0&&(a=-1);a=new(d("WAPromiseQueue").PromiseQueueMap)(a);return d("WALock").makeLock(a)}g.makeLockMap=a}),98);
__d("WACryptoLibraryConfig",[],(function(a,b,c,d,e,f){"use strict";var g={signalFutureMessagesMax:2e3,S508658PreventOldSessionLookupAndPromote:!1,S508658AutoAcknowledgeStaleSessions:!1};function a(){return g}function b(a){g=a}f.getCryptoLibraryConfig=a;f.setCryptoLibraryConfig=b}),66);
__d("WASignalSessions",["WABinary","WACryptoLibraryConfig","WASignalKeys","WASignalOther","err"],(function(a,b,c,d,e,f,g){"use strict";var h=3;function a(a){if(!d("WACryptoLibraryConfig").getCryptoLibraryConfig().S508658AutoAcknowledgeStaleSessions)return a;return a.initialExchangeInfo==null?a:o(a.local,a.remote,a.rootKey,a.recvChains,a.sendChain,null,a.prevSendChainHighestIndex,a.prevSessions,a.aliceBaseKey)}function b(a,b){return i(a,0,b,[])}function i(a,b,c,d){return{ratchetPubKey:a,nextMsgIndex:b,chainKey:c,unusedMsgKeys:d}}function e(a,b){return j(a,0,b)}function j(a,b,c){return{ratchetKey:a,nextMsgIndex:b,chainKey:c}}function k(a,b,c){return{remoteOneTimeId:a,remoteSignedId:b,localOneTimePubKey:c}}function f(a,b){return o(a.local,a.remote,a.rootKey,a.recvChains,a.sendChain,a.initialExchangeInfo,a.prevSendChainHighestIndex,b,a.aliceBaseKey)}function l(a,b,c){return o(a.local,a.remote,a.rootKey,b,c,a.initialExchangeInfo,a.prevSendChainHighestIndex,a.prevSessions,a.aliceBaseKey)}function m(a,b,c,d){c===void 0&&(c=a.sendChain);return o(a.local,a.remote,d,b,c,null,Math.max(a.sendChain.nextMsgIndex-1,0),a.prevSessions,a.aliceBaseKey)}function n(a,b,c,d,e,f,g){return o(a,b,c,d,e,f,0,[],g)}function o(a,b,c,d,e,f,g,h,i){return{local:a,remote:b,rootKey:c,sendChain:e,recvChains:d,initialExchangeInfo:f,prevSendChainHighestIndex:g,prevSessions:h,aliceBaseKey:i}}function p(a,b){b=new(d("WABinary").Binary)(b);var c=d("WASignalOther").readBytes(b,32),e=d("WASignalOther").readBytes(b,32);b=d("WASignalOther").readBytes(b,16);return q(a,c,e,b)}function q(a,b,c,d){return{index:a,cipherKey:b,macKey:c,iv:d}}function r(a){return{senderRatchetKey:a.ratchetPubKey,chainKey:{index:a.nextMsgIndex,key:a.chainKey},messageKeys:a.unusedMsgKeys}}function s(a){var b=a.ratchetKey;return{senderRatchetKey:b.serializedPubKey,senderRatchetKeyPrivate:b.privateKey,chainKey:{index:a.nextMsgIndex,key:a.chainKey}}}function t(a){var b=a.local,c=a.remote,d=a.initialExchangeInfo,e=void 0;if(d){var f=d.remoteOneTimeId;e={preKeyId:f!=null?f:void 0,signedPreKeyId:d.remoteSignedId,baseKey:d.localOneTimePubKey}}return{currentSession:{sessionVersion:h,localIdentityPublic:b.pubKey,remoteIdentityPublic:c.pubKey,rootKey:a.rootKey,previousCounter:a.prevSendChainHighestIndex,senderChain:s(a.sendChain),receiverChains:a.recvChains.map(r),pendingPreKey:e,remoteRegistrationId:c.regId,localRegistrationId:b.regId,aliceBaseKey:a.aliceBaseKey},previousSessions:a.prevSessions}}function u(a){var b=a.local,c=a.remote,e=a.sendChain,f=a.initialExchangeInfo,g=void 0;if(f){var i=f.remoteOneTimeId;g={preKeyId:i!=null?i:void 0,signedPreKeyId:f.remoteSignedId,baseKey:d("WASignalOther").toBuffer(f.localOneTimePubKey)}}return{sessionVersion:h,localIdentityPublic:d("WASignalOther").toBuffer(b.pubKey),remoteIdentityPublic:d("WASignalOther").toBuffer(c.pubKey),rootKey:d("WASignalOther").toBuffer(a.rootKey),previousCounter:a.prevSendChainHighestIndex,senderChain:{senderRatchetKey:d("WASignalOther").toBuffer(e.ratchetKey.serializedPubKey),senderRatchetKeyPrivate:d("WASignalOther").toBuffer(e.ratchetKey.privateKey),chainKey:{index:e.nextMsgIndex,key:d("WASignalOther").toBuffer(e.chainKey)},messageKeys:[]},receiverChains:a.recvChains.map(function(a){return{senderRatchetKey:d("WASignalOther").toBuffer(a.ratchetPubKey),chainKey:{index:a.nextMsgIndex,key:d("WASignalOther").toBuffer(a.chainKey)},messageKeys:a.unusedMsgKeys.map(function(a){return{index:a.index,cipherKey:d("WASignalOther").toBuffer(a.cipherKey),macKey:d("WASignalOther").toBuffer(a.macKey),iv:d("WASignalOther").toBuffer(a.iv)}})}}),pendingPreKey:g,remoteRegistrationId:c.regId,localRegistrationId:b.regId,aliceBaseKey:a.aliceBaseKey==null?void 0:d("WASignalOther").toBuffer(a.aliceBaseKey)}}function v(a){var b=B(a.currentSession,"currentSession");return x(b,a.previousSessions)}function w(a){return x(a,[])}function x(a,b){var e=B(a.sessionVersion,"sessionVersion");if(e!==h)throw c("err")("Signal: bad session version "+e);e=B(a.senderChain,"senderChain");var f=B(e.chainKey,"senderChain.chainKey");e=j(d("WASignalKeys").makeSerializedKeyPairFrom(A(e.senderRatchetKeyPrivate,32,"senderRatchetKeyPrivate"),z(e.senderRatchetKey,"senderRatchetKey")),B(f.index,"senderChain.chainKey.index"),A(f.key,32,"senderChain.chainKey.key"));f=B(a.receiverChains,"receiverChains").map(function(a){var b=B(a.chainKey,"receiverChains[].chainKey");return i(z(a.senderRatchetKey,"receiverChains[].senderRatchetKey"),B(b.index,"receiverChains[].chainKey.index"),A(b.key,32,"receiverChains[].chainKey.key"),y(a.messageKeys))});var g={regId:d("WASignalOther").castRegistrationId(B(a.localRegistrationId,"localRegistrationId")),pubKey:z(a.localIdentityPublic,"localIdentityPublic")},l={regId:d("WASignalOther").castRegistrationId(B(a.remoteRegistrationId,"remoteRegistrationId")),pubKey:z(a.remoteIdentityPublic,"remoteIdentityPublic")},m=a.pendingPreKey,n=null;if(m){var p=m.preKeyId;n=k(p!=null?d("WASignalKeys").castToPreKeyId(p):null,d("WASignalKeys").castToSignedPreKeyId(B(m.signedPreKeyId,"pendingPreKey.signedPreKeyId")),z(m.baseKey,"pendingPreKey.baseKey"))}p=a.aliceBaseKey==null?null:z(a.aliceBaseKey,"aliceBaseKey");return o(g,l,A(a.rootKey,32,"rootKey"),f,e,n,a.previousCounter||0,b,p)}function y(a){return a.map(function(a){return{index:B(a.index,"messageKeys[].index"),cipherKey:A(a.cipherKey,32,"messageKeys[].cipherKey"),macKey:A(a.macKey,32,"messageKeys[].macKey"),iv:A(a.iv,16,"messageKeys[].iv")}})}function z(a,b){return d("WASignalKeys").castToSerializedPubKey(new Uint8Array(B(a,b)))}function A(a,b,c){return d("WASignalOther").toBytes(B(a,c),b)}function B(a,b){if(a==null)throw c("err")("Signal: protobuf is missing "+b);return a}g.FORMAT_VERSION=h;g.maybeClearPendingPreKey=a;g.makeFreshRecvChain=b;g.makeRecvChain=i;g.makeFreshSendChain=e;g.makeSendChain=j;g.makeInitialExchangeInfo=k;g.setPrevSessions=f;g.updateChains=l;g.ratchetSession=m;g.makeFreshSession=n;g.makeSession=o;g.splitMsgKey=p;g.serializeSession=t;g.detachSession=u;g.parseSessionFromRecord=v;g.parseSession=w;g._parseSession=x;g.bytesOrThrow=A;g.definedOrThrow=B}),98);
__d("WASignalWhisperTextProtocol.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={};a.internalSpec={ratchetKey:[1,(d=d("WAProtoConst")).TYPES.BYTES],counter:[2,d.TYPES.UINT32],previousCounter:[3,d.TYPES.UINT32],ciphertext:[4,d.TYPES.BYTES]};b.internalSpec={registrationId:[5,d.TYPES.UINT32],preKeyId:[1,d.TYPES.UINT32],signedPreKeyId:[6,d.TYPES.UINT32],baseKey:[2,d.TYPES.BYTES],identityKey:[3,d.TYPES.BYTES],message:[4,d.TYPES.BYTES]};c.internalSpec={id:[1,d.TYPES.UINT32],baseKey:[2,d.TYPES.BYTES],ratchetKey:[3,d.TYPES.BYTES],identityKey:[4,d.TYPES.BYTES],baseKeySignature:[5,d.TYPES.BYTES]};e.internalSpec={id:[1,d.TYPES.UINT32],iteration:[2,d.TYPES.UINT32],ciphertext:[3,d.TYPES.BYTES]};f.internalSpec={id:[1,d.TYPES.UINT32],iteration:[2,d.TYPES.UINT32],chainKey:[3,d.TYPES.BYTES],signingKey:[4,d.TYPES.BYTES]};h.internalSpec={generation:[1,d.TYPES.UINT32],signature:[2,d.TYPES.BYTES]};g.SignalMessageSpec=a;g.PreKeySignalMessageSpec=b;g.KeyExchangeMessageSpec=c;g.SenderKeyMessageSpec=e;g.SenderKeyDistributionMessageSpec=f;g.DeviceConsistencyCodeMessageSpec=h}),98);
__d("WASignalGroupSession",["WASignalKeys","WASignalSessions"],(function(a,b,c,d,e,f,g){"use strict";var h=5,i=3;function j(a){var b=d("WASignalSessions").definedOrThrow(a.senderSigningKey,"senderSigningKey"),c=d("WASignalSessions").definedOrThrow(a.senderMessageKeys,"senderMessageKeys"),e=d("WASignalSessions").definedOrThrow(a.senderChainKey,"senderChainKey");return{senderSigningKeyPublic:r(b["public"],"public"),senderSigningKeyPrivate:b["private"]?d("WASignalSessions").bytesOrThrow(b["private"],32,"private"):void 0,senderKeyId:d("WASignalSessions").definedOrThrow(a.senderKeyId,"senderKeyId"),unusedMsgKeys:c.map(function(a){return k(d("WASignalSessions").definedOrThrow(a.iteration,"iteration"),d("WASignalSessions").bytesOrThrow(a.seed,50,"seed"))}),senderKeyChainKey:l(d("WASignalSessions").definedOrThrow(e.iteration,"iteration"),d("WASignalSessions").bytesOrThrow(e.seed,32,"seed"))}}function a(a,b,c,d,e){return{senderSigningKeyPublic:a,senderSigningKeyPrivate:b,senderKeyChainKey:c,senderKeyId:d,unusedMsgKeys:e==null?[]:e}}function b(a,b){var c=a.senderKeyStates.findIndex(function(a){return a.senderKeyId===b.senderKeyId});return{senderKeyStates:a.senderKeyStates.map(function(a,d){return d===c?b:a})}}function c(a,b){a=a.senderKeyStates.slice(a.senderKeyStates.length>h-1?1:0);a.push(b);return{senderKeyStates:a}}function e(a){return{senderKeyStates:[a]}}function k(a,b){return{iteration:a,seed:b}}function l(a,b){return{nextMsgIndex:a,chainKey:b}}function f(a){a=d("WASignalSessions").definedOrThrow(a.senderKeyStates,"senderKeyStates");return m(a)}function m(a){return n(a)}function n(a){a=a.map(function(a){return j(a)});return{senderKeyStates:a}}function o(a,b){var c=a.senderKeyStates.findIndex(function(a){return a.senderKeyId===b});return c===-1?void 0:a.senderKeyStates[c]}function p(a){return{senderKeyStates:a.senderKeyStates.map(function(a){return q(a)})}}function q(a){return{senderKeyId:a.senderKeyId,senderChainKey:{iteration:a.senderKeyChainKey.nextMsgIndex,seed:a.senderKeyChainKey.chainKey},senderSigningKey:{"public":a.senderSigningKeyPublic,"private":a.senderSigningKeyPrivate},senderMessageKeys:a.unusedMsgKeys.map(function(a){var b=a.iteration;a=a.seed;return{iteration:b,seed:a}})}}function r(a,b){return d("WASignalKeys").castToSerializedPubKey(new Uint8Array(d("WASignalSessions").definedOrThrow(a,b)))}function s(a){return a}g.FORMAT_VERSION=i;g.makeSenderKeyState=a;g.updateSessionWithUpdatedSenderKeyState=b;g.updateSessionWithNewSenderKeyState=c;g.makeNewSenderKeySession=e;g.makeSenderKeyMsgKey=k;g.makeSenderKeyChainKey=l;g.parseSessionFromRecord=f;g._parseSession=m;g.makeSenderKeySessionFromRecord=n;g.findSenderKeyState=o;g.serializeSession=p;g.serializeSenderKeyState=q;g.convertFromRawToSenderKeyState=s}),98);
__d("WASignalWhitepaper",["Promise","WABinary","WACryptoDependencies","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSessions","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Uint8Array(32);i.fill(255);var j=new Uint8Array([1]),k=new Uint8Array([2]);function a(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e,f=a.regId;a=a.staticKeyPair;var g=b.identity,h=b.signedKey.publicKey,j=c.privateKey,k=a.privateKey;e=(e=b.oneTimeKey)==null?void 0:e.publicKey;k=d("WABinary").Binary.build(i,v(k,h),v(j,g),v(j,h),e&&v(j,e)).readByteArrayView();h=(yield t(k,"WhisperText"));j=h[0];e=h[1];k=b.ratchetKey;h=d("WASignalSessions").makeFreshRecvChain(k,e);e=d("WASignalKeys").makeSerializedKeyPair();j=(yield r(j,e,k));k=d("WASignalSessions").makeInitialExchangeInfo(b.oneTimeKey==null?null:b.oneTimeKey.id,b.signedKey.id,d("WASignalKeys").serializePubKey(c));return d("WASignalSessions").makeFreshSession({regId:f,pubKey:d("WASignalKeys").serializePubKey(a)},{regId:b.regId,pubKey:g},j.rootKey,[h],d("WASignalSessions").makeFreshSendChain(e,j.chainKey),k,d("WASignalKeys").serializePubKey(c))});return l.apply(this,arguments)}function c(a,b,c,d){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f,g=a.regId;a=a.staticKeyPair;var h=a.privateKey,j=e.signed.privateKey,k=c,l=b.pubKey;f=(f=e.oneTime)==null?void 0:f.privateKey;l=d("WABinary").Binary.build(i,w(l,j),w(k,h),w(k,j),f&&w(k,f)).readByteArrayView();h=(yield t(l,"WhisperText"));j=h[0];k=h[1];f=e.ratchet;l=d("WASignalSessions").makeFreshSendChain(f,k);return d("WASignalSessions").makeSession({regId:g,pubKey:d("WASignalKeys").serializePubKey(a)},b,j,[],l,null,0,[],c)});return m.apply(this,arguments)}function e(a){a=d("WASignalGroupSession").makeSenderKeyState(d("WASignalKeys").serializePubKey(a),a.privateKey,d("WASignalGroupSession").makeSenderKeyChainKey(0,d("WASignalKeys").makeRawSenderKey()),d("WASignalOther").makeSenderKeyId(),[]);return(h||(h=b("Promise"))).resolve(d("WASignalGroupSession").makeNewSenderKeySession(a))}function f(a,c,e,f,g){e=d("WASignalGroupSession").makeSenderKeyState(e,void 0,d("WASignalGroupSession").makeSenderKeyChainKey(c,f),a,[]);c=null;g?c=d("WASignalGroupSession").updateSessionWithNewSenderKeyState(g,e):c=d("WASignalGroupSession").makeNewSenderKeySession(e);return(h||(h=b("Promise"))).resolve(c)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=(yield d("WASignalOther").makeCryptoKey(c,"hmac-sha256"));c=function(a){return d("WACryptoDependencies").getCrypto().subtle.sign({name:"HMAC",hash:"SHA-256"},e,a)};var f=c(j).then(function(a){return d("WASignalOther").hkdf(new Uint8Array(a),null,"WhisperMessageKeys",80)}).then(function(b){return d("WASignalSessions").splitMsgKey(a,b)});c=c(k).then(function(a){return d("WASignalOther").toBytes(a,32)});return(h||(h=b("Promise"))).all([c,f])});return o.apply(this,arguments)}function p(a,b){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=(yield d("WASignalOther").makeCryptoKey(c,"hmac-sha256"));c=function(a){return d("WACryptoDependencies").getCrypto().subtle.sign({name:"HMAC",hash:"SHA-256"},e,a)};var f=c(j).then(function(a){return d("WASignalOther").hkdf(new Uint8Array(a),null,"WhisperGroup",50)}).then(function(b){return d("WASignalGroupSession").makeSenderKeyMsgKey(a,b)});c=c(k).then(function(a){return d("WASignalOther").toBytes(a,32)});return(h||(h=b("Promise"))).all([c,f])});return q.apply(this,arguments)}function r(a,b,c){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b=b.privateKey;c=c;b=d("WASignalKeys").ecdh(b,c);c=(yield t(new Uint8Array(b),"WhisperRatchet",a));b=c[0];a=c[1];return{rootKey:b,chainKey:a}});return s.apply(this,arguments)}function t(a,b,c){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){c===void 0&&(c=null);a=(yield d("WASignalOther").hkdf(a,c,b,64));return[d("WASignalOther").sliceBytes(a,0,32),d("WASignalOther").sliceBytes(a,32,32)]});return u.apply(this,arguments)}function v(a,b){return new Uint8Array(d("WASignalKeys").ecdh(a,b))}function w(a,b){return v(b,a)}g.initiateSessionOutgoing=a;g.initiateSessionIncoming=c;g.initiateSenderKeySessionOutgoing=e;g.initiateSenderKeySessionIncoming=f;g.deriveMsgKey=n;g.deriveSenderKeyMsgKey=p;g.calculateRatchet=r}),98);
__d("WASignalCipher",["Promise","WABinary","WACryptoDependencies","WACryptoLibraryConfig","WACryptoUtils","WALogger","WAResultOrError","WASignalKeys","WASignalOther","WASignalSessions","WASignalSignatures","WASignalWhisperTextProtocol.pb","WASignalWhitepaper","asyncToGeneratorRuntime","decodeProtobuf","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=40,m=8,n=2e3;function a(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.sendChain,e=(yield d("WASignalWhitepaper").deriveMsgKey(c.nextMsgIndex,c.chainKey)),f=e[0];e=e[1];var g=(yield B(e)),h=g.cipherKey;g=g.macKey;h=(yield d("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-CBC",iv:e.iv},h,b));b=new(d("WABinary").Binary)();b.writeByteArray(a.local.pubKey);b.writeByteArray(a.remote.pubKey);var i=b.size();b.writeUint8(y(d("WASignalSessions").FORMAT_VERSION,d("WASignalSessions").FORMAT_VERSION));d("encodeProtobuf").encodeProtobuf(d("WASignalWhisperTextProtocol.pb").SignalMessageSpec,{ratchetKey:c.ratchetKey.serializedPubKey,counter:e.index,previousCounter:a.prevSendChainHighestIndex,ciphertext:h},b);h=b.readByteArrayView();b=(yield A(g,h));g=h.subarray(i);h=d("WABinary").Binary.build(g,new Uint8Array(b,0,m)).readByteArrayView();i=a.initialExchangeInfo;if(i!=null){g=new(d("WABinary").Binary)();g.writeUint8(y(d("WASignalSessions").FORMAT_VERSION,d("WASignalSessions").FORMAT_VERSION));d("encodeProtobuf").encodeProtobuf(d("WASignalWhisperTextProtocol.pb").PreKeySignalMessageSpec,{registrationId:a.local.regId,preKeyId:(b=i.remoteOneTimeId)!=null?b:void 0,signedPreKeyId:i.remoteSignedId,baseKey:i.localOneTimePubKey,identityKey:a.local.pubKey,message:h},g);b="pkmsg";i=g.readByteArrayView()}else b="msg",i=h;g=d("WASignalSessions").makeSendChain(c.ratchetKey,e.index+1,f);h=d("WASignalSessions").updateChains(a,a.recvChains,g);return[h,{type:b,ciphertext:i}]});return o.apply(this,arguments)}function c(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a==null)return d("WAResultOrError").makeError("errSignalNoSession");var c=(yield t(a,b));if(c.success){var e=c.value,f=e[0];e=e[1];return d("WAResultOrError").makeResult({newSessionInfo:null,updatedSession:f,plaintext:e})}else{f=a.prevSessions;e=c;for(c=0;!e.success&&c<f.length;c++){var g=d("WASignalSessions").maybeClearPendingPreKey(d("WASignalSessions").parseSession(f[c])),h=(yield t(g,b));if(h.success){h=h.value;var i=h[0];h=h[1];i=d("WASignalSessions").setPrevSessions(i,[d("WASignalSessions").detachSession(a)].concat(f.slice(0,c),f.slice(c+1)));var j=!a||!d("WACryptoUtils").serializedPubKeysEqual(i.remote.pubKey,a.remote.pubKey)?i.remote.pubKey:null;e=d("WAResultOrError").makeResult({newSessionInfo:{newIdentity:j,baseSession:g,usedPreKey:null},updatedSession:i,plaintext:h})}}return e}});return p.apply(this,arguments)}function e(a,b){if(a==null)return d("WAResultOrError").makeResult(null);a=a;if(C(a,b))return d("WAResultOrError").makeResult(a);var c=a.prevSessions;for(var e=0;e<c.length;e++){var f=d("WASignalSessions").parseSession(c[e]);if(C(f,b))return d("WACryptoLibraryConfig").getCryptoLibraryConfig().S508658PreventOldSessionLookupAndPromote===!0?d("WAResultOrError").makeError("errSignalInvalidMsg"):d("WAResultOrError").makeResult(d("WASignalSessions").setPrevSessions(f,[d("WASignalSessions").detachSession(a)].concat(c.slice(0,e),c.slice(e+1))))}return d("WAResultOrError").makeResult(null)}function f(a,b,c,d){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=e.localSignedPreKey;if(f==null)return d("WAResultOrError").makeError("errSignalInvalidSignedPreKey");f=d("WASignalSignatures").deserializeSignedPreKey(f);if(f==null)return d("WAResultOrError").makeError("errSignalSignedPreKeyDeserialization");if(f.id!==c.localSignedPreKeyId)return d("WAResultOrError").makeError("errSignalSignedPreKeyIdMismatch");var g=null;if(c.localOneTimeKeyId!=null){e=e.localOneTimeKey;if(e==null)return d("WAResultOrError").makeError("errSignalInvalidOneTimeKey");g=d("WASignalKeys").deserializePreKey(e);if(g==null)return d("WAResultOrError").makeError("errSignalOneTimeKeyDeserialization");if(g.id!==c.localOneTimeKeyId)return d("WAResultOrError").makeError("errSignalOneTimeKeyMismatch")}a=(yield d("WASignalWhitepaper").initiateSessionIncoming(a,c.remote,c.sessionBaseKey,{signed:f.keyPair,oneTime:(e=g)==null?void 0:e.keyPair,ratchet:d("WASignalKeys").toSerializedKeyPair(f.keyPair)}));g=a.remote.pubKey;e=!b||!d("WACryptoUtils").serializedPubKeysEqual(g,b.remote.pubKey)?g:null;b&&!e&&(a=d("WASignalSessions").setPrevSessions(a,[d("WASignalSessions").detachSession(b)].concat(b.prevSessions.slice(0,l-1))));f=(yield t(a,c));if(!f.success)return f;g=f.value;b=g[0];c=g[1];return d("WAResultOrError").makeResult({newIdentity:e,baseSession:a,updatedSession:b,plaintext:c})});return q.apply(this,arguments)}function r(a){var b,c,e=null;try{var f=x(a,d("WASignalSessions").FORMAT_VERSION,m);if(!f.success)return f;f=d("decodeProtobuf").decodeProtobuf(d("WASignalWhisperTextProtocol.pb").SignalMessageSpec,f.value);var g=f.ratchetKey;e=f.counter;c=f.ciphertext;if(g==null||e==null||c==null)return d("WAResultOrError").makeError("errSignalDeserializeInvalidProtoFormat");b=d("WASignalKeys").castToSerializedPubKey(new Uint8Array(g))}catch(a){d("WALogger").DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["deserializeMsg error ",""])),a);return d("WAResultOrError").makeError("errSignalDeserializeRatchetKeyBadFormat")}f={ratchetPubKey:b,counter:e,ciphertext:new Uint8Array(c),versionContentMac:a};return d("WAResultOrError").makeResult(f)}function s(a){a=x(a,d("WASignalSessions").FORMAT_VERSION,0);if(!a.success)return a;var b,c,e,f,g;try{a=d("decodeProtobuf").decodeProtobuf(d("WASignalWhisperTextProtocol.pb").PreKeySignalMessageSpec,a.value);var h=a.registrationId,j=a.preKeyId,k=a.signedPreKeyId,l=a.baseKey,m=a.identityKey;a=a.message;if(h==null||k==null||l==null||m==null||a==null)return d("WAResultOrError").makeError("errSignalDeserializePkInvalidProtoFormat");f=d("WASignalKeys").castToSerializedPubKey(new Uint8Array(l));b={regId:d("WASignalOther").castRegistrationId(h),pubKey:d("WASignalKeys").castToSerializedPubKey(new Uint8Array(m))};e=j!=null?d("WASignalKeys").castToPreKeyId(j):null;c=d("WASignalKeys").castToSignedPreKeyId(k);g=new Uint8Array(a)}catch(a){d("WALogger").DEV(i||(i=babelHelpers.taggedTemplateLiteralLoose(["deserializePkMsg error ",""])),a);return d("WAResultOrError").makeError("errSignalDeserializePkKeyBadFormat")}l=r(g);return!l.success?l:d("WAResultOrError").makeResult(babelHelpers["extends"]({},l.value,{remote:b,sessionBaseKey:f,localSignedPreKeyId:c,localOneTimeKeyId:e}))}function t(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b.ratchetPubKey,e=b.counter,f=b.ciphertext;b=b.versionContentMac;var g=a.recvChains,h=a.recvChains.findIndex(function(a){return d("WACryptoUtils").serializedPubKeysEqual(a.ratchetPubKey,c)});if(h===-1){var i=(yield d("WASignalWhitepaper").calculateRatchet(a.rootKey,a.sendChain.ratchetKey,c)),k=d("WASignalSessions").makeFreshRecvChain(c,i.chainKey);k=(yield v(k,e));if(!k.success)return k;k=k.value;var l=d("WASignalKeys").makeSerializedKeyPair();i=(yield d("WASignalWhitepaper").calculateRatchet(i.rootKey,l,c));var n=g.slice(-4);n.push(k.updatedChain);k=k.msgKey;n=d("WASignalSessions").ratchetSession(a,n,d("WASignalSessions").makeFreshSendChain(l,i.chainKey),i.rootKey)}else{l=(yield v(g[h],e));if(!l.success)return l;i=l.value;e=g.slice();e[h]=i.updatedChain;k=i.msgKey;n=d("WASignalSessions").updateChains(a,e,a.sendChain)}l=(yield B(k));g=l.cipherKey;i=l.macKey;e=d("WABinary").Binary.build(a.remote.pubKey,a.local.pubKey,b.subarray(0,-m)).readByteArrayView();l=(yield A(i,e));a=b.subarray(-m);i=!d("WACryptoUtils").uint8ArraysEqual(new Uint8Array(l,0,m),a);e=null;try{e=(yield d("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-CBC",iv:k.iv},g,f))}catch(a){d("WALogger").DEV(j||(j=babelHelpers.taggedTemplateLiteralLoose(["decryptMsgFromSession error ",""])),a)}if(i&&e==null)return h===-1?d("WAResultOrError").makeError("errInvalidMacInvalidCipherKeyNewChain"):d("WAResultOrError").makeError("errInvalidMacInvalidCipherKey");if(i)return d("WAResultOrError").makeError("errInvalidMacWithDecryptedPlaintext");return e==null?d("WAResultOrError").makeError("errUnknownInvalidCipherKey"):d("WAResultOrError").makeResult([n,e])});return u.apply(this,arguments)}function v(a,b){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b-a.nextMsgIndex,e=d("WACryptoLibraryConfig").getCryptoLibraryConfig().signalFutureMessagesMax;if(c>e)return d("WAResultOrError").makeError("errSignalTooManyMessagesInFuture");e=a.unusedMsgKeys;if(c<0){var f=e.findIndex(function(a){return a.index===b});return f===-1?d("WAResultOrError").makeError("errDuplicateMsg"):d("WAResultOrError").makeResult({msgKey:e[f],updatedChain:d("WASignalSessions").makeRecvChain(a.ratchetPubKey,a.nextMsgIndex,a.chainKey,z(e,f))})}f=a.nextMsgIndex;var g=(yield d("WASignalWhitepaper").deriveMsgKey(f,a.chainKey)),h=g[0];g=g[1];var i=null;if(c>0){c=c+e.length-n;c>0?(i=e.slice(c),c-=e.length):i=e.slice();for(f=f+1;f<=b;f++){c>0?c--:i.push(g);var j=(yield d("WASignalWhitepaper").deriveMsgKey(f,h));h=j[0];g=j[1]}}return d("WAResultOrError").makeResult({msgKey:g,updatedChain:d("WASignalSessions").makeRecvChain(a.ratchetPubKey,b+1,h,i||e)})});return w.apply(this,arguments)}function x(a,b,c){if(a.length<1)return d("WAResultOrError").makeError("errSignalEmptyVersionContentSuffix");var e=a[0]>>>4;if(e!==b)return e<b?d("WAResultOrError").makeError("errSignalLegacyMsg"):d("WAResultOrError").makeError("errSignalInvalidVersion");e=a.length-c;return e<1?d("WAResultOrError").makeError("errSignalContentExceededExpectedLength"):d("WAResultOrError").makeResult(a.subarray(1,e))}function y(a,b){return(a<<4|b)&255}function z(a,b){var c=[];for(var d=0;d<a.length;d++)d!==b&&c.push(a[d]);return c}function A(a,b){return d("WACryptoDependencies").getCrypto().subtle.sign(d("WASignalOther").HMAC_SHA256,a,b)}function B(a){return(k||(k=b("Promise"))).all([d("WASignalOther").makeCryptoKey(a.cipherKey,"aes-cbc"),d("WASignalOther").makeCryptoKey(a.macKey,"hmac-sha256")]).then(function(a){var b=a[0];a=a[1];return{cipherKey:b,macKey:a}})}function C(a,b){a=a.aliceBaseKey;return!a?!1:d("WACryptoUtils").serializedPubKeysEqual(a,b)}g.MAX_UNUSED_KEYS=n;g.encryptMsg=a;g.decryptMsg=c;g.findMatchingSession=e;g.decryptPkMsgWithNewSession=f;g.deserializeMsg=r;g.deserializePkMsg=s;g.decryptMsgFromSession=t;g.readContent=x;g.versionByte=y}),98);
__d("WASignalGroupCipher",["WABinary","WACryptoDependencies","WACryptoLibraryConfig","WALogger","WAResultOrError","WASignalCipher","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSessions","WASignalSignatures","WASignalWhisperTextProtocol.pb","WASignalWhitepaper","asyncToGeneratorRuntime","decodeProtobuf","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=64;function a(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=n(a);if(!a.success)return a;a=a.value;var c=a.senderKeyId,e=a.iteration,f=a.signingKeyPublic;a=a.chainKey;c=(yield d("WASignalWhitepaper").initiateSenderKeySessionIncoming(c,e,f,a,b));return d("WAResultOrError").makeResult(c)});return k.apply(this,arguments)}function c(a){a=d("WASignalGroupSession").serializeSenderKeyState(a);var b=new(d("WABinary").Binary)();b.writeUint8(d("WASignalCipher").versionByte(d("WASignalGroupSession").FORMAT_VERSION,d("WASignalGroupSession").FORMAT_VERSION));d("encodeProtobuf").encodeProtobuf(d("WASignalWhisperTextProtocol.pb").SenderKeyDistributionMessageSpec,{id:a.senderKeyId,iteration:d("WASignalSessions").definedOrThrow(a.senderChainKey,"senderChainKey").iteration,chainKey:d("WASignalSessions").definedOrThrow(a.senderChainKey,"senderChainKey").seed,signingKey:d("WASignalSessions").definedOrThrow(a.senderSigningKey,"senderSigningKey")["public"]},b);return b.readByteArrayView()}function e(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(!a.senderKeyStates||a.senderKeyStates.length===0)return d("WAResultOrError").makeError("errSignalNoSession");var c=a.senderKeyStates[a.senderKeyStates.length-1],e=(yield d("WASignalWhitepaper").deriveSenderKeyMsgKey(c.senderKeyChainKey.nextMsgIndex,c.senderKeyChainKey.chainKey)),f=e[0];e=e[1];var g=(yield p(e.seed)),h=g[0];g=g[1];g=(yield d("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-CBC",iv:g},h,b));h=new(d("WABinary").Binary)();d("encodeProtobuf").encodeProtobuf(d("WASignalWhisperTextProtocol.pb").SenderKeyMessageSpec,{id:c.senderKeyId,iteration:e.iteration,ciphertext:g},h);b=new(d("WABinary").Binary)();b.writeUint8(d("WASignalCipher").versionByte(d("WASignalGroupSession").FORMAT_VERSION,d("WASignalGroupSession").FORMAT_VERSION));b.writeBinary(h);g=d("WASignalKeys").makeKeyPairFromSerialized(d("WASignalSessions").definedOrThrow(c.senderSigningKeyPrivate,"senderSigningKeyPrivate"),c.senderSigningKeyPublic);g=d("WASignalSignatures").signSenderKeyMessage(g,b.readByteArrayView());b=new(d("WABinary").Binary)();b.writeUint8(d("WASignalCipher").versionByte(d("WASignalGroupSession").FORMAT_VERSION,d("WASignalGroupSession").FORMAT_VERSION));b.writeBinary(h);b.writeByteArray(g);h=d("WASignalGroupSession").makeSenderKeyChainKey(e.iteration+1,f);g=d("WASignalGroupSession").updateSessionWithUpdatedSenderKeyState(a,d("WASignalGroupSession").makeSenderKeyState(c.senderSigningKeyPublic,c.senderSigningKeyPrivate,h,c.senderKeyId,c.unusedMsgKeys));return d("WAResultOrError").makeResult([g,b.readByteArrayView()])});return l.apply(this,arguments)}function f(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b.senderKeyMessageId,e=b.iteration,f=b.ciphertext;b=b.versionContentMac;c=d("WASignalGroupSession").findSenderKeyState(a,c);if(c==null)return d("WAResultOrError").makeError("errSignalNoSession");var g=c.senderSigningKeyPublic;b=r(b,g);if(!b)return d("WAResultOrError").makeError("errSignalInvalidKey");g=(yield s(c,e));if(!g.success)return g;b=g.value;c=b.msgKey;e=d("WASignalGroupSession").updateSessionWithUpdatedSenderKeyState(a,b.updatedSenderKeyState);g=(yield p(c.seed));a=g[0];b=g[1];c=(yield d("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-CBC",iv:b},a,f));return d("WAResultOrError").makeResult([e,c])});return m.apply(this,arguments)}function n(a){var b,c,e,f;try{a=d("WASignalCipher").readContent(a,d("WASignalGroupSession").FORMAT_VERSION,0);if(!a.success)return a;a=d("decodeProtobuf").decodeProtobuf(d("WASignalWhisperTextProtocol.pb").SenderKeyDistributionMessageSpec,a.value);b=a.id;c=a.iteration;var g=d("WASignalSessions").bytesOrThrow(a.signingKey,33,"signingKey");e=d("WASignalKeys").castToSerializedPubKey(g);f=d("WASignalSessions").bytesOrThrow(a.chainKey,32,"chainKey");if(b==null||c==null)return d("WAResultOrError").makeError("errSignalGrpInvalidProtoFormat")}catch(a){d("WALogger").DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["deserializeSenderKeyDistributionMsg error ",""])),a);return d("WAResultOrError").makeError("errSignalGrpInvalidKeyFormat")}return d("WAResultOrError").makeResult({senderKeyId:b,iteration:c,signingKeyPublic:e,chainKey:f})}function o(a){if(a.length<1)return d("WAResultOrError").makeError("errSignalGrpVersionContentEmpty");var b=a[0]>>>4;if(b!==d("WASignalGroupSession").FORMAT_VERSION)return b<d("WASignalGroupSession").FORMAT_VERSION?d("WAResultOrError").makeError("errSignalLegacyMsg"):d("WAResultOrError").makeError("errSignalInvalidVersion");if(a.length<1+j)return d("WAResultOrError").makeError("errSignalGrpInvalidVersionContentLength");var c,e,f;try{b=a.subarray(1,-j);b=d("decodeProtobuf").decodeProtobuf(d("WASignalWhisperTextProtocol.pb").SenderKeyMessageSpec,b);c=b.id;e=b.iteration;f=b.ciphertext;if(c==null||e==null||f==null)return d("WAResultOrError").makeError("errSignalGrpSenderKeyInvalidProtoFormat")}catch(a){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Exception caught during SenderKeyMessageSpec Proto: ",""])),a);return d("WAResultOrError").makeError("errSignalGrpSenderKeyProtoError")}return d("WAResultOrError").makeResult({senderKeyMessageId:c,iteration:e,ciphertext:new Uint8Array(f),versionContentMac:a})}function p(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=new(d("WABinary").Binary)(a);var b=d("WASignalOther").readBytes(a,16);a=d("WASignalOther").readBytes(a,32);return[yield d("WASignalOther").makeCryptoKey(a,"aes-cbc"),b]});return q.apply(this,arguments)}function r(a,b){var c=a.subarray(a.length-j);a=a.subarray(0,a.length-j);return d("WASignalSignatures").verifyMsgSignalVariant(b,a,d("WASignalOther").toBytes(d("WASignalOther").toBuffer(c),64))}function s(a,b){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a,e=b-c.senderKeyChainKey.nextMsgIndex,f=d("WACryptoLibraryConfig").getCryptoLibraryConfig().signalFutureMessagesMax;if(e>f)return d("WAResultOrError").makeError("errSignalGrpTooManyMessagesInFuture");f=a.unusedMsgKeys||[];if(e<0){var g=f.findIndex(function(a){return a.iteration===b});return g===-1?d("WAResultOrError").makeError("errDuplicateMsg"):d("WAResultOrError").makeResult({msgKey:f[g],updatedSenderKeyState:d("WASignalGroupSession").makeSenderKeyState(c.senderSigningKeyPublic,c.senderSigningKeyPrivate,c.senderKeyChainKey,c.senderKeyId,u(f,g))})}g=c.senderKeyChainKey.nextMsgIndex;var h=(yield d("WASignalWhitepaper").deriveSenderKeyMsgKey(g,c.senderKeyChainKey.chainKey)),i=h[0];h=h[1];var j=null;if(e>0){e=e+f.length-d("WASignalCipher").MAX_UNUSED_KEYS;e>0?(j=f.slice(e),e-=f.length):j=f.slice();for(g=g+1;g<=b;g++){e>0?e--:j.push(h);var k=(yield d("WASignalWhitepaper").deriveSenderKeyMsgKey(g,i));i=k[0];h=k[1]}}return d("WAResultOrError").makeResult({msgKey:h,updatedSenderKeyState:d("WASignalGroupSession").makeSenderKeyState(c.senderSigningKeyPublic,c.senderSigningKeyPrivate,d("WASignalGroupSession").makeSenderKeyChainKey(b+1,i),a.senderKeyId,j||f)})});return t.apply(this,arguments)}function u(a,b){var c=[];for(var d=0;d<a.length;d++)d!==b&&c.push(a[d]);return c}g.processSenderKeyDistributionMsg=a;g.createSenderKeyDistributionProto=c;g.encryptSenderKeyMsgWithSession=e;g.decryptSenderKeyMsgFromSession=f;g.deserializeSenderKeyMsg=o}),98);
__d("WACryptoLibrary",["WACryptoUtils","WAJids","WALockMap","WALogger","WAResultOrError","WASignalCipher","WASignalGroupCipher","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSignatures","WASignalWhitepaper","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=d("WALockMap").makeLockMap(60*1e3),k=[],l=300;function m(a){k.push(a),k.length>=l&&k.shift()}function a(a){a(k),k=[]}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){m("createOutgoingSession");b=y(b);var c=b.signedKey;c=(yield d("WASignalSignatures").verifyMsgSignalVariant(b.identity,c.publicKey,c.signature));d("WALogger").DEV(i||(i=babelHelpers.taggedTemplateLiteralLoose(["getSessionForRecipient pkmsg signature verification result: ",""])),c);if(!c){m("createOutgoingSession: errSignalInvalidKey");return d("WAResultOrError").makeError("errSignalInvalidKey")}c=(yield d("WASignalWhitepaper").initiateSessionOutgoing(a,b,d("WASignalKeys").makeKeyPair()));return d("WAResultOrError").makeResult(c)});return o.apply(this,arguments)}function c(a,b,c,d,e){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d,e){a=a.handleNewSession;m("establishOutgoingSession");b=(yield n(b,d));if(!b.success)return b;d=b.value;return a(c,d,d.remote.pubKey,null,e)});return p.apply(this,arguments)}function e(a,c,e,f){var g=a.loadSession,h=a.handleNewSession;m("encryptContent");return j.lock([d("WAJids").extractUserJid(c)],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=null;do{var b=(yield g(c,"cryptoLibraryEncryptContent"));if(b==null){m("encryptContent: errSignalInvalidKey");return d("WAResultOrError").makeError("errSignalInvalidKey")}if(f!=null&&!d("WACryptoUtils").uint8ArraysEqual(f,b.remote.pubKey)){m("encryptContent: identity-mismatch");return d("WAResultOrError").makeError("identity-mismatch")}b=(yield d("WASignalCipher").encryptMsg(b,e));var i=b[0];b=b[1];var j=(yield h(c,i,i.remote.pubKey));j.success?a=d("WAResultOrError").makeResult(babelHelpers["extends"]({},b,{baseKey:i.aliceBaseKey})):j.error}while(a==null);return a}))}function f(a,c,e,f,g){var h=a.loadSession,i=a.handleNewSession,k=a.loadSignedPreKey,l=a.loadOneTimePreKey;m("decryptContent");return j.lock([d("WAJids").extractUserJid(e)],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=!1,b=(yield h(e,"decryptContent"));if(f.type==="pkmsg"){var j=d("WASignalCipher").deserializePkMsg(f.ciphertext);if(!j.success){m("decryptContent: errCryptoDeserialization");return d("WAResultOrError").makeError("errCryptoDeserialization")}j=j.value;j=(yield q({loadSignedPreKey:k,loadOneTimePreKey:l},c,j,b));if(!j.success)return j;j=j.value}else{f.type;var n=d("WASignalCipher").deserializeMsg(f.ciphertext);if(!n.success){m("decryptContent: errCryptoDeserialization");return d("WAResultOrError").makeError("errCryptoDeserialization")}n=n.value;b=(yield d("WASignalCipher").decryptMsg(b,n));if(!b.success)return b;j=b.value}n=j;b=n.newSessionInfo;b&&(b.newIdentity!=null||b.usedPreKey!=null)&&(yield i(e,b.baseSession,b.newIdentity,b.usedPreKey));if(!a){n=b==null?void 0:b.baseSession.remote.pubKey;yield g(new Uint8Array(j.plaintext),n);a=!0}yield i(e,j.updatedSession,j.updatedSession.remote.pubKey);return d("WAResultOrError").makeResult()}))}function q(a,b,c,d){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=a.loadSignedPreKey;a=a.loadOneTimePreKey;m("decryptPkMsg");var g=d("WASignalCipher").findMatchingSession(e,c.sessionBaseKey);if(!g.success)return g;g=g.value;if(g){g=(yield d("WASignalCipher").decryptMsgFromSession(g,c));if(!g.success)return g;g=g.value;var h=g[0];g=g[1];return d("WAResultOrError").makeResult({newSessionInfo:null,updatedSession:h,plaintext:g})}else{h=c.localOneTimeKeyId;g=(yield f(c.localSignedPreKeyId));f=h==null?null:yield a(h);a=(yield d("WASignalCipher").decryptPkMsgWithNewSession(b,e,c,{localSignedPreKey:g,localOneTimeKey:f}));if(!a.success)return a;b=a.value;e=b.newIdentity;c=b.baseSession;g=b.updatedSession;f=b.plaintext;return d("WAResultOrError").makeResult({newSessionInfo:{newIdentity:e,baseSession:c,usedPreKey:h},updatedSession:g,plaintext:f})}});return r.apply(this,arguments)}function s(c,e,f,g){var h=c.loadSenderKeySession,a=c.saveSenderKeySession;m("encryptGroupContent");return j.lock([e,d("WAJids").extractUserJid(f)],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){do{var b=(yield h(e,f));if(!b.success)return d("WAResultOrError").makeError(b.error);b=b.value;var c=(yield d("WASignalGroupCipher").encryptSenderKeyMsgWithSession(b,g));if(c.success){c=c.value;var i=c[0];c=c[1];yield a(e,f,i);i=b.senderKeyStates[b.senderKeyStates.length-1];b=d("WAResultOrError").makeResult({ciphertext:{ciphertext:c,type:"skmsg"},senderKeyId:i.senderKeyId,senderKeyDistributionProto:d("WASignalGroupCipher").createSenderKeyDistributionProto(d("WASignalGroupSession").convertFromRawToSenderKeyState(i))})}else{m("encryptGroupContent: sender-key-no-session");return d("WAResultOrError").makeError("sender-key-no-session")}}while(b==null);return b}))}function t(c,e,f,g,i){var k=c.loadSenderKeySession,a=c.saveSenderKeySession;m("decryptGroupContent");return j.lock([e,d("WAJids").extractUserJid(f)],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=!1,c=(yield k(e,f));if(!c.success){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[WACryptoLibrary] Unable to load sender key session for group during decryptGroupContent: ",", author: ",""])),e,f);return d("WAResultOrError").makeError(c.error)}var j=d("WASignalGroupCipher").deserializeSenderKeyMsg(g);if(!j.success){m("decryptGroupContent: errCryptoDeserialization");return d("WAResultOrError").makeError("errCryptoDeserialization")}c=c.value;c=(yield d("WASignalGroupCipher").decryptSenderKeyMsgFromSession(c,j.value));if(!c.success)return c;j=c.value;c=j[0];j=j[1];b||(yield i(new Uint8Array(j)),b=!0);yield a(e,f,c);return d("WAResultOrError").makeResult()}))}function u(c,e,f,g){var h=c.loadSenderKeySession,a=c.saveSenderKeySession;m("saveSenderKeySession");return j.lock([e,d("WAJids").extractUserJid(f)],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=null;if(h){var c=(yield h(e,f));b=c.success?c.value:null}c=(yield d("WASignalGroupCipher").processSenderKeyDistributionMsg(g,b));if(!c.success)return c;b=c.value;yield a(e,f,b);return d("WAResultOrError").makeResult()}))}function v(c,e,f,g){var a=c.saveSenderKeySession;m("rotateGroupSenderKey");return j.lock([e,d("WAJids").extractUserJid(f)],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield d("WASignalWhitepaper").initiateSenderKeySessionOutgoing(g)),c=b.senderKeyStates[0].senderKeyId;yield a(e,f,b);return{senderKeyId:c}}))}function w(a,b,c){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=a.loadSenderKeySession;a=a.saveSenderKeySession;m("createSenderKeyDistributionMsg");var f=(yield e(b,c)),g=f.error;if(!f.success&&g==="errLoadSenderKeySession"){g=(yield d("WASignalKeys").makeKeyPair());yield v({saveSenderKeySession:a},b,c,g);f=(yield e(b,c))}if(f.success){a=f.value.senderKeyStates.slice(-1);if(a.length>0)return d("WAResultOrError").makeResult(d("WASignalGroupCipher").createSenderKeyDistributionProto(d("WASignalGroupSession").convertFromRawToSenderKeyState(a[0])))}m("createSenderKeyDistributionMsg: errGetSenderKeyProto");return d("WAResultOrError").makeError("errGetSenderKeyProto")});return x.apply(this,arguments)}function y(a){var b=a.regId,c=a.identity,e=a.signedKey;a=a.oneTimeKey;m("sanitizeInitialSessionInfo");var f=d("WASignalKeys").castToSerializedPubKey(e.publicKey);return{regId:d("WASignalOther").castRegistrationId(b),identity:d("WASignalKeys").castToSerializedPubKey(c),signedKey:{id:d("WASignalKeys").castToSignedPreKeyId(e.id),publicKey:f,signature:d("WASignalOther").ensureSize(e.signature,64)},oneTimeKey:a&&{id:d("WASignalKeys").castToPreKeyId(a.id),publicKey:d("WASignalKeys").castToSerializedPubKey(a.publicKey)},ratchetKey:f}}g.publishLogs=a;g.createOutgoingSession=n;g.establishOutgoingSession=c;g.encryptContent=e;g.decryptContent=f;g.encryptGroupContent=s;g.decryptGroupContent=t;g.saveSenderKeySession=u;g.rotateGroupSenderKey=v;g.createSenderKeyDistributionMsg=w}),98);
__d("WACryptoManager",["Promise","WABridge","WACryptoLibrary","WACryptoUtils","WAGlobals","WAJids","WALogger","WALoggerTag","WANullthrows","WAOdsEnums","WAPromiseQueue","WAResultOrError","WASignalCipher","WASignalGroupSession","WASignalKeys","WASignalLocalStorageProtocol.pb","WASignalOther","WASignalSessions","WASignalSignatures","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u=d("WATagsLogger").TAGS([c("WALoggerTag").CryptoManager]),v={type:"default"};function a(a){return{flush:function(){return a.storage.savePendingToDatabase().then(function(){})}}}function e(a){return{regInfo:a.regInfo,network:a.network,storage:a.storage}}function w(a,b,c,d,e){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){e=(yield e(b,f));if(e!=null&&c.type!=="requestNewSession"){f=e;if(c.type==="default")return d("WAResultOrError").makeResult(f);else if(f.aliceBaseKey!=null&&c.session.baseKey!=null){c.type;if(!d("WACryptoUtils").uint8ArraysEqual(c.session.baseKey,f.aliceBaseKey))return d("WAResultOrError").makeResult(f)}}if(c.type==="useSession")e=c.session.keys;else{c.type;f=(yield a.network.requestKeys(b));if(!f.success)return f;e=f.value.keys;c.type==="compareTSAndUseSession"&&c.session.timestamp>=f.value.timestamp&&(e=c.session.keys)}b=(yield d("WACryptoLibrary").createOutgoingSession(a.regInfo,e));return!b.success?b:d("WAResultOrError").makeResult(b.value)});return x.apply(this,arguments)}function f(a,b,c,e){return d("WACryptoLibrary").establishOutgoingSession({handleNewSession:a.storage.handleNewSession},a.regInfo,b,c,e)}function y(a,b){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){d("WALogger").DEV(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Establish outgoing sessions"])));var c=(yield a.storage.loadSessions(b));b=b.filter(function(a){return!c.has(a)});if(b.length===0){d("WALogger").DEV(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[sessions] No need to establish outgoing sessions"])));return c}d("WALogger").DEV(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Missing sessions: ",". Requesting keys"])),b.length);b=(yield a.network.bulkRequestKeys(b));if(!b.success){d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["[sessions] fail during key requesting"])));return c}for(var e of c.entries()){var f=e[0],g=e[1];g.sendChain.nextMsgIndex>=d("WAGlobals").getConfig().sessionDropIfTooOld()&&(d("WALogger").DEV(o||(o=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Removing session "," due to ratchet key"])),f),c["delete"](f),d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.WA_LONG_SESSION_DROP,key:"decryption"}))}g=b.value;d("WALogger").DEV(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Received keys ",""])),g.size);var h=new(d("WAPromiseQueue").PromiseQueue)();g.forEach(function(e,b){h.enqueue(function(){return d("WACryptoLibrary").createOutgoingSession(a.regInfo,e.keys).then(function(a){a.success===!1?d("WALogger").ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Failed to create a session"]))):c.set(b,a.value)})})});yield h.wait();return c});return z.apply(this,arguments)}function A(a,b){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=Array.from(e.keys());d("WALogger").LOG(r||(r=babelHelpers.taggedTemplateLiteralLoose(["[SendMessage] sendWrittenMsg bulkEncryptContent"])));f=(yield y(a,f));var g=new Map();d("WALogger").DEV(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[SendMessage] start encryption"])));return(t||(t=b("Promise"))).all(Array.from(f.entries()).map(function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var f=b[0];b=b[1];b=(yield d("WASignalCipher").encryptMsg(b,c("WANullthrows")((b=e.get(f))==null?void 0:b.plaintext)));var h=b[0];b=b[1];g.set(f,babelHelpers["extends"]({},b,{baseKey:null}));return a.storage.handleNewSession(f,h,h.remote.pubKey)});return function(a){return f.apply(this,arguments)}}())).then(function(){return d("WAResultOrError").makeResult(g)})});return B.apply(this,arguments)}function C(a,b,c,e,f){return d("WACryptoLibrary").encryptContent({loadSession:function(b){return w(a,b,e,a.storage.loadSession,"cryptoManagerEncryptContent").then(function(a){if(a.success===!0)return a.value;else return null})},handleNewSession:a.storage.handleNewSession},b,c,f)}function D(a,b,c,e){return d("WACryptoLibrary").decryptContent({loadSession:a.storage.loadSession,handleNewSession:a.storage.handleNewSession,loadSignedPreKey:a.storage.loadSignedPreKey,loadOneTimePreKey:a.storage.loadOneTimePreKey},a.regInfo,b,c,e)}function E(a,b){return F.apply(this,arguments)}function F(){F=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield a.storage.loadSession(b,"getParticipantInfo"));return a==null?void 0:a.remote});return F.apply(this,arguments)}function G(a){return H.apply(this,arguments)}function H(){H=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b,e=(yield a.storage.getLastPreKeyGenerationId());b=((b=e==null?void 0:e.lastPreKeyId)!=null?b:0)+1;b=d("WASignalKeys").makePreKeys(b,1)[0];a=(yield a.storage.saveOneTimePreKey({keyId:b.plainObject.id,encoded:b.record}));if(a.success)return b.plainObject;throw c("err")("Cannot save one time prekey: "+a.error+", LastPreKeyId: "+((b=e==null?void 0:e.lastPreKeyId)!=null?b:0))});return H.apply(this,arguments)}function I(a,b){return J.apply(this,arguments)}function J(){J=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b===void 0&&(b=d("WAGlobals").getConfig().maxPrekeysToUpload());var c=(yield a.storage.getLastPreKeyGenerationId());c=d("WASignalKeys").makePreKeys(((c=c==null?void 0:c.lastPreKeyId)!=null?c:0)+1,b);return a.storage.savePreKeysGeneration(c.map(function(a){var b=a.plainObject;a=a.record;return{keyId:b.id,encoded:a}}))});return J.apply(this,arguments)}function K(a){return a.storage.loadLatestSignedPreKey().then(function(b){if(b.success===!1){var e,f,g;u.TAGS([c("WALoggerTag").SignedPrekey]).ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate signed prekey ",""])),b==null||(e=b.payload)==null?void 0:e.toString());throw c("err")("Failed to generate signed prekey: "+((f=b==null||(g=b.payload)==null?void 0:g.message)!=null?f:""))}f=b.value;f=d("WASignalSignatures").deserializeSignedPreKey(f);if(f==null){u.TAGS([c("WALoggerTag").SignedPrekey]).ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Failed to deserialize signed prekey: ",""])),b);throw c("err")("failed to deserialize signed prekey")}return L(a,f.id+1)})}function L(a,b){var e=d("WASignalSignatures").makeSignedPreKey(b,d("WATimeUtils").unixTimeMs(),a.regInfo.staticKeyPair);b=d("WASignalSignatures").serializeSignedPreKeyForPrivateStorage(e);return a.storage.saveSignedPreKeyIfNew(e.id,b).then(function(a){if(a.type==="success")return d("WAResultOrError").makeResult(e);else{a.type;return d("WAResultOrError").makeResult(a.key)}}).then(function(a){if(!a.success){var b,d;u.TAGS([c("WALoggerTag").SignedPrekey]).ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate signed prekey with id: ",""])),a);throw c("err")("Unexpected error when generateSignedPreKeyWithId: "+((b=a==null||(d=a.payload)==null?void 0:d.message)!=null?b:a.error))}return a.value})}function M(a,b,c,e){return d("WACryptoLibrary").encryptGroupContent({loadSenderKeySession:a.storage.loadSenderKeySession,saveSenderKeySession:a.storage.saveSenderKeySession},b,c,e)}function N(a,b,c,e,f){return d("WACryptoLibrary").decryptGroupContent({loadSenderKeySession:a.storage.loadSenderKeySession,saveSenderKeySession:a.storage.saveSenderKeySession},b,c,e,f)}function O(a,b,c,e){return d("WACryptoLibrary").saveSenderKeySession({saveSenderKeySession:a.storage.saveSenderKeySession},b,c,e)}function P(a,b,c){return Q.apply(this,arguments)}function Q(){Q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=(yield G(a));return d("WACryptoLibrary").rotateGroupSenderKey({saveSenderKeySession:a.storage.saveSenderKeySession},b,c,e.keyPair)});return Q.apply(this,arguments)}function R(a){return(t||(t=b("Promise"))).resolve().then(function(){return{regId:d("WASignalOther").makeRegistrationId(a),staticKeyPair:d("WASignalKeys").makeKeyPair(),authKeyPair:d("WASignalKeys").makeKeyPair()}})}function S(a){return d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").RecordStructureSpec,d("WASignalSessions").serializeSession(a))}function T(a){return d("WASignalOther").decodeSignalProto(d("WASignalLocalStorageProtocol.pb").RecordStructureSpec,a,d("WASignalSessions").parseSessionFromRecord)}function U(a){return d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").SenderKeyRecordStructureSpec,d("WASignalGroupSession").serializeSession(a))}function V(a){return d("WASignalOther").decodeSignalProto(d("WASignalLocalStorageProtocol.pb").SenderKeyRecordStructureSpec,a,d("WASignalGroupSession").parseSessionFromRecord)}function W(a){return a}function X(a,b){return a+"|"+b}function Y(a){a=a.split("|");if(a.length!==2)throw c("err")("Incorrect ComplexSenderKey");return{groupId:d("WAJids").unsafeCoerceToGroupJid(a[0]),deviceId:d("WAJids").unsafeCoerceToDeviceJid(a[1])}}g.DEFAULT_SESSION_REQUEST=v;g.cryptoManagerFlushable=a;g.initCryptoManager=e;g.getSessionForRecipient=w;g.establishOutgoingSession=f;g.ensureSessionsExists=y;g.bulkEncryptContent=A;g.encryptContent=C;g.decryptContent=D;g.getParticipantInfo=E;g.generateOneTimePreKey=G;g.generatePreKeys=I;g.generateSignedPreKey=K;g.generateSignedPreKeyWithId=L;g.encryptGroupContent=M;g.decryptGroupContent=N;g.saveSenderKeySession=O;g.rotateGroupSenderKey=P;g.generateRegistrationInfo=R;g.encodeSession=S;g.decodeSession=T;g.encodeSenderKeySession=U;g.decodeSenderKeySession=V;g.castToPreKeyGenerationId=W;g.encodeSenderKey=X;g.decodeSenderKey=Y}),98);
__d("WADbSignal",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a,b,c){return a+"_"+b+"_"+c}c={abProps:"abProps",authKeyPair:"authKeyPair",cat:"cat",certificateChain:"certificateChain",clockSkew:"clockSkew",deviceId:"deviceId",deviceUUID:"deviceUUID",edgeInfo:"edgeInfo",fbid:"fbid",identityKeyPair:"identityKeyPair",lastPrekeyGenerationId:"lastPrekeyGenerationId",lastPrekeyId:"lastPrekeyId",lastSessionDeviceWasLinkedTo:"lastSessionDeviceWasLinkedTo",lastSignedPrekeyId:"lastSignedPrekeyId",regId:"regId",registrationVersion:"registrationVersion",deviceRegUnixTime:"deviceRegUnixTime"};({msgrDeviceId:"msgrDeviceId"});d={registrationHistory:"registrationHistory"};f.unsafeCoerceToSenderKeySessionId=a;f.buildSenderKeySessionId=b;f.MetaKeysEnum=c;f.PlainTextMetaKeysEnum=d}),66);
__d("WABulkSaveSignalDataApi",["Promise","WACryptoManager","WADbSignal","WAJids","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.dhashUpdate,e=a.icdcUpdate,f=a.identityRemove,g=a.identityUpdate,j=a.preKeyRemove,l=a.senderKeySessionUpdate,m=a.sessionRemove,n=a.sessionUpdate,o=a.lastSyncTsUpdate,p=n.map(function(a){var b=a.id;a=a.updated;return{id:b,session:d("WACryptoManager").encodeSession(a)}}),q=[];l.forEach(function(a){var b=a.author,c=a.groupId;a=a.updated;var e=d("WAJids").extractUserJid(b);b=d("WAJids").extractDeviceId(b);var f=d("WADbSignal").buildSenderKeySessionId(c,e,b);q.push({deviceId:b,groupJid:c,id:f,record:d("WACryptoManager").encodeSenderKeySession(a),userJid:e})});yield d("WASignalDB").getDb().runInTransaction(["contacts","identity","prekey","senderKeySessions","session"],"readwrite",function(a){var d=a.stores,l=d.session,n=d.identity,r=d.senderKeySessions;d=d.prekey;return(h||(h=b("Promise"))).all([l.bulkDelete(m),n.bulkDelete(f),l.bulkPut(p),r.bulkPut(q),k(a.stores,g),i(a.stores,e,g,c,o),d.bulkDelete(j.map(function(a){a=a.id;return a}))])},d("WASignalDB").signalOp("bulkSaveSignalData"))});return function(b){return a.apply(this,arguments)}}();function i(a,b,c,d,e){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){var g=new Set();for(c of c)g.add(d("WAJids").extractUserJid(c.id));c=Array.from(g);for(var h of b)g.add(h.id);h=(yield a.contacts.bulkGet(Array.from(g)));g=new Map();for(h of h){if(h==null)continue;g.set(h.contactJid,h)}for(h of c){c=g.get(h);c==null?(c={contactJid:h,dhash:null},g.set(h,c)):c.dhash=null}for(c of b){h=g.get(c.id);h==null?(h={contactJid:c.id,dhash:null,icdcInfo:c.icdc},g.set(c.id,h)):h.icdcInfo=c.icdc}for(b of e){h=g.get(b.id);h==null?(h={contactJid:b.id,dhash:b.dhash},g.set(b.id,h)):h.dhash=b.dhash}for(c of f){e=g.get(c.id);e==null?(e={contactJid:c.id,dhash:null,lastSyncTs:c.lastSyncTs},g.set(c.id,e)):e.lastSyncTs=c.lastSyncTs}return a.contacts.bulkPut(Array.from(g.values()))});return j.apply(this,arguments)}function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b.length===0)return;b=b.map(function(a){var b=a.id;a=a.identity;return{deviceJid:b,identity:a,userJid:d("WAJids").extractUserJid(b)}});yield a.identity.bulkPut(b)});return l.apply(this,arguments)}g.bulkSaveSignalData=a}),98);
__d("WAIdentityUtils",["WABinary","WACryptoDependencies","WASignalOther"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b=a.length===33&&a[0]===5;return b?a.slice(1):a}function i(a,b){for(var c=0;c<a.length&&c<b.length;++c)if(a[c]!==b[c])return a[c]-b[c];return a.length-b.length}function a(a){a=a.map(function(a){return h(a)});var b=new(d("WABinary").Binary)();a.sort(i).forEach(function(a){return b.writeByteArray(a)});a=d("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",b.readByteArrayView());return a.then(function(a){a=new Uint8Array(a);return d("WASignalOther").sliceBytes(a,0,10)})}g.removeKeyTypeIfNeeded=h;g.computeIdentitiesHash=a}),98);
__d("WAICDCUtils",["WAArmadilloICDC.pb","WABase64","WABinary","WACryptoDependencies","WACryptoEd25519","WACryptoUtils","WAIdentityUtils","WALogger","WASignalKeys","WASignalOther","WASignalSignatures","WATimeUtils","decodeProtobuf","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l;function a(a,b,c,e){if(a!==e.details.seq){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Received ICDC has mismatched sequence between XML node and byte structure"])));return null}if(c!==e.details.timestamp){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Received ICDC has mismatched timestamp between XML node and byte structure"])));return null}if(e.details.signingDeviceIndex==null){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Received ICDC has mismatched missed signingDeviceIndex"])));return null}var f=e.details.signingDeviceIndex;return{dirty:b,sequence:a,timestamp:c,signingDeviceIndex:f,devices:e.details.devices.map(function(a){return new Uint8Array(a)})}}function b(a){return a.signingDeviceIndex<0||a.signingDeviceIndex>=a.devices.length}function e(a){a=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloICDC.pb").SignedICDCIdentityListSpec,a);var b=a.signature;a=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloICDC.pb").ICDCIdentityListSpec,a.details);return{signature:b,details:a}}function f(a){return a.map(function(a){return d("WASignalKeys").serializeIdentity(new Uint8Array(d("WABase64").decodeB64UrlSafe(a)))})}function m(a,b,e,f,g){var h=d("WAIdentityUtils").removeKeyTypeIfNeeded(a.publicKey);e=e.map(function(a){return d("WAIdentityUtils").removeKeyTypeIfNeeded(a)});var i=e.findIndex(function(a){return d("WACryptoUtils").uint8ArraysEqual(a,h)});if(i===-1){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["signingDeviceIndex not found. This should never happen. ",". caller: ",""])),f,g);throw c("err")("signingDeviceIndex not found")}f=b==null?1:b+1;g=d("WATimeUtils").unixTime();g<0&&d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["ICDC timestamp is negative. time: ",", closkSkew: ",""])),Date.now(),d("WATimeUtils").getClockSkew());b={seq:f,timestamp:g,devices:e,signingDeviceIndex:i};f=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloICDC.pb").ICDCIdentityListSpec,b).readBuffer();g=n(a,d("WABinary").Binary.build(f).readByteArrayView());e={details:f,signature:g};i=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloICDC.pb").SignedICDCIdentityListSpec,e).readBuffer();return{icdcInfo:b,encodedSignedICDC:i}}function n(a,b){var c=d("WASignalOther").makeBytes(64);d("WACryptoDependencies").getCrypto().getRandomValues(c);var e=new Uint8Array(64);d("WACryptoEd25519").hashSha512(e,b,b.length);e=d("WASignalSignatures").makeSignature(a,b,c);return d("WABinary").Binary.build(e).readBuffer()}var o=4*d("WATimeUtils").HOUR_SECONDS;function p(a){return a==null?!0:!d("WATimeUtils").happenedWithin(a,o)}g.validateAndPrepareICDCFromNotification=a;g.isICDCIndexInvalid=b;g.decodeICDCInfo=e;g.base64DeviceIdentitiesToSerializedPubKeys=f;g.computeICDCInfoForUpload=m;g.isLastSyncTsExpired=p}),98);
__d("WAComputeAndUploadICDCInfo",["WABase64","WADeprecatedSendIq","WADeprecatedWapParser","WAGetDevices","WAGlobals","WAICDCUtils","WAIdentityUtils","WALogger","WAPromiseBackoffs","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=new(c("WADeprecatedWapParser"))("parseUploadICDCInfoResponse",function(a){a.assertTag("iq"),a.assertFromServer(),a.assertAttr("type","result")}),m=0;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){a=c.reason;var e=c.caller;c=c.sequence;d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["computeAndUploadICDCInfo called ",""])),c);var f;try{f=(yield d("WAGlobals").getWaOneQueue().enqueue(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.cryptoManager;var b=(yield a.storage.loadIdentities(d("WAGlobals").getMyUserJid()));a=a.regInfo;return{regInfo:a,identities:Array.from(b.values())}});return function(b){return a.apply(this,arguments)}}(),{operationType:"icdc_load_identities",flush:!1,afterInit:!0}))}catch(a){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Loading identities fails with error: ",""])),a.toString())}if(f==null)return;var g=f,n=g.regInfo;g=g.identities;n=d("WAICDCUtils").computeICDCInfoForUpload(n.staticKeyPair,c,g,a,e);var o=n.icdcInfo;c=n.encodedSignedICDC;a=(yield d("WAIdentityUtils").computeIdentitiesHash(g));e=d("WAWap").wap("iq",{id:d("WAWap").generateId(),to:d("WAWap").S_WHATSAPP_NET,type:"set",xmlns:"fbid:devices"},d("WAWap").wap("icdc",{ihash:d("WAWap").CUSTOM_STRING(d("WABase64").encodeB64(a)),seq:d("WAWap").INT(o.seq),ts:d("WAWap").INT(o.timestamp)},c));n=(yield d("WADeprecatedSendIq").deprecatedSendIq(e,l));n.success?(m=0,yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return a.storage.saveICDC(d("WAGlobals").getMyUserJid(),{sequence:o.seq,timestamp:o.timestamp,devices:o.devices,signingDeviceIndex:o.signingDeviceIndex,dirty:!1})},{operationType:"save_icdc",flush:!0,afterInit:!0})):(m+=1,n.errorCode===406||n.errorCode===500?setTimeout(function(){d("WAGetDevices").getDevices(null,{ignoreDhash:!0,reason:"compute-Upload-icdc",users:new Set().add(d("WAGlobals").getMyUserJid())})["catch"](function(a){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Failed getting devices ",""])),a.toString())})},d("WAPromiseBackoffs").getDelay(m,{jitter:.1,max:3e4,algo:{type:"fibonacci",first:1e3,second:1e3}})):d("WALogger").WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Cannot update ICDC for user, because of "," server response"])),n.errorCode))});return function(b,c){return a.apply(this,arguments)}}();g.computeAndUploadICDCInfo=a}),98);
__d("WAPushSafeTypes",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}f.unsafeNotNullable=a}),66);
__d("WAGetDevices",["WADevicesState","WALogger","WAPushSafeTypes","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WAPushSafeTypes").unsafeNotNullable(b);b=a.users;var c=a.reason;a=a.ignoreDhash;a=a===void 0?!1:a;d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["fetchAndSaveDevices: ",""])),c);a&&d("WADevicesState").getDevicesState().reset(Array.from(b));yield d("WADevicesState").getDevicesState().waitForUserDevices(Array.from(b),"getDevices job: "+c,a)});return i.apply(this,arguments)}g.getDevices=a}),98);
__d("WAFetchAndSaveDevices",["Promise","WAComputeAndUploadICDCInfo","WAGlobals","WAICDCUtils","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return;var c=[];yield d("WAGlobals").getWaOneQueue().enqueue(function(e){var f=e.cryptoManager;d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Update user devices signal and DB"])));return(j||(j=b("Promise"))).all(a.map(function(a){var b;c.push({contactJid:a.jid,dhash:a.dhash,lastSyncTs:a.lastSyncTs,icdcInfo:(b=a.icdcInfo)!=null?b:void 0});return f.storage.updateUserDevicesInfo([a])}))},{operationType:"get_devices",flush:!0,afterInit:!0});var e=d("WAGlobals").getMyUserJid(),f=a.find(function(a){return a.jid===e});if(f!=null){f=f.icdcInfo;if(f==null||d("WAICDCUtils").isICDCIndexInvalid(f)||f!=null&&f.dirty){var g;f==null?g="empty":f.dirty?g="dirty":g="invalidIndex";d("WAComputeAndUploadICDCInfo").computeAndUploadICDCInfo(null,{reason:g,caller:"get_devices",sequence:f==null?void 0:f.sequence})["catch"](function(a){d("WALogger").DEV(i||(i=babelHelpers.taggedTemplateLiteralLoose(["computeAndSaveICDC: ",""])),a)})}}});return k.apply(this,arguments)}g.updateUsersDevicesSignalAndDB=a}),98);
__d("WAHandleFbDeviceChangeNotificationProtocol",["WAICDCUtils","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a.dhash}function b(a){var b;b=((b=a.iCDCDirtyMixin)==null?void 0:b.dirty)==="true";var c=d("WATimeUtils").castToUnixTime(a.ts),e=a.seq;a=d("WAICDCUtils").decodeICDCInfo(a.elementValue);e=d("WAICDCUtils").validateAndPrepareICDCFromNotification(e,b,c,a);return e==null?d("WAResultOrError").makeError("icdc-validation-failure"):d("WAResultOrError").makeResult(e)}g.parseDhash=a;g.parseICDCFromServer=b}),98);
__d("WALoadContactsApi",["WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASignalDB").getDb().runInTransaction(["contacts"],"readonly",function(b){return b.stores.contacts.bulkGet(a).then(function(a){return new Map(a.filter(Boolean).map(function(a){return[a.contactJid,{contactJid:a.contactJid,dhash:a.dhash,icdcFails:a.icdcFails,icdcInfo:a.icdcInfo,lastSyncTs:a.lastSyncTs}]}))})},d("WASignalDB").signalOp("loadContacts"))};g.loadContacts=a}),98);
__d("WARPCAbortController",["Promise"],(function(a,b,c,d,e,f){"use strict";var g,h="rpc-timeout";function a(a,c){var d,e=new(g||(g=b("Promise")))(function(a,b){d=setTimeout(function(){b(h)},c)});return g.race([a,e])["finally"](function(){clearTimeout(d)})}f.RPC_TIMEOUT=h;f.rpcAbortController=a}),66);
__d("WASmaxInDevicesIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInDevicesIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInDevicesNonRetryableIQErrorMixin",["WASmaxInDevicesIQErrorBadRequestMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxInDevicesIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);return!b.success?b:b}g.parseNonRetryableIQErrorMixin=a}),98);
__d("WASmaxInDevicesIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",500);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInDevicesIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","service-unavailable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",503);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorServiceUnavailableMixin=a}),98);
__d("WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup",["WAResultOrError","WASmaxInDevicesIQErrorInternalServerErrorMixin","WASmaxInDevicesIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:b.value});var c=d("WASmaxInDevicesIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorInternalServerError","IQErrorServiceUnavailable"],[b,c])}g.parseIQErrorInternalServerErrorOrServiceUnavailableMixinGroup=a}),98);
__d("WASmaxInDevicesRetryableIQErrorMixin",["WAResultOrError","WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"backoff",0,86400);if(!b.success)return b;a=d("WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup").parseIQErrorInternalServerErrorOrServiceUnavailableMixinGroup(a);return!a.success?a:d("WAResultOrError").makeResult({backoff:b.value,iQErrorInternalServerErrorOrServiceUnavailableMixinGroup:a.value})}g.parseRetryableIQErrorMixin=a}),98);
__d("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup",["WAResultOrError","WASmaxInDevicesNonRetryableIQErrorMixin","WASmaxInDevicesRetryableIQErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesRetryableIQErrorMixin").parseRetryableIQErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"RetryableIQError",value:b.value});var c=d("WASmaxInDevicesNonRetryableIQErrorMixin").parseNonRetryableIQErrorMixin(a);return c.success?d("WAResultOrError").makeResult({name:"NonRetryableIQError",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["RetryableIQError","NonRetryableIQError"],[b,c])}g.parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup=a}),98);
__d("WASmaxInDevicesFetchResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup").parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup:b.value}))}g.parseFetchResponseError=a}),98);
__d("WASmaxInDevicesIQErrorItemNotFoundMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","item-not-found");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",404);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorItemNotFoundMixin=a}),98);
__d("WASmaxInDevicesFetchNonRetryableUserErrorMixin",["WASmaxInDevicesIQErrorItemNotFoundMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxInDevicesIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);return!b.success?b:b}g.parseFetchNonRetryableUserErrorMixin=a}),98);
__d("WASmaxInDevicesFetchRetryableUserErrorMixin",["WAResultOrError","WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup").parseIQErrorInternalServerErrorOrServiceUnavailableMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({iQErrorInternalServerErrorOrServiceUnavailableMixinGroup:b.value})}g.parseFetchRetryableUserErrorMixin=a}),98);
__d("WASmaxInDevicesFetchOrFetchNonRetryableUserErrorMixinGroup",["WAResultOrError","WASmaxInDevicesFetchNonRetryableUserErrorMixin","WASmaxInDevicesFetchRetryableUserErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesFetchRetryableUserErrorMixin").parseFetchRetryableUserErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"FetchRetryableUserError",value:b.value});var c=d("WASmaxInDevicesFetchNonRetryableUserErrorMixin").parseFetchNonRetryableUserErrorMixin(a);return c.success?d("WAResultOrError").makeResult({name:"FetchNonRetryableUserError",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["RetryableUserError","NonRetryableUserError"],[b,c])}g.parseFetchOrFetchNonRetryableUserErrorMixinGroup=a}),98);
__d("WASmaxInDevicesFetchUserResponseFailureMixin",["WAResultOrError","WASmaxInDevicesFetchOrFetchNonRetryableUserErrorMixinGroup","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxParseJid").attrUserJid(a,"jid");if(!a.success)return a;b=d("WASmaxInDevicesFetchOrFetchNonRetryableUserErrorMixinGroup").parseFetchOrFetchNonRetryableUserErrorMixinGroup(b.value);return!b.success?b:d("WAResultOrError").makeResult({jid:a.value,errorFetchOrFetchNonRetryableUserErrorMixinGroup:b.value})}g.parseFetchUserResponseFailureMixin=a}),98);
__d("WASmaxInDevicesDeviceModelInfoMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"platform");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"model");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function a(a){var b=d("WASmaxParseUtils").optionalChildWithTag(a,"platform",h);if(!b.success)return b;a=d("WASmaxParseUtils").optionalChildWithTag(a,"model",i);return!a.success?a:d("WAResultOrError").makeResult({platform:b.value,model:a.value})}g.parseDeviceModelInfoPlatform=h;g.parseDeviceModelInfoModel=i;g.parseDeviceModelInfoMixin=a}),98);
__d("WASmaxInDevicesDhashMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrString(a,"dhash");return!a.success?a:d("WAResultOrError").makeResult({dhash:a.value})}g.parseDhashMixin=a}),98);
__d("WASmaxInDevicesKeyDataMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").contentBytesRange(a,32,32);return!a.success?a:d("WAResultOrError").makeResult({elementValue:a.value})}g.parseKeyDataMixin=a}),98);
__d("WASmaxInDevicesIdentityKeyMixin",["WASmaxInDevicesKeyDataMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"identity");if(!a.success)return a;a=d("WASmaxInDevicesKeyDataMixin").parseKeyDataMixin(a.value);return!a.success?a:a}g.parseIdentityKeyMixin=a}),98);
__d("WASmaxInDevicesDeviceListMixin",["WAResultOrError","WASmaxInDevicesDeviceModelInfoMixin","WASmaxInDevicesDhashMixin","WASmaxInDevicesIdentityKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"device");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"id",1,999);if(!b.success)return b;var c=d("WASmaxInDevicesIdentityKeyMixin").parseIdentityKeyMixin(a);if(!c.success)return c;a=d("WASmaxInDevicesDeviceModelInfoMixin").parseDeviceModelInfoMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({id:b.value},c.value,{deviceModelInfoMixin:a.success?a.value:null}))}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"devices");if(!b.success)return b;b=d("WASmaxInDevicesDhashMixin").parseDhashMixin(a);a=d("WASmaxParseUtils").mapChildrenWithTag(a,"device",0,25,h);return!a.success?a:d("WAResultOrError").makeResult({dhashMixin:b.success?b.value:null,device:a.value})}g.parseDeviceListDevice=h;g.parseDeviceListMixin=a}),98);
__d("WASmaxInDevicesICDCDirtyMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"icdc");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"dirty","true");return!b.success?b:d("WAResultOrError").makeResult({dirty:b.value})}g.parseICDCDirtyMixin=a}),98);
__d("WASmaxInDevicesICDCSeqMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrIntRange(a,"seq",0,2147483647);return!a.success?a:d("WAResultOrError").makeResult({seq:a.value})}g.parseICDCSeqMixin=a}),98);
__d("WASmaxInDevicesICDCSignedListMixin",["WAResultOrError","WASmaxInDevicesICDCSeqMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"icdc");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"ts",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").contentBytesRange(a,1,40072);if(!c.success)return c;a=d("WASmaxInDevicesICDCSeqMixin").parseICDCSeqMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({ts:b.value,elementValue:c.value},a.value))}g.parseICDCSignedListMixin=a}),98);
__d("WASmaxInDevicesICDCFromServerMixin",["WAResultOrError","WASmaxInDevicesICDCDirtyMixin","WASmaxInDevicesICDCSignedListMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"icdc");if(!b.success)return b;b=d("WASmaxInDevicesICDCSignedListMixin").parseICDCSignedListMixin(a);if(!b.success)return b;a=d("WASmaxInDevicesICDCDirtyMixin").parseICDCDirtyMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{iCDCDirtyMixin:a.success?a.value:null}))}g.parseICDCFromServerMixin=a}),98);
__d("WASmaxInDevicesFetchUserResponseSuccessMixin",["WAResultOrError","WASmaxInDevicesDeviceListMixin","WASmaxInDevicesICDCFromServerMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"devices");if(!b.success)return b;b=d("WASmaxInDevicesDeviceListMixin").parseDeviceListMixin(a);return!b.success?b:b}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"icdc");if(!b.success)return b;b=d("WASmaxInDevicesICDCFromServerMixin").parseICDCFromServerMixin(a);return!b.success?b:b}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"devices",h);if(!b.success)return b;var c=d("WASmaxParseUtils").optionalChildWithTag(a,"icdc",i);if(!c.success)return c;a=d("WASmaxParseJid").attrUserJid(a,"jid");return!a.success?a:d("WAResultOrError").makeResult({jid:a.value,devices:b.value,icdc:c.value})}g.parseFetchUserResponseSuccessDevices=h;g.parseFetchUserResponseSuccessIcdc=i;g.parseFetchUserResponseSuccessMixin=a}),98);
__d("WASmaxInDevicesUserResponseFetchFailureOrFetchSuccessMixinGroup",["WAResultOrError","WASmaxInDevicesFetchUserResponseFailureMixin","WASmaxInDevicesFetchUserResponseSuccessMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesFetchUserResponseFailureMixin").parseFetchUserResponseFailureMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"FetchUserResponseFailure",value:b.value});var c=d("WASmaxInDevicesFetchUserResponseSuccessMixin").parseFetchUserResponseSuccessMixin(a);return c.success?d("WAResultOrError").makeResult({name:"FetchUserResponseSuccess",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["UserResponseFailure","UserResponseSuccess"],[b,c])}g.parseUserResponseFetchFailureOrFetchSuccessMixinGroup=a}),98);
__d("WASmaxInDevicesFetchUserResponseMixin",["WAResultOrError","WASmaxInDevicesUserResponseFetchFailureOrFetchSuccessMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxInDevicesUserResponseFetchFailureOrFetchSuccessMixinGroup").parseUserResponseFetchFailureOrFetchSuccessMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({userResponseFetchFailureOrFetchSuccessMixinGroup:b.value})}g.parseFetchUserResponseMixin=a}),98);
__d("WASmaxInDevicesIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInDevicesFetchResponseSuccess",["WAResultOrError","WASmaxInDevicesFetchUserResponseMixin","WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxInDevicesFetchUserResponseMixin").parseFetchUserResponseMixin(a);return!b.success?b:b}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"users");if(!c.success)return c;a=d("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"user",0,25,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{usersUser:b.value}))}g.parseFetchResponseSuccessUsersUser=h;g.parseFetchResponseSuccess=a}),98);
__d("WASmaxOutDevicesBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutDevicesDhashMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyDhash;a=d("WASmaxJsx").smax("smax$any",{dhash:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeDhashMixin=a}),98);
__d("WASmaxOutDevicesICDCSeqMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anySeq;a=d("WASmaxJsx").smax("smax$any",{seq:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeICDCSeqMixin=a}),98);
__d("WASmaxOutDevicesFetchRequest",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutDevicesBaseIQGetRequestMixin","WASmaxOutDevicesDhashMixin","WASmaxOutDevicesICDCSeqMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.userJid,c=a.dhashMixinArgs;a=a.iCDCSeqMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutDevicesICDCSeqMixin").mergeICDCSeqMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutDevicesDhashMixin").mergeDhashMixin,d("WASmaxJsx").smax("user",{jid:d("WAWap").USER_JID(b)}),c),a);return b}function a(a){a=a.userArgs;a=d("WASmaxOutDevicesBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},d("WASmaxJsx").smax("users",null,d("WASmaxChildren").REPEATED_CHILD(h,a,1,25))));return a}g.makeFetchRequestUsersUser=h;g.makeFetchRequest=a}),98);
__d("WASmaxDevicesFetchRPC",["WAComms","WASmaxInDevicesFetchResponseError","WASmaxInDevicesFetchResponseSuccess","WASmaxOutDevicesFetchRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WASmaxOutDevicesFetchRequest").makeFetchRequest(a);b=(yield d("WAComms").sendSmaxStanza(a,b));var c=d("WASmaxInDevicesFetchResponseSuccess").parseFetchResponseSuccess(b,a);if(c.success)return{name:"FetchResponseSuccess",value:c.value};b=d("WASmaxInDevicesFetchResponseError").parseFetchResponseError(b,a);if(b.success)return{name:"FetchResponseError",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Fetch",{Success:c,Error:b}))});return h.apply(this,arguments)}g.sendFetchRPC=a}),98);
__d("WAFetchFbDevicesProtocolV2",["Promise","WAArrayChunk","WAHandleFbDeviceChangeNotificationProtocol","WAJids","WALoadContactsApi","WARPCAbortController","WASignalKeys","WASmaxDevicesFetchRPC","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=25,l=1e4,m=d("WATagsLogger").TAGS(["wa-devices-protocol"]);function a(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){if(a.length===0)return new Map();var e=(yield o(a,c));c=d("WAArrayChunk").chunk(a.map(function(a){var b=e.get(a);b=b!=null?{anyDhash:b}:null;return{userJid:a,dhashMixinArgs:b}}),k);var f=new Map();yield (j||(j=b("Promise"))).allSettled(c.map(function(a){return q(f,a)}));return f});return n.apply(this,arguments)}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b)return new Map();b=(yield d("WALoadContactsApi").loadContacts(a));var c=new Map();b.forEach(function(a){a&&a.dhash!=null&&c.set(a.contactJid,a.dhash)});return c});return p.apply(this,arguments)}function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{var e=new Set(b.map(function(a){return a.userJid}));b=(yield d("WARPCAbortController").rpcAbortController(d("WASmaxDevicesFetchRPC").sendFetchRPC({userArgs:b}),l));if(b.name==="FetchResponseError")throw c("err")("Failed to fetch user devices");b.value.usersUser.map(function(b){b=b.userResponseFetchFailureOrFetchSuccessMixinGroup;if(b.name==="FetchUserResponseFailure")return;b=b.value;var c=b.jid,f=b.devices;b=b.icdc;e["delete"](c);a.set(c,{newState:s(c,f,b,d("WATimeUtils").unixTime()),stateIsUpToDate:!1})});e.forEach(function(b){a.set(b,{stateIsUpToDate:!0})})}catch(a){if(a===d("WARPCAbortController").RPC_TIMEOUT){m.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Timeout for fetchAndSaveDevices"])));return}m.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["",""])),a)}});return r.apply(this,arguments)}function s(a,b,c,e){e===void 0&&(e=null);var f=[],g=null;if(b){f=b.device.map(function(a){var b;return{id:d("WAJids").interpretAsDeviceId(a.id),identity:d("WASignalKeys").serializeIdentity(a.elementValue),platform:(b=a.deviceModelInfoMixin)==null||(b=b.platform)==null?void 0:b.elementValue,model:(b=a.deviceModelInfoMixin)==null||(b=b.model)==null?void 0:b.elementValue}});g=(b=b.dhashMixin)==null?void 0:b.dhash}b=null;if(c){c=d("WAHandleFbDeviceChangeNotificationProtocol").parseICDCFromServer(c);b=c.success?c.value:null}return{jid:a,devices:f,lastSyncTs:d("WATimeUtils").unixTime(),dhash:g,icdcInfo:b,notificationTs:e}}g.fetchFbDevicesProtocol=a}),98);
__d("WADevicesState",["Promise","WAFetchAndSaveDevices","WAFetchFbDevicesProtocolV2","WAPREList","WAPREMetrics","WAResolvable","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=3e4,n=1e3*60*60,o=d("WATagsLogger").TAGS(["WADevicesState"]);c=function(){function a(){this.$1=new Map()}var c=a.prototype;c.$2=function(a){var b=this;setTimeout(function(){a.forEach(function(a){var c=a[0];a=a[1];a.resolveWasCalled()||(a.resolve(d("WAResultOrError").makeError()),b.$1.get(c)===a&&b.$1["delete"](c))})},m);setTimeout(function(){a.forEach(function(a){var c=a[0];a=a[1];b.$1.get(c)===a&&b.$1["delete"](c)})},n)};c.waitForUserDevices=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var f=this;e===void 0&&(e=!1);var g=[],m=[];e===!0&&a.forEach(function(a){f.$1["delete"](a)});a.forEach(function(a){var b=f.$1.get(a);if(b==null){var c=new(d("WAResolvable").Resolvable)();g.push([a,c]);f.$1.set(a,c)}else m.push([a,b.promise])});this.$2(g);o.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["getDevices called for users ",", reason: ",""])),Array.from(a),c);var n=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.GET_DEVICES,{string:{reason:c}});n.addPoint("fetch_start");var p=(yield d("WAFetchFbDevicesProtocolV2").fetchFbDevicesProtocol(g.map(function(a){a=a[0];return a}),e)["catch"](function(a){n.addPoint("fetch_fail");o.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["fetchFBDevicesProtocol failed: ",""])),a);return new Map()}));n.addPoint("fetch_end");var q=!0;o.DEV(j||(j=babelHelpers.taggedTemplateLiteralLoose(["getDevices -> update devices signal"])));n.addPoint("signal_update_start");yield d("WAFetchAndSaveDevices").updateUsersDevicesSignalAndDB(Array.from(p.values()).map(function(a){return a.newState}).filter(Boolean))["catch"](function(a){q=!1,o.ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["updateDevicesSignalAndDB failed: ",""])),a)});n.addPoint("signal_update_end");g.forEach(function(a){var b=a[0];a=a[1];if(!q){a.resolve(d("WAResultOrError").makeError());f.$1["delete"](b);return}p.has(b)?a.resolve(d("WAResultOrError").makeResult()):(a.resolve(d("WAResultOrError").makeError()),f.$1["delete"](b))});n.endSuccess();yield (l||(l=b("Promise"))).allSettled(m.map(function(a){a[0];a=a[1];return a}))});function c(b,c,d){return a.apply(this,arguments)}return c}();c.reset=function(a){var b=this;a.forEach(function(a){return b.$1["delete"](a)})};return a}();var p=new c();function a(){return p}g.DeviceStateClassV2=c;g.getDevicesState=a}),98);
__d("WAComputeICDC",["Promise","WAGetDevices","WAICDCUtils","WAIdentityUtils","WAJids","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=d("WATagsLogger").TAGS(["WAComputeICDC"]);function a(a,b,c,d){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){var g=new Set(),n=[].concat(a);a=a.find(function(a){return a.user===c});if(a==null){a=(yield f.cryptoManager.storage.loadIdentities(c));a=a.get(e);if(a==null){m.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Sender does not have identity"])));return}n.push({user:c,devicesInfo:[{identity:a,jid:e}]})}a=void 0;var o=[],p=[];yield (l||(l=b("Promise"))).all(n.map(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var h=(yield (l||(l=b("Promise"))).all([f.cryptoManager.storage.loadICDC(e.user),f.cryptoManager.storage.loadLastSyncTs(e.user)])),j=h[0];h=h[1];d("WAICDCUtils").isLastSyncTsExpired(h)&&g.add(e.user);h=new Set();if(j==null)g.add(e.user);else if(d("WAICDCUtils").isICDCIndexInvalid(j))g.add(e.user),m.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["ICDC has invalid index"]))),j=null;else for(var k of j.devices)h.add(k.toString());k=[];var n=[];for(var q of e.devicesInfo){var r=d("WAJids").extractDeviceId(q.jid),s=d("WAIdentityUtils").removeKeyTypeIfNeeded(q.identity);h.has(s.toString())||(k.push(r),n.push(s.buffer))}r={unknownDevices:n,unknownDeviceIds:k};j!=null&&(r.seq=j.sequence,r.signingDevice=j.devices[j.signingDeviceIndex].buffer);e.user===c?a=r:(o.push(r),p.push(e.user))});return function(a){return e.apply(this,arguments)}}()));g.size>0&&(m.LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Triggering getDevices for users with missing or incorrect icdc info."]))),d("WAGetDevices").getDevices(null,{ignoreDhash:!0,reason:"missing-icdc-info",users:g})["catch"](function(a){m.ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Error during get devices for users with missing icdc info: ",""])),a)}));return{senderIdentity:a,recipientIdentities:o,recipientUserJids:p}});return n.apply(this,arguments)}g.computeICDC=a}),98);
__d("WAMultiDevice.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={},j={},k={},l={},m={};a.name="MultiDevice";a.internalSpec={payload:[1,(d=d("WAProtoConst")).TYPES.MESSAGE,c],metadata:[2,d.TYPES.MESSAGE,b]};b.name="MultiDevice$Metadata";b.internalSpec={};c.name="MultiDevice$Payload";c.internalSpec={applicationData:[1,d.TYPES.MESSAGE,e],signal:[2,d.TYPES.MESSAGE,m],__oneofs__:{payload:["applicationData","signal"]}};e.name="MultiDevice$ApplicationData";e.internalSpec={appStateSyncKeyShare:[1,d.TYPES.MESSAGE,h],appStateSyncKeyRequest:[2,d.TYPES.MESSAGE,f],__oneofs__:{applicationData:["appStateSyncKeyShare","appStateSyncKeyRequest"]}};f.name="MultiDevice$ApplicationData$AppStateSyncKeyRequestMessage";f.internalSpec={keyIds:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,l]};h.name="MultiDevice$ApplicationData$AppStateSyncKeyShareMessage";h.internalSpec={keys:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,i]};i.name="MultiDevice$ApplicationData$AppStateSyncKey";i.internalSpec={keyId:[1,d.TYPES.MESSAGE,l],keyData:[2,d.TYPES.MESSAGE,j]};j.name="MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyData";j.internalSpec={keyData:[1,d.TYPES.BYTES],fingerprint:[2,d.TYPES.MESSAGE,k],timestamp:[3,d.TYPES.INT64]};k.name="MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyData$AppStateSyncKeyFingerprint";k.internalSpec={rawId:[1,d.TYPES.UINT32],currentIndex:[2,d.TYPES.UINT32],deviceIndexes:[3,d.FLAGS.REPEATED|d.FLAGS.PACKED|d.TYPES.UINT32]};l.name="MultiDevice$ApplicationData$AppStateSyncKeyId";l.internalSpec={keyId:[1,d.TYPES.BYTES]};m.name="MultiDevice$Signal";m.internalSpec={};g.MultiDeviceSpec=a;g.MultiDevice$MetadataSpec=b;g.MultiDevice$PayloadSpec=c;g.MultiDevice$ApplicationDataSpec=e;g.MultiDevice$ApplicationData$AppStateSyncKeyRequestMessageSpec=f;g.MultiDevice$ApplicationData$AppStateSyncKeyShareMessageSpec=h;g.MultiDevice$ApplicationData$AppStateSyncKeySpec=i;g.MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyDataSpec=j;g.MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyData$AppStateSyncKeyFingerprintSpec=k;g.MultiDevice$ApplicationData$AppStateSyncKeyIdSpec=l;g.MultiDevice$SignalSpec=m}),98);
__d("WAParseAppStateSyncKeyRequest",["WASyncdKeyTypes"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=[];for(a of a.keyIds)a.keyId!=null&&b.push(d("WASyncdKeyTypes").toSyncKeyId(a.keyId));return{keyIds:b}}g.parseAppStateSyncKeyRequest=a}),98);
__d("WASyncdKeyManagementUtils",["WASyncdKeyTypes"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return new DataView(d("WASyncdKeyTypes").fromSyncKeyId(a)).getUint16(0)}function h(a){return new DataView(d("WASyncdKeyTypes").fromSyncKeyId(a)).getUint32(2)}function b(a){return h(a)+1}g.getKeyDeviceId=a;g.getKeyEpoch=h;g.generateNewKeyEpoch=b}),98);
__d("WAParseAppStateSyncKeyShare",["WALogger","WALongInt","WASyncdKeyManagementUtils","WASyncdKeyTypes"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=[],c=[];for(a of a.keys){var d=i(a);d!=null&&(d.type==="orphan"?c.push(d.keyId):(d.type,b.push(d.keyData)))}return{keys:b,orphanKeys:c}}function i(a){var b,c,e,f,g,i;if(((b=a.keyId)==null?void 0:b.keyId)==null){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Key missing keyId"])));return null}b=d("WASyncdKeyTypes").toSyncKeyId(a.keyId.keyId);c=(c=a.keyData)==null?void 0:c.keyData;e=d("WALongInt").maybeNumberOrThrowIfTooLarge((e=a.keyData)==null?void 0:e.timestamp);f=(f=a.keyData)==null||(f=f.fingerprint)==null?void 0:f.currentIndex;g=(g=a.keyData)==null||(g=g.fingerprint)==null?void 0:g.deviceIndexes;i=(i=a.keyData)==null||(i=i.fingerprint)==null?void 0:i.rawId;return a.keyData==null||c==null||e==null||f==null||g==null||i==null?{keyId:b,type:"orphan"}:{keyData:{fingerprint:{currentIndex:f,deviceIndexes:g,rawId:i},keyData:d("WASyncdKeyTypes").toSyncKeyData(c),keyEpoch:d("WASyncdKeyManagementUtils").getKeyEpoch(b),keyId:b,timestamp:e},type:"key"}}g.parseAppStateSyncKeyShare=a}),98);
__d("WAConvertAppData",["WAAppData","WAArmadilloApplication.pb","WAJids","WALogger","WAMultiDevice.pb","WAParseAppStateSyncKeyRequest","WAParseAppStateSyncKeyShare","WAStanzaUtils","WASyncdKeyTypes","WATimeUtils","decodeProtobuf","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u;function v(a){a=d("WAJids").interpretAndValidateJid(a);if(a.jidType==="msgrUser")return a.userJid;else if(a.jidType==="group")return a.groupJid;else{a.jidType;throw c("err")("Incorrect jid type: "+a.jidType)}}function w(a){a=d("WAJids").interpretAndValidateJid(a);if(a.jidType==="msgrUser")return a.userJid;else if(a.jidType==="msgrDevice")return d("WAJids").extractUserJid(a.deviceJid);else{a.jidType;throw c("err")("Incorrect jid type: "+a.jidType)}}function x(a){return a!=null?typeof a==="number"&&a>d("WATimeUtils").MAX_INT?d("WATimeUtils").castMilliSecondsToUnixTime(a):d("WATimeUtils").castLongIntToUnixTime(a):void 0}function y(a){return a==null?void 0:{lastMessageTimestamp:x(a.lastMessageTimestamp),lastSystemMessageTimestamp:x(a.lastSystemMessageTimestamp),messages:a.messages==null?[]:a.messages.map(function(a){return{key:a.key==null?void 0:{fromMe:a.key.fromMe,id:a.key.id},ts:x(a.timestamp)}})}}function z(a,b){var c=a.chatId;if(c==null){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Missing chatId in chat action: ",""])),a);return null}if(a.chatArchive!=null){var e=a.chatArchive;e=y(e.messageRange);return{chatJid:v(c),messageRange:e,ts:b,type:"chat_archive"}}else if(a.chatDelete!=null){e=a.chatDelete;e=y(e.messageRange);return{chatJid:v(c),messageRange:e,ts:b,type:"chat_delete"}}else if(a.chatRead!=null){e=a.chatRead;var f=y(e.messageRange);return{chatJid:v(c),messageRange:f,read:e.read,ts:b,type:"chat_read"}}else{d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata sync action type: ",""])),a);return null}}function A(a){var b=a.key,c=b==null?void 0:b.remoteJid,e=b==null?void 0:b.id,f=b==null?void 0:b.fromMe;if(b==null||c==null||f==null||e==null){d("WALogger").WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Missing messageKey in message action: ",""])),a);return null}var g=v(c),h=d("WAJids").interpretAsGroupJid(g)!=null;if(h&&!f){if((b==null?void 0:b.participant)==null){d("WALogger").WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["No participant in messageKey in message action when it is group chat and message is not fromMe: ",""])),a);return null}h=w(b.participant)}else f?h=d("WAJids").AUTHOR_ME:h=w(c);b={author:h,chat:g,externalId:d("WAStanzaUtils").toStanzaId(e)};if(a.messageDelete!=null)return{protocolMsgId:b,type:"delete_for_me"};else{d("WALogger").WARN(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata sync action type: ",""])),a);return null}}function B(a){var b=[];for(a of a){var c=x(a.actionTimestamp);if(a.chatAction!=null){c=z(a.chatAction,c);c!=null&&b.push({chatAction:c})}else if(a.messageAction!=null){c=A(a.messageAction);c!=null&&b.push({messageAction:c})}else d("WALogger").WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata sync action type: ",""])),a)}return b}function C(a){var b=a.anonId,c=a.id,e=a.rootKey;a=a.status;if(a==null||c==null||b==null||e==null){d("WALogger").WARN(n||(n=babelHelpers.taggedTemplateLiteralLoose(["missing keys in EncryptedBackupsSecretsEpoch"])));return null}var f;if(a===d("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_OPEN)f=d("WAAppData").EPOCH_STATUS_OPEN;else if(a===d("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_CLOSE)f=d("WAAppData").EPOCH_STATUS_CLOSE;else{d("WALogger").WARN(o||(o=babelHelpers.taggedTemplateLiteralLoose(["status in EncryptedBackupsSecretsEpoch has invalid value"])));return null}return{anonId:b,id:c,rootKey:e,status:f}}function D(a){var b=a.backupId,c=a.epoch,e=a.mailboxRootKey,f=a.obliviousValidationToken,g=a.serverDataId;a=a.tempOcmfClientState;if(b==null||g==null||a==null||e==null||f==null){d("WALogger").WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["missing keys in EncryptedBackupsSecrets"])));return null}return{backupId:b,epoch:c.map(C).reduce(function(a,b){if(b!=null)return a.concat([b]);else return a},[]),mailboxRootKey:e,obliviousValidationToken:f,serverDataId:g,tempOcmfClientState:a}}function E(a){var b;if(((b=a.applicationData)==null||(b=b.metadataSync)==null?void 0:b.actions)!=null){return{actions:B((b=a.applicationData)==null||(b=b.metadataSync)==null?void 0:b.actions),type:"meta_sync"}}else if(((b=a.signal)==null?void 0:b.encryptedBackupsSecrets)!=null){b=D(a.signal.encryptedBackupsSecrets);return b==null?null:{encryptedBackupsSecrets:b,type:"backups_secrets"}}else{d("WALogger").WARN(q||(q=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),a);return null}}function F(a){var b;if(((b=a.applicationData)==null?void 0:b.appStateSyncKeyShare)!=null){return{syncKeyShare:d("WAParseAppStateSyncKeyShare").parseAppStateSyncKeyShare((b=a.applicationData)==null?void 0:b.appStateSyncKeyShare),type:"sync_key_share"}}else if(((b=a.applicationData)==null?void 0:b.appStateSyncKeyRequest)!=null){return{syncKeyRequest:d("WAParseAppStateSyncKeyRequest").parseAppStateSyncKeyRequest((b=a.applicationData)==null?void 0:b.appStateSyncKeyRequest),type:"sync_key_request"}}else{d("WALogger").WARN(r||(r=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),a);return null}}function a(a){if(a.subprotocolType==="armadillo"){var b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAArmadilloApplication.pb").ArmadilloSpec,a.payload);if(b.payload==null)throw c("err")("Appdata contains unparseable armadillo data.");return E(b.payload)}else if(a.subprotocolType==="multiDevice"){b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMultiDevice.pb").MultiDeviceSpec,a.payload);if(b.payload==null)throw c("err")("Appdata contains unparseable armadillo data.");return F(b.payload)}else throw c("err")("Appdata contains unexpected message application: "+a.subprotocolType)}function G(a){return a==null?void 0:{lastMessageTimestamp:a.lastMessageTimestamp,lastSystemMessageTimestamp:a.lastSystemMessageTimestamp,messages:a.messages.map(function(a){return{key:a.key==null?void 0:{fromMe:a.key.fromMe,id:a.key.id},timestamp:a.ts}})}}function H(a){switch(a.type){case"meta_sync":return{payload:{applicationData:P(a)}};case"backups_secrets":return{payload:{signal:{encryptedBackupsSecrets:N(a.encryptedBackupsSecrets)}}};default:a.type;d("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),a.type);return{}}}function I(a){return{keyId:d("WASyncdKeyTypes").fromSyncKeyId(a)}}function J(a){return{keyData:{fingerprint:{currentIndex:a.fingerprint.currentIndex,deviceIndexes:a.fingerprint.deviceIndexes,rawId:a.fingerprint.rawId},keyData:d("WASyncdKeyTypes").fromSyncKeyData(a.keyData),timestamp:a.timestamp},keyId:I(a.keyId)}}function K(a){var b=a.keys.map(J);a=a.orphanKeys==null?[]:a.orphanKeys.map(function(a){return{keyId:I(a)}});b.push.apply(b,a);return{keys:b}}function L(a){return{keyIds:a.keyIds.map(I)}}function M(a){switch(a.type){case"sync_key_share":return{payload:{applicationData:{appStateSyncKeyShare:K(a.syncKeyShare)}}};case"sync_key_request":return{payload:{applicationData:{appStateSyncKeyRequest:L(a.syncKeyRequest)}}};default:a.type;d("WALogger").WARN(t||(t=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),a.type);return{}}}function b(a){var b;switch(a.type){case"meta_sync":case"backups_secrets":var c=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloApplication.pb").ArmadilloSpec,H(a));b={armadillo:{payload:c.readByteArrayView(),version:1}};break;case"sync_key_share":case"sync_key_request":c=d("encodeProtobuf").encodeProtobuf(d("WAMultiDevice.pb").MultiDeviceSpec,M(a));b={multiDevice:{payload:c.readByteArrayView(),version:1}};break;default:a.type,d("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),a.type),b={}}return{payload:{subProtocol:b}}}function N(a){return{backupId:a.backupId,epoch:a.epoch.map(O),mailboxRootKey:a.mailboxRootKey,obliviousValidationToken:a.obliviousValidationToken,serverDataId:a.serverDataId,tempOcmfClientState:a.tempOcmfClientState}}function O(a){var b;a.status===d("WAAppData").EPOCH_STATUS_OPEN?b=d("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_OPEN:a.status===d("WAAppData").EPOCH_STATUS_CLOSE&&(b=d("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_CLOSE);return{anonId:a.anonId,id:a.id,rootKey:a.rootKey,status:b}}function P(a){return{metadataSync:{actions:a.actions.map(function(a){if(a.chatAction)return{actionTimestamp:a.chatAction.ts,chatAction:Q(a.chatAction)};else return{messageAction:R(a.messageAction)}})}}}function Q(a){var b=G(a.messageRange),c=a.chatJid;switch(a.type){case"chat_archive":return{chatArchive:{archived:a.archived,messageRange:b},chatId:c};case"chat_delete":return{chatDelete:{messageRange:b},chatId:c};default:a.type;return{chatId:c,chatRead:{messageRange:b,read:a.read}}}}function R(a){if(a.type==="delete_for_me"){var b=a.protocolMsgId.chat,e=d("WAJids").interpretAsGroupJid(b)!=null;return{key:{fromMe:d("WAJids").isAuthorMe(a.protocolMsgId.author),id:a.protocolMsgId.externalId,participant:!d("WAJids").isAuthorMe(a.protocolMsgId.author)&&e?a.protocolMsgId.author:void 0,remoteJid:b},messageDelete:{}}}else throw c("err")("No other available type")}function e(a){if(a.type!=="meta_sync")return[];a=a.actions.map(function(a){var b=a.chatAction;a=a.messageAction;return(a=a==null?void 0:a.protocolMsgId.chat)!=null?a:b==null?void 0:b.chatJid}).filter(Boolean);return Array.from(new Set(a))}g.parseArmadilloAppData=E;g.parseMultiDeviceAppData=F;g.parseAppData=a;g.convertArmadilloAppData=H;g.convertMultiDeviceAppData=M;g.convertAppData=b;g.getChatJidForAppData=e}),98);
__d("WADbPersonalSenderKeyStatusTxns",["WASignalDB","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=["groupJid","senderKeyTs"],i=["groupJid","senderKeyTs"],j={hasSenderKey:new Set(),rotateSenderKey:!0,senderKeyId:null,senderKeyTs:d("WATimeUtils").castToUnixTime(0)};a=function(a){return d("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",function(b){return b.stores.personalSenderKeyStatuses.bulkPut(a.map(function(a){return babelHelpers["extends"]({},j,{groupJid:a})}))},d("WASignalDB").signalOp("bulkPutNewPersonalSenderKeyStatus"))};c=function(a,c,e){return d("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var d=(yield b.stores.personalSenderKeyStatuses.get(a));yield b.stores.personalSenderKeyStatuses.bulkPut([babelHelpers["extends"]({},d||j,{groupJid:a,rotateSenderKey:!1,senderKeyId:c,senderKeyTs:e})])});return function(a){return d.apply(this,arguments)}}(),d("WASignalDB").signalOp("markSenderKeyAsRotated"))};e=function(a){return d("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=(yield b.stores.personalSenderKeyStatuses.get(a));if(c!=null){c.groupJid;var d=c.senderKeyTs;c=babelHelpers.objectWithoutPropertiesLoose(c,h);return babelHelpers["extends"]({},c,{ts:d})}c=babelHelpers["extends"]({},j,{groupJid:a});yield b.stores.personalSenderKeyStatuses.bulkPut([c]);c.groupJid;d=c.senderKeyTs;b=babelHelpers.objectWithoutPropertiesLoose(c,i);return babelHelpers["extends"]({},b,{ts:d})});return function(a){return c.apply(this,arguments)}}(),"Signal - getSenderKeyStatus")};f=function(a){return d("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=(yield b.stores.personalSenderKeyStatuses.bulkGet(a));yield b.stores.personalSenderKeyStatuses.bulkPut(c.filter(function(a){return a!=null}).map(function(a){return babelHelpers["extends"]({},a,{rotateSenderKey:!0})}))});return function(a){return c.apply(this,arguments)}}(),d("WASignalDB").signalOp("bulkSetRotateSenderKeyToTrue"))};var k=function(a){return d("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",function(b){return b.stores.personalSenderKeyStatuses.bulkDelete(a)},d("WASignalDB").signalOp("deletePersonalSenderKeyStatus"))};g.bulkPutNewPersonalSenderKeyStatus=a;g.markSenderKeyAsRotated=c;g.getSenderKeyStatus=e;g.bulkSetRotateSenderKeyToTrue=f;g.deletePersonalSenderKeyStatus=k}),98);
__d("WACreateGroup",["WADbPersonalSenderKeyStatusTxns","WAGlobals","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAGlobals").getDependencies().createGroups(a),yield d("WADbPersonalSenderKeyStatusTxns").bulkPutNewPersonalSenderKeyStatus(a.map(function(a){return a.groupToCreate.jid}))});return function(b){return a.apply(this,arguments)}}();g.createGroups=a}),98);
__d("WAGetPrekeyIdsInRange",["WASignalKeys"],(function(a,b,c,d,e,f,g){"use strict";var h=16777215;function i(a){return a}function a(a,b){var c=[];a=i(a);var e=i(b);if(a<=e)for(var f=a;f<=b;f++)c.push(d("WASignalKeys").castToPreKeyId(f));else{for(b=a;b<h;b++)c.push(d("WASignalKeys").castToPreKeyId(b));for(f=1;f<=e;f++)c.push(d("WASignalKeys").castToPreKeyId(f))}return c}g.PRE_KEY_MAX_ID=h;g.getPrekeyIdsInRange=a}),98);
__d("WADeletePreKeyGenerationsApi",["Promise","WAGetPrekeyIdsInRange","WALogger","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a){return d("WASignalDB").getDb().runInTransaction(["prekey","prekeyGeneration"],"readwrite",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){var e=(yield c.stores.prekeyGeneration.bulkGet(a)),f=[];for(e of e){if(e==null){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Attempting to delete non-existent prekey generation"])));continue}for(var g of d("WAGetPrekeyIdsInRange").getPrekeyIdsInRange(e.startingId,e.endingId))f.push(g)}yield (i||(i=b("Promise"))).all([c.stores.prekeyGeneration.bulkDelete(a),c.stores.prekey.bulkDelete(f)])});return function(a){return c.apply(this,arguments)}}(),d("WASignalDB").signalOp("deletePreKeyGenerations"))};g.deletePreKeyGenerations=a}),98);
__d("WAGetLastPreKeyGenerationIdApi",["Promise","WADbSignal","WASignalDB","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDb().runInTransaction(["meta"],"readonly",function(a){return(h||(h=b("Promise"))).all([a.stores.meta.get(d("WADbSignal").MetaKeysEnum.lastPrekeyId).then(function(a){return a==null?void 0:a.value.lastPrekeyId}),a.stores.meta.get(d("WADbSignal").MetaKeysEnum.lastPrekeyGenerationId).then(function(a){return a==null?void 0:a.value.lastPrekeyGenerationId})])},d("WASignalDB").signalOp("getLastPreKeyGenerationId"))),e=a[0];a=a[1];if(e==null&&a!=null||e!=null&&a==null)throw c("err")("Last prekey id and Last prekey generation id should both be non-null");return e!=null&&a!=null?{lastGenerationId:a,lastPreKeyId:e}:null});return function(){return a.apply(this,arguments)}}();g.getLastPreKeyGenerationId=a}),98);
__d("WAGetPreKeyGenerationsTimestampsApi",["WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){return d("WASignalDB").getDb().runInTransaction(["prekeyGeneration"],"readonly",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield a.stores.prekeyGeneration.readAll());return a.map(function(a){return{id:a.generationId,timestamp:a.createdTs}})});return function(b){return a.apply(this,arguments)}}(),d("WASignalDB").signalOp("getPreKeyGenerationsTimestamps"))};g.getPreKeyGenerationsTimestamps=a}),98);
__d("WALoadICDCApi",["WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASignalDB").getDb().runInTransaction(["contacts"],"readonly",function(b){return b.stores.contacts.bulkGet([a]).then(function(a){a=a.filter(Boolean).length>0?a[0]:null;return(a=a==null?void 0:a.icdcInfo)!=null?a:null})},d("WASignalDB").signalOp("loadICDC"))};g.loadICDC=a}),98);
__d("WALoadIdentitiesApi",["Promise","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a){return d("WASignalDB").getDb().runInTransaction(["identity"],"readonly",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=(yield b.stores.identity.readIndex("userJid",[a]));return new Map(b.filter(Boolean).map(function(a){return[a.deviceJid,a.identity]}))});return function(a){return c.apply(this,arguments)}}(),d("WASignalDB").signalOp("loadIdentities"))};c=function(a){return d("WASignalDB").getDb().runInTransaction(["identity"],"readonly",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){var d=(yield (h||(h=b("Promise"))).all(a.map(function(a){return c.stores.identity.readIndex("userJid",[a])}))),e=new Map();for(d of d)for(var f of d){if(f==null)continue;var g=e.get(f.userJid);g==null&&(g=new Map());g.set(f.deviceJid,f.identity);e.set(f.userJid,g)}return e});return function(a){return c.apply(this,arguments)}}(),d("WASignalDB").signalOp("bulkLoadIdentities"))};g.loadIdentities=a;g.bulkLoadIdentities=c}),98);
__d("WALoadLastSyncTsApi",["WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASignalDB").getDb().runInTransaction(["contacts"],"readonly",function(b){return b.stores.contacts.bulkGet([a]).then(function(a){a=a.filter(Boolean).length>0?a[0]:null;return(a=a==null?void 0:a.lastSyncTs)!=null?a:null})},d("WASignalDB").signalOp("loadLastSyncTs"))};g.loadLastSyncTs=a}),98);
__d("WADbMetaTxns",["WADbSignal","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a.meta.bulkGet([d("WADbSignal").MetaKeysEnum.lastSignedPrekeyId,d("WADbSignal").MetaKeysEnum.identityKeyPair]).then(function(a){var b=a[0];a=a[1];b=b==null?void 0:b.value.lastSignedPrekeyId;a=a==null?void 0:a.value.identityKeyPair;return{identityPair:a,keyId:b}})}c=function(a){return d("WASignalDB").getDb().runInTransaction(["meta"],"readwrite",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield b.stores.meta.bulkPut([{key:d("WADbSignal").MetaKeysEnum.cat,value:{cat:a}}]);return a});return function(a){return c.apply(this,arguments)}}(),d("WASignalDB").signalOp("saveCAT"))};g.maybeGetLastSignedPrekeyIdAndIdentity=a;g.saveCAT=c}),98);
__d("WADbSignedPrekeyTxns",["WADbMetaTxns","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WADbMetaTxns").maybeGetLastSignedPrekeyIdAndIdentity(a)),c=b.identityPair;b=b.keyId;if(b==null)if(c==null)return d("WAResultOrError").makeError("missing-last-signed-prekey-id-and-registration");else return d("WAResultOrError").makeError("missing-last-signed-prekey-id");c=(yield a.signedPrekey.get(b));return c==null?d("WAResultOrError").makeError("missing-last-signed-prekey"):d("WAResultOrError").makeResult(c.encoded)});return h.apply(this,arguments)}g.getLatestSignedPreKey=a}),98);
__d("WALoadLatestSignedPreKeyApi",["WADbSignedPrekeyTxns","WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(){return d("WASignalDB").getDb().runInTransaction(["meta","signedPrekey"],"readonly",function(a){return d("WADbSignedPrekeyTxns").getLatestSignedPreKey(a.stores)},d("WASignalDB").signalOp("loadLatestSignedPreKey"))};g.loadLatestSignedPreKey=a}),98);
__d("WALoadOneTimePreKeyApi",["WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASignalDB").getDb().runInTransaction(["prekey"],"readonly",function(b){return b.stores.prekey.get(a).then(function(a){return a==null?void 0:a.encoded})},d("WASignalDB").signalOp("loadOneTimePreKey"))};g.loadOneTimePreKey=a}),98);
__d("WADbPrekeyTxns",["WAGetPrekeyIdsInRange","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield a.prekeyGeneration.get(b));if(b==null)throw c("err")("Expected a prekey generation row");b=d("WAGetPrekeyIdsInRange").getPrekeyIdsInRange(b.startingId,b.endingId);a=(yield a.prekey.bulkGet(b));return a.filter(Boolean).map(function(a){return a.encoded})});return h.apply(this,arguments)}g.getPrekeysForGeneration=a}),98);
__d("WALoadPreKeysApi",["WADbPrekeyTxns","WADbSignal","WADbSignedPrekeyTxns","WALoggerTag","WASignalDB","WASignalSignatures","WATagsLogger","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=d("WATagsLogger").TAGS([c("WALoggerTag").SignedPrekey]);a=function(a){return d("WASignalDB").getDb().runInTransaction(["identity","meta","prekey","prekeyGeneration","signedPrekey"],"readonly",function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e=(yield d("WADbSignedPrekeyTxns").getLatestSignedPreKey(b.stores));if(!e.success){var f;k.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to get latest signed prekey"])));throw(f=e.error)!=null?f:c("err")("Failed to get latest signed prekey")}var g=d("WASignalSignatures").deserializeSignedPreKey(e.value);if(g==null){k.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Failed to deserialize signed prekey"])));throw c("err")("Failed to deserialize signed prekey")}f=a!=null?a:yield b.stores.meta.get(d("WADbSignal").MetaKeysEnum.lastPrekeyGenerationId).then(function(a){return a==null?void 0:a.value.lastPrekeyGenerationId});if(f==null){k.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["No last prekey generation id"])));throw c("err")("No last prekey generation id")}return d("WADbPrekeyTxns").getPrekeysForGeneration(b.stores,f).then(function(a){return{preKeys:a,signedPreKey:g}})});return function(a){return e.apply(this,arguments)}}(),d("WASignalDB").signalOp("loadPreKeys"))};g.loadPreKeys=a}),98);
__d("WALoadSenderKeySessionApi",["WACryptoManager","WADbSignal","WAJids","WAResultOrError","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,c){var e=d("WAJids").extractUserJid(c);c=d("WAJids").extractDeviceId(c);var f=d("WADbSignal").buildSenderKeySessionId(a,e,c);return d("WASignalDB").getDb().runInTransaction(["senderKeySessions"],"readonly",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield a.stores.senderKeySessions.get(f));if(a==null)return d("WAResultOrError").makeError("errLoadSenderKeySession");a=d("WACryptoManager").decodeSenderKeySession(a.record);return d("WAResultOrError").makeResult(a)});return function(b){return a.apply(this,arguments)}}(),d("WASignalDB").signalOp("loadSenderKeySession"))};g.loadSenderKeySession=a}),98);
__d("WALoadSignedPreKeyApi",["WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASignalDB").getDb().runInTransaction(["signedPrekey"],"readonly",function(b){return b.stores.signedPrekey.get(a).then(function(a){return a==null?void 0:a.encoded})},d("WASignalDB").signalOp("loadSignedPreKey"))};g.loadSignedPreKey=a}),98);
__d("WASaveOneTimePreKeyApi",["Promise","WADbSignal","WAResultOrError","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a){return d("WASignalDB").getDb().runInTransaction(["meta","prekey"],"readwrite",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){var e=(yield c.stores.meta.get(d("WADbSignal").MetaKeysEnum.lastPrekeyId));e=e==null?void 0:e.value.lastPrekeyId;if(e==null)return d("WAResultOrError").makeError("missing_last_prekey");yield (h||(h=b("Promise"))).all([c.stores.prekey.bulkPut([babelHelpers["extends"]({},a,{isDeleted:!1})]),c.stores.meta.bulkPut([{key:d("WADbSignal").MetaKeysEnum.lastPrekeyId,value:{lastPrekeyId:a.keyId}}])]);return d("WAResultOrError").makeResult()});return function(a){return c.apply(this,arguments)}}(),d("WASignalDB").signalOp("saveOneTimePreKey"))};g.saveOneTimePreKey=a}),98);
__d("WASavePreKeysGenerationApi",["Promise","WACryptoManager","WADbSignal","WAResultOrError","WASignalDB","WATimeUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)throw c("err")("Keys provided to savePreKeysGeneration cannot be empty");var e=(yield d("WASignalDB").getDb().runInTransaction(["meta","prekey","prekeyGeneration"],"readwrite",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){var e=(yield c.stores.meta.get(d("WADbSignal").MetaKeysEnum.lastPrekeyGenerationId));e=d("WACryptoManager").castToPreKeyGenerationId(((e=e==null?void 0:e.value.lastPrekeyGenerationId)!=null?e:0)+1);var f=a[0].keyId,g=a[a.length-1].keyId,i=a.map(function(a){return babelHelpers["extends"]({},a,{isDeleted:!1})});yield (h||(h=b("Promise"))).all([c.stores.prekey.bulkPut(i),c.stores.meta.bulkPut([{key:d("WADbSignal").MetaKeysEnum.lastPrekeyId,value:{lastPrekeyId:g}},{key:d("WADbSignal").MetaKeysEnum.lastPrekeyGenerationId,value:{lastPrekeyGenerationId:e}}]),c.stores.prekeyGeneration.bulkPut([{createdTs:d("WATimeUtils").unixTime(),endingId:g,generationId:e,startingId:f}])]);return d("WAResultOrError").makeResult(e)});return function(a){return c.apply(this,arguments)}}(),d("WASignalDB").signalOp("savePreKeysGeneration")));return e});return function(b){return a.apply(this,arguments)}}();g.savePreKeysGeneration=a}),98);
__d("WASaveSignedPreKeyIfNewApi",["Promise","WADbSignal","WASignalDB","WASignalSignatures","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,c){return d("WASignalDB").getDb().runInTransaction(["meta","signedPrekey"],"readwrite",function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var f=(yield e.stores.signedPrekey.get(a));if(f!=null){f=d("WASignalSignatures").deserializeSignedPreKey(f.encoded);if(f!=null)return{key:f,type:"duplicate"}}yield (h||(h=b("Promise"))).all([e.stores.signedPrekey.bulkPut([{encoded:c,keyId:a}]),e.stores.meta.bulkPut([{key:d("WADbSignal").MetaKeysEnum.lastSignedPrekeyId,value:{lastSignedPrekeyId:a}}])]);return{type:"success"}});return function(a){return e.apply(this,arguments)}}(),d("WASignalDB").signalOp("saveSignedPreKeyIfNew"))};g.saveSignedPreKeyIfNew=a}),98);
__d("WASessionApi",["WACryptoManager","WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASignalDB").getDb().store("session").get(a).then(function(a){return a==null?null:d("WACryptoManager").decodeSession(a.session)})};b=function(a){return d("WASignalDB").getDb().store("session").bulkGet(a).then(h)};function h(a){var b=new Map();for(a of a){if(a==null)continue;var c=d("WACryptoManager").decodeSession(a.session);b.set(a.id,c)}return b}g.loadSession=a;g.bulkLoadSession=b}),98);
__d("WACryptoDbCallbacks",["WABulkSaveSignalDataApi","WADeletePreKeyGenerationsApi","WAGetLastPreKeyGenerationIdApi","WAGetPreKeyGenerationsTimestampsApi","WALoadICDCApi","WALoadIdentitiesApi","WALoadLastSyncTsApi","WALoadLatestSignedPreKeyApi","WALoadOneTimePreKeyApi","WALoadPreKeysApi","WALoadSenderKeySessionApi","WALoadSignedPreKeyApi","WASaveOneTimePreKeyApi","WASavePreKeysGenerationApi","WASaveSignedPreKeyIfNewApi","WASessionApi"],(function(a,b,c,d,e,f,g){"use strict";a=function(){return{bulkLoadIdentities:d("WALoadIdentitiesApi").bulkLoadIdentities,bulkSaveSignalData:d("WABulkSaveSignalDataApi").bulkSaveSignalData,deletePreKeyGenerations:d("WADeletePreKeyGenerationsApi").deletePreKeyGenerations,getLastPreKeyGenerationId:d("WAGetLastPreKeyGenerationIdApi").getLastPreKeyGenerationId,getPreKeyGenerationsTimestamps:d("WAGetPreKeyGenerationsTimestampsApi").getPreKeyGenerationsTimestamps,loadICDC:d("WALoadICDCApi").loadICDC,loadIdentities:d("WALoadIdentitiesApi").loadIdentities,loadLastSyncTs:d("WALoadLastSyncTsApi").loadLastSyncTs,loadLatestSignedPreKey:d("WALoadLatestSignedPreKeyApi").loadLatestSignedPreKey,loadOneTimePreKey:d("WALoadOneTimePreKeyApi").loadOneTimePreKey,loadPreKeys:d("WALoadPreKeysApi").loadPreKeys,loadSenderKeySession:d("WALoadSenderKeySessionApi").loadSenderKeySession,loadSession:d("WASessionApi").loadSession,loadSessions:d("WASessionApi").bulkLoadSession,loadSignedPreKey:d("WALoadSignedPreKeyApi").loadSignedPreKey,saveOneTimePreKey:d("WASaveOneTimePreKeyApi").saveOneTimePreKey,savePreKeysGeneration:d("WASavePreKeysGenerationApi").savePreKeysGeneration,saveSignedPreKeyIfNew:d("WASaveSignedPreKeyIfNewApi").saveSignedPreKeyIfNew}};g.getCryptoDbCallbacks=a}),98);
__d("WAMPSFlushable",["MpsTypes","WebMps","asyncToGeneratorRuntime","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$1=[],this.$2=new Map(),this.$3=new Set()}var e=a.prototype;e.enqueue=function(a,b,c){if(a==null)return;this.$1.push(a);this.$2.set(a.messageId,b);this.$3.add(c)};e.flush=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){if(this.$1.length===0)return;a=this.$1;b=Array.from(this.$3).join(", ");f=this.$2;this.$1=[];this.$2=new Map();this.$3=new Set();try{var h=(yield d("WebMps").mps().saveNewMessages(a.map(function(a){return{directive:null,message:a,insertionSource:d("MpsTypes").InsertionSource.Receive}}),{source:b}));f.forEach(function(a,b){a(h.get(b))})}catch(a){var i=c("getErrorSafe")(a);e==null||e.addPoint("mps_persistance_fail");f.forEach(function(a){a(i)})}});function e(b,c,d,e,f){return a.apply(this,arguments)}return e}();return a}();e=new a();g.MPSFlushable=a;g.mpsFlushable=e}),98);
__d("WASignalEntityStoreV2",["$InternalEnum","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g=b("$InternalEnum").Mirrored(["NOT_PERSISTED","PERSIST_IN_PROGRESS","PERSISTED"]);a=function(){function a(){this.$1=new Map()}var c=a.prototype;c.TEST_ONLY_LOAD_FROM_MEMORY=function(a){return this.$2(a)};c.$2=function(a){a=this.$1.get(a);return a!=null?{entity:a.entity,deleted:a.deleted}:null};c.load=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=this.$2(a);if(c!=null&&c.deleted)return null;if(c!=null&&c.entity!=null)return c.entity;c=(yield b(a));this.$3(a,c);return c});function c(b,c){return a.apply(this,arguments)}return c}();c.bulkLoad=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=[],d=new Map();for(a of a){var e=this.$2(a);if(e==null){c.push(a);continue}if(e.deleted)continue;e.entity!=null?d.set(a,e.entity):c.push(a)}e=(yield b(c));for(a of e.entries()){b=a[0];c=a[1];d.set(b,c);this.$3(b,c)}return d});function c(b,c){return a.apply(this,arguments)}return c}();c.$3=function(a,b){this.$1.set(a,{entity:b,status:g.PERSISTED,deleted:!1})};c.store=function(a,b){this.$1.set(a,{entity:b,status:g.NOT_PERSISTED,deleted:!1})};c.remove=function(a){this.$1.set(a,{entity:null,status:g.NOT_PERSISTED,deleted:!0})};c.pureSnapshot=function(){var a=[],b=Array.from(this.$1.entries()).filter(function(a){a[0];a=a[1];return a.status===g.NOT_PERSISTED}).filter(function(b){var c=b[0];b=b[1];b.deleted&&a.push({id:c});return!b.deleted}).filter(function(a){a[0];a=a[1];return a.entity!=null}).map(function(a){var b=a[0];a=a[1];return{id:b,cachedEntity:a.entity}});return{update:b,remove:a}};c.snapshot=function(){var a=this,b=this.pureSnapshot();b.remove.forEach(function(b){b=b.id;b=a.$1.get(b);b&&(b.status=g.PERSIST_IN_PROGRESS)});b.update.forEach(function(b){b=b.id;b=a.$1.get(b);b&&(b.status=g.PERSIST_IN_PROGRESS)});return b};c.markSnapshotAsCommitted=function(){this.$1.forEach(function(a){a.status===g.PERSIST_IN_PROGRESS&&(a.status=g.PERSISTED)})};c.markSnapshotAsFailed=function(){this.$1.forEach(function(a){a.status===g.PERSIST_IN_PROGRESS&&(a.status=g.NOT_PERSISTED)})};c.clear=function(){this.$1=new Map()};return a}();f.PersistStatus=g;f.SignalEntityStore=a}),66);
__d("WASignalIdentityStore",["Promise","WAJids","WALogger","WASignalEntityStoreV2","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(){function a(){this.$1=new Map(),this.$2=new(d("WASignalEntityStoreV2").SignalEntityStore)()}var c=a.prototype;c.bulkLoadIdentities=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=this,d=function*(){var a=e[0],d=e[1];yield c.loadIdentitiesByUser(a,function(){return(i||(i=b("Promise"))).resolve(d)})};for(var e of a)yield* d();return a});function c(b){return a.apply(this,arguments)}return c}();c.loadIdentitiesByUser=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=this.$1.get(a);if(e==null){var f=this.$3(a,yield c(a));c=Array.from(f.keys());this.$1.set(a,new Set(c));return this.$2.bulkLoad(c,function(){return(i||(i=b("Promise"))).resolve(f)})}else return this.$2.bulkLoad(Array.from(e),function(a){a.length>0&&d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[WASignalIdentityStore] This should never happen."])));return(i||(i=b("Promise"))).resolve(new Map())})});function c(b,c){return a.apply(this,arguments)}return c}();c.$3=function(a,b){b=new Map(b);var c=this.$2.pureSnapshot(),e=c.remove;c=c.update;for(e of e){var f=e.id;b["delete"](f)}for(f of c){e=f.id;c=f.cachedEntity;c!=null&&d("WAJids").extractUserJid(e)===a&&b.set(e,c)}return b};c.store=function(a,b){this.$2.store(a,b);b=d("WAJids").extractUserJid(a);b=this.$1.get(b);b!=null&&b.add(a)};c.remove=function(a){this.$2.remove(a);var b=d("WAJids").extractUserJid(a);b=this.$1.get(b);b!=null&&b["delete"](a)};c.clear=function(){this.$2.clear(),this.$1=new Map()};c.load=function(a,b){return this.$2.load(a,b)};c.bulkLoad=function(a,b){return this.$2.bulkLoad(a,b)};c.snapshot=function(){return this.$2.snapshot()};c.pureSnapshot=function(){return this.pureSnapshot()};c.markSnapshotAsCommitted=function(){this.$2.markSnapshotAsCommitted()};c.markSnapshotAsFailed=function(){this.$2.markSnapshotAsFailed()};return a}();g.SignalIdentityStore=a}),98);
__d("WAInMemorySignalStore",["MAWMpsGating","Promise","WAArmadilloTransportEvent.pb","WABuildMpsPayload","WACryptoManager","WACryptoUtils","WAGlobals","WAIdentityUtils","WAJids","WAMPSFlushable","WAProtocolQueue","WAResultOrError","WASignalEntityStoreV2","WASignalIdentityStore","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u=d("WATagsLogger").TAGS(["CryptoManager","InMemorySignalStore"]);a=function(){function a(a,c){var e=this;this.loadSession=function(a,b){return e.$1.load(a,function(a){return e.$9.loadSession(a,b)})};this.loadSessions=function(a){return e.$1.bulkLoad(a,function(a){return e.$9.loadSessions(a).then(function(a){return new Map(Array.from(a.entries()).map(function(a){return[a[0],a[1]]}))})}).then(function(a){return new Map(Array.from(a.entries()).map(function(a){return[a[0],a[1]]}))})};this.loadSignedPreKey=function(a){return e.$7.load(a,function(){return e.$9.loadSignedPreKey(a)})};this.bulkLoadIdentities=function(a){var c=new Map();return(t||(t=b("Promise"))).all(a.map(function(a){return e.loadIdentities(a).then(function(b){c.set(a,b)})})).then(function(){return c})};this.loadIdentities=function(a){return e.$5.loadIdentitiesByUser(a,function(){return e.$9.loadIdentities(a)})};this.saveIdentity=function(a,c){return(t||(t=b("Promise"))).resolve(e.storeIdentity(a,c))};this.loadOneTimePreKey=function(a){return e.$6.load(a,function(){return e.$9.loadOneTimePreKey(a)})};this.saveSenderKeySession=function(a,c,d){e.storeSenderKeySession(a,c,d);return(t||(t=b("Promise"))).resolve()};this.saveSignedPreKeyIfNew=function(a,b){return e.$9.saveSignedPreKeyIfNew(a,b)};this.loadSenderKeySession=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var f=(yield e.$8.load(d("WACryptoManager").encodeSenderKey(a,c),b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield e.$9.loadSenderKeySession(a,c));return b.success?b.value:null})));return f==null?d("WAResultOrError").makeError("errLoadSenderKeySession"):d("WAResultOrError").makeResult(f)});return function(b,c){return a.apply(this,arguments)}}();this.handleNewSession=function(a,c,f,g,h){e.storeSession(a,c);f!=null&&e.storeIdentity(a,f);g!=null&&e.removeOneTimePreKey(g);return(t||(t=b("Promise"))).resolve(d("WAResultOrError").makeResult())};this.saveICDC=function(a,c){e.$3.store(a,c);return(t||(t=b("Promise"))).resolve()};this.loadICDC=function(a){return e.$3.load(a,function(){return e.$9.loadICDC(a)})};this.saveLastSyncTs=function(a,c){e.$4.store(a,c);return(t||(t=b("Promise"))).resolve()};this.loadLastSyncTs=function(a){return e.$4.load(a,function(){return e.$9.loadLastSyncTs(a)})};this.saveDhash=function(a,c){e.$2.store(a,c);return(t||(t=b("Promise"))).resolve()};this.getLastPreKeyGenerationId=function(){return e.$9.getLastPreKeyGenerationId()};this.savePreKeysGeneration=function(a){return e.$9.savePreKeysGeneration(a)};this.getPreKeyGenerationsTimestamps=function(){return e.$9.getPreKeyGenerationsTimestamps()};this.deletePreKeyGenerations=function(a){return e.$9.deletePreKeyGenerations(a)};this.saveOneTimePreKey=function(a){return e.$9.saveOneTimePreKey(a)};this.loadPreKeys=function(a){return e.$9.loadPreKeys(a)};this.loadLatestSignedPreKey=function(){return e.$9.loadLatestSignedPreKey()};this.$9=a;this.$10=c;this.$5=new(d("WASignalIdentityStore").SignalIdentityStore)();this.$1=new((a=d("WASignalEntityStoreV2")).SignalEntityStore)();this.$2=new a.SignalEntityStore();this.$3=new a.SignalEntityStore();this.$4=new a.SignalEntityStore();this.$6=new a.SignalEntityStore();this.$7=new a.SignalEntityStore();this.$8=new a.SignalEntityStore()}var c=a.prototype;c.storeSession=function(a,b){this.$1.store(a,b)};c.storeIdentity=function(a,b){if(!b)return;this.$5.store(a,b)};c.removeOneTimePreKey=function(a){this.$6.remove(a)};c.storeSenderKeySession=function(a,b,c){this.$8.store(d("WACryptoManager").encodeSenderKey(a,b),c)};c.updateUserDevicesInfo=function(a){var c=this;return(t||(t=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield c.loadIdentities(a.jid)),f=a.devices,g=a.jid,o=a.notificationTs,p=a.dhash,q=a.icdcInfo,r=a.lastSyncTs;u.DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Update user devices: userJid: ","; new identities: ","; previous identities: ","}"])),g,f.map(function(b){b=b.id;return d("WAJids").toDeviceJid(a.jid,b)}).join(","),Array.from(e.keys()).join(","));var s=new Set(e.keys()),v=[],w=[];for(var x of f){var y=x.id,z=x.identity,A=x.model,B=x.platform;y=d("WAJids").toDeviceJid(a.jid,y);var C=e.get(y);if(d("WAGlobals").getMyDeviceJid()===y){var D=d("WACryptoUtils").uint8ArraysEqual(d("WAIdentityUtils").removeKeyTypeIfNeeded(c.$10.staticKeyPair.publicKey),d("WAIdentityUtils").removeKeyTypeIfNeeded(z));D||u.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Receiving an identity for my device but it is different from original one"])))}s["delete"](y);if(C==null)w.push({instruction:"identityAdded",jid:d("WAJids").extractUserJid(y),type:"instruction",device:y,identity:z,model:A,platform:B,notificationTs:o,priority:d("WAProtocolQueue").WAProtocolQueuePriorityLow});else if(!d("WACryptoUtils").uint8ArraysEqual(C,z)){if(d("WAJids").extractUserJid(y)!==g){u.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Device notification of one user cannot remove session the other one"])));continue}v.push(y);u.DEV(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Removing session dur to identity mismatch: ",""])),y);w.push({instruction:"identityChanged",jid:d("WAJids").extractUserJid(y),type:"instruction",device:y,identity:z,model:A,platform:B,notificationTs:o,priority:d("WAProtocolQueue").WAProtocolQueuePriorityLow})}}D=[];for(C of s){if(d("WAJids").extractUserJid(C)!==g){u.ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Device notification of one user cannot remove identity the other one "])));continue}D.push(C);d("WAGlobals").getMyDeviceJid()===C&&u.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Removing my device identity. This should not happen"])));u.DEV(n||(n=babelHelpers.taggedTemplateLiteralLoose(["Removing old identity: ",""])),C);w.push({instruction:"identityRemoved",jid:d("WAJids").extractUserJid(C),type:"instruction",device:C,notificationTs:o,priority:d("WAProtocolQueue").WAProtocolQueuePriorityLow})}return(t||(t=b("Promise"))).all([p!=null?c.saveDhash(g,p):(t||(t=b("Promise"))).resolve(),r!=null?c.saveLastSyncTs(g,r):(t||(t=b("Promise"))).resolve(),q!=null?c.saveICDC(g,q):(t||(t=b("Promise"))).resolve()].concat(Array.from(D).map(function(a){return c.deleteIdentity(a)}),[D.concat(v).map(function(a){return c.$11(a)})],f.map(function(b){var a=b.id;b=b.identity;return c.saveIdentity(d("WAJids").toDeviceJid(g,a),b)}))).then(function(){return w})});return function(b){return a.apply(this,arguments)}}())).then(function(a){a=a.flat();a.forEach(function(a){var b;switch(a.instruction){case"identityAdded":b=d("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.ADDED;break;case"identityChanged":b=d("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.REPLACED;break;case"identityRemoved":b=d("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.REMOVED;break;default:return}if(d("MAWMpsGating").isFullMpsEnabled()||d("MAWMpsGating").isMpsWaAdminMsgsEnabled()){var c,e=d("WAGlobals").getDependencies().generateExternalId();d("WAMPSFlushable").mpsFlushable.enqueue(d("WABuildMpsPayload").buildMpsDeviceChangeAdminMessage(a.jid,(c=a.notificationTs)!=null?c:d("WATimeUtils").unixTime(),e,b,a.platform,a.model),function(a){if(a!=null){u.ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["Failed to save device change admin message: ",""])),a);return}},"handle_device_change")}d("MAWMpsGating").isFullMpsEnabled()||d("WAProtocolQueue").pqFlushable.enqueue(a)});d("MAWMpsGating").isFullMpsEnabled()&&d("WAGlobals").getDependencies().recordDeviceChangeHistory(a.map(function(a){var b;if(a.device==null)return null;var c=a.device;switch(a.instruction){case"identityAdded":return{jid:a.jid,deviceChangeType:d("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.ADDED,platform:a.platform,model:a.model,device:c,identity:a.identity,ts:(b=a.notificationTs)!=null?b:d("WATimeUtils").unixTime()};case"identityChanged":return{jid:a.jid,deviceChangeType:d("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.REPLACED,platform:a.platform,model:a.model,device:c,identity:a.identity,ts:(b=a.notificationTs)!=null?b:d("WATimeUtils").unixTime()};case"identityRemoved":return{jid:a.jid,deviceChangeType:d("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.REMOVED,device:c,ts:(b=a.notificationTs)!=null?b:d("WATimeUtils").unixTime()};default:return null}}).filter(Boolean))["catch"](function(a){u.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Failed to record device change history: ",""])),a)})}).then(function(){})};c.savePendingToDatabase=function(){var a=this,c=this.$12();if(c==null)return(t||(t=b("Promise"))).resolve();u.DEV(q||(q=babelHelpers.taggedTemplateLiteralLoose(["Snapshot: ",""])),c);u.LOG(r||(r=babelHelpers.taggedTemplateLiteralLoose(["Snapshot save: start"])));return this.$9.bulkSaveSignalData(c).then(function(){u.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Snapshot save: end"]))),a.$13()},function(c){a.$14();return(t||(t=b("Promise"))).reject(c)})};c.clear=function(){this.$1.clear(),this.$5.clear(),this.$6.clear(),this.$7.clear(),this.$8.clear(),this.$2.clear(),this.$3.clear()};c.deleteIdentity=function(a){this.$5.remove(a);return(t||(t=b("Promise"))).resolve()};c.$11=function(a){this.$1.remove(a);return(t||(t=b("Promise"))).resolve()};c.$13=function(){this.$1.markSnapshotAsCommitted(),this.$2.markSnapshotAsCommitted(),this.$3.markSnapshotAsCommitted(),this.$4.markSnapshotAsCommitted(),this.$5.markSnapshotAsCommitted(),this.$6.markSnapshotAsCommitted(),this.$7.markSnapshotAsCommitted(),this.$8.markSnapshotAsCommitted()};c.$14=function(){this.$1.markSnapshotAsFailed(),this.$2.markSnapshotAsFailed(),this.$3.markSnapshotAsFailed(),this.$4.markSnapshotAsFailed(),this.$5.markSnapshotAsFailed(),this.$6.markSnapshotAsFailed(),this.$7.markSnapshotAsFailed(),this.$8.markSnapshotAsFailed()};c.$12=function(){var a=this.$1.snapshot(),b=[],c=a.remove.map(function(a){return a.id});a.update.forEach(function(c){var a=c.id;c=c.cachedEntity;if(c==null)return;b.push({id:a,updated:c})});var e=[];this.$8.snapshot().update.forEach(function(a){var b=d("WACryptoManager").decodeSenderKey(a.id),c=b.groupId;b=b.deviceId;a.cachedEntity!=null&&c&&b&&e.push({groupId:c,author:b,updated:a.cachedEntity})});a=this.$5.snapshot();var f=a.remove.map(function(a){return a.id}),g=[];a.update.forEach(function(b){var a=b.id;b=b.cachedEntity;if(b==null)return;g.push({id:a,identity:b})});a=this.$6.snapshot().remove;var h=this.$2.snapshot(),i=[];for(h of h.update){var j=h.cachedEntity,k=h.id;j!=null&&i.push({id:k,dhash:j})}k=this.$4.snapshot();j=[];for(h of k.update){k=h.cachedEntity;var l=h.id;k!=null&&j.push({id:l,lastSyncTs:k})}l=this.$3.snapshot();k=[];for(h of l.update){l=h.cachedEntity;var m=h.id;l!=null&&k.push({id:m,icdc:l})}return b.length===0&&c.length===0&&g.length===0&&e.length===0&&a.length===0&&k.length===0&&i.length===0&&j.length===0&&f.length===0?null:{dhashUpdate:i,icdcUpdate:k,identityRemove:f,identityUpdate:g,preKeyRemove:a,senderKeySessionUpdate:e,sessionRemove:c,sessionUpdate:b,lastSyncTsUpdate:j}};c.warmCache=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=this;a=a.map(d("WAJids").interpretAsUserJid).filter(Boolean);a=(yield this.$9.bulkLoadIdentities(a).then(function(a){return b.$5.bulkLoadIdentities(a)}));a=Array.from(a.values()).reduce(function(a,b){return a.concat(Array.from(b.keys()))},[]);yield this.loadSessions(a)});function c(b){return a.apply(this,arguments)}return c}();return a}();g.InMemorySignalStoreImpl=a}),98);
__d("WARequestKeysBatcher",["WAResolvable"],(function(a,b,c,d,e,f,g){"use strict";var h={delayMs:50,maxSize:100};function a(a,b){b=b===void 0?h:b;var c=b.delayMs,e=b.maxSize,f=null;function g(b){f&&f.args===b&&(f=null);return a(b)}return function(a){if(f!=null)f.args.push(a);else{var b=[a],h=new(d("WAResolvable").Resolvable)();a=h.promise.then(g);var i=function(){return void h.resolve(b)},j=setTimeout(i,c);f={args:b,batchPromise:a,run:i,timer:j}}a=f;i=a.args;j=a.batchPromise;var k=i.length-1;if(i.length>=e){clearTimeout((a=f)==null?void 0:a.timer);f.run();f=null}return j.then(function(a){return a[k]})}}g.makeSimpleBatcher=a}),98);
__d("WARequestKeys",["WABulkRequestKeys","WAPromiseManagement","WARequestKeysBatcher","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=d("WARequestKeysBatcher").makeSimpleBatcher(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WABulkRequestKeys").bulkRequestKeys(a));return b.success===!1?a.map(function(){return b}):a.map(function(a){a=b.value.get(a);return a?d("WAResultOrError").makeResult(a):d("WAResultOrError").makeError("errRequestKeysNoKeys")})});return function(b){return a.apply(this,arguments)}}());c=d("WAPromiseManagement").cacheWhilePending(function(a){return a},a);g.requestKeys=c}),98);
__d("WACryptoManagerUtils",["Promise","WABulkRequestKeys","WACryptoDbCallbacks","WACryptoManager","WAGlobals","WAHandleFailureUtils","WAInMemorySignalStore","WALogger","WALoggerTag","WAPREList","WAPREMetrics","WARequestKeys","WAResultOrError","WASignalKeys","WASignalSignatures","WATagsLogger","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q=d("WATagsLogger").TAGS([c("WALoggerTag").SignedPrekey]);function a(a){var b=new(d("WAInMemorySignalStore").InMemorySignalStoreImpl)(d("WACryptoDbCallbacks").getCryptoDbCallbacks(),a),c=r();return{manager:d("WACryptoManager").initCryptoManager({regInfo:a,storage:b,network:c}),storage:b}}function r(){return{requestKeys:d("WARequestKeys").requestKeys,bulkRequestKeys:d("WABulkRequestKeys").bulkRequestKeys}}function e(a,c,e,f){var g=null;return d("WACryptoManager").decryptContent(f.cryptoManager,c,{ciphertext:e,type:a},function(a,c){g={plaintext:a,remoteIdentity:c};return(p||(p=b("Promise"))).resolve()}).then(function(a){if(a.success)return d("WAResultOrError").makeResult(g);else return a})["catch"](function(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["DecryptMsg runtime error: ",""])),a);throw a})}function f(a,c,e,f){var g=null;return d("WACryptoManager").decryptGroupContent(f.cryptoManager,a,c,e,function(a){g={plaintext:a};return(p||(p=b("Promise"))).resolve()}).then(function(a){if(a.success)return d("WAResultOrError").makeResult(g);else return a})["catch"](function(a){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["DecryptMsg runtime error: ",""])),a);throw a})}function s(a,b){return d("WACryptoManager").getParticipantInfo(b,a)}function t(a){return a.storage.getPreKeyGenerationsTimestamps()}function u(a,b){return b.storage.deletePreKeyGenerations(a)}function v(a,b,c,e){return d("WACryptoManager").saveSenderKeySession(e.cryptoManager,a,b,c)}function w(a){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield a.storage.loadLatestSignedPreKey());if(e.success===!1){q.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Missing signed prekey: ",", triggering reregistration"])),e.error);yield d("WAHandleFailureUtils").reregisterPhone();throw c("err")("No signed prekey: "+e.error)}e=d("WASignalSignatures").deserializeSignedPreKey(e.value);if(e==null){q.ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["Cannot deserialize signed prekey"])));throw c("err")("Cannot deserialize signed prekey")}var f=(yield d("WACryptoManager").generateOneTimePreKey(a));if(f==null){d("WATagsLogger").TAGS([c("WALoggerTag").OneTimePrekey]).ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["Cannot generate one time prekey"])));throw c("err")("Cannot generate one time prekey")}a=a.regInfo;var g=a.regId;a=a.staticKeyPair;return(p||(p=b("Promise"))).resolve({regId:g,keyType:d("WASignalKeys").KEY_TYPE,publicKey:a.publicKey,signedPreKey:e,preKey:f})});return x.apply(this,arguments)}function y(a,b,c){var e=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION,{string:{chat:"group",jid:a}},void 0);return d("WACryptoManager").encryptGroupContent(c.cryptoManager,a,d("WAGlobals").getMyDeviceJid(),b).then(function(a){a.success?e.endSuccess():(d("WATagsLogger").TAGS(["EncryptGroupContent"]).ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Failed to encrypt group content: ",""])),a.error),e.endFail(a.error));return a})["catch"](function(a){d("WATagsLogger").TAGS(["EncryptGroupContent"]).ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Runtime excpetion when encrypting group content: ",""])),a);e.endFail("runtime-exception");return d("WAResultOrError").makeError("runtime-exception")})}function z(a,b,c,e,f,g){var h=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION,{string:{chat:"1:1",jid:c},string_array:{node_types:e,message_types:f,media_types:g}},void 0);return d("WACryptoManager").bulkEncryptContent(b.cryptoManager,a).then(function(a){if(a.success)h.endSuccess();else{var b=a.error;switch(b){case"missing":case"mismatch":case"runtime-exception":break;default:break}h.endFail(b)}return a})}function A(a,b,c,e,f,g){var h=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION,{string:{chat:"1:1",jid:g}},void 0);return d("WACryptoManager").encryptContent(c.cryptoManager,a,b,e||d("WACryptoManager").DEFAULT_SESSION_REQUEST,f).then(function(a){if(a.success)h.endSuccess();else{var b=a.error;switch(b){case"identity-mismatch":case"errSignalInvalidKey":break;default:break}h.endFail(b)}return a})}function B(a,b){return d("WACryptoManager").bulkEncryptContent(b.cryptoManager,a).then(function(a){if(a.success===!1){d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[SendMessage] Fail encrypt messages"])));return new Map()}return a.value})}function C(a,b){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){a=(yield d("WACryptoManager").ensureSessionsExists(c.cryptoManager,a));yield (p||(p=b("Promise"))).all(Array.from(a.entries()).map(function(a){var b=a[0];a=a[1];return c.cryptoManager.storage.handleNewSession(b,a,a.remote.pubKey)}))});return D.apply(this,arguments)}g.createCryptoManager=a;g.decryptMsg=e;g.decryptGroupMsg=f;g.getParticipantInfo=s;g.getPreKeyGenerationsTimestamps=t;g.deletePreKeyGenerations=u;g.saveSenderKeySession=v;g.getSignalInfoForRetry=w;g.encryptGroupContentWithMetrics=y;g.bulkEncryptMsgWithMetrics=z;g.encryptMsgWithMetrics=A;g.bulkEncrypt=B;g.bulkPreEstablishOutgoingSession=C}),98);
__d("WADbRegistrationApi",["Promise","WADbSignal","WAJids","WALogger","WASignalDB","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(a,c){return d("WASignalDB").getDb().runInTransaction(["contacts"],"readwrite",function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var d=(yield b.stores.contacts.get(a));if(d!=null)return b.stores.contacts.bulkPut([babelHelpers["extends"]({},d,{icdcInfo:c})]);else return b.stores.contacts.bulkPut([{contactJid:a,dhash:null,icdcInfo:c}])});return function(a){return d.apply(this,arguments)}}(),d("WASignalDB").signalOp("saveICDC"))};function a(a){return d("WASignalDB").getDb().runInTransaction(["meta"],"readwrite",function(b){return b.stores.meta.bulkPut([{key:d("WADbSignal").MetaKeysEnum.deviceId,value:{deviceId:a}}])},d("WASignalDB").signalOp("saveDeviceId"))}function e(a,c){return d("WASignalDB").getDb().runInTransaction(["meta","signedPrekey"],"readwrite",function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield (i||(i=b("Promise"))).all([e.stores.meta.bulkPut([{key:d("WADbSignal").MetaKeysEnum.deviceUUID,value:{deviceUUID:c.deviceUUID}},{key:d("WADbSignal").MetaKeysEnum.fbid,value:{fbid:a}},{key:d("WADbSignal").MetaKeysEnum.regId,value:{regId:c.signalRegInfo.regId}},{key:d("WADbSignal").MetaKeysEnum.identityKeyPair,value:{identityKeyPair:c.signalRegInfo.identityKeyPair}},{key:d("WADbSignal").MetaKeysEnum.lastSignedPrekeyId,value:{lastSignedPrekeyId:c.signalRegInfo.signedPreKey.keyId}},{key:d("WADbSignal").MetaKeysEnum.registrationVersion,value:{registrationVersion:c.registrationVersion}},{key:d("WADbSignal").MetaKeysEnum.authKeyPair,value:{authKeyPair:c.signalRegInfo.authKeyPair}},{key:d("WADbSignal").MetaKeysEnum.deviceRegUnixTime,value:{deviceRegUnixTime:c.registrationUnixTime}}]),e.stores.signedPrekey.bulkPut([c.signalRegInfo.signedPreKey])])});return function(a){return e.apply(this,arguments)}}(),d("WASignalDB").signalOp("saveRegistrationMeta"))}var k=function(a,b){var c=b.sessionId;return d("WASignalDB").getDb().runInTransaction(["meta"],"readwrite",function(a){return a.stores.meta.bulkPut([{key:d("WADbSignal").MetaKeysEnum.lastSessionDeviceWasLinkedTo,value:{lastSessionDeviceWasLinkedTo:c}}])},d("WASignalDB").signalOp("saveLastSessionDeviceWasLinkedTo"))};function f(){return d("WASignalDB").getDb().runInTransaction(["meta"],"readonly",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield a.stores.meta.bulkGet([(a=d("WADbSignal")).MetaKeysEnum.fbid,a.MetaKeysEnum.deviceId,a.MetaKeysEnum.cat,a.MetaKeysEnum.regId,a.MetaKeysEnum.identityKeyPair,a.MetaKeysEnum.authKeyPair]));var b=a[0],e=a[1],f=a[2],g=a[3],i=a[4];a=a[5];d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["worker: got db data"])));b=b==null?void 0:b.value.fbid;e=e==null?void 0:e.value.deviceId;f=f==null?void 0:f.value.cat;g=g==null?void 0:g.value.regId;i=i==null?void 0:i.value.identityKeyPair;a=a==null?void 0:a.value.authKeyPair;if(b==null)throw c("err")("fbid not set");if(e==null)throw c("err")("deviceId not set");if(f==null)throw c("err")("fbCat not set");if(g==null||i==null)throw c("err")("regInfo not set");return{deviceJid:d("WAJids").toDeviceJid(d("WAJids").toMsgrUserJid(b),e),fbCat:f.encrypted_serialized_cat,regInfo:{authKeyPair:a,regId:g,staticKeyPair:i},userJid:d("WAJids").toMsgrUserJid(b)}});return function(b){return a.apply(this,arguments)}}(),d("WASignalDB").signalOp("loadAllRegistrationMeta"))}g.saveICDC=j;g.saveDeviceId=a;g.saveRegistrationMeta=e;g.saveLastSessionDeviceWasLinkedTo=k;g.loadAllRegistrationMetaInTransaction=f}),98);
__d("WAMapUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return new Map(Array.from(a.entries()).map(function(a){return[a[0],b(a[1],a[0])]}))}f.mapValues=a}),66);
__d("WAProtocolMediaType",[],(function(a,b,c,d,e,f){"use strict";function a(a){switch(a){case"image":case"sticker":case"gif":case"video":case"ptt":case"audio":case"document":case"product":return a;case"xma-image":return"document";default:return null}}f.castToProtocolMediaType=a}),66);
__d("WAEncNode",["WAAsMessageTransport","WACryptoManagerUtils","WAGlobals","WALogger","WAMapUtils","WAMsgTransport.pb","WANullthrows","WAProtocolMediaType","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,e,f){var g=new Set(),i=new Set(),m=new Set(),n=d("WAMapUtils").mapValues(a,function(a,b){var c=a.params;a=a.icdc;var d;g.add(c.type);switch(c.type){case"message":d=j({messageBytes:c.messageBytes,to:b,icdc:a,chat:c.chat,backupDirective:c.backupDirective,applicationPayloadVersion:c.applicationPayloadVersion});i.add(c.messageType.type);c.messageType.mediaType!=null&&m.add(c.messageType.mediaType);break;case"appdata":d=k({messageBytes:c.messageBytes});break;default:c.type,d=l({skdm:c.skdm,icdc:a})}return{plaintext:d}});return d("WACryptoManagerUtils").bulkEncryptMsgWithMetrics(n,b,e,Array.from(g),Array.from(i),Array.from(m)).then(function(b){if(!b.success){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to encrypt message: ",""])),b.error);return null}return d("WAMapUtils").mapValues(b.value,function(b,e){var g,h=b.type,i=b.ciphertext;b=b.baseKey;g=c("WANullthrows")((g=a.get(e))==null?void 0:g.params);var j=g.type==="message"&&g.messageType.type==="media"?d("WAProtocolMediaType").castToProtocolMediaType(g.messageType.mediaType):null;return{encType:"device",to:e,v:((e=g.messageBytes)==null?void 0:e.version)==="v2"?"2":"3",type:h,mediaType:j,count:f,ciphertext:i,baseKey:b}})})}function b(a,b,c,e,f,g,h,m){var n;switch(b.type){case"message":n=j({messageBytes:b.messageBytes,to:a,icdc:h,chat:b.chat,backupDirective:m,applicationPayloadVersion:b.applicationPayloadVersion});break;case"appdata":n=k({messageBytes:b.messageBytes});break;default:b.type,n=l({skdm:b.skdm,icdc:h})}m=d("WACryptoManagerUtils").encryptMsgWithMetrics(a,n,c,f,g,b==null?void 0:b.chat);return m.then(function(c){var f;if(!c.success){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to encrypt message: ",""])),c.error);return null}var g=b.type==="message"&&b.messageType.type==="media"?d("WAProtocolMediaType").castToProtocolMediaType(b.messageType.mediaType):null,h=c.value,j=h.type;h=h.ciphertext;return{encType:"device",to:a,v:((f=b.messageBytes)==null?void 0:f.version)==="v2"?"2":"3",type:j,mediaType:g,count:e,ciphertext:h,baseKey:c.value.baseKey}})}function j(a){var b=a.messageBytes,c=a.to,e=a.icdc,f=a.chat,g=a.backupDirective;a=a.applicationPayloadVersion;if(b.version==="v3"){var h=null;d("WAGlobals").isPeerDevice(c)&&(h=f);f=d("WAAsMessageTransport").asMessageTransport(b.bytes,h,null,e,g,a);return d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,f).readByteArrayView()}else if(d("WAGlobals").isPeerDevice(c))return b.bytesForPeer;else return b.bytes}function k(a){a=a.messageBytes;if(a.version==="v3"){a=d("WAAsMessageTransport").asMessageTransport(a.bytes);return d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,a).readByteArrayView()}else throw c("err")("Plaintext v2 not supported yet")}function l(a){var b=a.skdm;a=a.icdc;b=d("WAAsMessageTransport").asMessageTransport(null,null,b,a);return d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,b).readByteArrayView()}g.getEncNodes=a;g.getEncNode=b}),98);
__d("WAPhash",["Promise","WABase64","WABinary","WACryptoDependencies","WALogger","WASortedLists"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a){d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Calculate pHash -- Start"])));a=d("WASortedLists").sortAndDedupe(a);var c=new(d("WABinary").Binary)();for(var e=0;e<a.length;e++)c.writeString(a[e]);return(j||(j=b("Promise"))).resolve(d("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",c.readByteArrayView()).then(function(a){d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Calculate pHash -- end"])));a=new Uint8Array(a,0,6);return"2:"+d("WABase64").encodeB64(a)}))}g.calculatePHash=a}),98);
__d("WAEncUserMsg",["Promise","WAComputeICDC","WAEncNode","WAGlobals","WAJids","WAPhash","WATagsLogger","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s=d("WATagsLogger").TAGS(["WAEncUserMsg"]);function a(a,b,c,d){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){s.LOG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- START"])));a.length===0&&s.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- no recipient"])));s.LOG(n||(n=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- ICDC"])));var h=a.flatMap(function(a){return a.devicesInfo}).map(function(a){return a.jid});w(a)&&s.LOG(o||(o=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- OTHER_RECIPENT_DEVICE_EMPTY"])));var i;e.type==="message"&&!c("gkx")("3176")&&(i=(yield x(a,f,g)));return(r||(r=b("Promise"))).all([u(h,e,f,i,g),d("WAPhash").calculatePHash(h.concat(d("WAGlobals").getMyDeviceJid()))]).then(function(a){var b=a[0];a=a[1];s.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- DONE"])));return{participants:b,phash:a}})});return t.apply(this,arguments)}function e(a,b,c){return u(a,b,c)}function u(a,b,c,d,e){return v(a,b,c,d,e).then(function(a){if(a.length===0){s.WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- getParticipantNodes -- EMPTY NODE"])));e==null||e.addPoint("getParticipantNodes_empty_node");return}return a})}function f(a,b,c,e,f,g){return d("WAEncNode").getEncNode(a,b,c,e,f,g)}function v(a,b,c,e,f){var g=!1;s.LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- encrypt -- getParticipantNodes -- START"])));(b.type!=="message"||d("WAJids").interpretAsGroupJid(b.chat)!=null)&&(g=!0);a=d("WAEncNode").getEncNodes(new Map(a.map(function(a){return[a,{params:b,icdc:e}]})),c).then(function(a){if(a==null){s.WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- encrypt - getParticipantNodes -- EMPTY DEVICE JIDS"])));f==null||f.addPoint("getParticipantNodes_empty_device_jids");return[]}b.type==="message"&&(g=g||Array.from(a.keys()).some(function(a){return d("WAJids").extractUserJid(a)===b.chat}));return Array.from(a==null?void 0:a.values())});return a.then(function(a){if(g)return a;else{s.ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- getParticipantNodes -- receiverEncypted -- FALSE"])));f==null||f.addPoint("getParticipantNodes_receiverEncypted_false");return[]}}).then(function(a){return a.filter(Boolean)})}function w(a){return a.filter(function(a){return a.user!==d("WAGlobals").getMyUserJid()}).flatMap(function(a){return a.devicesInfo}).length===0}function x(a,b,c){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e;try{c==null||c.addPoint("icdc_start"),e=(yield d("WAComputeICDC").computeICDC(a,d("WAGlobals").getMyUserJid(),d("WAGlobals").getMyDeviceJid(),b)),c==null||c.addPoint("icdc_end",{bool:{isICDCEmpty:e==null}})}catch(a){c==null||c.addPoint("icdc-error"),s.ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- ICDC calc error: ",""])),a)}return e});return y.apply(this,arguments)}g.encryptUserMsg=a;g.encryptGroupFanoutMsg=e;g.encryptDeviceJidMessage=f}),98);
__d("WAGetUserDevices",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";function a(a,b){return g.apply(this,arguments)}function g(){g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield b.storage.bulkLoadIdentities(a));return Array.from(b).flatMap(function(a){a=a[1];return Array.from(a.keys())})});return g.apply(this,arguments)}f.getUserDevices=a}),66);
__d("WAEncGroupMsg",["WAAsMessageTransport","WABridge","WACryptoManager","WACryptoManagerUtils","WADbPersonalSenderKeyStatusTxns","WAEncUserMsg","WAGetUserDevices","WAGlobals","WAHex","WAMsgTransport.pb","WAOdsEnums","WAPhash","WAPromiseQueue","WAProtocolMediaType","WAResultOrError","WASortedLists","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o=d("WATagsLogger").TAGS(["WAEncGroupMsg"]),p=30*d("WATimeUtils").DAY_SECONDS,q=new(d("WAPromiseQueue").PromiseQueue)();function r(a,b,c){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=a.senderKeyId;if(e==null||a.rotateSenderKey||!d("WATimeUtils").happenedWithin(a.ts,p))return d("WAResultOrError").makeError("sender-key-invalid");c=(yield c.cryptoManager.storage.loadSenderKeySession(b,d("WAGlobals").getMyDeviceJid()));if(c.success===!1||c.value.senderKeyStates.length===0)return d("WAResultOrError").makeError("sender-key-missing");b=c.value.senderKeyStates.at(-1);if(b==null)return d("WAResultOrError").makeError("sender-key-missing");return b.senderKeyId!==a.senderKeyId?d("WAResultOrError").makeError("sender-key-id-mismatch"):d("WAResultOrError").makeResult({senderKeyId:e})});return s.apply(this,arguments)}function t(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield d("WACryptoManager").rotateGroupSenderKey(b.cryptoManager,a,d("WAGlobals").getMyDeviceJid()));yield d("WADbPersonalSenderKeyStatusTxns").markSenderKeyAsRotated(a,b.senderKeyId,d("WATimeUtils").unixTime());return{senderKeyId:b.senderKeyId}});return u.apply(this,arguments)}function v(a,c,e,f){return q.enqueue(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield d("WADbPersonalSenderKeyStatusTxns").getSenderKeyStatus(a)),g=(yield r(b,a,e)),i=(yield d("WAGetUserDevices").getUserDevices(c,e.cryptoManager)),j=new Set(i);if(g.success===!1){o.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Rotating sender key for group "," because ",""])),a,g.error);d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.GROUP_SKS_INVALID,key:g.error});f.addPoint("sender_key_rotation_start");var k=(yield t(a,e));f.addPoint("sender_key_rotation_end");return{senderKeyId:k.senderKeyId,needsSenderKey:j,groupParticipants:new Set(i)}}else{((k=b.hasSenderKey)!=null?k:[]).forEach(function(a){return j["delete"](a)});f.addPoint("no_sk_rotation",{"int":{noRotationNeedsSK:j.size}});return{senderKeyId:g.value.senderKeyId,needsSenderKey:j,groupParticipants:new Set(i)}}}))}function a(a,b,c,d,e,f,g){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h){h.addPoint("enc_group_start");var p=(yield v(a,b.map(function(a){return a.user}),f,h)),q=p.senderKeyId,r=p.needsSenderKey;p=p.groupParticipants;o.LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Finish rotate participant info"])));h.addPoint("rotated_participant_info");var s=null,t,u;b=b.flatMap(function(a){return a.devicesInfo}).map(function(a){return a.jid});p["delete"](d("WAGlobals").getMyDeviceJid());var w=!d("WASortedLists").areEqual(d("WASortedLists").asSortedSet(p),d("WASortedLists").sortAndDedupe(b)),y=e.type==="text"&&e.isRevoked,z=e.type==="media"?d("WAProtocolMediaType").castToProtocolMediaType(e.mediaType):null;if(w||y){w=(yield d("WAEncUserMsg").encryptGroupFanoutMsg(b,{type:"message",messageBytes:c,messageType:e,chat:a,backupDirective:g},f));w&&!(e.type==="text"&&e.isInvisible===!0)&&(t=w,u={encType:"group",to:a,v:c.version==="v3"?"3":"2",type:"skmsg",mediaType:z,ciphertext:null});o.LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Finish group fanout msg"])));h.addPoint("finish_group_fanout_msg")}else{if(c.version==="v3"){y=d("WAAsMessageTransport").asMessageTransport(c.bytes);g=d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,y).readByteArrayView()}else g=c.bytes;w=(yield d("WACryptoManagerUtils").encryptGroupContentWithMetrics(a,g,f));o.LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Finish encrypt group content"])));h.addPoint("finish_encrypt_group_content");if(w.success){o.LOG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Encrypt success"])));y=w.value;q!==y.senderKeyId&&p.forEach(function(a){return r.add(a)});if(r.size>0){g={groupId:a,axolotlSenderKeyDistributionMessage:d("WAHex").bytesToBuffer(y.senderKeyDistributionProto)};o.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["start key distribution"])));w=b.filter(function(a){return r.has(a)});q=(yield x(w,g,f));o.LOG(n||(n=babelHelpers.taggedTemplateLiteralLoose(["end key distribution"])));h.addPoint("finish_skdm_enc_node");q.length>0&&(t=q,s={group:a,senderKeyId:y.senderKeyId,knowsSenderKey:new Set(w)})}u={encType:"group",to:a,v:c.version==="v2"?"2":"3",type:y.ciphertext.type,mediaType:z,ciphertext:y.ciphertext.ciphertext};e.type==="text"&&e.isInvisible===!0&&(u={encType:"group",to:a,v:c.version==="v2"?"2":"3",type:"skmsg",mediaType:null,ciphertext:null})}}p=(yield d("WAPhash").calculatePHash(b.concat(d("WAGlobals").getMyDeviceJid())));h.addPoint("phash_finish");return{phash:p,participants:t,encNode:u,senderKeyDistributionInfo:s}});return w.apply(this,arguments)}function x(a,b,c){b=d("WAAsMessageTransport").asMessageTransport(null,null,b,null);var e=d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,b).readByteArrayView();return d("WACryptoManagerUtils").bulkEncrypt(new Map(a.map(function(a){return[a,{plaintext:e}]})),c).then(function(a){var b=[];a.forEach(function(a,c){b.push({encType:"device",to:c,v:"3",type:a.type,ciphertext:a.ciphertext,mediaType:null,count:null,baseKey:null})});return b})}g.encryptGroupMsg=a}),98);
__d("WAFrankingNode",["Promise","WAFranking","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,c,e){if(c==null){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Franking key is missing"])));return(j||(j=b("Promise"))).resolve(null)}if(e!=null&&e!==0){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Can't handle franking version ",""])),e);return(j||(j=b("Promise"))).resolve(null)}return d("WAFranking").genFrankingTag(c,a)}g.genFrankingTagFromMessageApplicationEncode=a}),98);
__d("WAGenReportingMeta",["WAByteArray","WAFranking","WAFrankingNode","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=(yield d("WAFrankingNode").genFrankingTagFromMessageApplicationEncode(a,b,c));return{frankingKey:b,frankingTag:e,frankingVersion:d("WAFranking").getFrankingVersion(c),reportingContent:d("WAByteArray").uint8ArrayToBuffer(a),reportingTag:null}});return h.apply(this,arguments)}g.genReportingMeta=a}),98);
__d("WAGetKeysForUpload",["WALoggerTag","WAResultOrError","WASignalKeys","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("WATagsLogger").TAGS([c("WALoggerTag").PrekeyGenerateAndUpload,c("WALoggerTag").SignedPrekey]);function a(a,b){return a.storage.loadPreKeys(b).then(function(b){var c=b.preKeys;b=b.signedPreKey;var e=[];c.forEach(function(a){a=d("WASignalKeys").deserializePreKey(a);a==null?i.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to deserialize prekey received from the db"]))):e.push(a)});return d("WAResultOrError").makeResult({regInfo:a.regInfo,keyType:d("WASignalKeys").KEY_TYPE,preKeys:e,signedPreKey:b})})}g.getKeysForUpload=a}),98);
__d("WAMakeSignedPreKeyMixin",["WAWap"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b={idElementValue:d("WAWap").BIG_ENDIAN_CONTENT(a.id,3)},c={anyElementValue:a.keyPair.publicKey};a=a.signature;return{keyIDMixinArgs:b,keyDataMixinArgs:c,signatureElementValue:a}}g.makeSignedPreKeyMixin=a}),98);
__d("WARandomJitter",[],(function(a,b,c,d,e,f){"use strict";function a(){return Math.round(Math.random()*500-250)}f.getRandomJitter=a}),66);
__d("WARetryUtils",["WARandomJitter"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a)return{algo:{backoff:{first:1,second:1,type:"fibonacci"},toMs:function(a){return(1+a)*1e3+d("WARandomJitter").getRandomJitter()},type:"adjust"},relativeDelay:!0,max:6e5};else return{algo:{type:"adjust",backoff:{type:"fibonacci",first:1,second:1},toMs:function(a){return(9+a)*1e3}},max:62e4}}g.fibonacciBackoff=a}),98);
__d("WASmaxInPreKeysSetVnameFailureBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");return!b.success?b:d("WAResultOrError").makeResult({text:b.value})}g.parseSetVnameFailureBadRequestMixin=a}),98);
__d("WASmaxInPreKeysSetVnameFailureFallbackMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");return!b.success?b:d("WAResultOrError").makeResult({text:b.value})}g.parseSetVnameFailureFallbackMixin=a}),98);
__d("WASmaxInPreKeysSetVnameFailureInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");return!b.success?b:d("WAResultOrError").makeResult({text:b.value})}g.parseSetVnameFailureInternalServerErrorMixin=a}),98);
__d("WASmaxInPreKeysSetVnameFailureNotAcceptableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"violation");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-acceptable");if(!a.success)return a;var c=d("WASmaxParseUtils").attrString(b.value,"reason");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrInt,b.value,"max");if(!e.success)return e;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrInt,b.value,"length");return!b.success?b:d("WAResultOrError").makeResult({text:a.value,violationReason:c.value,violationMax:e.value,violationLength:b.value})}g.parseSetVnameFailureNotAcceptableMixin=a}),98);
__d("WASmaxInPreKeysVnameFailures",["WAResultOrError","WASmaxInPreKeysSetVnameFailureBadRequestMixin","WASmaxInPreKeysSetVnameFailureFallbackMixin","WASmaxInPreKeysSetVnameFailureInternalServerErrorMixin","WASmaxInPreKeysSetVnameFailureNotAcceptableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysSetVnameFailureNotAcceptableMixin").parseSetVnameFailureNotAcceptableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"SetVnameFailureNotAcceptable",value:b.value});var c=d("WASmaxInPreKeysSetVnameFailureBadRequestMixin").parseSetVnameFailureBadRequestMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"SetVnameFailureBadRequest",value:c.value});var e=d("WASmaxInPreKeysSetVnameFailureInternalServerErrorMixin").parseSetVnameFailureInternalServerErrorMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"SetVnameFailureInternalServerError",value:e.value});var f=d("WASmaxInPreKeysSetVnameFailureFallbackMixin").parseSetVnameFailureFallbackMixin(a);return f.success?d("WAResultOrError").makeResult({name:"SetVnameFailureFallback",value:f.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["VnameFailureNotAcceptable","VnameFailureBadRequest","VnameFailureInternalServerError","VnameFailureFallback"],[b,c,e,f])}g.parseVnameFailures=a}),98);
__d("WASmaxInPreKeysSetResponsePreKeySuccessVnameFailure",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysVnameFailures","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;var e=d("WASmaxParseUtils").flattenedChildWithTag(c.value,"error");if(!e.success)return e;var f=d("WASmaxParseUtils").attrString(c.value,"text");if(!f.success)return f;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,c.value,"code",207);if(!c.success)return c;var g=d("WASmaxParseUtils").attrIntRange(e.value,"code",400,599);if(!g.success)return g;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysVnameFailures").parseVnameFailures(e.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorText:f.value,errorCode:c.value,errorErrorCode:g.value},a.value,{errorErrorVnameFailures:b.value}))}g.parseSetResponsePreKeySuccessVnameFailure=a}),98);
__d("WASmaxInPreKeysIQErrorNotAcceptableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"field");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"name");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"reason");return!a.success?a:d("WAResultOrError").makeResult({name:b.value,reason:a.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"field",h);if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-acceptable");if(!c.success)return c;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",406);return!a.success?a:d("WAResultOrError").makeResult({text:c.value,code:a.value,field:b.value})}g.parseIQErrorNotAcceptableField=h;g.parseIQErrorNotAcceptableMixin=a}),98);
__d("WASmaxInPreKeysRequestErrors",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorNotAcceptableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorNotAcceptableMixin").parseIQErrorNotAcceptableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAcceptable",value:b.value});var c=d("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorNotAcceptable","IQErrorFallbackClient"],[b,c])}g.parseRequestErrors=a}),98);
__d("WASmaxInPreKeysSetResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrors").parseRequestErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrors:b.value}))}g.parseSetResponseRequestError=a}),98);
__d("WASmaxInPreKeysSetResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseSetResponseServerError=a}),98);
__d("WASmaxInPreKeysSetResponseSuccess",["WASmaxInPreKeysIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseSetResponseSuccess=a}),98);
__d("WASmaxOutPreKeysKeyDataMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyElementValue;a=d("WASmaxJsx").smax("smax$any",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeKeyDataMixin=a}),98);
__d("WASmaxOutPreKeysIdentityKeyMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysKeyDataMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutPreKeysKeyDataMixin").mergeKeyDataMixin(d("WASmaxJsx").smax("identity",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIdentityKeyMixin=a}),98);
__d("WASmaxOutPreKeysKeyTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("type",null,new Uint8Array([5])));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeKeyTypeMixin=a}),98);
__d("WASmaxOutPreKeysKeyIDMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.idElementValue;a=d("WASmaxJsx").smax("id",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeKeyIDMixin=a}),98);
__d("WASmaxOutPreKeysPreKeyListMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysKeyDataMixin","WASmaxOutPreKeysKeyIDMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.keyIDMixinArgs;a=a.keyDataMixinArgs;b=d("WASmaxJsx").smax("key",null,d("WASmaxOutPreKeysKeyIDMixin").mergeKeyIDMixin(d("WASmaxJsx").smax("id",null),b),d("WASmaxOutPreKeysKeyDataMixin").mergeKeyDataMixin(d("WASmaxJsx").smax("value",null),a));return b}function i(a){a=a.keyArgs;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("list",null,d("WASmaxChildren").REPEATED_CHILD(h,a,0,2e4)));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makePreKeyListListKey=h;g.mergePreKeyListMixin=a}),98);
__d("WASmaxOutPreKeysRegistrationIDMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.registrationElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("registration",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRegistrationIDMixin=a}),98);
__d("WASmaxOutPreKeysRequestPaddingMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.paddingElementValue;a=d("WASmaxJsx").smax("iq",null,d("WASmaxJsx").smax("padding",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRequestPaddingMixin=a}),98);
__d("WASmaxOutPreKeysSignedPreKeyMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysKeyDataMixin","WASmaxOutPreKeysKeyIDMixin"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.keyIDMixinArgs,e=a.keyDataMixinArgs;a=a.signatureElementValue;c=(b=d("WASmaxJsx")).smax("smax$any",null,b.smax("skey",null,d("WASmaxOutPreKeysKeyIDMixin").mergeKeyIDMixin(b.smax("id",null),c),d("WASmaxOutPreKeysKeyDataMixin").mergeKeyDataMixin(b.smax("value",null),e),b.smax("signature",null,a)));return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSignedPreKeyMixin=a}),98);
__d("WASmaxOutPreKeysVerifiedNameMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.verifiedNameElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("verified_name",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeVerifiedNameMixin=a}),98);
__d("WASmaxOutPreKeysIdentityKeyBundleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysIdentityKeyMixin","WASmaxOutPreKeysKeyTypeMixin","WASmaxOutPreKeysPreKeyListMixin","WASmaxOutPreKeysRegistrationIDMixin","WASmaxOutPreKeysRequestPaddingMixin","WASmaxOutPreKeysSignedPreKeyMixin","WASmaxOutPreKeysVerifiedNameMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.verifiedNameMixinArgs,c=a.requestPaddingMixinArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutPreKeysRequestPaddingMixin").mergeRequestPaddingMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutPreKeysVerifiedNameMixin").mergeVerifiedNameMixin,d("WASmaxOutPreKeysKeyTypeMixin").mergeKeyTypeMixin(d("WASmaxOutPreKeysSignedPreKeyMixin").mergeSignedPreKeyMixin(d("WASmaxOutPreKeysPreKeyListMixin").mergePreKeyListMixin(d("WASmaxOutPreKeysIdentityKeyMixin").mergeIdentityKeyMixin(d("WASmaxOutPreKeysRegistrationIDMixin").mergeRegistrationIDMixin(d("WASmaxJsx").smax("iq",null),a),a),a),a)),b),c);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIdentityKeyBundleMixin=a}),98);
__d("WASmaxOutPreKeysSetRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WASmaxOutPreKeysIdentityKeyBundleMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutPreKeysIdentityKeyBundleMixin").mergeIdentityKeyBundleMixin(d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"set"})),a);return a}g.makeSetRequest=a}),98);
__d("WASmaxPreKeysSetRPC",["WAComms","WASmaxInPreKeysSetResponsePreKeySuccessVnameFailure","WASmaxInPreKeysSetResponseRequestError","WASmaxInPreKeysSetResponseServerError","WASmaxInPreKeysSetResponseSuccess","WASmaxOutPreKeysSetRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WASmaxOutPreKeysSetRequest").makeSetRequest(a);b=(yield d("WAComms").sendSmaxStanza(a,b));var c=d("WASmaxInPreKeysSetResponseSuccess").parseSetResponseSuccess(b,a);if(c.success)return{name:"SetResponseSuccess",value:c.value};var e=d("WASmaxInPreKeysSetResponsePreKeySuccessVnameFailure").parseSetResponsePreKeySuccessVnameFailure(b,a);if(e.success)return{name:"SetResponsePreKeySuccessVnameFailure",value:e.value};var f=d("WASmaxInPreKeysSetResponseRequestError").parseSetResponseRequestError(b,a);if(f.success)return{name:"SetResponseRequestError",value:f.value};b=d("WASmaxInPreKeysSetResponseServerError").parseSetResponseServerError(b,a);if(b.success)return{name:"SetResponseServerError",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Set",{Success:c,PreKeySuccessVnameFailure:e,RequestError:f,ServerError:b}))});return h.apply(this,arguments)}g.sendSetRPC=a}),98);
__d("WAGenerateAndUploadPreKeysProtocol",["WACryptoManager","WAGetKeysForUpload","WAGlobals","WAMakeSignedPreKeyMixin","WAPromiseRetryLoop","WAResultOrError","WARetryUtils","WASmaxPreKeysSetRPC","WATagsLogger","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=d("WATagsLogger").TAGS(["generateAndUploadPreKeysProtocol"]);function a(){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAGlobals").getWaOneQueue().enqueue(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.cryptoManager;var b=(yield d("WACryptoManager").generatePreKeys(a));if(!b.success)return b;m.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["About to upload pre keys"]))).devConsole("generation "+b.value);return d("WAGetKeysForUpload").getKeysForUpload(a,b.value)});return function(b){return a.apply(this,arguments)}}(),{operationType:"generate_prekeys",flush:!0,afterInit:!0}));a=a.value;var c=a.regInfo,e=a.preKeys;a=a.signedPreKey;var f=babelHelpers["extends"]({registrationElementValue:d("WAWap").BIG_ENDIAN_CONTENT(c.regId),anyElementValue:c.staticKeyPair.publicKey,keyArgs:e.map(o)},d("WAMakeSignedPreKeyMixin").makeSignedPreKeyMixin(a));c=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({name:"uploadKeys",timer:d("WARetryUtils").fibonacciBackoff(!1),code:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){m.LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Attempt to upload keys"])));var b=(yield d("WASmaxPreKeysSetRPC").sendSetRPC(f));switch(b.name){case"SetResponseSuccess":m.LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Keys are successfully uploaded"])));a(d("WAResultOrError").makeResult({preKeys:e}));return;case"SetResponseRequestError":m.WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Got Malformed upload keys IQ on upload pre keys attempt"])));a(d("WAResultOrError").makeError("request-error"));return;default:b.name,m.WARN(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Got unexpected error: ",", will retry after backoff"])),b.name)}});function c(b){return a.apply(this,arguments)}return c}()});c.start();return c.promise()});return n.apply(this,arguments)}function o(a){var b={idElementValue:d("WAWap").BIG_ENDIAN_CONTENT(a.id,3)};a={anyElementValue:a.keyPair.publicKey};return{keyIDMixinArgs:b,keyDataMixinArgs:a}}g.generateAndUploadPreKeysProtocol=a}),98);
__d("WAGenerateAndUploadPreKeys",["WABridge","WAGenerateAndUploadPreKeysProtocol","WALoggerTag","WAOdsEnums","WATagsLogger","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=d("WATagsLogger").TAGS([c("WALoggerTag").PrekeyGenerateAndUpload,c("WALoggerTag").SignedPrekey]);function a(a,b){a=b.reason;j.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["About to generate and upload pre keys with reason: ",""])),a);return d("WAGenerateAndUploadPreKeysProtocol").generateAndUploadPreKeysProtocol().then(function(a){if(a.success){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_UPLOAD,key:"success",amount:a.value.preKeys.length},!0);return}var b=a.error;if(b==="request-error"){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_UPLOAD,key:"malformed"},!0);throw c("err")("Malformed upload keys IQ")}b;j.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate and upload prekeys with error ",": ","}"])),b,(b=a.payload)==null?void 0:b.message)})}g.generateAndUploadPreKeys=a}),98);
__d("WAGetMetaApi",["WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(){return d("WASignalDB").getDb().runInTransaction(["meta"],"readonly",function(a){return a.stores.meta.bulkGet(["certificateChain","deviceId","identityKeyPair","abProps","edgeInfo","clockSkew","authKeyPair"]).then(function(a){var b,c,d,e,f,g,h,i=a[0],j=a[1],k=a[2],l=a[3],m=a[4],n=a[5];a=a[6];return{abProps:l==null||(b=l.value)==null?void 0:b.abProps,authKeyPair:a==null||(c=a.value)==null?void 0:c.authKeyPair,certificateChain:i==null||(d=i.value)==null?void 0:d.certificateChain,clockSkew:n==null||(e=n.value)==null?void 0:e.clockSkew,deviceId:j==null||(f=j.value)==null?void 0:f.deviceId,edgeInfo:m==null||(g=m.value)==null?void 0:g.edgeInfo,identityKeyPair:k==null||(h=k.value)==null?void 0:h.identityKeyPair}})},d("WASignalDB").signalOp("getMeta"))};g.getMeta=a}),98);
__d("WAGetCurrentUserDeviceInfoApi",["WAGetMetaApi","WASignalKeys"],(function(a,b,c,d,e,f,g){"use strict";a=function(){return d("WAGetMetaApi").getMeta().then(function(a){var b=a==null?void 0:a.deviceId;a=a==null?void 0:a.identityKeyPair;if(b==null||a==null)return null;a=d("WASignalKeys").serializePubKey(a);return{deviceId:b,identityKey:a}})};b=function(){return d("WAGetMetaApi").getMeta().then(function(a){return(a==null?void 0:a.deviceId)==null?null:{deviceId:a==null?void 0:a.deviceId}})};g.getCurrentUserDeviceInfo=a;g.getCurrentUserDeviceId=b}),98);
__d("WAGetDeviceIdentityMixin",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a!=null?{deviceIdentityElementValue:a}:null}f.getDeviceIdentityMixin=a}),66);
__d("WAGetLocalPublicPrivateIdentityKeyApi",["WADbSignal","WALogger","WASignalDB","WASignalKeys","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){return d("WASignalDB").getDb().runInTransaction(["meta"],"readonly",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;a=(yield a.stores.meta.get(d("WADbSignal").MetaKeysEnum.identityKeyPair));if((a==null||(b=a.value)==null?void 0:b.identityKeyPair)==null){var e="[Remote Presence Error] Identity key pair was null";d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["",""])),e);throw c("err")(e)}return d("WASignalKeys").toSerializedKeyPair(a.value.identityKeyPair)});return function(b){return a.apply(this,arguments)}}(),d("WASignalDB").signalOp("getLocalPublicPrivateIdentityKey"))};g.getLocalPublicPrivateIdentityKey=a}),98);
__d("WAGetIdentityKeys",["WAGetLocalPublicPrivateIdentityKeyApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAGetLocalPublicPrivateIdentityKeyApi").getLocalPublicPrivateIdentityKey());var b=a.privateKey;a=a.serializedPubKey;return{identityPrivateKey:b,identityPublicKey:a}});return h.apply(this,arguments)}g.getIdentityKeysInWorker=a}),98);
__d("WAGroupInviteUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}f.toInviteCode=a}),66);
__d("WAGroupParserUtils",["WAGroupInviteUtils","WAJids","WALogger","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i={superadmin:"superadmin",admin:"admin",participant:"participant",nonparticipant:"nonparticipant"};function j(a){if(!a.hasAttr("error"))throw c("err")("Expected participant node to have error attr");var b=a.attrInt("error"),e=a.attrUserJid("jid");switch(b){case 401:return{errorCode:b,text:"not-authorized",user:e};case 403:a=a.child("add_request");return{errorCode:b,text:"request-code",code:d("WAGroupInviteUtils").toInviteCode(a.attrString("code")),expiration:a.attrTime("expiration"),user:e};case 404:return{errorCode:b,text:"not-found",user:e};case 406:return{errorCode:b,text:"enterprise-not-allowed",user:e};case 408:return{errorCode:b,text:"temporarily-blocked",user:e};case 409:return{errorCode:b,text:"conflict",user:e};case 500:return{errorCode:b,text:"resource-constraint",user:e};default:d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["received unknown participant error code: ",""])),b);return{errorCode:-1,text:"unknown",user:e}}}function k(a,b){a.assertTag("participant");var c="participant";switch(b){case"add":case"demote":c="participant";break;case"promote":c="admin";break;case"remove":c="nonparticipant";break}b=a.attrUserJid("jid");if(a.hasAttr("error")){var e=j(a);return d("WAResultOrError").makeError(e)}else{e=a.attrEnumOrDefault("type",i,c);c=a.maybeAttrString("addressable")!=="false";return d("WAResultOrError").makeResult({user:b,type:e,addressable:c})}}function a(a){a.assertTag("group");var b,c=a.attrString("id");c.includes("@")?b=a.attrGroupJid("id"):b=d("WAJids").toGroupJid(c);return{jid:b,creator:a.maybeAttrUserJid("creator")||void 0,creationTs:a.attrTime("creation"),subject:{content:a.maybeAttrString("subject")||void 0,user:a.maybeAttrUserJid("s_o")||void 0,ts:a.hasAttr("s_t")?a.attrTime("s_t"):void 0},description:m(a)||void 0,participantVersion:a.maybeAttrString("p_v_id")||void 0,participants:a.mapChildrenWithTag("participant",function(a){return k(a)}),memberAddMode:l(a)||void 0}}function l(a){if(a.hasChild("member_add_mode")){a=a.child("member_add_mode");if(a.hasContent()){a=a.contentString();if(a==="admin_add"||a==="all_member_add")return a}}return null}function m(a){if(a.hasChild("description")){a=a.child("description");if(a.hasChild("body")){var b=a.child("body");if(b.hasContent())return{id:a.attrString("id"),ts:a.attrTime("t"),content:b.contentString(),user:b.maybeAttrUserJid("participant")||void 0}}}return null}g.PARTICIPANT_TYPES=i;g.parseProtocolGroupParticipantNode=k;g.parseGroupNode=a}),98);
__d("WALoadReceiptApi",["MAWTransactionMode","WADbTransactor","WAMsg","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READONLY},"loadReceipt",function(a){return function(b){var c=d("WAMsg").craftWAMsgIdString(b);return a.receipts.get({waMsgId:c}).then(function(a){var c;return a==null?d("WAResultOrError").makeError("missing-receipt"):d("WAResultOrError").makeResult({id:b,permittedIdentitiesPerDevice:(c=a.permittedIdentitiesPerDevice)!=null?c:new Map(),recipientDevices:a.recipientDevices})})}});g.loadReceipt=a}),98);
__d("WAMarkSenderKeyAsSentApi",["WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,c,e){return d("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var d=(yield b.stores.personalSenderKeyStatuses.get(a));if(d==null)return;if(d.senderKeyId!==c)return;e.forEach(function(a){d.hasSenderKey.add(a)});yield b.stores.personalSenderKeyStatuses.bulkPut([d])});return function(a){return d.apply(this,arguments)}}(),d("WASignalDB").signalOp("markSenderKeyAsSent"))};g.markSenderKeyAsSent=a}),98);
__d("WASmaxInDevicesNotifyResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup").parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup:b.value}))}g.parseNotifyResponseError=a}),98);
__d("WASmaxInDevicesNotifyResponseSuccess",["WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseNotifyResponseSuccess=a}),98);
__d("WASmaxOutDevicesBaseIQSetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"set"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQSetRequestMixin=a}),98);
__d("WASmaxOutDevicesNotifyRequest",["WASmaxChildren","WASmaxJsx","WASmaxOutDevicesBaseIQSetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.userJid;a=d("WASmaxJsx").smax("user",{jid:d("WAWap").USER_JID(a)});return a}function a(a){a=a.userArgs;a=d("WASmaxOutDevicesBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},d("WASmaxJsx").smax("users",null,d("WASmaxChildren").REPEATED_CHILD(h,a,1,25))));return a}g.makeNotifyRequestUsersUser=h;g.makeNotifyRequest=a}),98);
__d("WASmaxDevicesNotifyRPC",["WAComms","WASmaxInDevicesNotifyResponseError","WASmaxInDevicesNotifyResponseSuccess","WASmaxOutDevicesNotifyRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WASmaxOutDevicesNotifyRequest").makeNotifyRequest(a);b=(yield d("WAComms").sendSmaxStanza(a,b));var c=d("WASmaxInDevicesNotifyResponseSuccess").parseNotifyResponseSuccess(b,a);if(c.success)return{name:"NotifyResponseSuccess",value:c.value};b=d("WASmaxInDevicesNotifyResponseError").parseNotifyResponseError(b,a);if(b.success)return{name:"NotifyResponseError",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Notify",{Success:c,Error:b}))});return h.apply(this,arguments)}g.sendNotifyRPC=a}),98);
__d("WANotifyDeviceChange",["Promise","WAGlobals","WALogger","WAPersistedJobManager","WASmaxDevicesNotifyRPC","WATimeUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,c){a=c.users;if(a.size===0)return(i||(i=b("Promise"))).resolve();c=d("WAGlobals").getConfig().maxUsersForNotifyDeviceChange();var e=Array.from(a);a.size>c&&(d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["The maximum number of users that can be notified is ",""])),c),e=e.slice(0,c));return j(e)}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WASmaxDevicesNotifyRPC").sendNotifyRPC({userArgs:a.map(function(a){return{userJid:a}})}));if(a.name==="NotifyResponseSuccess")return;a.name;a=a.value.errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup;if(a.name==="RetryableIQError"){var b=a.value.backoff;if(b!=null)throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{type:"constant",delay:b},jitter:0});else throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{type:"exponential",first:d("WATimeUtils").HOUR_MILLISECONDS/60},jitter:.1})}throw c("err")("Failed with an unexpected error code "+a.value.code)});return k.apply(this,arguments)}g.notifyDeviceChange=a}),98);
__d("WAParseFranking",["WAFranking","WAFrankingTypes"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b;if(a==null)return null;b=(b=a.maybeChild("franking_tag"))==null?void 0:b.contentBytes();a=(a=a.maybeChild("reporting_tag"))==null?void 0:a.contentBytes();return{frankingKey:null,frankingTag:b!=null?d("WAFrankingTypes").castToFrankingTag(b):null,reportingTag:a!=null?d("WAFrankingTypes").castToReportingTag(a):null,frankingVersion:d("WAFranking").getFrankingVersion(),reportingContent:null}}g.parseFrankingNode=a}),98);
__d("WAWaterFlow",["$InternalEnum","WAMapWithDefault","WAPREMetrics","WATagsLogger","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r=d("WATagsLogger").TAGS(["WAWaterflow"]),s=b("$InternalEnum").Mirrored(["INIT","ON_GOING","COMPLETED"]),t=function(){function a(a,b,c){this.$1=s.INIT,this.$7=[],this.$9=new(d("WAMapWithDefault").MapWithDefault)(function(){return[]}),this.$5=r.TAGS([a]),this.$8=b,this.$3={},this.$4=new Set(),this.$10=!c,this.$6=d("WATimeUtils").performanceAbsoluteNow()}var b=a.prototype;b.$11=function(){var a=this,b={"int":{},bool:{},string:{},string_array:{}};this.$4.forEach(function(c){var d=a.$3[c];Array.isArray(d)&&(b.string_array[c]=d);typeof d==="boolean"&&(b.bool[c]=d);typeof d==="number"&&(b["int"][c]=d);typeof d==="string"&&(b.string[c]=d)});return b};b.$12=function(a){if(a==null)return;for(var b in a){var c=a[b];c!==this.$3[b]&&(this.$4.add(b),this.$3[b]=c)}};b.$13=function(a,b){this.$6=d("WATimeUtils").performanceAbsoluteNow();this.$12(a);a=this.$11();this.$4.clear();this.$10&&this.$5.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose([" -> Start.",""])),u(this.$3));this.$1=s.ON_GOING;if(this.$8==null)return this;this.$2=d("WAPREMetrics").startMetric(this.$8,a,b);return this};b.startMetric=function(a){return this.$13(a)};b.reStartMetric=function(a,b){return this.$13(b,a)};b.startPoint=function(a,b){var e;if(typeof a!=="string"){this.$5.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Step should be a enum type"])));throw c("err")("Step should be a enum type")}this.$12(b);b=this.$11();(e=this.$2)==null||e.addPoint(a+"_start",b);this.$4.clear();e={step:a,from:d("WATimeUtils").performanceAbsoluteNow()};this.$7.push(e);this.$9.get(a).push(e);this.$10&&this.$5.LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose([""," -> Start.","",""])),a,v(this.$7,this.$6),u(this.$3))};b.endPoint=function(a,b){var e,f=d("WATimeUtils").performanceAbsoluteNow(),g=this.$9.get(a).pop();g==null?this.$5.WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["No start point was found for step: ","."])),a):g.to=f;if(typeof a!=="string"){this.$5.ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Step should be a enum type"])));throw c("err")("Step should be a enum type")}this.$12(b);b=this.$11();(e=this.$2)==null||e.addPoint(a+"_end",b);this.$4.clear();this.$10&&this.$5.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose([""," -> Done.;\nTime taken: ",";\nTime from start: ",";","","\n"])),a,w(g!=null?f-g.from:0),w(f-this.$6),v(this.$7,this.$6),u(this.$3))};b.isOnGoing=function(){return this.$1===s.ON_GOING};b.isCompleted=function(){return this.$1===s.COMPLETED};b.annotate=function(a){this.$12(a)};b.reAnnotate=function(a){this.$12(a(this.$3))};b.getAnnotations=function(){return this.$3};b.annotateImmediately=function(a){var b;this.$12(a);a=this.$11();(b=this.$2)==null||b.addAnnotations(a);this.$4.clear()};b.addPoint=function(a,b){var d;if(typeof a!=="string"){this.$5.ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["Step should be a enum type"])));throw c("err")("Step should be a enum type")}this.$12(b);b=this.$11();(d=this.$2)==null||d.addPoint(a,b);this.$4.clear()};b.getStartTime=function(){return this.$6};b.log=function(){this.$10&&this.$5.LOG(o||(o=babelHelpers.taggedTemplateLiteralLoose([" -> in progress.\nTime passed: "," sec;","","\n"])),(d("WATimeUtils").performanceAbsoluteNow()-this.$6)/1e3,v(this.$7,this.$6),u(this.$3))};b.endSuccess=function(a){var b;this.$12(a);a=this.$11();(b=this.$2)==null||b.endSuccess(a);this.$4.clear();this.$10&&this.$5.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose([" -> Done. Success: true\nTime taken: "," sec;","","\n"])),(d("WATimeUtils").performanceAbsoluteNow()-this.$6)/1e3,v(this.$7,this.$6),u(this.$3));this.$1=s.COMPLETED};b.endFail=function(a,b){var c;this.$12(b);b=this.$11();(c=this.$2)==null||c.endFail(a,b);this.$4.clear();this.$10&&this.$5.LOG(q||(q=babelHelpers.taggedTemplateLiteralLoose([" -> Done. Success: false\nTime taken: "," sec;","","\n"])),(d("WATimeUtils").performanceAbsoluteNow()-this.$6)/1e3,v(this.$7,this.$6),u(this.$3));this.$1=s.COMPLETED};return a}();function a(a){if(a==null)return{};var b={bool:{},"int":{},string:{},string_array:{}};for(var c in a)Array.isArray(a[c])&&(b.string_array[c]=a[c]),typeof a[c]==="number"&&(b["int"][c]=a[c]),typeof a[c]==="boolean"&&(b.bool[c]=a[c]),typeof a[c]==="string"&&(b.string[c]=a[c]);return b}function u(a){a=Object.entries(a).map(function(a){var b=a[0];a=a[1];return b+": "+String(a)});return a.length>0?"\n"+a.join("\n"):""}function v(a,b){a=a.map(function(a){var c=a.step,e=a.from;a=a.to;return typeof c==="string"?c+" => Started after: "+w(e-b)+"; "+(a!=null?"Completed after: "+w(a-e):"In progress: "+w(d("WATimeUtils").performanceAbsoluteNow()-e)):""}).filter(Boolean);return a.length>0?"\n"+a.join("\n"):""}function w(a){return a/1e3+"s"}function e(a,b,c){return new t(a,b,c!=null?c:!1)}g.WAWaterflow=t;g.convertToPREAnnotation=a;g.makeWaterflow=e}),98);
__d("WAQueryGroup",["$InternalEnum","WADeprecatedSendIq","WADeprecatedWapParser","WAGroupParserUtils","WAPREList","WAPREMetrics","WAResultOrError","WAWap","WAWaterFlow","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=new(c("WADeprecatedWapParser"))("queryAllGroupsResponse",function(a){a.assertTag("iq");return{groups:a.child("groups").mapChildren(d("WAGroupParserUtils").parseGroupNode)}});function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a,b=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.QUERY_GROUPS);a=(a=d("WAWap")).wap("iq",{id:a.generateId(),to:a.G_US,type:"get",xmlns:"w:g2"},a.wap("participating",null,a.wap("participants",null),a.wap("description",null)));a=(yield d("WADeprecatedSendIq").deprecatedSendIq(a,h));if(!a.success){b.endFail("query_groups_fail");return d("WAResultOrError").makeError(a)}b.endSuccess();return d("WAResultOrError").makeResult(a.result)});return i.apply(this,arguments)}var j=new(c("WADeprecatedWapParser"))("queryAllGroupsResponse",function(a){a.assertTag("iq");return{group:d("WAGroupParserUtils").parseGroupNode(a.child("group"))}}),k=b("$InternalEnum").Mirrored(["IQ_REQUEST"]);function e(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b!=null?b:"unknown",e=d("WAWaterFlow").makeWaterflow("query-group",d("WAPREList").PRE_METRIC.QUERY_GROUP).startMetric();e.addPoint(k.IQ_REQUEST,{key:c});a=(yield d("WADeprecatedSendIq").deprecatedSendIq(d("WAWap").wap("iq",{id:d("WAWap").generateId(),to:d("WAWap").GROUP_JID(a),type:"get",xmlns:"w:g2"},d("WAWap").wap("query",{request:b!=null?d("WAWap").CUSTOM_STRING(b):d("WAWap").DROP_ATTR})),j));if(!a.success){e.endFail("Fail-"+c+"-"+a.errorCode);return d("WAResultOrError").makeError(a)}e.endSuccess();return d("WAResultOrError").makeResult(a.result.group)});return l.apply(this,arguments)}g.queryAllGroups=a;g.parseQueryGroupResponse=j;g.queryGroup=e}),98);
__d("WAQueryGroups",["Promise","WACreateGroup","WAGetDevices","WAPushSafeTypes","WAQueryGroup","WATimeUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){f===void 0&&(f=!1);a=d("WAPushSafeTypes").unsafeNotNullable(e);e={groups:[]};if(a.type==="all"){var g=(yield d("WAQueryGroup").queryAllGroups());if(g.success===!1){var i;throw c("err")("Failed to parse queryAllGroup response with error "+JSON.stringify((i=g.error)!=null?i:null))}e=g.value}else{a.type;i=(yield (h||(h=b("Promise"))).all(a.groups.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAQueryGroup").queryGroup(a));if(a.success===!1){var b;throw c("err")("Failed to parse queryGroup response with error "+JSON.stringify((b=a.error)!=null?b:null))}return a.value});return function(b){return a.apply(this,arguments)}}())));e={groups:i}}yield d("WACreateGroup").createGroups(e.groups.map(function(a){return{groupStatus:"queried",groupToCreate:a,serverTs:d("WATimeUtils").unixTime(),extras:void 0,folder:void 0,key:void 0}}));var j=new Set();e.groups.forEach(function(a){return a.participants.forEach(function(a){a.success?j.add(a.value.user):j.add(a.error.user)})});yield d("WAGetDevices").getDevices(null,{users:j,reason:"query-groups",ignoreDhash:f})});return i.apply(this,arguments)}g.queryGroups=a}),98);
__d("WASmaxInPreKeysIQErrorItemNotFoundMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","item-not-found");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",404);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorItemNotFoundMixin=a}),98);
__d("WASmaxInPreKeysRequestErrorsFetchDigest",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorItemNotFoundMixin","WASmaxInPreKeysIQErrorNotAcceptableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorNotAcceptableMixin").parseIQErrorNotAcceptableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAcceptable",value:b.value});var c=d("WASmaxInPreKeysIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:c.value});var e=d("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return e.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorNotAcceptable","IQErrorItemNotFound","IQErrorFallbackClient"],[b,c,e])}g.parseRequestErrorsFetchDigest=a}),98);
__d("WASmaxInPreKeysFetchDigestResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrorsFetchDigest","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrorsFetchDigest").parseRequestErrorsFetchDigest(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrorsFetchDigest:b.value}))}g.parseFetchDigestResponseRequestError=a}),98);
__d("WASmaxInPreKeysFetchDigestResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseFetchDigestResponseServerError=a}),98);
__d("WASmaxInPreKeysKeysHashMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"hash");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,20,20);return!a.success?a:d("WAResultOrError").makeResult({hashElementValue:a.value})}g.parseKeysHashMixin=a}),98);
__d("WASmaxInPreKeysPreKeyIDListMixin",["WAResultOrError","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"id");if(!b.success)return b;b=d("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(a);return!b.success?b:b}function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"list");if(!a.success)return a;a=d("WASmaxParseUtils").mapChildrenWithTag(a.value,"id",0,2e4,h);return!a.success?a:d("WAResultOrError").makeResult({listId:a.value})}g.parsePreKeyIDListListId=h;g.parsePreKeyIDListMixin=a}),98);
__d("WASmaxInPreKeysIdentityDigestBundleMixin",["WAResultOrError","WASmaxInPreKeysIdentityKeyMixin","WASmaxInPreKeysKeyTypeMixin","WASmaxInPreKeysKeysHashMixin","WASmaxInPreKeysPreKeyIDListMixin","WASmaxInPreKeysRegistrationIDMixin","WASmaxInPreKeysSignedPreKeyMixin"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysRegistrationIDMixin").parseRegistrationIDMixin(a);if(!b.success)return b;var c=d("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(a);if(!c.success)return c;var e=d("WASmaxInPreKeysPreKeyIDListMixin").parsePreKeyIDListMixin(a);if(!e.success)return e;var f=d("WASmaxInPreKeysSignedPreKeyMixin").parseSignedPreKeyMixin(a);if(!f.success)return f;var g=d("WASmaxInPreKeysKeyTypeMixin").parseKeyTypeMixin(a);a=d("WASmaxInPreKeysKeysHashMixin").parseKeysHashMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,c.value,e.value,f.value,{keyTypeMixin:g.success?g.value:null},a.value))}g.parseIdentityDigestBundleMixin=a}),98);
__d("WASmaxInPreKeysFetchDigestResponseSuccess",["WAResultOrError","WASmaxInPreKeysIQResultResponseMixin","WASmaxInPreKeysIdentityDigestBundleMixin","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"digest");if(!c.success)return c;var e=d("WASmaxParseReference").optionalAttrStringFromReference(b,["digest","identity_type"]);if(!e.success)return e;e=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,c.value,"identity_type",e.value);if(!e.success)return e;c=d("WASmaxInPreKeysIdentityDigestBundleMixin").parseIdentityDigestBundleMixin(c.value);if(!c.success)return c;a=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({hasDigestIdentityType:e.value!=null,digestIdentityDigestBundleMixin:c.value},a.value))}g.parseFetchDigestResponseSuccess=a}),98);
__d("WASmaxOutPreKeysFetchDigestRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin"],(function(a,b,c,d,e,f,g){function a(){var a=d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"get"},d("WASmaxJsx").smax("digest",null)));return a}g.makeFetchDigestRequest=a}),98);
__d("WASmaxPreKeysFetchDigestRPC",["WAComms","WASmaxInPreKeysFetchDigestResponseRequestError","WASmaxInPreKeysFetchDigestResponseServerError","WASmaxInPreKeysFetchDigestResponseSuccess","WASmaxOutPreKeysFetchDigestRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WASmaxOutPreKeysFetchDigestRequest").makeFetchDigestRequest();a=(yield d("WAComms").sendSmaxStanza(b,a));var c=d("WASmaxInPreKeysFetchDigestResponseSuccess").parseFetchDigestResponseSuccess(a,b);if(c.success)return{name:"FetchDigestResponseSuccess",value:c.value};var e=d("WASmaxInPreKeysFetchDigestResponseRequestError").parseFetchDigestResponseRequestError(a,b);if(e.success)return{name:"FetchDigestResponseRequestError",value:e.value};a=d("WASmaxInPreKeysFetchDigestResponseServerError").parseFetchDigestResponseServerError(a,b);if(a.success)return{name:"FetchDigestResponseServerError",value:a.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("FetchDigest",{Success:c,RequestError:e,ServerError:a}))});return h.apply(this,arguments)}g.sendFetchDigestRPC=a}),98);
__d("WARequestPreKeyDigestProtocol",["WABinary","WAConvertRegistrationIdMixin","WAConvertSignedPreKeyMixin","WACryptoDependencies","WACryptoUtils","WAParsableXmlNode","WAResultOrError","WASignalKeys","WASmaxPreKeysFetchDigestRPC","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=d("WATagsLogger").TAGS(["requestPreKeyDigestProtocol"]);function a(a){return d("WASmaxPreKeysFetchDigestRPC").sendFetchDigestRPC({withoutRetry:!1}).then(function(b){switch(b.name){case"FetchDigestResponseServerError":var c=b.value.errorServerErrors.name;j.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),b.name,c);return d("WAResultOrError").makeError({type:"server-error",payload:c});case"FetchDigestResponseRequestError":c=b.value.errorRequestErrorsFetchDigest.name;j.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),b.name,c);return d("WAResultOrError").makeError({type:"request-error",payload:c});default:b.name;c=k(b.value.digestIdentityDigestBundleMixin);return l(c,a).then(function(a){return a==="ok"?d("WAResultOrError").makeResult():d("WAResultOrError").makeError({type:"compare-error",payload:a})})}})}function k(a){var b=d("WAConvertRegistrationIdMixin").registrationIdMixin(a),c=d("WAConvertSignedPreKeyMixin").convertSignedPreKeyMixin(a),e=a.listId.map(function(a){return d("WASignalKeys").castToPreKeyId(d("WAParsableXmlNode").convertBytesToUint(a.elementValue,3))});a=a.hashElementValue;return{regId:b,skeyId:c.id,preKeyIds:e,hash:a}}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a.regId!==b.regInfo.regId)return"RegIdMismatch";if(a.skeyId!==b.signedPreKey.id)return"SignedPreKeyIdMismatch";var c=new Map();b.preKeys.forEach(function(a){return c.set(a.id,a)});var e=a.preKeyIds.some(function(a){return!c.has(a)});if(e)return"UnknownPreKey";e=a.preKeyIds.map(function(a){return c.get(a)}).filter(Boolean);b=(yield n(b,e));return!d("WACryptoUtils").uint8ArraysEqual(b,a.hash)?"HashMismatch":"ok"});return m.apply(this,arguments)}function n(a,b){var c=new(d("WABinary").Binary)();c.writeByteArray(a.regInfo.staticKeyPair.publicKey);c.writeByteArray(a.signedPreKey.keyPair.publicKey);c.writeByteArray(a.signedPreKey.signature);b.forEach(function(a){c.writeByteArray(a.keyPair.publicKey)});return d("WACryptoDependencies").getCrypto().subtle.digest("SHA-1",c.readByteArrayView()).then(function(a){return new Uint8Array(a)})}g.requestPreKeyDigestProtocol=a}),98);
__d("WARequestPreKeyDigest",["WABridge","WAGenerateAndUploadPreKeys","WAGetKeysForUpload","WAGlobals","WALogger","WAOdsEnums","WARequestPreKeyDigestProtocol","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield a(function(a){a=a.cryptoManager;return d("WAGetKeysForUpload").getKeysForUpload(a)}));a=(yield d("WARequestPreKeyDigestProtocol").requestPreKeyDigestProtocol(a.value));if(a.success===!1){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_DIGEST,key:"fail"});if(a.error.type==="compare-error"){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["PreKey digest comparison failed: ",""])),a.error.payload);d("WAGenerateAndUploadPreKeys").generateAndUploadPreKeys(null,{reason:"prekey digest comparison failed"})["catch"](function(a){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Error while generating and uploading prekeys: ",""])),a)});return}throw c("err")("Error while requesting key digest: "+a.error.type+" "+a.error.payload)}a.success;d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_DIGEST,key:"success"})});return k.apply(this,arguments)}function a(a){return j(function(a){return d("WAGlobals").getWaOneQueue().enqueue(a,{operationType:"request_prekey_digest",flush:!1})})}g.requestPreKeyDigestFn=j;g.requestPreKeyDigest=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrors").parseRequestErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrors:b.value}))}g.parseRotateSignedResponseRequestError=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseRotateSignedResponseServerError=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseSuccess",["WASmaxInPreKeysIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseRotateSignedResponseSuccess=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseValidationError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysIdentityKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;var e=d("WASmaxParseUtils").attrString(c.value,"text");if(!e.success)return e;var f=d("WASmaxParseUtils").attrIntRange(c.value,"code",400,499);if(!f.success)return f;c=d("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(c.value);if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorText:e.value,errorCode:f.value,errorIdentityKeyMixin:c.value},a.value))}g.parseRotateSignedResponseValidationError=a}),98);
__d("WASmaxOutPreKeysRotateSignedRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WASmaxOutPreKeysSignedPreKeyMixin"],(function(a,b,c,d,e,f,g){function a(a){a=a.signedPreKeyMixinArgs;a=d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"set"},d("WASmaxOutPreKeysSignedPreKeyMixin").mergeSignedPreKeyMixin(d("WASmaxJsx").smax("rotate",null),a)));return a}g.makeRotateSignedRequest=a}),98);
__d("WASmaxPreKeysRotateSignedRPC",["WAComms","WASmaxInPreKeysRotateSignedResponseRequestError","WASmaxInPreKeysRotateSignedResponseServerError","WASmaxInPreKeysRotateSignedResponseSuccess","WASmaxInPreKeysRotateSignedResponseValidationError","WASmaxOutPreKeysRotateSignedRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WASmaxOutPreKeysRotateSignedRequest").makeRotateSignedRequest(a);b=(yield d("WAComms").sendSmaxStanza(a,b));var c=d("WASmaxInPreKeysRotateSignedResponseSuccess").parseRotateSignedResponseSuccess(b,a);if(c.success)return{name:"RotateSignedResponseSuccess",value:c.value};var e=d("WASmaxInPreKeysRotateSignedResponseValidationError").parseRotateSignedResponseValidationError(b,a);if(e.success)return{name:"RotateSignedResponseValidationError",value:e.value};var f=d("WASmaxInPreKeysRotateSignedResponseRequestError").parseRotateSignedResponseRequestError(b,a);if(f.success)return{name:"RotateSignedResponseRequestError",value:f.value};b=d("WASmaxInPreKeysRotateSignedResponseServerError").parseRotateSignedResponseServerError(b,a);if(b.success)return{name:"RotateSignedResponseServerError",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("RotateSigned",{Success:c,ValidationError:e,RequestError:f,ServerError:b}))});return h.apply(this,arguments)}g.sendRotateSignedRPC=a}),98);
__d("WARotateSignedPreKeyProtocol",["WACryptoManager","WAErrorMessage","WAGlobals","WAHandleFailureUtils","WAMakeSignedPreKeyMixin","WAResultOrError","WASmaxPreKeysRotateSignedRPC","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n=d("WATagsLogger").TAGS(["rotateSignedPreKeyProtocol"]);function a(){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){n.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["start generating skey..."])));try{var a=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return d("WACryptoManager").generateSignedPreKey(a)},{operationType:"generate_signed_prekey",flush:!0,afterInit:!0}));n.LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["generated skey. Start rotating skey..."])));a=(yield d("WASmaxPreKeysRotateSignedRPC").sendRotateSignedRPC({signedPreKeyMixinArgs:d("WAMakeSignedPreKeyMixin").makeSignedPreKeyMixin(a)}));switch(a.name){case"RotateSignedResponseValidationError":var b=a.value,c=b.errorCode,e=b.errorText;b=b.errorIdentityKeyMixin;n.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["ValidationError: "," ",""])),c,e);return d("WAResultOrError").makeError({type:"validation-error",identity:b.elementValue});case"RotateSignedResponseRequestError":c=a.value.errorRequestErrors.value.code;e=a.value.errorRequestErrors.name;n.ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["RequestError: "," ",""])),c,e);return d("WAResultOrError").makeError({type:"request-error"});case"RotateSignedResponseServerError":b=a.value.errorServerErrors.value.code;c=a.value.errorServerErrors.name;n.ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["ServerError: "," ",""])),b,c);return d("WAResultOrError").makeError({type:"server-error"});default:a.name;n.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["successfully rotated new skey"])));return d("WAResultOrError").makeResult()}}catch(a){e=d("WAErrorMessage").maybeGetMessageFromError(a);if(e.includes("No lastSignedPrekeyId and registration")){yield d("WAHandleFailureUtils").reregisterPhone();return d("WAResultOrError").makeError({type:"no-prekey-reregistered"})}throw a}});return o.apply(this,arguments)}g.rotateSignedPreKeyProtocol=a}),98);
__d("WARotateSignedPreKey",["Promise","WAGenerateAndUploadPreKeys","WALoggerTag","WARotateSignedPreKeyProtocol","WATagsLogger","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=d("WATagsLogger").TAGS([c("WALoggerTag").SignedPrekeyRotation,c("WALoggerTag").SignedPrekey]);function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WARotateSignedPreKeyProtocol").rotateSignedPreKeyProtocol());if(a.success||a.error.type==="no-prekey-reregistered")return;if(a.error.type==="validation-error"){l.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Signed prekey failed server validation. need to upload all keys."])));d("WAGenerateAndUploadPreKeys").generateAndUploadPreKeys(null,{reason:"signed prekey failed server validation"})["catch"](function(a){l.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Error while generating and uploading prekeys: ",""])),a)});return(k||(k=b("Promise"))).resolve()}l.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["rotateSignedPreKey failed."])));throw c("err")("rotateSignedPreKey RPC failed: "+a.error.type)});return m.apply(this,arguments)}g.rotateSignedPreKey=a}),98);
__d("WASmaxInMessagePublishAckAdminEditMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","3");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckAdminEditMixin=a}),98);
__d("WASmaxInMessagePublishAckAdminRevokeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","8");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckAdminRevokeMixin=a}),98);
__d("WASmaxInMessagePublishAckMessageEditMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","1");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckMessageEditMixin=a}),98);
__d("WASmaxInMessagePublishAckMessagePinMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","2");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckMessagePinMixin=a}),98);
__d("WASmaxInMessagePublishEnums",["WAJids"],(function(a,b,c,d,e,f,g){a={CBP:"CBP",NBP:"NBP",PMP:"PMP"};b={delivery:"delivery",no_optimization:"no_optimization"};c={"false":"false","true":"true"};e={free_customer_service:"free_customer_service",free_entry_point:"free_entry_point",regular:"regular"};f={lid:"lid",pn:"pn"};var h={validators:[(d=d("WAJids")).validateDeviceJid,d.validateDeviceJid,d.validateUserJid,d.validateUserJid],typeName:"DeviceJid|DeviceJid|UserJid|UserJid"};d={validators:[d.validateUserJid,d.validateUserJid],typeName:"UserJid|UserJid"};g.ENUM_CBP_NBP_PMP=a;g.ENUM_DELIVERY_NOOPTIMIZATION=b;g.ENUM_FALSE_TRUE=c;g.ENUM_FREECUSTOMERSERVICE_FREEENTRYPOINT_REGULAR=e;g.ENUM_LID_PN=f;g.DEVICEJID_DEVICEJID_USERJID_USERJID=h;g.USERJID_USERJID=d}),98);
__d("WASmaxInMessagePublishAckPaidConversationMixin",["WAResultOrError","WASmaxInMessagePublishEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"delivery_context");if(!b.success)return b;b=d("WASmaxParseUtils").attrStringEnum(a,"optimization_goal",d("WASmaxInMessagePublishEnums").ENUM_DELIVERY_NOOPTIMIZATION);return!b.success?b:d("WAResultOrError").makeResult({optimizationGoal:b.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"source_url");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function j(a){var b=d("WASmaxParseUtils").assertTag(a,"referral");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"source_url",i);if(!b.success)return b;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"source_type");return!a.success?a:d("WAResultOrError").makeResult({sourceType:a.value,sourceUrl:b.value})}function k(a){var b=d("WASmaxParseUtils").assertTag(a,"origin");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"referral",j);if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"type");return!a.success?a:d("WAResultOrError").makeResult({type:a.value,referral:b.value})}function l(a){var b=d("WASmaxParseUtils").assertTag(a,"pricing");if(!b.success)return b;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"consumer_country_code");if(!b.success)return b;var c=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"business_country_code");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"conversation_status",0,void 0);if(!e.success)return e;var f=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"latest_c2b_timestamp",0,void 0);if(!f.success)return f;var g=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"analytics_conversation_id");if(!g.success)return g;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"b2c_timestamp",0,void 0);return!a.success?a:d("WAResultOrError").makeResult({consumerCountryCode:b.value,businessCountryCode:c.value,conversationStatus:e.value,latestC2bTimestamp:f.value,analyticsConversationId:g.value,b2cTimestamp:a.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"biz");if(!b.success)return b;a=d("WASmaxParseUtils").optionalChildWithTag(b.value,"delivery_context",h);if(!a.success)return a;var c=d("WASmaxParseUtils").optionalChildWithTag(b.value,"origin",k);if(!c.success)return c;var e=d("WASmaxParseUtils").optionalChildWithTag(b.value,"pricing",l);if(!e.success)return e;var f=d("WASmaxParseUtils").attrString(b.value,"paid_convo_id");if(!f.success)return f;var g=d("WASmaxParseUtils").attrStringEnum(b.value,"pricing_model",d("WASmaxInMessagePublishEnums").ENUM_CBP_NBP_PMP);if(!g.success)return g;var i=d("WASmaxParseUtils").attrStringEnum(b.value,"billable",d("WASmaxInMessagePublishEnums").ENUM_FALSE_TRUE);if(!i.success)return i;var j=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,b.value,"expiration_timestamp",0,void 0);if(!j.success)return j;var m=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,b.value,"pricing_category");if(!m.success)return m;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,b.value,"pricing_type",d("WASmaxInMessagePublishEnums").ENUM_FREECUSTOMERSERVICE_FREEENTRYPOINT_REGULAR);return!b.success?b:d("WAResultOrError").makeResult({bizPaidConvoId:f.value,bizPricingModel:g.value,bizBillable:i.value,bizExpirationTimestamp:j.value,bizPricingCategory:m.value,bizPricingType:b.value,bizDeliveryContext:a.value,bizOrigin:c.value,bizPricing:e.value})}g.parseAckPaidConversationBizDeliveryContext=h;g.parseAckPaidConversationBizOriginReferralSourceUrl=i;g.parseAckPaidConversationBizOriginReferral=j;g.parseAckPaidConversationBizOrigin=k;g.parseAckPaidConversationBizPricing=l;g.parseAckPaidConversationMixin=a}),98);
__d("WASmaxInMessagePublishAckPaidGroupConversationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"biz");if(!b.success)return b;a=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"pricing");if(!a.success)return a;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a.value,"business_country_code");return!b.success?b:d("WAResultOrError").makeResult({bizPricingBusinessCountryCode:b.value})}g.parseAckPaidGroupConversationMixin=a}),98);
__d("WASmaxInMessagePublishAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup",["WAResultOrError","WASmaxInMessagePublishAckPaidConversationMixin","WASmaxInMessagePublishAckPaidGroupConversationMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInMessagePublishAckPaidConversationMixin").parseAckPaidConversationMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"AckPaidConversation",value:b.value});var c=d("WASmaxInMessagePublishAckPaidGroupConversationMixin").parseAckPaidGroupConversationMixin(a);return c.success?d("WAResultOrError").makeResult({name:"AckPaidGroupConversation",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["AckPaidConversation","AckPaidGroupConversation"],[b,c])}g.parseAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup=a}),98);
__d("WASmaxInMessagePublishAckRevokeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","7");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckRevokeMixin=a}),98);
__d("WASmaxInMessagePublishServerFrankingTagMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"franking");if(!a.success)return a;a=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"reporting_tag");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,9,128);return!a.success?a:d("WAResultOrError").makeResult({frankingReportingTagElementValue:a.value})}g.parseServerFrankingTagMixin=a}),98);
__d("WASmaxInMessagePublishAckMixin",["WAResultOrError","WASmaxInMessagePublishAckAdminEditMixin","WASmaxInMessagePublishAckAdminRevokeMixin","WASmaxInMessagePublishAckMessageEditMixin","WASmaxInMessagePublishAckMessagePinMixin","WASmaxInMessagePublishAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup","WASmaxInMessagePublishAckRevokeMixin","WASmaxInMessagePublishServerFrankingTagMixin","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"class","message");if(!c.success)return c;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var e=d("WASmaxInMessagePublishAckMessageEditMixin").parseAckMessageEditMixin(a),f=d("WASmaxInMessagePublishAckAdminEditMixin").parseAckAdminEditMixin(a),g=d("WASmaxInMessagePublishAckMessagePinMixin").parseAckMessagePinMixin(a),h=d("WASmaxInMessagePublishAckAdminRevokeMixin").parseAckAdminRevokeMixin(a),i=d("WASmaxInMessagePublishAckRevokeMixin").parseAckRevokeMixin(a),j=d("WASmaxInMessagePublishServerFrankingTagMixin").parseServerFrankingTagMixin(a);a=d("WASmaxInMessagePublishAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup").parseAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup(a);return d("WAResultOrError").makeResult({"class":c.value,t:b.value,ackMessageEditMixin:e.success?e.value:null,ackAdminEditMixin:f.success?f.value:null,ackMessagePinMixin:g.success?g.value:null,ackAdminRevokeMixin:h.success?h.value:null,ackRevokeMixin:i.success?i.value:null,serverFrankingTagMixin:j.success?j.value:null,ackPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup:a.success?a.value:null})}g.parseAckMixin=a}),98);
__d("WASmaxInMessagePublishApplicationNegativeAckMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"application_error",0,void 0);return!b.success?b:d("WAResultOrError").makeResult({applicationError:b.value})}g.parseApplicationNegativeAckMixin=a}),98);
__d("WASmaxInMessagePublishMessageNackRetryAttributesMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"backoff",0,86400);return!b.success?b:d("WAResultOrError").makeResult({backoff:b.value})}g.parseMessageNackRetryAttributesMixin=a}),98);
__d("WASmaxInMessagePublishNegativeAckMixin",["WAResultOrError","WASmaxInMessagePublishAckMixin","WASmaxInMessagePublishApplicationNegativeAckMixin","WASmaxInMessagePublishMessageNackRetryAttributesMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseUtils").attrString(a,"error");if(!c.success)return c;b=d("WASmaxInMessagePublishAckMixin").parseAckMixin(a,b);if(!b.success)return b;var e=d("WASmaxInMessagePublishApplicationNegativeAckMixin").parseApplicationNegativeAckMixin(a);a=d("WASmaxInMessagePublishMessageNackRetryAttributesMixin").parseMessageNackRetryAttributesMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({error:c.value},b.value,{applicationNegativeAckMixin:e.success?e.value:null,messageNackRetryAttributesMixin:a.success?a.value:null}))}g.parseNegativeAckMixin=a}),98);
__d("WASmaxInMessagePublishIndividualResponseNegative",["WAResultOrError","WASmaxInMessagePublishNegativeAckMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"recipient");if(!c.success)return c;a=d("WASmaxInMessagePublishNegativeAckMixin").parseNegativeAckMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({recipient:c.value},a.value))}g.parseIndividualResponseNegative=a}),98);
__d("WASmaxInMessagePublishAckRcatMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"rcat");if(!b.success)return b;a=d("WASmaxParseUtils").contentBytes(b.value);return!a.success?a:d("WAResultOrError").makeResult({rcatElementValue:a.value})}g.parseAckRcatMixin=a}),98);
__d("WASmaxInMessagePublishDeviceListStaleMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"phash");return!b.success?b:d("WAResultOrError").makeResult({phash:b.value})}g.parseDeviceListStaleMixin=a}),98);
__d("WASmaxInMessagePublishRefreshLIDMixin",["WAResultOrError","WASmaxInMessagePublishEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").attrStringEnum(a,"refresh_lid",d("WASmaxInMessagePublishEnums").ENUM_FALSE_TRUE);return!b.success?b:d("WAResultOrError").makeResult({refreshLid:b.value})}g.parseRefreshLIDMixin=a}),98);
__d("WASmaxInMessagePublishIndividualResponseSuccess",["WAResultOrError","WASmaxInMessagePublishAckMixin","WASmaxInMessagePublishAckRcatMixin","WASmaxInMessagePublishDeviceListStaleMixin","WASmaxInMessagePublishEnums","WASmaxInMessagePublishRefreshLIDMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"recipient");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrJidEnum,a,"participant",d("WASmaxInMessagePublishEnums").USERJID_USERJID);if(!e.success)return e;b=d("WASmaxInMessagePublishAckMixin").parseAckMixin(a,b);if(!b.success)return b;var f=d("WASmaxInMessagePublishDeviceListStaleMixin").parseDeviceListStaleMixin(a),g=d("WASmaxInMessagePublishRefreshLIDMixin").parseRefreshLIDMixin(a);a=d("WASmaxInMessagePublishAckRcatMixin").parseAckRcatMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({recipient:c.value,participant:e.value},b.value,{deviceListStaleMixin:f.success?f.value:null,refreshLIDMixin:g.success?g.value:null,ackRcatMixin:a.success?a.value:null}))}g.parseIndividualResponseSuccess=a}),98);
__d("WASmaxOutMessagePublishAppdataMetaAttributeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaAppdata;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{appdata:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAppdataMetaAttributeMixin=a}),98);
__d("WASmaxOutMessagePublishAutomatedMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("automated",null));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAutomatedMixin=a}),98);
__d("WASmaxOutMessagePublishAuthMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.authVerificationTimestamp,c=a.authDisableIosAutofill;a=a.authEnableRiskCheck;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("auth",{verification_timestamp:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,b),disable_ios_autofill:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,c),enable_risk_check:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)})));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAuthMixin=a}),98);
__d("WASmaxOutMessagePublishBizAcceptTsMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.bizAcceptTs;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{accept_ts:d("WAWap").INT(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizAcceptTsMixin=a}),98);
__d("WASmaxOutMessagePublishBizAutoResponseMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.bizAutoResponse;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{auto_response:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizAutoResponseMixin=a}),98);
__d("WASmaxOutMessagePublishBizCampaignMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.bizCampaignId;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{campaign_id:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizCampaignMixin=a}),98);
__d("WASmaxOutMessagePublishBizEngagementDataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.engagementConversationState;a=a.engagementCustomerServiceState;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("engagement",{conversation_state:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b),customer_service_state:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)})));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizEngagementDataMixin=a}),98);
__d("WASmaxOutMessagePublishBizMetadataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c,e=a.metadataAppOwner,f=a.metadataCsidBm,g=a.metadataPaymentBm,h=a.metadataCustomerCategory;a=a.metadataDidBepRun;e=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("metadata",{app_owner:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).CUSTOM_STRING,e),csid_bm:b.OPTIONAL(c.CUSTOM_STRING,f),payment_bm:b.OPTIONAL(c.CUSTOM_STRING,g),customer_category:b.OPTIONAL(c.CUSTOM_STRING,h),did_bep_run:b.OPTIONAL(c.CUSTOM_STRING,a)})));return e}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizMetadataMixin=a}),98);
__d("WASmaxOutMessagePublishBizPricingDataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.pricingConsumerCountryCode;a=a.pricingBusinessCountryCode;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("pricing",{consumer_country_code:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b),business_country_code:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)})));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizPricingDataMixin=a}),98);
__d("WASmaxOutMessagePublishBizRolesMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.bizHostStorage,c=a.bizActualActors;a=a.bizPrivacyModeTs;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{host_storage:d("WAWap").INT(b),actual_actors:d("WAWap").INT(c),privacy_mode_ts:d("WAWap").INT(a)}));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizRolesMixin=a}),98);
__d("WASmaxMixinGroupExhaustiveError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){function b(){var b;for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return(b=a.call.apply(a,[this].concat(d))||this,b.name="SmaxMixinGroupExhaustiveError",babelHelpers.assertThisInitialized(b))||babelHelpers.assertThisInitialized(b)}babelHelpers.inheritsLoose(b,a);return b}(babelHelpers.wrapNativeSuper(Error));f.SmaxMixinGroupExhaustiveError=a}),66);
__d("WASmaxOutMessagePublishButtonsMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("buttons",null)));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeButtonsMixin=a}),98);
__d("WASmaxOutMessagePublishExtensionsMetadataMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.capabilityArgs;a=d("WASmaxJsx").smax("capabilities",null,d("WASmaxChildren").REPEATED_CHILD(i,a,1,50));return a}function i(a){a=a.capabilityName;a=d("WASmaxJsx").smax("capability",{name:d("WAWap").CUSTOM_STRING(a)});return a}function j(a){var b=a.capabilitiesArgs,c=a.extensionsMetadataWellVersion,e=a.extensionsMetadataDataApiVersion;a=a.extensionsMetadataFlowMessageVersion;c=d("WASmaxJsx").smax("native_flow",null,d("WASmaxJsx").smax("extensions_metadata",{well_version:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,c),data_api_version:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,e),flow_message_version:d("WAWap").INT(a)},d("WASmaxChildren").OPTIONAL_CHILD(h,b)));return c}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeExtensionsMetadataExtensionsMetadataCapabilities=h;g.makeExtensionsMetadataExtensionsMetadataCapabilitiesCapability=i;g.mergeExtensionsMetadataMixin=a}),98);
__d("WASmaxOutMessagePublishMixedMetadataMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.paymentsMetadataVersion;a=d("WASmaxJsx").smax("native_flow",null,d("WASmaxJsx").smax("mixed_metadata",null,d("WASmaxJsx").smax("payments_metadata",{version:d("WAWap").INT(a)})));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMixedMetadataMixin=a}),98);
__d("WASmaxOutMessagePublishNativeFlowMessageTypeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishExtensionsMetadataMixin","WASmaxOutMessagePublishMixedMetadataMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.nativeFlowName,c=a.nativeFlowV,e=a.extensionsMetadataMixinArgs;a=a.mixedMetadataMixinArgs;b=d("WASmaxJsx").smax("interactive",{type:"native_flow"},d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishMixedMetadataMixin").mergeMixedMetadataMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishExtensionsMetadataMixin").mergeExtensionsMetadataMixin,d("WASmaxJsx").smax("native_flow",{name:d("WAWap").CUSTOM_STRING(b),v:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,c)}),e),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNativeFlowMessageTypeMixin=a}),98);
__d("WASmaxOutMessagePublishInteractiveMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishNativeFlowMessageTypeMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.hasInteractiveV1;a=a.nativeFlowMessageTypeMixinArgs;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxOutMessagePublishNativeFlowMessageTypeMixin").mergeNativeFlowMessageTypeMixin(d("WASmaxJsx").smax("interactive",{v:d("WASmaxAttrs").OPTIONAL_LITERAL("1",b)}),a)));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeInteractiveMixin=a}),98);
__d("WASmaxOutMessagePublishNativeFlowMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.bizNativeFlowName;a=a.bizNativeFlowVersion;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{native_flow_name:d("WAWap").CUSTOM_STRING(b),native_flow_version:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,a)}));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNativeFlowMixin=a}),98);
__d("WASmaxOutMessagePublishButtonsOrNativeFlowOrInteractiveMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishButtonsMixin","WASmaxOutMessagePublishInteractiveMixin","WASmaxOutMessagePublishNativeFlowMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isButtons)return d("WASmaxOutMessagePublishButtonsMixin").mergeButtonsMixin(a);if(b.nativeFlow)return d("WASmaxOutMessagePublishNativeFlowMixin").mergeNativeFlowMixin(a,b.nativeFlow);if(b.interactive)return d("WASmaxOutMessagePublishInteractiveMixin").mergeInteractiveMixin(a,b.interactive);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeButtonsOrNativeFlowOrInteractiveMixinGroup=a}),98);
__d("WASmaxOutMessagePublishConversionRecipientStatusMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.conversionRecipientStatus;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("conversion",{recipient_status:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeConversionRecipientStatusMixin=a}),98);
__d("WASmaxOutMessagePublishClickToWhatsAppAttributionMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.ctwaAttributionElementValue;a=d("WASmaxJsx").smax("ctwa_attribution",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeClickToWhatsAppAttributionMixin=a}),98);
__d("WASmaxOutMessagePublishCtwaAttributionMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishClickToWhatsAppAttributionMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishClickToWhatsAppAttributionMixin").mergeClickToWhatsAppAttributionMixin(d("WASmaxJsx").smax("ctwa_attribution",null),a);return a}function i(a){a=a.ctwaAttributionArgs;a=d("WASmaxJsx").smax("message",null,d("WASmaxChildren").OPTIONAL_CHILD(h,a));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeCtwaAttributionCtwaAttribution=h;g.mergeCtwaAttributionMixin=a}),98);
__d("WASmaxOutMessagePublishClickToWhatsAppTypeMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.sourceUrlElementValue;a=d("WASmaxJsx").smax("source_url",null,a);return a}function i(a){var b,c,e=a.sourceUrlArgs,f=a.ctwaConversionSource,g=a.ctwaConversionData,i=a.ctwaSourceType,j=a.ctwaEntryPointConversionSource,k=a.ctwaEntryPointConversionApp;a=a.ctwaSignals;f=d("WASmaxJsx").smax("ctwa",{conversion_source:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).CUSTOM_STRING,f),conversion_data:b.OPTIONAL(c.CUSTOM_STRING,g),source_type:b.OPTIONAL(c.CUSTOM_STRING,i),entry_point_conversion_source:b.OPTIONAL(c.CUSTOM_STRING,j),entry_point_conversion_app:b.OPTIONAL(c.CUSTOM_STRING,k),signals:b.OPTIONAL(c.CUSTOM_STRING,a)},d("WASmaxChildren").OPTIONAL_CHILD(h,e));return f}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeClickToWhatsAppTypeSourceUrl=h;g.mergeClickToWhatsAppTypeMixin=a}),98);
__d("WASmaxOutMessagePublishCtwaConversionMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishClickToWhatsAppTypeMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishClickToWhatsAppTypeMixin").mergeClickToWhatsAppTypeMixin(d("WASmaxJsx").smax("ctwa",null),a);return a}function i(a){a=a.ctwaArgs;a=d("WASmaxJsx").smax("message",null,d("WASmaxChildren").OPTIONAL_CHILD(h,a));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeCtwaConversionCtwa=h;g.mergeCtwaConversionMixin=a}),98);
__d("WASmaxOutMessagePublishDeliveryContextMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c,e=a.deliveryContextHsmMaxBid,f=a.deliveryContextOptimizationGoal,g=a.deliveryContextTemplateId,h=a.deliveryContextCampaignId,i=a.deliveryContextSourceType,j=a.deliveryContextTierType,k=a.deliveryContextDeliveryType,l=a.deliveryContextClientToken,m=a.deliveryContextPrice,n=a.deliveryContextWabaId,o=a.deliveryContextQualityFlag,p=a.deliveryContextIsZeroRatedTemplate,q=a.deliveryContextPartnerId,r=a.deliveryContextAppId,s=a.deliveryContextVertical,t=a.deliveryContextBmMessageLimitStatus;a=a.deliveryContextShouldBypassIntegrityPhoneLimit;e=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("delivery_context",{hsm_max_bid:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).INT,e),optimization_goal:b.OPTIONAL(c.CUSTOM_STRING,f),template_id:b.OPTIONAL(c.CUSTOM_STRING,g),campaign_id:b.OPTIONAL(c.CUSTOM_STRING,h),source_type:b.OPTIONAL(c.CUSTOM_STRING,i),tier_type:b.OPTIONAL(c.CUSTOM_STRING,j),delivery_type:b.OPTIONAL(c.CUSTOM_STRING,k),client_token:b.OPTIONAL(c.CUSTOM_STRING,l),price:b.OPTIONAL(c.INT,m),waba_id:b.OPTIONAL(c.CUSTOM_STRING,n),quality_flag:b.OPTIONAL(c.CUSTOM_STRING,o),is_zero_rated_template:b.OPTIONAL(c.CUSTOM_STRING,p),partner_id:b.OPTIONAL(c.CUSTOM_STRING,q),app_id:b.OPTIONAL(c.CUSTOM_STRING,r),vertical:b.OPTIONAL(c.INT,s),bm_message_limit_status:b.OPTIONAL(c.CUSTOM_STRING,t),should_bypass_integrity_phone_limit:b.OPTIONAL(c.CUSTOM_STRING,a)})));return e}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeDeliveryContextMixin=a}),98);
__d("WASmaxOutMessagePublishCapabilitiesMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.hasFeatureV1;a=d("WASmaxJsx").smax("feature",{name:"full_catalog",v:d("WASmaxAttrs").OPTIONAL_LITERAL("1",a)});return a}function i(a){a=a.featureArgs;a=d("WASmaxJsx").smax("hsm",null,d("WASmaxJsx").smax("capabilities",null,d("WASmaxChildren").OPTIONAL_CHILD(h,a)));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeCapabilitiesCapabilitiesFeature=h;g.mergeCapabilitiesMixin=a}),98);
__d("WASmaxOutMessagePublishHSMReviewMetadataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c,e=a.anyCategory,f=a.anyTag,g=a.anyId,h=a.anySubTag,i=a.anyLibraryTemplateId;a=a.anyIsTemplateFromLibraryEdited;e=d("WASmaxJsx").smax("smax$any",{category:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).CUSTOM_STRING,e),tag:b.OPTIONAL(c.CUSTOM_STRING,f),id:b.OPTIONAL(c.CUSTOM_STRING,g),sub_tag:b.OPTIONAL(c.CUSTOM_STRING,h),library_template_id:b.OPTIONAL(c.CUSTOM_STRING,i),is_template_from_library_edited:b.OPTIONAL(c.CUSTOM_STRING,a)});return e}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeHSMReviewMetadataMixin=a}),98);
__d("WASmaxOutMessagePublishQualityTokenMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){var b=a.hasQualityTokenV1;a=a.qualityTokenElementValue;b=d("WASmaxJsx").smax("hsm",null,d("WASmaxJsx").smax("quality_token",{v:d("WASmaxAttrs").OPTIONAL_LITERAL("1",b)},a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeQualityTokenMixin=a}),98);
__d("WASmaxOutMessagePublishHsmMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishCapabilitiesMixin","WASmaxOutMessagePublishHSMReviewMetadataMixin","WASmaxOutMessagePublishQualityTokenMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.messageTtl,e=a.hasHsmV1,f=a.hasHsmButtons1,g=a.hsmObjective,h=a.hSMReviewMetadataMixinArgs,i=a.capabilitiesMixinArgs;a=a.qualityTokenMixinArgs;c=d("WASmaxJsx").smax("message",{ttl:(b=d("WASmaxAttrs")).OPTIONAL(d("WAWap").INT,c)},d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishQualityTokenMixin").mergeQualityTokenMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishCapabilitiesMixin").mergeCapabilitiesMixin,d("WASmaxOutMessagePublishHSMReviewMetadataMixin").mergeHSMReviewMetadataMixin(d("WASmaxJsx").smax("hsm",{v:b.OPTIONAL_LITERAL("1",e),buttons:b.OPTIONAL_LITERAL("1",f),objective:b.OPTIONAL(d("WAWap").CUSTOM_STRING,g)}),h),i),a));return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeHsmMixin=a}),98);
__d("WASmaxOutMessagePublishQualityControlMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.decisionSourceValue;a=d("WASmaxJsx").smax("decision_source",{value:d("WAWap").CUSTOM_STRING(a)});return a}function i(a){var b=a.decisionSourceArgs,c=a.qualityControlSourceType;a=a.qualityControlDecisionId;c=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("quality_control",{source_type:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,c),decision_id:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)},d("WASmaxChildren").REPEATED_CHILD(h,b,0,Infinity))));return c}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeQualityControlBizQualityControlDecisionSource=h;g.mergeQualityControlMixin=a}),98);
__d("WASmaxOutMessagePublishBizMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAuthMixin","WASmaxOutMessagePublishBizAcceptTsMixin","WASmaxOutMessagePublishBizAutoResponseMixin","WASmaxOutMessagePublishBizCampaignMixin","WASmaxOutMessagePublishBizEngagementDataMixin","WASmaxOutMessagePublishBizMetadataMixin","WASmaxOutMessagePublishBizPricingDataMixin","WASmaxOutMessagePublishBizRolesMixin","WASmaxOutMessagePublishButtonsOrNativeFlowOrInteractiveMixinGroup","WASmaxOutMessagePublishConversionRecipientStatusMixin","WASmaxOutMessagePublishCtwaAttributionMixin","WASmaxOutMessagePublishCtwaConversionMixin","WASmaxOutMessagePublishDeliveryContextMixin","WASmaxOutMessagePublishHsmMixin","WASmaxOutMessagePublishQualityControlMixin"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.hsmMixinArgs,e=a.bizRolesMixinArgs,f=a.bizAutoResponseMixinArgs,g=a.bizAcceptTsMixinArgs,h=a.bizCampaignMixinArgs,i=a.deliveryContextMixinArgs,j=a.qualityControlMixinArgs,k=a.authMixinArgs,l=a.conversionRecipientStatusMixinArgs,m=a.ctwaConversionMixinArgs,n=a.bizMetadataMixinArgs,o=a.ctwaAttributionMixinArgs,p=a.bizEngagementDataMixinArgs,q=a.bizPricingDataMixinArgs;a=a.buttonsOrNativeFlowOrInteractiveMixinGroupArgs;b=(b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishButtonsOrNativeFlowOrInteractiveMixinGroup").mergeButtonsOrNativeFlowOrInteractiveMixinGroup,b.optionalMerge(d("WASmaxOutMessagePublishBizPricingDataMixin").mergeBizPricingDataMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizEngagementDataMixin").mergeBizEngagementDataMixin,b.optionalMerge(d("WASmaxOutMessagePublishCtwaAttributionMixin").mergeCtwaAttributionMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizMetadataMixin").mergeBizMetadataMixin,b.optionalMerge(d("WASmaxOutMessagePublishCtwaConversionMixin").mergeCtwaConversionMixin,b.optionalMerge(d("WASmaxOutMessagePublishConversionRecipientStatusMixin").mergeConversionRecipientStatusMixin,b.optionalMerge(d("WASmaxOutMessagePublishAuthMixin").mergeAuthMixin,b.optionalMerge(d("WASmaxOutMessagePublishQualityControlMixin").mergeQualityControlMixin,b.optionalMerge(d("WASmaxOutMessagePublishDeliveryContextMixin").mergeDeliveryContextMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizCampaignMixin").mergeBizCampaignMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizAcceptTsMixin").mergeBizAcceptTsMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizAutoResponseMixin").mergeBizAutoResponseMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizRolesMixin").mergeBizRolesMixin,b.optionalMerge(d("WASmaxOutMessagePublishHsmMixin").mergeHsmMixin,d("WASmaxJsx").smax("message",null),c),e),f),g),h),i),j),k),l),m),n),o),p),q),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizMixin=a}),98);
__d("WASmaxOutMessagePublishClientFrankingTagMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.frankingTagElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("franking",null,d("WASmaxJsx").smax("franking_tag",null,a)));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeClientFrankingTagMixin=a}),98);
__d("WASmaxOutMessagePublishClientReportingTokenMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.reportingTokenV;a=a.reportingTokenElementValue;b=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("reporting",null,d("WASmaxJsx").smax("reporting_token",{v:d("WAWap").INT(b)},a)));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeClientReportingTokenMixin=a}),98);
__d("WASmaxOutMessagePublishDeviceIdentityMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.deviceIdentityElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("device-identity",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeDeviceIdentityMixin=a}),98);
__d("WASmaxOutMessagePublishInternalTestMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.testConfig;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("test",{config:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeInternalTestMixin=a}),98);
__d("WASmaxOutMessagePublishLIDSessionDeprecationMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaDeprecatedLidSession;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{deprecated_lid_session:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeLIDSessionDeprecationMixin=a}),98);
__d("WASmaxOutMessagePublishMessageAssociationTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaMessageAssociationType;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{message_association_type:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMessageAssociationTypeMixin=a}),98);
__d("WASmaxOutMessagePublishMetaHideDecryptionPlaceholderMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("meta",{"decrypt-fail":"hide"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMetaHideDecryptionPlaceholderMixin=a}),98);
__d("WASmaxOutMessagePublishMulticastMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("multicast",null));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMulticastMixin=a}),98);
__d("WASmaxOutMessagePublishNoExtraFanoutMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{device_fanout:"false"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNoExtraFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishAnonPaddingMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.taPadElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("ta_pad",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAnonPaddingMixin=a}),98);
__d("WASmaxOutMessagePublishWireSizePaddingMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.paddingElementValue;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("padding",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeWireSizePaddingMixin=a}),98);
__d("WASmaxOutMessagePublishPaddingMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAnonPaddingMixin","WASmaxOutMessagePublishWireSizePaddingMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.anonPaddingMixinArgs;a=a.wireSizePaddingMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishWireSizePaddingMixin").mergeWireSizePaddingMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishAnonPaddingMixin").mergeAnonPaddingMixin,d("WASmaxJsx").smax("message",null),b),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePaddingMixin=a}),98);
__d("WASmaxOutMessagePublishPreFilledNumberMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("url_number",null));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePreFilledNumberMixin=a}),98);
__d("WASmaxOutMessagePublishPreFilledTextMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("url_text",null));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePreFilledTextMixin=a}),98);
__d("WASmaxOutMessagePublishSenderIntentMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{sender_intent:"hosted"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSenderIntentMixin=a}),98);
__d("WASmaxOutMessagePublishRequestIDMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.requestIdElementValue;a=d("WASmaxJsx").smax("trace",null,d("WASmaxJsx").smax("request_id",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRequestIDMixin=a}),98);
__d("WASmaxOutMessagePublishTraceIDMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.edgeIdElementValue;a=d("WASmaxJsx").smax("edge_id",null,a);return a}function i(a){var b=a.deviceArgs,c=a.correlationIdType;a=a.idElementValue;c=d("WASmaxJsx").smax("correlation_id",{type:d("WAWap").CUSTOM_STRING(c)},d("WASmaxJsx").smax("id",null,a),d("WASmaxChildren").OPTIONAL_CHILD(k,b));return c}function j(a){a=a.observabilityFlagsId;a=d("WASmaxJsx").smax("observability_flags",{id:d("WAWap").INT(a)});return a}function k(a){a=a.deviceId;a=d("WASmaxJsx").smax("device",{id:d("WAWap").INT(a)});return a}function l(a){var b=a.edgeIdArgs,c=a.correlationIdArgs,e=a.observabilityFlagsArgs;a=a.traceIdElementValue;a=d("WASmaxJsx").smax("trace",null,[d("WASmaxJsx").smax("trace_id",null,a),d("WASmaxChildren").OPTIONAL_CHILD(h,b)].concat(d("WASmaxChildren").REPEATED_CHILD(i,c,0,10),[d("WASmaxChildren").OPTIONAL_CHILD(j,e)]));return a}function a(a,b){b=l(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeTraceIDEdgeId=h;g.makeTraceIDCorrelationId=i;g.makeTraceIDObservabilityFlags=j;g.makeTraceIDCorrelationIdDevice=k;g.mergeTraceIDMixin=a}),98);
__d("WASmaxOutMessagePublishRequestOrTraceIDMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishRequestIDMixin","WASmaxOutMessagePublishTraceIDMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.requestID)return d("WASmaxOutMessagePublishRequestIDMixin").mergeRequestIDMixin(a,b.requestID);if(b.traceID)return d("WASmaxOutMessagePublishTraceIDMixin").mergeTraceIDMixin(a,b.traceID);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeRequestOrTraceIDMixinGroup=a}),98);
__d("WASmaxOutMessagePublishTraceContextMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishRequestOrTraceIDMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.requestOrTraceIDMixinGroupArgs;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutMessagePublishRequestOrTraceIDMixinGroup").mergeRequestOrTraceIDMixinGroup(d("WASmaxJsx").smax("trace",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeTraceContextMixin=a}),98);
__d("WASmaxOutMessagePublishVerifiedNameNameMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageVerifiedName;a=d("WASmaxJsx").smax("message",{verified_name:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeVerifiedNameNameMixin=a}),98);
__d("WASmaxOutMessagePublishWebDriverConfigMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaWebdriverConfig;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{webdriver_config:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeWebDriverConfigMixin=a}),98);
__d("WASmaxOutMessagePublishBaseMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAutomatedMixin","WASmaxOutMessagePublishBizMixin","WASmaxOutMessagePublishClientFrankingTagMixin","WASmaxOutMessagePublishClientReportingTokenMixin","WASmaxOutMessagePublishDeviceIdentityMixin","WASmaxOutMessagePublishInternalTestMixin","WASmaxOutMessagePublishLIDSessionDeprecationMixin","WASmaxOutMessagePublishMessageAssociationTypeMixin","WASmaxOutMessagePublishMetaHideDecryptionPlaceholderMixin","WASmaxOutMessagePublishMulticastMixin","WASmaxOutMessagePublishNoExtraFanoutMixin","WASmaxOutMessagePublishPaddingMixin","WASmaxOutMessagePublishPreFilledNumberMixin","WASmaxOutMessagePublishPreFilledTextMixin","WASmaxOutMessagePublishSenderIntentMixin","WASmaxOutMessagePublishTraceContextMixin","WASmaxOutMessagePublishVerifiedNameNameMixin","WASmaxOutMessagePublishWebDriverConfigMixin"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.deviceIdentityMixinArgs,e=a.hasNoExtraFanout,f=a.hasMulticast,g=a.hasPreFilledText,h=a.hasPreFilledNumber,i=a.hasAutomated,j=a.bizMixinArgs,k=a.verifiedNameNameMixinArgs,l=a.clientFrankingTagMixinArgs,m=a.clientReportingTokenMixinArgs,n=a.internalTestMixinArgs,o=a.hasMetaHideDecryptionPlaceholder,p=a.traceContextMixinArgs,q=a.hasSenderIntent,r=a.lIDSessionDeprecationMixinArgs,s=a.paddingMixinArgs,t=a.webDriverConfigMixinArgs;a=a.messageAssociationTypeMixinArgs;b=(b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishMessageAssociationTypeMixin").mergeMessageAssociationTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishWebDriverConfigMixin").mergeWebDriverConfigMixin,b.optionalMerge(d("WASmaxOutMessagePublishPaddingMixin").mergePaddingMixin,b.optionalMerge(d("WASmaxOutMessagePublishLIDSessionDeprecationMixin").mergeLIDSessionDeprecationMixin,b.optionalMerge(d("WASmaxOutMessagePublishSenderIntentMixin").mergeSenderIntentMixin,b.optionalMerge(d("WASmaxOutMessagePublishTraceContextMixin").mergeTraceContextMixin,b.optionalMerge(d("WASmaxOutMessagePublishMetaHideDecryptionPlaceholderMixin").mergeMetaHideDecryptionPlaceholderMixin,b.optionalMerge(d("WASmaxOutMessagePublishInternalTestMixin").mergeInternalTestMixin,b.optionalMerge(d("WASmaxOutMessagePublishClientReportingTokenMixin").mergeClientReportingTokenMixin,b.optionalMerge(d("WASmaxOutMessagePublishClientFrankingTagMixin").mergeClientFrankingTagMixin,b.optionalMerge(d("WASmaxOutMessagePublishVerifiedNameNameMixin").mergeVerifiedNameNameMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizMixin").mergeBizMixin,b.optionalMerge(d("WASmaxOutMessagePublishAutomatedMixin").mergeAutomatedMixin,b.optionalMerge(d("WASmaxOutMessagePublishPreFilledNumberMixin").mergePreFilledNumberMixin,b.optionalMerge(d("WASmaxOutMessagePublishPreFilledTextMixin").mergePreFilledTextMixin,b.optionalMerge(d("WASmaxOutMessagePublishMulticastMixin").mergeMulticastMixin,b.optionalMerge(d("WASmaxOutMessagePublishNoExtraFanoutMixin").mergeNoExtraFanoutMixin,b.optionalMerge(d("WASmaxOutMessagePublishDeviceIdentityMixin").mergeDeviceIdentityMixin,d("WASmaxJsx").smax("message",null),c),e),f),g),h),i),j),k),l),m),n),o),p),q),r),s),t),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseMixin=a}),98);
__d("WASmaxOutMessagePublishGroupInviteTargetMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaGroupInvite;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{group_invite:d("WAWap").GROUP_JID(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeGroupInviteTargetMixin=a}),98);
__d("WASmaxOutMessagePublishBotFeedbackMessageTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("bot",{type:"feedback"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotFeedbackMessageTypeMixin=a}),98);
__d("WASmaxOutMessagePublishEncRetryMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encCount;a=d("WASmaxJsx").smax("enc",{count:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncRetryMixin=a}),98);
__d("WASmaxOutMessagePublishEncPayloadMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.encElementValue;a=d("WASmaxJsx").smax("enc",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncPayloadMixin=a}),98);
__d("WASmaxOutMessagePublishEncTypeIndividualMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncPayloadMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encType;b=d("WASmaxOutMessagePublishEncPayloadMixin").mergeEncPayloadMixin(d("WASmaxJsx").smax("enc",{type:d("WAWap").CUSTOM_STRING(b)}),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncTypeIndividualMixin=a}),98);
__d("WASmaxOutMessagePublishEncVersion2Mixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("enc",{v:"2"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncVersion2Mixin=a}),98);
__d("WASmaxOutMessagePublishEncVersionFutureproofMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encV;a=d("WASmaxJsx").smax("enc",{v:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncVersionFutureproofMixin=a}),98);
__d("WASmaxOutMessagePublishEncVersionBot",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncVersion2Mixin","WASmaxOutMessagePublishEncVersionFutureproofMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isEncVersion2)return d("WASmaxOutMessagePublishEncVersion2Mixin").mergeEncVersion2Mixin(a);if(b.encVersionFutureproof)return d("WASmaxOutMessagePublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(a,b.encVersionFutureproof);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeEncVersionBot=a}),98);
__d("WASmaxOutMessagePublishMediaTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encMediatype;a=d("WASmaxJsx").smax("enc",{mediatype:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMediaTypeMixin=a}),98);
__d("WASmaxOutMessagePublishBotRequestMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncRetryMixin","WASmaxOutMessagePublishEncTypeIndividualMixin","WASmaxOutMessagePublishEncVersionBot","WASmaxOutMessagePublishMediaTypeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.toJid,c=a.encRetryMixinArgs,e=a.encTypeIndividualMixinArgs,f=a.mediaTypeMixinArgs;a=a.encVersionBotArgs;b=d("WASmaxJsx").smax("to",{jid:d("WAWap").JID(b)},d("WASmaxOutMessagePublishEncVersionBot").mergeEncVersionBot(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishMediaTypeMixin").mergeMediaTypeMixin,d("WASmaxOutMessagePublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishEncRetryMixin").mergeEncRetryMixin,d("WASmaxJsx").smax("enc",null),c),e),f),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotRequestMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"media"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeMediaMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeTextMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"text"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeTextMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeTextOrMediaMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishContentTypeTextMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeText)return d("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(a);if(b.isContentTypeMedia)return d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentTypeTextOrMediaMixinGroup=a}),98);
__d("WASmaxOutMessagePublishBotMetricsEntryPointMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaOrigin;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{origin:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotMetricsEntryPointMixin=a}),98);
__d("WASmaxOutMessagePublishBotLocalAutomatedTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.botLocalAutomatedType;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("bot",{local_automated_type:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotLocalAutomatedTypeMixin=a}),98);
__d("WASmaxOutMessagePublishBotMessageTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.botType;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("bot",{type:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotMessageTypeMixin=a}),98);
__d("WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaThreadOrigin;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{thread_origin:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotMetricsThreadEntryPointMixin=a}),98);
__d("WASmaxOutMessagePublishBotPersonaTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.botPersonaType;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("bot",{persona_type:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotPersonaTypeMixin=a}),98);
__d("WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.botFeedbackRequested;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("bot",{feedback_requested:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBusinessBotMessageFeedbackRequestedMixin=a}),98);
__d("WASmaxOutMessagePublishBusinessBotMessageMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.botBizBot;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("bot",{biz_bot:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBusinessBotMessageMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeEventMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaEventType;a=d("WASmaxJsx").smax("message",{type:"event"},d("WASmaxJsx").smax("meta",{event_type:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeEventMixin=a}),98);
__d("WASmaxOutMessagePublishProductListMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("list",{type:"product_list"})));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeProductListMixin=a}),98);
__d("WASmaxOutMessagePublishSingleSelectListMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.listV;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("list",{type:"single_select",v:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)})));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSingleSelectListMixin=a}),98);
__d("WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishProductListMixin","WASmaxOutMessagePublishSingleSelectListMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.singleSelectList)return d("WASmaxOutMessagePublishSingleSelectListMixin").mergeSingleSelectListMixin(a,b.singleSelectList);if(b.isProductList)return d("WASmaxOutMessagePublishProductListMixin").mergeProductListMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeSingleSelectOrProductListMixinGroup=a}),98);
__d("WASmaxOutMessagePublishContentTypeListFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:"list"}));return a}function i(a){var b=a.toCount;a=a.singleSelectOrProductListMixinGroupArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup").mergeSingleSelectOrProductListMixinGroup,d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").HOMOGENEOUS_CHILD_COUNT(h,b)))),a);return b}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeContentTypeListFanoutParticipantsTo=h;g.mergeContentTypeListFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishLiveLocationModeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaLivelocMode;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{liveloc_mode:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeLiveLocationModeMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeLiveLocationFanoutMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishLiveLocationModeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encDuration;a=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,a)}));return a}function i(a){var b=a.toArgs;a=a.liveLocationModeMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishLiveLocationModeMixin").mergeLiveLocationModeMixin,d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").HOMOGENEOUS_CHILD(h,b)))),a);return b}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeContentTypeLiveLocationFanoutParticipantsTo=h;g.mergeContentTypeLiveLocationFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMedianotifyMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"medianotify"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeMedianotifyMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishContentTypeMedianotifyMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeMedia)return d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(a);if(b.isContentTypeMedianotify)return d("WASmaxOutMessagePublishContentTypeMedianotifyMixin").mergeContentTypeMedianotifyMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentTypeMediaOrMedianotifyMixinGroup=a}),98);
__d("WASmaxOutMessagePublishSenderContentBindingMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.senderContentBindingElementValue;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("sender_content_binding",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSenderContentBindingMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaFanoutDeprecatedMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup","WASmaxOutMessagePublishSenderContentBindingMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encMediatype,c=a.hasEncStickerTypeAvatar;a=a.encNativeFlowName;b=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b),sticker_type:d("WASmaxAttrs").OPTIONAL_LITERAL("avatar",c),native_flow_name:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return b}function i(a){var b=a.toArgs,c=a.senderContentBindingMixinArgs;a=a.contentTypeMediaOrMedianotifyMixinGroupArgs;b=d("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup").mergeContentTypeMediaOrMedianotifyMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSenderContentBindingMixin").mergeSenderContentBindingMixin,d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").HOMOGENEOUS_CHILD(h,b))),c),a);return b}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeContentTypeMediaFanoutDeprecatedParticipantsTo=h;g.mergeContentTypeMediaFanoutDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaFanoutMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup","WASmaxOutMessagePublishSenderContentBindingMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encMediatype,c=a.hasEncStickerTypeAvatar;a=a.encNativeFlowName;b=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:d("WAWap").CUSTOM_STRING(b),sticker_type:d("WASmaxAttrs").OPTIONAL_LITERAL("avatar",c),native_flow_name:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return b}function i(a){var b=a.toArgs,c=a.senderContentBindingMixinArgs;a=a.contentTypeMediaOrMedianotifyMixinGroupArgs;b=d("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup").mergeContentTypeMediaOrMedianotifyMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSenderContentBindingMixin").mergeSenderContentBindingMixin,d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").HOMOGENEOUS_CHILD(h,b))),c),a);return b}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeContentTypeMediaFanoutParticipantsTo=h;g.mergeContentTypeMediaFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypePollCreationMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaContenttype;a=d("WASmaxJsx").smax("message",{type:"poll"},d("WASmaxJsx").smax("meta",{polltype:"creation",contenttype:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypePollCreationMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypePollResultSnapshotMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"poll"},d("WASmaxJsx").smax("meta",{polltype:"result_snapshot"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypePollResultSnapshotMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypePollVoteMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaContenttype;a=d("WASmaxJsx").smax("message",{type:"poll"},d("WASmaxJsx").smax("meta",{polltype:"vote",contenttype:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypePollVoteMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeReactionMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"reaction"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeReactionMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypePayMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"pay"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypePayMixin=a}),98);
__d("WASmaxOutMessagePublishPayNodeTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.payType;a=d("WASmaxJsx").smax("pay",{type:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePayNodeTypeMixin=a}),98);
__d("WASmaxOutMessagePublishBasePayNodeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishPayNodeTypeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.payCountry,c=a.payVersion,e=a.payIsFirstSend;b=d("WASmaxOutMessagePublishPayNodeTypeMixin").mergePayNodeTypeMixin(d("WASmaxJsx").smax("pay",{country:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b),version:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,c),is_first_send:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,e)}),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBasePayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishLegacyAmountMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.payCurrency;a=a.payAmount;b=d("WASmaxJsx").smax("pay",{currency:d("WAWap").CUSTOM_STRING(b),amount:d("WAWap").CUSTOM_STRING(a)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeLegacyAmountMixin=a}),98);
__d("WASmaxOutMessagePublishMoneyMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.moneyValue,c=a.moneyOffset;a=a.moneyCurrency;b=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("money",{value:d("WAWap").CUSTOM_STRING(b),offset:d("WAWap").CUSTOM_STRING(c),currency:d("WAWap").CUSTOM_STRING(a)}));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMoneyMixin=a}),98);
__d("WASmaxOutMessagePublishBaseIndividualPublishSendPayNodeMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBasePayNodeMixin","WASmaxOutMessagePublishLegacyAmountMixin","WASmaxOutMessagePublishMoneyMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishMoneyMixin").mergeMoneyMixin(d("WASmaxJsx").smax("amount",null),a);return a}function i(a){var b=a.amountArgs,c=a.payCredentialId,e=a.payDeviceId,f=a.payRequestId,g=a.legacyAmountMixinArgs;c=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishLegacyAmountMixin").mergeLegacyAmountMixin,d("WASmaxOutMessagePublishBasePayNodeMixin").mergeBasePayNodeMixin(d("WASmaxJsx").smax("pay",{"credential-id":d("WAWap").CUSTOM_STRING(c),"device-id":d("WAWap").CUSTOM_STRING(e),"request-id":d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,f)},d("WASmaxChildren").OPTIONAL_CHILD(h,b)),a),g);return c}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeBaseIndividualPublishSendPayNodeAmount=h;g.mergeBaseIndividualPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishInstallmentMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishMoneyMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishMoneyMixin").mergeMoneyMixin(d("WASmaxJsx").smax("due_amount",null),a);return a}function i(a){a=d("WASmaxOutMessagePublishMoneyMixin").mergeMoneyMixin(d("WASmaxJsx").smax("interest",null),a);return a}function j(a){var b=a.dueAmountArgs,c=a.interestArgs,e=a.installmentMaxCount;a=a.installmentSelectedCount;e=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("installment",{max_count:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,e),selected_count:d("WAWap").INT(a)},d("WASmaxChildren").OPTIONAL_CHILD(h,b),d("WASmaxChildren").OPTIONAL_CHILD(i,c)));return e}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeInstallmentInstallmentDueAmount=h;g.makeInstallmentInstallmentInterest=i;g.mergeInstallmentMixin=a}),98);
__d("WASmaxOutMessagePublishBeneficiaryMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.beneficiaryName,e=a.beneficiaryAddressLine1,f=a.beneficiaryAddressLine2,g=a.beneficiaryCity,h=a.beneficiaryState,i=a.beneficiaryPhoneNumber,j=a.beneficiaryCountry;a=a.beneficiaryPostalCode;e=d("WASmaxJsx").smax("beneficiary",{name:(b=d("WAWap")).CUSTOM_STRING(c),address_line1:b.CUSTOM_STRING(e),address_line2:(c=d("WASmaxAttrs")).OPTIONAL(b.CUSTOM_STRING,f),city:c.OPTIONAL(b.CUSTOM_STRING,g),state:c.OPTIONAL(b.CUSTOM_STRING,h),phone_number:c.OPTIONAL(b.CUSTOM_STRING,i),country:b.CUSTOM_STRING(j),postal_code:b.CUSTOM_STRING(a)});return e}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBeneficiaryMixin=a}),98);
__d("WASmaxOutMessagePublishBeneficiariesMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBeneficiaryMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishBeneficiaryMixin").mergeBeneficiaryMixin(d("WASmaxJsx").smax("beneficiary",null),a);return a}function i(a){a=a.beneficiaryArgs;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxChildren").REPEATED_CHILD(h,a,1,5));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeBeneficiariesBeneficiary=h;g.mergeBeneficiariesMixin=a}),98);
__d("WASmaxOutMessagePublishOrderInPaymentMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBeneficiariesMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishBeneficiariesMixin").mergeBeneficiariesMixin(d("WASmaxJsx").smax("beneficiaries",null),a);return a}function i(a){var b,c=a.beneficiariesArgs,e=a.orderId,f=a.orderMessageId,g=a.orderPaymentConfigId;a=a.orderType;e=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("order",{id:(b=d("WAWap")).CUSTOM_STRING(e),message_id:d("WASmaxAttrs").OPTIONAL(b.STANZA_ID,f),payment_config_id:d("WASmaxAttrs").OPTIONAL(b.CUSTOM_STRING,g),type:d("WASmaxAttrs").OPTIONAL(b.CUSTOM_STRING,a)},d("WASmaxChildren").OPTIONAL_CHILD(h,c)));return e}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeOrderInPaymentOrderBeneficiaries=h;g.mergeOrderInPaymentMixin=a}),98);
__d("WASmaxOutMessagePublishPaymentInitiatorMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyPaymentInitiator;a=d("WASmaxJsx").smax("smax$any",{payment_initiator:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePaymentInitiatorMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeP2MMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishInstallmentMixin","WASmaxOutMessagePublishOrderInPaymentMixin","WASmaxOutMessagePublishPaymentInitiatorMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.orderInPaymentMixinArgs,c=a.paymentInitiatorMixinArgs;a=a.installmentMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishInstallmentMixin").mergeInstallmentMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishPaymentInitiatorMixin").mergePaymentInitiatorMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishOrderInPaymentMixin").mergeOrderInPaymentMixin,d("WASmaxJsx").smax("pay",{"transaction-type":"p2m"}),b),c),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBRPublishSendPayNodeP2MMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeP2PMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("pay",{"transaction-type":"p2p"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBRPublishSendPayNodeP2PMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishBRPublishSendPayNodeP2MMixin","WASmaxOutMessagePublishBRPublishSendPayNodeP2PMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isBRPublishSendPayNodeP2P)return d("WASmaxOutMessagePublishBRPublishSendPayNodeP2PMixin").mergeBRPublishSendPayNodeP2PMixin(a);if(b.bRPublishSendPayNodeP2M)return d("WASmaxOutMessagePublishBRPublishSendPayNodeP2MMixin").mergeBRPublishSendPayNodeP2MMixin(a,b.bRPublishSendPayNodeP2M);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeBRPublishSendPayNodeP2POrMMixinGroup=a}),98);
__d("WASmaxOutMessagePublishBRSendPayEloNodeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.eloDeviceSignature,e=a.eloWalletSignature,f=a.eloChallengeId;a=a.eloCardholderVerificationMethod;c=d("WASmaxJsx").smax("pay",null,d("WASmaxJsx").smax("elo",{device_signature:(b=d("WAWap")).CUSTOM_STRING(c),wallet_signature:b.CUSTOM_STRING(e),challenge_id:b.CUSTOM_STRING(f),cardholder_verification_method:b.CUSTOM_STRING(a)}));return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBRSendPayEloNodeMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup","WASmaxOutMessagePublishBRSendPayEloNodeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.payId,e=a.payPaymentRails,f=a.payTrustedDeviceInfo,g=a.payNonce,h=a.bRSendPayEloNodeMixinArgs;a=a.bRPublishSendPayNodeP2POrMMixinGroupArgs;c=d("WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup").mergeBRPublishSendPayNodeP2POrMMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishBRSendPayEloNodeMixin").mergeBRSendPayEloNodeMixin,d("WASmaxJsx").smax("pay",{id:(b=d("WAWap")).CUSTOM_STRING(c),"payment-rails":b.CUSTOM_STRING(e),"trusted-device-info":b.CUSTOM_STRING(f),nonce:b.CUSTOM_STRING(g)}),h),a);return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBRPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishUPILiteDetailsMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.upiLiteDetailsLiteReferenceNumber,e=a.upiLiteDetailsLiteArqc,f=a.upiLiteDetailsLiteTimestamp;a=a.upiLiteDetailsLitePurpose;c=d("WASmaxJsx").smax("upi_lite_details",{lite_reference_number:(b=d("WAWap")).CUSTOM_STRING(c),lite_arqc:b.CUSTOM_STRING(e),lite_timestamp:b.INT(f),lite_purpose:b.CUSTOM_STRING(a)});return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeUPILiteDetailsMixin=a}),98);
__d("WASmaxOutMessagePublishOrderMessageMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.orderOrderId,e=a.orderOrderMessageId,f=a.orderExpiryTs,g=a.orderOrderType;a=a.orderDiscountProgramName;e=d("WASmaxJsx").smax("order",{"order-id":(b=d("WAWap")).CUSTOM_STRING(c),"order-message-id":(c=d("WASmaxAttrs")).OPTIONAL(b.CUSTOM_STRING,e),"expiry-ts":c.OPTIONAL(b.INT,f),"order-type":c.OPTIONAL(b.CUSTOM_STRING,g),"discount-program-name":c.OPTIONAL(b.CUSTOM_STRING,a)});return e}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeOrderMessageMixin=a}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2MMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishOrderMessageMixin","WASmaxOutMessagePublishPaymentInitiatorMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.orderArgs;a=a.paymentLinkArgs;b=d("WASmaxJsx").smax("upi",null,d("WASmaxChildren").OPTIONAL_CHILD(i,b),d("WASmaxChildren").OPTIONAL_CHILD(j,a));return b}function i(a){a=d("WASmaxOutMessagePublishOrderMessageMixin").mergeOrderMessageMixin(d("WASmaxJsx").smax("order",null),a);return a}function j(a){var b=a.paymentLinkOrderId;a=a.paymentLinkMessageId;b=d("WASmaxJsx").smax("payment_link",{order_id:d("WAWap").CUSTOM_STRING(b),message_id:d("WAWap").CUSTOM_STRING(a)});return b}function k(a){var b=a.upiArgs;a=a.paymentInitiatorMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishPaymentInitiatorMixin").mergePaymentInitiatorMixin,d("WASmaxJsx").smax("pay",{"transaction-type":"p2m"},d("WASmaxChildren").OPTIONAL_CHILD(h,b)),a);return b}function a(a,b){b=k(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeUPIPublishSendPayNodeP2MUpi=h;g.makeUPIPublishSendPayNodeP2MUpiOrder=i;g.makeUPIPublishSendPayNodeP2MUpiPaymentLink=j;g.mergeUPIPublishSendPayNodeP2MMixin=a}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2PMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.hasPayTransactionTypeP2P;a=d("WASmaxJsx").smax("pay",{"transaction-type":d("WASmaxAttrs").OPTIONAL_LITERAL("p2p",a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeUPIPublishSendPayNodeP2PMixin=a}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2POrMMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishUPIPublishSendPayNodeP2MMixin","WASmaxOutMessagePublishUPIPublishSendPayNodeP2PMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.uPIPublishSendPayNodeP2P)return d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2PMixin").mergeUPIPublishSendPayNodeP2PMixin(a,b.uPIPublishSendPayNodeP2P);if(b.uPIPublishSendPayNodeP2M)return d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2MMixin").mergeUPIPublishSendPayNodeP2MMixin(a,b.uPIPublishSendPayNodeP2M);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeUPIPublishSendPayNodeP2POrMMixinGroup=a}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishUPILiteDetailsMixin","WASmaxOutMessagePublishUPIPublishSendPayNodeP2POrMMixinGroup","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.upiLiteDetailsArgs;a=a.upiToken;a=d("WASmaxJsx").smax("upi",{token:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)},d("WASmaxChildren").OPTIONAL_CHILD(i,b));return a}function i(a){a=d("WASmaxOutMessagePublishUPILiteDetailsMixin").mergeUPILiteDetailsMixin(d("WASmaxJsx").smax("upi_lite_details",null),a);return a}function j(a){var b,c,e=a.upiArgs,f=a.payId,g=a.payMpin,i=a.payReceiverVpa,j=a.payReceiverVpaId,k=a.paySenderVpa,l=a.paySenderVpaId,m=a.paySeqNo,n=a.payUpiBankInfo,o=a.payMode,p=a.payPurposeCode,q=a.payMcc,r=a.payRefId,s=a.payDeviceSsid,t=a.payNote;a=a.uPIPublishSendPayNodeP2POrMMixinGroupArgs;f=d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2POrMMixinGroup").mergeUPIPublishSendPayNodeP2POrMMixinGroup(d("WASmaxJsx").smax("pay",{id:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).CUSTOM_STRING,f),mpin:b.OPTIONAL(c.CUSTOM_STRING,g),"receiver-vpa":c.CUSTOM_STRING(i),"receiver-vpa-id":b.OPTIONAL(c.CUSTOM_STRING,j),"sender-vpa":c.CUSTOM_STRING(k),"sender-vpa-id":b.OPTIONAL(c.CUSTOM_STRING,l),"seq-no":c.CUSTOM_STRING(m),"upi-bank-info":c.CUSTOM_STRING(n),mode:b.OPTIONAL(c.CUSTOM_STRING,o),"purpose-code":b.OPTIONAL(c.CUSTOM_STRING,p),mcc:b.OPTIONAL(c.CUSTOM_STRING,q),"ref-id":b.OPTIONAL(c.CUSTOM_STRING,r),device_ssid:b.OPTIONAL(c.CUSTOM_STRING,s),note:b.OPTIONAL(c.CUSTOM_STRING,t)},d("WASmaxChildren").OPTIONAL_CHILD(h,e)),a);return f}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeUPIPublishSendPayNodeUpi=h;g.makeUPIPublishSendPayNodeUpiUpiLiteDetails=i;g.mergeUPIPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishOrUPIPublishSendPayNodeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishBRPublishSendPayNodeMixin","WASmaxOutMessagePublishUPIPublishSendPayNodeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.bRPublishSendPayNode)return d("WASmaxOutMessagePublishBRPublishSendPayNodeMixin").mergeBRPublishSendPayNodeMixin(a,b.bRPublishSendPayNode);if(b.uPIPublishSendPayNode)return d("WASmaxOutMessagePublishUPIPublishSendPayNodeMixin").mergeUPIPublishSendPayNodeMixin(a,b.uPIPublishSendPayNode);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeBRPublishOrUPIPublishSendPayNodeMixinGroup=a}),98);
__d("WASmaxOutMessagePublishIntegrationPublishPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBRPublishOrUPIPublishSendPayNodeMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.bRPublishOrUPIPublishSendPayNodeMixinGroupArgs;a=d("WASmaxOutMessagePublishBRPublishOrUPIPublishSendPayNodeMixinGroup").mergeBRPublishOrUPIPublishSendPayNodeMixinGroup(d("WASmaxJsx").smax("pay",null),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIntegrationPublishPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualNonNoviPublishSendPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBaseIndividualPublishSendPayNodeMixin","WASmaxOutMessagePublishIntegrationPublishPayNodeMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishIntegrationPublishPayNodeMixin").mergeIntegrationPublishPayNodeMixin(d("WASmaxOutMessagePublishBaseIndividualPublishSendPayNodeMixin").mergeBaseIndividualPublishSendPayNodeMixin(d("WASmaxJsx").smax("pay",null),a),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualNonNoviPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualPublishSendPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualNonNoviPublishSendPayNodeMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishIndividualNonNoviPublishSendPayNodeMixin").mergeIndividualNonNoviPublishSendPayNodeMixin(d("WASmaxJsx").smax("pay",null),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualRequestPayNodeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBasePayNodeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.paySender,c=a.payExpiryTs,e=a.payRequestId;b=d("WASmaxOutMessagePublishBasePayNodeMixin").mergeBasePayNodeMixin(d("WASmaxJsx").smax("pay",{sender:d("WASmaxAttrs").OPTIONAL(d("WAWap").USER_JID,b),"expiry-ts":d("WAWap").CUSTOM_STRING(c),"request-id":d("WAWap").CUSTOM_STRING(e)}),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualRequestPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishPayInviteNodeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.payService;a=d("WASmaxJsx").smax("pay",{type:"invite",service:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePayInviteNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishIndividualPublishSendPayNodeMixin","WASmaxOutMessagePublishIndividualRequestPayNodeMixin","WASmaxOutMessagePublishPayInviteNodeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.individualPublishSendPayNode)return d("WASmaxOutMessagePublishIndividualPublishSendPayNodeMixin").mergeIndividualPublishSendPayNodeMixin(a,b.individualPublishSendPayNode);if(b.individualRequestPayNode)return d("WASmaxOutMessagePublishIndividualRequestPayNodeMixin").mergeIndividualRequestPayNodeMixin(a,b.individualRequestPayNode);if(b.payInviteNode)return d("WASmaxOutMessagePublishPayInviteNodeMixin").mergePayInviteNodeMixin(a,b.payInviteNode);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup=a}),98);
__d("WASmaxOutMessagePublishIndividualPublishPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.individualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroupArgs;a=d("WASmaxOutMessagePublishIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup").mergeIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup(d("WASmaxJsx").smax("pay",null),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualPublishPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualPublishPayNodeMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualPublishPayNodeMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishIndividualPublishPayNodeMixin").mergeIndividualPublishPayNodeMixin(d("WASmaxJsx").smax("pay",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualPublishPayNodeMessageMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypePayMixin","WASmaxOutMessagePublishIndividualIndividualPublishPayNodeMessageMixin"],(function(a,b,c,d,e,f,g){function h(a){a=a.individualIndividualPublishPayNodeMessageMixinArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualPublishPayNodeMessageMixin").mergeIndividualIndividualPublishPayNodeMessageMixin,d("WASmaxOutMessagePublishContentTypePayMixin").mergeContentTypePayMixin(d("WASmaxJsx").smax("message",null)),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualContentTypePayIndividualMixin=a}),98);
__d("WASmaxOutMessagePublishContentFanoutMixins",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeEventMixin","WASmaxOutMessagePublishContentTypeListFanoutMixin","WASmaxOutMessagePublishContentTypeLiveLocationFanoutMixin","WASmaxOutMessagePublishContentTypeMediaFanoutDeprecatedMixin","WASmaxOutMessagePublishContentTypeMediaFanoutMixin","WASmaxOutMessagePublishContentTypeMedianotifyMixin","WASmaxOutMessagePublishContentTypePollCreationMixin","WASmaxOutMessagePublishContentTypePollResultSnapshotMixin","WASmaxOutMessagePublishContentTypePollVoteMixin","WASmaxOutMessagePublishContentTypeReactionMixin","WASmaxOutMessagePublishContentTypeTextMixin","WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeText)return d("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(a);if(b.contentTypeMediaFanout)return d("WASmaxOutMessagePublishContentTypeMediaFanoutMixin").mergeContentTypeMediaFanoutMixin(a,b.contentTypeMediaFanout);if(b.contentTypeMediaFanoutDeprecated)return d("WASmaxOutMessagePublishContentTypeMediaFanoutDeprecatedMixin").mergeContentTypeMediaFanoutDeprecatedMixin(a,b.contentTypeMediaFanoutDeprecated);if(b.contentTypeLiveLocationFanout)return d("WASmaxOutMessagePublishContentTypeLiveLocationFanoutMixin").mergeContentTypeLiveLocationFanoutMixin(a,b.contentTypeLiveLocationFanout);if(b.individualContentTypePayIndividual)return d("WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin").mergeIndividualContentTypePayIndividualMixin(a,b.individualContentTypePayIndividual);if(b.contentTypeListFanout)return d("WASmaxOutMessagePublishContentTypeListFanoutMixin").mergeContentTypeListFanoutMixin(a,b.contentTypeListFanout);if(b.isContentTypeReaction)return d("WASmaxOutMessagePublishContentTypeReactionMixin").mergeContentTypeReactionMixin(a);if(b.contentTypePollCreation)return d("WASmaxOutMessagePublishContentTypePollCreationMixin").mergeContentTypePollCreationMixin(a,b.contentTypePollCreation);if(b.contentTypePollVote)return d("WASmaxOutMessagePublishContentTypePollVoteMixin").mergeContentTypePollVoteMixin(a,b.contentTypePollVote);if(b.isContentTypePollResultSnapshot)return d("WASmaxOutMessagePublishContentTypePollResultSnapshotMixin").mergeContentTypePollResultSnapshotMixin(a);if(b.isContentTypeMedianotify)return d("WASmaxOutMessagePublishContentTypeMedianotifyMixin").mergeContentTypeMedianotifyMixin(a);if(b.contentTypeEvent)return d("WASmaxOutMessagePublishContentTypeEventMixin").mergeContentTypeEventMixin(a,b.contentTypeEvent);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentFanoutMixins=a}),98);
__d("WASmaxOutMessagePublishLidChatOriginMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{origin:"ctwa"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeLidChatOriginMixin=a}),98);
__d("WASmaxOutMessagePublishMsgMetaOriginMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaOrigin;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{origin:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMsgMetaOriginMixin=a}),98);
__d("WASmaxOutMessagePublishPeripheralOriginMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaPeripheral;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{peripheral:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePeripheralOriginMixin=a}),98);
__d("WASmaxOutMessagePublishTDeprecatedMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageT;a=d("WASmaxJsx").smax("message",{t:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeTDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishToContentBindingMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.toJid;a=a.contentBindingElementValue;b=d("WASmaxJsx").smax("to",{jid:d("WAWap").JID(b)},d("WASmaxJsx").smax("content_binding",null,a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeToContentBindingMixin=a}),98);
__d("WASmaxOutMessagePublishAvatarStickerTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("enc",{sticker_type:"avatar"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAvatarStickerTypeMixin=a}),98);
__d("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAvatarStickerTypeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encMediatype,c=a.encNativeFlowName;a=a.hasAvatarStickerType;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishAvatarStickerTypeMixin").mergeAvatarStickerTypeMixin,d("WASmaxJsx").smax("enc",{mediatype:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b),native_flow_name:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,c)}),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncMediaTypeDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishEncVersion3Mixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("enc",{v:"3"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncVersion3Mixin=a}),98);
__d("WASmaxOutMessagePublishEncVersion",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncVersion2Mixin","WASmaxOutMessagePublishEncVersion3Mixin","WASmaxOutMessagePublishEncVersionFutureproofMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isEncVersion2)return d("WASmaxOutMessagePublishEncVersion2Mixin").mergeEncVersion2Mixin(a);if(b.isEncVersion3)return d("WASmaxOutMessagePublishEncVersion3Mixin").mergeEncVersion3Mixin(a);if(b.encVersionFutureproof)return d("WASmaxOutMessagePublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(a,b.encVersionFutureproof);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeEncVersion=a}),98);
__d("WASmaxOutMessagePublishToDeviceMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin","WASmaxOutMessagePublishEncTypeIndividualMixin","WASmaxOutMessagePublishEncVersion","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.toJid,c=a.encTypeIndividualMixinArgs,e=a.encMediaTypeDeprecatedMixinArgs;a=a.encVersionArgs;b=d("WASmaxJsx").smax("to",{jid:d("WAWap").JID(b)},d("WASmaxOutMessagePublishEncVersion").mergeEncVersion(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin").mergeEncMediaTypeDeprecatedMixin,d("WASmaxOutMessagePublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(d("WASmaxJsx").smax("enc",null),c),e),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeToDeviceMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotLocalAutomatedTypeMixin","WASmaxOutMessagePublishBotMessageTypeMixin","WASmaxOutMessagePublishBotMetricsEntryPointMixin","WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin","WASmaxOutMessagePublishBotPersonaTypeMixin","WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin","WASmaxOutMessagePublishBusinessBotMessageMixin","WASmaxOutMessagePublishContentFanoutMixins","WASmaxOutMessagePublishLidChatOriginMixin","WASmaxOutMessagePublishMsgMetaOriginMixin","WASmaxOutMessagePublishPeripheralOriginMixin","WASmaxOutMessagePublishTDeprecatedMixin","WASmaxOutMessagePublishToContentBindingMixin","WASmaxOutMessagePublishToDeviceMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.toContentBindingMixinArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishToContentBindingMixin").mergeToContentBindingMixin,d("WASmaxOutMessagePublishToDeviceMixin").mergeToDeviceMixin(d("WASmaxJsx").smax("to",null),a),b);return a}function a(){var a=d("WASmaxJsx").smax("enc",null);return a}function i(a){var b,c=a.toArgs,e=a.messageTo,f=a.tDeprecatedMixinArgs,g=a.botMessageTypeMixinArgs,i=a.businessBotMessageMixinArgs,j=a.botMetricsEntryPointMixinArgs,k=a.botMetricsThreadEntryPointMixinArgs,l=a.msgMetaOriginMixinArgs,m=a.hasLidChatOrigin,n=a.botLocalAutomatedTypeMixinArgs,o=a.businessBotMessageFeedbackRequestedMixinArgs,p=a.botPersonaTypeMixinArgs,q=a.peripheralOriginMixinArgs;a=a.contentFanoutMixinsArgs;b=d("WASmaxOutMessagePublishContentFanoutMixins").mergeContentFanoutMixins((b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishPeripheralOriginMixin").mergePeripheralOriginMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotPersonaTypeMixin").mergeBotPersonaTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin").mergeBusinessBotMessageFeedbackRequestedMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotLocalAutomatedTypeMixin").mergeBotLocalAutomatedTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishLidChatOriginMixin").mergeLidChatOriginMixin,b.optionalMerge(d("WASmaxOutMessagePublishMsgMetaOriginMixin").mergeMsgMetaOriginMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin").mergeBotMetricsThreadEntryPointMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotMetricsEntryPointMixin").mergeBotMetricsEntryPointMixin,b.optionalMerge(d("WASmaxOutMessagePublishBusinessBotMessageMixin").mergeBusinessBotMessageMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotMessageTypeMixin").mergeBotMessageTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishTDeprecatedMixin").mergeTDeprecatedMixin,d("WASmaxJsx").smax("message",{to:d("WAWap").JID(e)},d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").REPEATED_CHILD(h,c,1,1997))),f),g),i),j),k),l),m),n),o),p),q),a);return b}function b(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeIndividualIndividualFanoutParticipantsTo=h;g.makeIndividualIndividualFanoutEnc=a;g.mergeIndividualIndividualFanoutMixin=b}),98);
__d("WASmaxOutMessagePublishEncListMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("enc",{mediatype:"list"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncListMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeListMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishEncListMixin","WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.singleSelectOrProductListMixinGroupArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup").mergeSingleSelectOrProductListMixinGroup,d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishEncListMixin").mergeEncListMixin(d("WASmaxJsx").smax("enc",null)))),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeListMixin=a}),98);
__d("WASmaxOutMessagePublishEncLiveLocationDeprecatedMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encDuration;a=d("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncLiveLocationDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishEncLiveLocationMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encDuration;a=d("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncLiveLocationMixin=a}),98);
__d("WASmaxOutMessagePublishEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncLiveLocationDeprecatedMixin","WASmaxOutMessagePublishEncLiveLocationMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.encLiveLocation)return d("WASmaxOutMessagePublishEncLiveLocationMixin").mergeEncLiveLocationMixin(a,b.encLiveLocation);if(b.encLiveLocationDeprecated)return d("WASmaxOutMessagePublishEncLiveLocationDeprecatedMixin").mergeEncLiveLocationDeprecatedMixin(a,b.encLiveLocationDeprecated);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup=a}),98);
__d("WASmaxOutMessagePublishContentTypeLiveLocationSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup","WASmaxOutMessagePublishLiveLocationModeMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.liveLocationModeMixinArgs;a=a.encLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroupArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishLiveLocationModeMixin").mergeLiveLocationModeMixin,d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup").mergeEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup(d("WASmaxJsx").smax("enc",null),a))),b);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeLiveLocationSingleMixin=a}),98);
__d("WASmaxOutMessagePublishEncMediaTypeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAvatarStickerTypeMixin","WASmaxOutMessagePublishMediaTypeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encNativeFlowName,c=a.hasAvatarStickerType;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishAvatarStickerTypeMixin").mergeAvatarStickerTypeMixin,d("WASmaxOutMessagePublishMediaTypeMixin").mergeMediaTypeMixin(d("WASmaxJsx").smax("enc",{native_flow_name:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b)}),a),c);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncMediaTypeMixin=a}),98);
__d("WASmaxOutMessagePublishEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin","WASmaxOutMessagePublishEncMediaTypeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.encMediaType)return d("WASmaxOutMessagePublishEncMediaTypeMixin").mergeEncMediaTypeMixin(a,b.encMediaType);if(b.encMediaTypeDeprecated)return d("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin").mergeEncMediaTypeDeprecatedMixin(a,b.encMediaTypeDeprecated);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup","WASmaxOutMessagePublishEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup","WASmaxOutMessagePublishSenderContentBindingMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.senderContentBindingMixinArgs,c=a.contentTypeMediaOrMedianotifyMixinGroupArgs;a=a.encMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroupArgs;a=d("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup").mergeContentTypeMediaOrMedianotifyMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSenderContentBindingMixin").mergeSenderContentBindingMixin,d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup").mergeEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup(d("WASmaxJsx").smax("enc",null),a)),b),c);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeMediaSingleMixin=a}),98);
__d("WASmaxOutMessagePublishContentMixins",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeEventMixin","WASmaxOutMessagePublishContentTypeListMixin","WASmaxOutMessagePublishContentTypeLiveLocationSingleMixin","WASmaxOutMessagePublishContentTypeMediaSingleMixin","WASmaxOutMessagePublishContentTypePollCreationMixin","WASmaxOutMessagePublishContentTypePollResultSnapshotMixin","WASmaxOutMessagePublishContentTypePollVoteMixin","WASmaxOutMessagePublishContentTypeReactionMixin","WASmaxOutMessagePublishContentTypeTextMixin","WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeText)return d("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(a);if(b.contentTypeMediaSingle)return d("WASmaxOutMessagePublishContentTypeMediaSingleMixin").mergeContentTypeMediaSingleMixin(a,b.contentTypeMediaSingle);if(b.contentTypeLiveLocationSingle)return d("WASmaxOutMessagePublishContentTypeLiveLocationSingleMixin").mergeContentTypeLiveLocationSingleMixin(a,b.contentTypeLiveLocationSingle);if(b.individualContentTypePayIndividual)return d("WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin").mergeIndividualContentTypePayIndividualMixin(a,b.individualContentTypePayIndividual);if(b.contentTypeList)return d("WASmaxOutMessagePublishContentTypeListMixin").mergeContentTypeListMixin(a,b.contentTypeList);if(b.isContentTypeReaction)return d("WASmaxOutMessagePublishContentTypeReactionMixin").mergeContentTypeReactionMixin(a);if(b.contentTypePollCreation)return d("WASmaxOutMessagePublishContentTypePollCreationMixin").mergeContentTypePollCreationMixin(a,b.contentTypePollCreation);if(b.contentTypePollVote)return d("WASmaxOutMessagePublishContentTypePollVoteMixin").mergeContentTypePollVoteMixin(a,b.contentTypePollVote);if(b.isContentTypePollResultSnapshot)return d("WASmaxOutMessagePublishContentTypePollResultSnapshotMixin").mergeContentTypePollResultSnapshotMixin(a);if(b.contentTypeEvent)return d("WASmaxOutMessagePublishContentTypeEventMixin").mergeContentTypeEventMixin(a,b.contentTypeEvent);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentMixins=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualRetryToPeerMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageRecipient;a=d("WASmaxJsx").smax("message",{recipient:d("WAWap").JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualRetryToPeerMixin=a}),98);
__d("WASmaxOutMessagePublishRetryMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncRetryMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.messageT;a=a.encRetryMixinArgs;b=d("WASmaxJsx").smax("message",{t:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,b)},d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishEncRetryMixin").mergeEncRetryMixin,d("WASmaxJsx").smax("enc",null),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRetryMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualRetryMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualIndividualRetryToPeerMixin","WASmaxOutMessagePublishRetryMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.individualIndividualRetryToPeerMixinArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualRetryToPeerMixin").mergeIndividualIndividualRetryToPeerMixin,d("WASmaxOutMessagePublishRetryMixin").mergeRetryMixin(d("WASmaxJsx").smax("message",null),a),b);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualRetryMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualSingleContentBindingMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.contentBindingElementValue;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("content_binding",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualSingleContentBindingMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotLocalAutomatedTypeMixin","WASmaxOutMessagePublishBotMessageTypeMixin","WASmaxOutMessagePublishBotMetricsEntryPointMixin","WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin","WASmaxOutMessagePublishBotPersonaTypeMixin","WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin","WASmaxOutMessagePublishBusinessBotMessageMixin","WASmaxOutMessagePublishContentMixins","WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin","WASmaxOutMessagePublishEncTypeIndividualMixin","WASmaxOutMessagePublishEncVersion","WASmaxOutMessagePublishIndividualIndividualRetryMixin","WASmaxOutMessagePublishIndividualIndividualSingleContentBindingMixin","WASmaxOutMessagePublishLidChatOriginMixin","WASmaxOutMessagePublishMsgMetaOriginMixin","WASmaxOutMessagePublishPeripheralOriginMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.messageTo,e=a.individualIndividualRetryMixinArgs,f=a.individualIndividualSingleContentBindingMixinArgs,g=a.botMessageTypeMixinArgs,h=a.businessBotMessageMixinArgs,i=a.botMetricsEntryPointMixinArgs,j=a.botMetricsThreadEntryPointMixinArgs,k=a.msgMetaOriginMixinArgs,l=a.hasLidChatOrigin,m=a.botLocalAutomatedTypeMixinArgs,n=a.businessBotMessageFeedbackRequestedMixinArgs,o=a.botPersonaTypeMixinArgs,p=a.peripheralOriginMixinArgs,q=a.contentMixinsArgs,r=a.encTypeIndividualMixinArgs,s=a.encMediaTypeDeprecatedMixinArgs;a=a.encVersionArgs;c=d("WASmaxOutMessagePublishContentMixins").mergeContentMixins((b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishPeripheralOriginMixin").mergePeripheralOriginMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotPersonaTypeMixin").mergeBotPersonaTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin").mergeBusinessBotMessageFeedbackRequestedMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotLocalAutomatedTypeMixin").mergeBotLocalAutomatedTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishLidChatOriginMixin").mergeLidChatOriginMixin,b.optionalMerge(d("WASmaxOutMessagePublishMsgMetaOriginMixin").mergeMsgMetaOriginMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin").mergeBotMetricsThreadEntryPointMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotMetricsEntryPointMixin").mergeBotMetricsEntryPointMixin,b.optionalMerge(d("WASmaxOutMessagePublishBusinessBotMessageMixin").mergeBusinessBotMessageMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotMessageTypeMixin").mergeBotMessageTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualSingleContentBindingMixin").mergeIndividualIndividualSingleContentBindingMixin,b.optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualRetryMixin").mergeIndividualIndividualRetryMixin,d("WASmaxJsx").smax("message",{to:d("WAWap").JID(c)},d("WASmaxOutMessagePublishEncVersion").mergeEncVersion(b.optionalMerge(d("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin").mergeEncMediaTypeDeprecatedMixin,d("WASmaxOutMessagePublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(d("WASmaxJsx").smax("enc",null),r),s),a)),e),f),g),h),i),j),k),l),m),n),o),p),q);return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualSingleMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishBotMetricsEntryPointMixin","WASmaxOutMessagePublishIndividualIndividualFanoutMixin","WASmaxOutMessagePublishIndividualIndividualSingleMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.individualIndividualSingle)return d("WASmaxOutMessagePublishIndividualIndividualSingleMixin").mergeIndividualIndividualSingleMixin(a,b.individualIndividualSingle);if(b.individualIndividualFanout)return d("WASmaxOutMessagePublishIndividualIndividualFanoutMixin").mergeIndividualIndividualFanoutMixin(a,b.individualIndividualFanout);if(b.botMetricsEntryPoint)return d("WASmaxOutMessagePublishBotMetricsEntryPointMixin").mergeBotMetricsEntryPointMixin(a,b.botMetricsEntryPoint);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup=a}),98);
__d("WASmaxOutMessagePublishIndividualBotRequestMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotFeedbackMessageTypeMixin","WASmaxOutMessagePublishBotRequestMixin","WASmaxOutMessagePublishContentTypeTextOrMediaMixinGroup","WASmaxOutMessagePublishIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.messageTo,c=a.contentTypeTextOrMediaMixinGroupArgs,e=a.individualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroupArgs,f=a.hasBotFeedbackMessageType;a=a.botRequestMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup").mergeIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup,d("WASmaxOutMessagePublishContentTypeTextOrMediaMixinGroup").mergeContentTypeTextOrMediaMixinGroup(d("WASmaxJsx").smax("message",{to:d("WAWap").USER_JID(b)},d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishBotFeedbackMessageTypeMixin").mergeBotFeedbackMessageTypeMixin,d("WASmaxJsx").smax("bot",null,d("WASmaxOutMessagePublishBotRequestMixin").mergeBotRequestMixin(d("WASmaxJsx").smax("to",null),a)),f)),c),e);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualBotRequestMessageMixin=a}),98);
__d("WASmaxOutMessagePublishBotResponseMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.botEditTargetId,e=a.botSenderTimestampMs,f=a.botEdit;a=a.hasBotTypeVoice;c=d("WASmaxJsx").smax("bot",{edit_target_id:(b=d("WASmaxAttrs")).OPTIONAL(d("WAWap").STANZA_ID,c),sender_timestamp_ms:b.OPTIONAL(d("WAWap").INT,e),edit:b.OPTIONAL(d("WAWap").CUSTOM_STRING,f),type:b.OPTIONAL_LITERAL("voice",a)});return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotResponseMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualContentTypeBotResponseMediaFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin"],(function(a,b,c,d,e,f,g){function h(a){a=a.toCount;a=d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").REPEATED_CHILD_COUNT(i,a,2,2));return a}function i(){var a=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:"image"}));return a}function j(a){a=a.participantsArgs;a=d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxChildren").OPTIONAL_CHILD(h,a)));return a}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeIndividualContentTypeBotResponseMediaFanoutParticipants=h;g.makeIndividualContentTypeBotResponseMediaFanoutParticipantsTo=i;g.mergeIndividualContentTypeBotResponseMediaFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeTextMixin","WASmaxOutMessagePublishIndividualContentTypeBotResponseMediaFanoutMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeText)return d("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(a);if(b.individualContentTypeBotResponseMediaFanout)return d("WASmaxOutMessagePublishIndividualContentTypeBotResponseMediaFanoutMixin").mergeIndividualContentTypeBotResponseMediaFanoutMixin(a,b.individualContentTypeBotResponseMediaFanout);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup=a}),98);
__d("WASmaxOutMessagePublishEncTypeMessageSecretMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncPayloadMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishEncPayloadMixin").mergeEncPayloadMixin(d("WASmaxJsx").smax("enc",{type:"msmsg"}),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncTypeMessageSecretMessageMixin=a}),98);
__d("WASmaxOutMessagePublishMessageTargetMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.metaTargetId,e=a.metaTargetSenderJid,f=a.metaTargetChatJid;a=a.metaTargetChatJidLid;c=d("WASmaxJsx").smax("meta",{target_id:(b=d("WAWap")).STANZA_ID(c),target_sender_jid:d("WASmaxAttrs").OPTIONAL(b.USER_JID,e),target_chat_jid:d("WASmaxAttrs").OPTIONAL(b.JID,f),target_chat_jid_lid:d("WASmaxAttrs").OPTIONAL(b.JID,a)});return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMessageTargetMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualBotResponseFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotResponseMixin","WASmaxOutMessagePublishContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup","WASmaxOutMessagePublishEncTypeMessageSecretMessageMixin","WASmaxOutMessagePublishEncVersionBot","WASmaxOutMessagePublishMessageTargetMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.toArgs;a=d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").REPEATED_CHILD(i,a,2,2));return a}function i(a){a=a.toJid;a=d("WASmaxJsx").smax("to",{jid:d("WAWap").USER_JID(a)});return a}function j(a){var b,c=a.participantsArgs,e=a.messageTo,f=a.contentTypeTextOrIndividualBotResponseMediaFanoutMixinGroupArgs,g=a.botResponseMixinArgs,i=a.messageTargetMixinArgs,j=a.encTypeMessageSecretMessageMixinArgs;a=a.encVersionBotArgs;e=d("WASmaxOutMessagePublishContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup").mergeContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup((b=d("WASmaxJsx")).smax("message",{to:d("WAWap").USER_JID(e)},d("WASmaxOutMessagePublishBotResponseMixin").mergeBotResponseMixin(b.smax("bot",null),g),d("WASmaxOutMessagePublishMessageTargetMixin").mergeMessageTargetMixin(b.smax("meta",null),i),d("WASmaxOutMessagePublishEncVersionBot").mergeEncVersionBot(d("WASmaxOutMessagePublishEncTypeMessageSecretMessageMixin").mergeEncTypeMessageSecretMessageMixin(b.smax("enc",null),j),a),d("WASmaxChildren").OPTIONAL_CHILD(h,c)),f);return e}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeIndividualBotResponseFanoutParticipants=h;g.makeIndividualBotResponseFanoutParticipantsTo=i;g.mergeIndividualBotResponseFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishIndividualBotRequestMessageMixin","WASmaxOutMessagePublishIndividualBotResponseFanoutMixin","WASmaxOutMessagePublishIndividualIndividualFanoutMixin","WASmaxOutMessagePublishIndividualIndividualSingleMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.individualBotResponseFanout)return d("WASmaxOutMessagePublishIndividualBotResponseFanoutMixin").mergeIndividualBotResponseFanoutMixin(a,b.individualBotResponseFanout);if(b.individualBotRequestMessage)return d("WASmaxOutMessagePublishIndividualBotRequestMessageMixin").mergeIndividualBotRequestMessageMixin(a,b.individualBotRequestMessage);if(b.individualIndividualSingle)return d("WASmaxOutMessagePublishIndividualIndividualSingleMixin").mergeIndividualIndividualSingleMixin(a,b.individualIndividualSingle);if(b.individualIndividualFanout)return d("WASmaxOutMessagePublishIndividualIndividualFanoutMixin").mergeIndividualIndividualFanoutMixin(a,b.individualIndividualFanout);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup=a}),98);
__d("WASmaxOutMessagePublishIndividualRecipientDeprecaredMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageRecipient;a=d("WASmaxJsx").smax("message",{recipient:d("WAWap").JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualRecipientDeprecaredMixin=a}),98);
__d("WASmaxOutMessagePublishMessageEditMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{edit:"1"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMessageEditMixin=a}),98);
__d("WASmaxOutMessagePublishMessagePinMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{edit:"2"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMessagePinMixin=a}),98);
__d("WASmaxOutMessagePublishRevokeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{edit:"7"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRevokeMixin=a}),98);
__d("WASmaxOutMessagePublishMessageEditOrMessagePinOrRevokeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishMessageEditMixin","WASmaxOutMessagePublishMessagePinMixin","WASmaxOutMessagePublishRevokeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isMessageEdit)return d("WASmaxOutMessagePublishMessageEditMixin").mergeMessageEditMixin(a);if(b.isMessagePin)return d("WASmaxOutMessagePublishMessagePinMixin").mergeMessagePinMixin(a);if(b.isRevoke)return d("WASmaxOutMessagePublishRevokeMixin").mergeRevokeMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeMessageEditOrMessagePinOrRevokeMixinGroup=a}),98);
__d("WASmaxOutMessagePublishMetaDestinationIdMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaDestinationId;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{destination_id:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMetaDestinationIdMixin=a}),98);
__d("WASmaxOutMessagePublishPeerRecipientUsernameMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyPeerRecipientUsername;a=d("WASmaxJsx").smax("smax$any",{peer_recipient_username:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePeerRecipientUsernameMixin=a}),98);
__d("WASmaxOutMessagePublishPeerRecipientLIDMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyPeerRecipientLid;a=d("WASmaxJsx").smax("smax$any",{peer_recipient_lid:d("WAWap").JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePeerRecipientLIDMixin=a}),98);
__d("WASmaxOutMessagePublishPeerRecipientPNMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyPeerRecipientPn;a=d("WASmaxJsx").smax("smax$any",{peer_recipient_pn:d("WAWap").JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePeerRecipientPNMixin=a}),98);
__d("WASmaxOutMessagePublishRecipientPNMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageRecipientPn;a=d("WASmaxJsx").smax("message",{recipient_pn:d("WAWap").JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRecipientPNMixin=a}),98);
__d("WASmaxOutMessagePublishRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishPeerRecipientLIDMixin","WASmaxOutMessagePublishPeerRecipientPNMixin","WASmaxOutMessagePublishRecipientPNMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.recipientPN)return d("WASmaxOutMessagePublishRecipientPNMixin").mergeRecipientPNMixin(a,b.recipientPN);if(b.peerRecipientPN)return d("WASmaxOutMessagePublishPeerRecipientPNMixin").mergePeerRecipientPNMixin(a,b.peerRecipientPN);if(b.peerRecipientLID)return d("WASmaxOutMessagePublishPeerRecipientLIDMixin").mergePeerRecipientLIDMixin(a,b.peerRecipientLID);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup=a}),98);
__d("WASmaxOutMessagePublishStatusMentionMessageMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{is_status_mention:"true"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeStatusMentionMessageMixin=a}),98);
__d("WASmaxOutMessagePublishPrivacyTokenContentsMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyElementValue;a=d("WASmaxJsx").smax("smax$any",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePrivacyTokenContentsMixin=a}),98);
__d("WASmaxOutMessagePublishTCTokenMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishPrivacyTokenContentsMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.tctokenT;a=a.privacyTokenContentsMixinArgs;b=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutMessagePublishPrivacyTokenContentsMixin").mergePrivacyTokenContentsMixin(d("WASmaxJsx").smax("tctoken",{t:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,b)}),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeTCTokenMixin=a}),98);
__d("WASmaxOutMessagePublishThreadTypeTagEnumMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaThreadType;a=d("WASmaxJsx").smax("meta",{thread_type:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeThreadTypeTagEnumMixin=a}),98);
__d("WASmaxOutMessagePublishThreadTypeTagLegacyMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaThreadType;a=d("WASmaxJsx").smax("meta",{thread_type:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeThreadTypeTagLegacyMixin=a}),98);
__d("WASmaxOutMessagePublishThreadTypeTagEnumOrLegacyMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishThreadTypeTagEnumMixin","WASmaxOutMessagePublishThreadTypeTagLegacyMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.threadTypeTagEnum)return d("WASmaxOutMessagePublishThreadTypeTagEnumMixin").mergeThreadTypeTagEnumMixin(a,b.threadTypeTagEnum);if(b.threadTypeTagLegacy)return d("WASmaxOutMessagePublishThreadTypeTagLegacyMixin").mergeThreadTypeTagLegacyMixin(a,b.threadTypeTagLegacy);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeThreadTypeTagEnumOrLegacyMixinGroup=a}),98);
__d("WASmaxOutMessagePublishThreadTypeTagMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishThreadTypeTagEnumOrLegacyMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.threadTypeTagEnumOrLegacyMixinGroupArgs;a=d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishThreadTypeTagEnumOrLegacyMixinGroup").mergeThreadTypeTagEnumOrLegacyMixinGroup(d("WASmaxJsx").smax("meta",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeThreadTypeTagMixin=a}),98);
__d("WASmaxOutMessagePublishViewOnceMetaAttributeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{view_once:"true"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeViewOnceMetaAttributeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualRequest",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAppdataMetaAttributeMixin","WASmaxOutMessagePublishBaseMixin","WASmaxOutMessagePublishGroupInviteTargetMixin","WASmaxOutMessagePublishIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup","WASmaxOutMessagePublishIndividualRecipientDeprecaredMixin","WASmaxOutMessagePublishMessageEditOrMessagePinOrRevokeMixinGroup","WASmaxOutMessagePublishMetaDestinationIdMixin","WASmaxOutMessagePublishPeerRecipientUsernameMixin","WASmaxOutMessagePublishPeripheralOriginMixin","WASmaxOutMessagePublishRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup","WASmaxOutMessagePublishStatusMentionMessageMixin","WASmaxOutMessagePublishTCTokenMixin","WASmaxOutMessagePublishThreadTypeTagMixin","WASmaxOutMessagePublishViewOnceMetaAttributeMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b,c=a.messageId,e=a.groupInviteTargetMixinArgs,f=a.threadTypeTagMixinArgs,g=a.peerRecipientUsernameMixinArgs,h=a.individualRecipientDeprecaredMixinArgs,i=a.appdataMetaAttributeMixinArgs,j=a.hasStatusMentionMessage,k=a.tCTokenMixinArgs,l=a.hasViewOnceMetaAttribute,m=a.metaDestinationIdMixinArgs,n=a.peripheralOriginMixinArgs,o=a.individualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroupArgs,p=a.messageEditOrMessagePinOrRevokeMixinGroupArgs,q=a.recipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroupArgs;b=(b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup").mergeRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup,b.optionalMerge(d("WASmaxOutMessagePublishMessageEditOrMessagePinOrRevokeMixinGroup").mergeMessageEditOrMessagePinOrRevokeMixinGroup,d("WASmaxOutMessagePublishIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup").mergeIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup(b.optionalMerge(d("WASmaxOutMessagePublishPeripheralOriginMixin").mergePeripheralOriginMixin,b.optionalMerge(d("WASmaxOutMessagePublishMetaDestinationIdMixin").mergeMetaDestinationIdMixin,b.optionalMerge(d("WASmaxOutMessagePublishViewOnceMetaAttributeMixin").mergeViewOnceMetaAttributeMixin,b.optionalMerge(d("WASmaxOutMessagePublishTCTokenMixin").mergeTCTokenMixin,b.optionalMerge(d("WASmaxOutMessagePublishStatusMentionMessageMixin").mergeStatusMentionMessageMixin,b.optionalMerge(d("WASmaxOutMessagePublishAppdataMetaAttributeMixin").mergeAppdataMetaAttributeMixin,b.optionalMerge(d("WASmaxOutMessagePublishIndividualRecipientDeprecaredMixin").mergeIndividualRecipientDeprecaredMixin,b.optionalMerge(d("WASmaxOutMessagePublishPeerRecipientUsernameMixin").mergePeerRecipientUsernameMixin,b.optionalMerge(d("WASmaxOutMessagePublishThreadTypeTagMixin").mergeThreadTypeTagMixin,b.optionalMerge(d("WASmaxOutMessagePublishGroupInviteTargetMixin").mergeGroupInviteTargetMixin,d("WASmaxOutMessagePublishBaseMixin").mergeBaseMixin(d("WASmaxJsx").smax("message",{id:d("WAWap").STANZA_ID(c)}),a),e),f),g),h),i),j),k),l),m),n),o),p),q);return b}g.makeIndividualRequest=a}),98);
__d("WASmaxMessagePublishIndividualRPC",["WAComms","WASmaxInMessagePublishIndividualResponseNegative","WASmaxInMessagePublishIndividualResponseSuccess","WASmaxOutMessagePublishIndividualRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WASmaxOutMessagePublishIndividualRequest").makeIndividualRequest(a);b=(yield d("WAComms").sendSmaxStanza(a,b));var c=d("WASmaxInMessagePublishIndividualResponseNegative").parseIndividualResponseNegative(b,a);if(c.success)return{name:"IndividualResponseNegative",value:c.value};b=d("WASmaxInMessagePublishIndividualResponseSuccess").parseIndividualResponseSuccess(b,a);if(b.success)return{name:"IndividualResponseSuccess",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Individual",{Negative:c,Success:b}))});return h.apply(this,arguments)}g.sendIndividualRPC=a}),98);
__d("WASendMsgRPC",["WADeprecatedSendIq","WADeprecatedWapParser","WAFrankingTypes","WAGetDeviceIdentityMixin","WAJids","WALogger","WAParseFranking","WASmaxMessagePublishIndividualRPC","WATimeUtils","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,c,d,e){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){f===void 0&&(f=!1);var g=d("WAJids").interpretAsGroupJid(a.protocolMsgId.chat),h=a.messageType.type==="text"&&a.messageType.invitedParticipantUserJid!=null;if(b.type==="direct_user"){var i={individualIndividualSingle:{messageTo:b.message.to,individualIndividualRetryMixinArgs:n(a.count,b.recipient),contentMixinsArgs:m(a,b.message),encTypeIndividualMixinArgs:o(b.message),encVersionArgs:p(b.message)}};i={messageId:a.externalId,deviceIdentityMixinArgs:d("WAGetDeviceIdentityMixin").getDeviceIdentityMixin(a.deviceIdentity),hasNoExtraFanout:a.messageType.isInvisible===!0?!0:null,messageEditOrMessagePinOrRevokeMixinGroupArgs:q(a.messageType),clientFrankingTagMixinArgs:c!=null&&c.frankingTag?{frankingTagElementValue:c.frankingTag}:null,hasMetaHideDecryptionPlaceholder:a.messageType.isInvisible===!0?!0:null,groupInviteTargetMixinArgs:h&&g!=null?{metaGroupInvite:g}:null,individualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroupArgs:i,internalTestMixinArgs:f?{testConfig:"armadillo_express"}:null};e==null||e.addPoint("send_individual_rpc");i=(yield d("WASmaxMessagePublishIndividualRPC").sendIndividualRPC(i));if(i.name==="IndividualResponseSuccess"){var j;j=((j=i.value.deviceListStaleMixin)==null?void 0:j.phash)!=null?{type:"mismatch",local:null,server:i.value.deviceListStaleMixin.phash}:{type:"ok"};var s=i.value.serverFrankingTagMixin!=null&&c!=null?babelHelpers["extends"]({},c,{reportingTag:d("WAFrankingTypes").castToReportingTag(i.value.serverFrankingTagMixin.frankingReportingTagElementValue)}):null;return{type:"success",ts:d("WATimeUtils").castToUnixTime(i.value.t),phash:j,count:null,reportingMeta:s}}else{i.name;return{type:"error",errorCode:parseInt(i.value.error,10),backoff:parseInt((j=i.value.messageNackRetryAttributesMixin)==null?void 0:j.backoff,10),applicationError:(s=i.value.applicationNegativeAckMixin)==null?void 0:s.applicationError}}}j=a.messageType.isInvisible===!0?"false":d("WAWap").DROP_ATTR;i=b.participant!=null?d("WAWap").JID(b.participant):d("WAWap").DROP_ATTR;s=b.phash!=null&&b.type==="group"?d("WAWap").CUSTOM_STRING(b.phash):d("WAWap").DROP_ATTR;function t(){if(a.messageType.type==="text"&&a.messageType.isRevoked)return d("WAWap").CUSTOM_STRING("7");else if(a.messageType.type==="text"&&a.messageType.isEdit===!0)return d("WAWap").CUSTOM_STRING("1");return d("WAWap").DROP_ATTR}t=t();function u(){if(h&&g!=null)return d("WAWap").wap("meta",{"decrypt-fail":"hide",group_invite:d("WAWap").CUSTOM_STRING(g)});return a.messageType.isInvisible===!0||a.messageType.isEdit===!0?d("WAWap").wap("meta",{"decrypt-fail":"hide"}):null}u=u();f=f?d("WAWap").wap("test",{config:d("WAWap").CUSTOM_STRING("armadillo_express")}):null;var v=a.deviceIdentity!=null?d("WAWap").wap("device-identity",null,a.deviceIdentity):null,w=(c==null?void 0:c.frankingTag)!=null?d("WAWap").wap("franking",null,d("WAWap").wap("franking_tag",null,c.frankingTag)):null,x=null;b.participants!=null&&(x=d("WAWap").wap("participants",null,b.participants.map(function(a){return k(a)})));var y=null;b.message!=null&&(y=k(b.message,!0));j=d("WAWap").wap("message",{device_fanout:j,edit:t,id:d("WAWap").CUSTOM_STRING(a.externalId),participant:i,phash:s,to:d("WAWap").JID(b.messageTo),type:d("WAWap").CUSTOM_STRING(a.messageType.type)},u,w,x,y,v,f);r(a.externalId);e==null||e.addPoint("send_stanza_and_return_ack");t=(yield d("WADeprecatedSendIq").deprecatedSendStanzaAndReturnAck(j,{id:a.externalId,"class":"message",from:b.messageTo,participant:b.participant!=null?b.participant:null}));e==null||e.addPoint("send_msg_ack_parser");i=l.parse(t);if(i.success){e==null||e.addPoint("send_msg_ack_parser_success");s=i.success;u=s.errorCode;w=s.applicationError;x=s.backoff;if(u==null){y=i.success;v=y.ts;f=y.phash;j=y.count;s=c!=null?babelHelpers["extends"]({},c,{reportingTag:(t=i.success.reportingMeta)==null?void 0:t.reportingTag}):null;return{type:"success",ts:v,phash:f==null||f===b.phash?{type:"ok"}:{type:"mismatch",local:b.phash,server:f},count:j,reportingMeta:s}}else{e==null||e.addPoint("send_msg_ack_parser_failed",{"int":{errorCode:u,applicationError:w}});return{type:"error",errorCode:u,applicationError:w,backoff:x}}}else return{type:"parsing_error"}});return j.apply(this,arguments)}function k(a,b){b===void 0&&(b=!1);var c=d("WAWap").wap("enc",{count:a.count!=null?d("WAWap").INT(a.count):d("WAWap").DROP_ATTR,mediatype:a.mediaType!=null?d("WAWap").CUSTOM_STRING(a.mediaType):d("WAWap").DROP_ATTR,type:d("WAWap").CUSTOM_STRING(a.type),v:d("WAWap").CUSTOM_STRING(a.v)},a.ciphertext);if(b||a.encType==="group")return c;else return d("WAWap").wap("to",{jid:d("WAWap").DEVICE_JID(a.to)},c)}var l=new(c("WADeprecatedWapParser"))("sendMsgAck",function(a){a.assertTag("ack");return{count:a.maybeAttrInt("count"),errorCode:a.maybeAttrInt("error"),phash:a.maybeAttrString("phash"),applicationError:a.maybeAttrInt("application_error"),ts:a.attrTime("t"),reportingMeta:d("WAParseFranking").parseFrankingNode(a.maybeChild("franking")),backoff:a.maybeAttrInt("backoff")}});function m(a,b){if(a.messageType.type==="reaction")return{isContentTypeReaction:!0};if(a.messageType.type==="text")return{isContentTypeText:!0};a.messageType.type;if(b.mediaType!=null){b={contentTypeMediaOrMedianotifyMixinGroupArgs:{isContentTypeMedia:!0},encMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroupArgs:{encMediaType:{encMediatype:b.mediaType}}};return{contentTypeMediaSingle:b}}d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["WASendMsgRPC: Wrong media type: ",""])),a.messageType.mediaType);return{isContentTypeText:!0}}function n(a,b){a=a!=null?{encCount:a}:null;b=b!=null?{messageRecipient:b}:null;return{encRetryMixinArgs:a,individualIndividualRetryToPeerMixinArgs:b}}function o(a){return{encType:a.type,encElementValue:a.ciphertext}}function p(a){return a.v==="2"?{isEncVersion2:!0}:{isEncVersion3:!0}}function q(a){return a.type==="text"&&a.isRevoked?{isRevoke:!0}:null}function r(a){try{BigInt(a)}catch(b){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[WASendMsgRPC] Sending message with not allowed stanzaId: ",", error: ",""])),a,b)}}g.sendStanza=a;g.createEncWapNode=k}),98);
__d("WASendMsgInternal",["FBLogger","Promise","WABridge","WADevicesState","WAEncGroupMsg","WAEncUserMsg","WAGlobals","WAJids","WALogger","WAMarkSenderKeyAsSentApi","WAOdsEnums","WAQueryGroups","WAResultOrError","WASendMsgRPC","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o=10002,p=10009;function a(a,b){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e;b.addPoint("encrypt_start",{string:{sentMessageType:a.messageType.isRevoked===!0?"revoke":a.messageType.type},bool:{isInvisibleMsg:a.messageType.type==="text"&&a.messageType.isInvisible===!0}});var f=(yield d("WAGlobals").getWaOneQueue().enqueue(function(c){c=c.cryptoManager;return a.type==="chat"?w(a,b,2,{cryptoManager:c}):u(a,{cryptoManager:c},2)},{operationType:"encrypt",flush:!0}));b.addPoint("finish_encrypt",{string:{chatType:f.success?f.value.type:f.error}});if(f.success===!1)throw c("FBLogger")("wmi").mustfixThrow("Encryption failed %s",f.error);f=f.value;b.addPoint("sending_stanza_start",{string:{encryptionType:f.type},"int":{ciphertextByteLength:(e=(e=(e=f.message)==null||(e=e.ciphertext)==null?void 0:e.length)!=null?e:(e=f.participants)==null||(e=e[0].ciphertext)==null?void 0:e.length)!=null?e:0}});e=(yield d("WASendMsgRPC").sendStanza(a,f,a.reportingMeta,b));b.addPoint("sending_stanza_end",{bool:{wai:e.type==="success"}});return{serverResponse:e,encryption:f}});return q.apply(this,arguments)}function e(a,b,c){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var f;e===void 0&&(e=!1);B(a,c);var g=e?3:2,h=function(b){return a.type==="chat"?w(a,c,g,{cryptoManager:b}):u(a,{cryptoManager:b},g)},i=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return h(a)},{operationType:"encrypt",flush:!0})),j=i.success?i.value.type:i.error;c.addPoint("finish_encrypt",{string:{chatType:j}});if(i.success===!1){d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["MAWSendMsg Failed to encrypt message for "," message"])),j);return d("WAResultOrError").makeError({type:"encryption-error",isRetriable:!1})}i=i.value;c.addPoint("sending_stanza_start",{string:{encryptionType:i.type},"int":{ciphertextByteLength:(f=(f=(f=i.message)==null||(f=f.ciphertext)==null?void 0:f.length)!=null?f:(f=i.participants)==null||(f=f[0].ciphertext)==null?void 0:f.length)!=null?f:0}});f=(yield d("WASendMsgRPC").sendStanza(a,i,a.reportingMeta,c,e));c.addPoint("sending_stanza_end");if(f.type==="success"){c.addPoint("send_stanza_success");try{e=(yield (n||(n=b("Promise"))).all([x(a,i,f,c),z(i)]));e=e[0];c.addPoint("mark_sender_key_sent");return d("WAResultOrError").makeResult({baseKey:(i=i.message)==null?void 0:i.baseKey,reportingMeta:f.reportingMeta,serverTs:f.ts,meta:{pOrDhashMismatch:e}})}catch(a){c.addPoint("send_stanza_failed");throw a}}f.type;C(f,j,c);f.applicationError===o&&(yield d("WAGlobals").getDependencies().handleReachabilityErrorAdminMsg(a.chat));if(f.type==="parsing_error")return d("WAResultOrError").makeError({type:"result-parsing-error",isRetriable:!0});if(f.type==="error"){i=f.errorCode!=null&&f.errorCode>=500;if(i)return d("WAResultOrError").makeError({type:"retryable-error",backoff:f.backoff,isRetriable:!0});else return d("WAResultOrError").makeError({type:"non-retryable-error",applicationErrorCode:f.applicationError,errorCode:f.errorCode,isRetriable:!1})}return d("WAResultOrError").makeError({type:"unexpected-message-codepath",details:"impossible-server-error-result",isRetriable:!0,applicationErrorCode:f.applicationError})});return r.apply(this,arguments)}function s(a){d("WADevicesState").getDevicesState().reset([a]);return d("WADevicesState").getDevicesState().waitForUserDevices([a],"SendMsgUtil_recoverUser",!0)}function t(a){return d("WAJids").switchOnChatJidType(a,{interopUser:s,msgrUser:s,lidUser:s,phoneUser:s,group:function(a){return d("WAQueryGroups").queryGroups(null,{type:"array",groups:[a]},!0)}})}function u(a,b,c){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=a.chat,f=a.to,g=a.messageBytes,h=a.messageType,i=a.count,j=a.sessionInfo,k=a.identityKey,l=a.backupDirective,m=(yield d("WAEncUserMsg").encryptDeviceJidMessage(f,{type:"message",chat:e,messageBytes:g,messageType:h,applicationPayloadVersion:c,backupDirective:l},b,i,j,k));return d("WAJids").switchOnUserChatJidType(e,{user:function(b){return m!=null?d("WAResultOrError").makeResult({type:"direct_user",messageTo:a.to,message:m,recipient:d("WAGlobals").isPeerDevice(a.to)?b:null}):d("WAResultOrError").makeError("direct_user")},group:function(b){return m!=null?d("WAResultOrError").makeResult({type:"direct_group",messageTo:b,participant:a.to,message:m}):d("WAResultOrError").makeError("direct_group")}})});return v.apply(this,arguments)}function w(a,c,e,f){var g=a.recipients,j=a.messageBytes,k=a.messageType,l=a.chat,m=a.backupDirective;return d("WAJids").switchOnUserChatJidType(l,{user:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WAEncUserMsg").encryptUserMsg(g,{type:"message",messageBytes:j,messageType:k,chat:a,applicationPayloadVersion:e,backupDirective:m},f,c)),h=b.participants;return h!=null&&h.length>0?d("WAResultOrError").makeResult({type:"user",messageTo:a,participants:h,phash:b.phash}):d("WAResultOrError").makeError("user")});function h(b){return a.apply(this,arguments)}return h}(),group:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptChatMessage -- group message"])));var b=(yield d("WAEncGroupMsg").encryptGroupMsg(a,g,j,k,f,m,c));d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptChatMessage -- finish encrypt group message"])));var e=b.participants,l=b.encNode;return e==null&&l==null?d("WAResultOrError").makeError("group"):d("WAResultOrError").makeResult({type:"group",messageTo:a,participants:e,message:l,senderKeyDistributionInfo:b.senderKeyDistributionInfo,phash:b.phash})});function e(b){return a.apply(this,arguments)}return e}()})}function x(a,b,c,d){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){if(c.type!=="success")return!1;c=c.phash;if(c.type==="mismatch"){e.addPoint("phash_mismatch");d("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Got phash mismatch, local[","] server[","]"])),c.local,c.server);d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PHASH_MISMATCH,key:b.type});yield t(a.chat);e.addPoint("participant_recovery_finished");return!0}return!1});return y.apply(this,arguments)}function z(a){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.senderKeyDistributionInfo!=null){a=a.senderKeyDistributionInfo;var b=a.group,c=a.senderKeyId;a=a.knowsSenderKey;yield d("WAMarkSenderKeyAsSentApi").markSenderKeyAsSent(b,c,a)}});return A.apply(this,arguments)}function B(a,b){var c=0;a.type==="chat"&&(c=a.recipients.reduce(function(a,b){return a+b.devicesInfo.length},0));var d=a.messageType.type==="text"&&a.messageType.isRevoked;d=d?"revoke":a.messageType.type;b.addPoint("start_encrypt",{string:{sentMessageType:d},"int":{numDevices:c},bool:{isInvisibleMsg:a.messageType.type==="text"&&a.messageType.isInvisible===!0}})}function C(a,b,c){if(a.type==="success")return;a.type==="parsing_error"&&(d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["sendMessage ack success is false, chatType:",""])),b),c.addPoint("ack_parse_fail"));var e=a.errorCode;a=a.applicationError;a===o&&c.addPoint("reachability_error_code");d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["sendMessage ack success is true, error: ",", applicationError: ",", chatType:",""])),e,a,b);e!=null&&c.addPoint("ack_success_error_"+e,{"int":{applicationError:a}});a===p&&c.addPoint("sender_blocked",{})}g.sendMessageV2=a;g.sendMessage=e}),98);
__d("WASentBytesCacheApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";c=(a=d("WADbTransactor")).makeSignalTransactor({sentBytesCache:(b=d("MAWTransactionMode")).READWRITE},"deleteSentBytes",function(a){return function(b){return a.sentBytesCache.bulkDelete(b)}});e=a.makeSignalTransactor({sentBytesCache:b.READONLY},"loadExpired",function(a){return function(b){return a.sentBytesCache.where("ts").belowOrEqual(b).toArray().then(function(a){return a.map(function(a){return a.waMsgId})})}});f=a.makeSignalTransactor({sentBytesCache:b.READONLY},"loadSentBytes",function(a){return function(b){return a.sentBytesCache.bulkGet(b).then(function(a){return a.filter(Boolean)})}});d=a.makeSignalTransactor({sentBytesCache:b.READWRITE},"saveSentBytes",function(a){return function(b){return a.sentBytesCache.put(b).then(function(){})}});g.deleteSentBytes=c;g.loadExpired=e;g.loadSentBytes=f;g.saveSentBytes=d}),98);
__d("WASentBytesCache",["WAGlobals","WAJids","WAMsg","WASentBytesCacheApi","WATagsLogger","WATimeUtils","WAWaitForUserUnblocked","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=d("WATagsLogger").TAGS(["SentBytesCache"]),k=30*24*60*60;c=function(){function a(){var a=this;void d("WAWaitForUserUnblocked").waitForUserUnblocked().then(function(){a.$1()["catch"](function(a){j.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to prune sent bytes: ",""])),a)})})}var c=a.prototype;c.loadSentBytes=function(a){return d("WASentBytesCacheApi").loadSentBytes(a)};c.getMsgsForRetry=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=Array.from(new Set(a.map(function(a){a=a.deviceJid;return d("WAJids").extractUserJid(a)}))),c=new Map();try{c=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return a.storage.bulkLoadIdentities(b)},{operationType:"retries_load_identities",flush:!1,afterInit:!0}))}catch(a){j.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["It fails to bulkLoadIdentities: ",""])),a.toString())}var e=(yield this.loadSentBytes(a.map(function(a){a=a.protocolMsgId;return d("WAMsg").craftWAMsgIdString({author:a.author,chat:a.chat,externalId:a.externalId})})));return a.map(function(a){var b=a.deviceJid,f=a.protocolMsgId,g=d("WAMsg").craftWAMsgIdString({author:f.author,chat:f.chat,externalId:f.externalId});f=(f=c.get(d("WAJids").extractUserJid(b)))==null?void 0:f.get(b);if(f==null)return{type:"unauthorized"};b=e.find(function(a){return a.waMsgId===g});if(b==null)return{type:"missing"};else if(!d("WATimeUtils").happenedWithin(b.ts,k))return{type:"unauthorized"};return{frankingKey:b.frankingKey,frankingVersion:b.frankingVersion,messageBytes:b.messageBytes,backupDirective:b.backupDirective,messageType:b.messageType,protocolMsgId:b.protocolMsgId,retryCount:a.retryCount+1,type:"unacked"}})});function c(b){return a.apply(this,arguments)}return c}();c.saveSentBytes=function(a){return d("WASentBytesCacheApi").saveSentBytes(a)};c.$1=function(){return d("WASentBytesCacheApi").loadExpired(d("WATimeUtils").pastUnixTime(k)).then(function(a){return d("WASentBytesCacheApi").deleteSentBytes(a)})};return a}();var l=new c();function a(){return l}g.SentBytesCache=c;g.sentBytesCache=a}),98);
__d("WASetMetaApi",["WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASignalDB").getDb().runInTransaction(["meta"],"readwrite",function(b){return b.stores.meta.bulkPut(Object.entries(a).map(function(a){var b,c=a[0];a=a[1];return{key:c,value:(b={},b[c]=a,b)}}))},d("WASignalDB").signalOp("setMeta"))};g.setMeta=a}),98);
__d("WASmaxInAppdataPublishAckMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"class","appdata");if(!c.success)return c;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);return!b.success?b:d("WAResultOrError").makeResult({"class":c.value,t:b.value})}g.parseAckMixin=a}),98);
__d("WASmaxInAppdataPublishPeerResponseNegative",["WAResultOrError","WASmaxInAppdataPublishAckMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseUtils").attrString(a,"error");if(!c.success)return c;a=d("WASmaxInAppdataPublishAckMixin").parseAckMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({error:c.value},a.value))}g.parsePeerResponseNegative=a}),98);
__d("WASmaxInAppdataPublishDeviceListStaleMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"phash");return!b.success?b:d("WAResultOrError").makeResult({phash:b.value})}g.parseDeviceListStaleMixin=a}),98);
__d("WASmaxInAppdataPublishPeerResponseSuccess",["WAResultOrError","WASmaxInAppdataPublishAckMixin","WASmaxInAppdataPublishDeviceListStaleMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxInAppdataPublishAckMixin").parseAckMixin(a,b);if(!c.success)return c;b=d("WASmaxInAppdataPublishDeviceListStaleMixin").parseDeviceListStaleMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({},c.value,{deviceListStaleMixin:b.success?b.value:null}))}g.parsePeerResponseSuccess=a}),98);
__d("WASmaxOutAppdataPublishDeviceIdentityMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.deviceIdentityElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("device-identity",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeDeviceIdentityMixin=a}),98);
__d("WASmaxOutAppdataPublishInternalTestMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.testConfig;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("test",{config:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeInternalTestMixin=a}),98);
__d("WASmaxOutAppdataPublishRequestIDMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.requestIdElementValue;a=d("WASmaxJsx").smax("trace",null,d("WASmaxJsx").smax("request_id",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRequestIDMixin=a}),98);
__d("WASmaxOutAppdataPublishTraceIDMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.edgeIdElementValue;a=d("WASmaxJsx").smax("edge_id",null,a);return a}function i(a){var b=a.deviceArgs,c=a.correlationIdType;a=a.idElementValue;c=d("WASmaxJsx").smax("correlation_id",{type:d("WAWap").CUSTOM_STRING(c)},d("WASmaxJsx").smax("id",null,a),d("WASmaxChildren").OPTIONAL_CHILD(j,b));return c}function j(a){a=a.deviceId;a=d("WASmaxJsx").smax("device",{id:d("WAWap").INT(a)});return a}function k(a){var b=a.edgeIdArgs,c=a.correlationIdArgs;a=a.traceIdElementValue;a=d("WASmaxJsx").smax("trace",null,[d("WASmaxJsx").smax("trace_id",null,a),d("WASmaxChildren").OPTIONAL_CHILD(h,b)].concat(d("WASmaxChildren").REPEATED_CHILD(i,c,0,10)));return a}function a(a,b){b=k(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeTraceIDEdgeId=h;g.makeTraceIDCorrelationId=i;g.makeTraceIDCorrelationIdDevice=j;g.mergeTraceIDMixin=a}),98);
__d("WASmaxOutAppdataPublishRequestOrTraceIDMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutAppdataPublishRequestIDMixin","WASmaxOutAppdataPublishTraceIDMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.requestID)return d("WASmaxOutAppdataPublishRequestIDMixin").mergeRequestIDMixin(a,b.requestID);if(b.traceID)return d("WASmaxOutAppdataPublishTraceIDMixin").mergeTraceIDMixin(a,b.traceID);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeRequestOrTraceIDMixinGroup=a}),98);
__d("WASmaxOutAppdataPublishTraceContextMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishRequestOrTraceIDMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.requestOrTraceIDMixinGroupArgs;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutAppdataPublishRequestOrTraceIDMixinGroup").mergeRequestOrTraceIDMixinGroup(d("WASmaxJsx").smax("trace",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeTraceContextMixin=a}),98);
__d("WASmaxOutAppdataPublishWithDeviceListCheckMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.appdataDeviceListCheck;a=d("WASmaxJsx").smax("appdata",{device_list_check:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeWithDeviceListCheckMixin=a}),98);
__d("WASmaxOutAppdataPublishBaseMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishDeviceIdentityMixin","WASmaxOutAppdataPublishInternalTestMixin","WASmaxOutAppdataPublishTraceContextMixin","WASmaxOutAppdataPublishWithDeviceListCheckMixin"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.deviceIdentityMixinArgs,e=a.withDeviceListCheckMixinArgs,f=a.internalTestMixinArgs;a=a.traceContextMixinArgs;b=(b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutAppdataPublishTraceContextMixin").mergeTraceContextMixin,b.optionalMerge(d("WASmaxOutAppdataPublishInternalTestMixin").mergeInternalTestMixin,b.optionalMerge(d("WASmaxOutAppdataPublishWithDeviceListCheckMixin").mergeWithDeviceListCheckMixin,b.optionalMerge(d("WASmaxOutAppdataPublishDeviceIdentityMixin").mergeDeviceIdentityMixin,d("WASmaxJsx").smax("appdata",null),c),e),f),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseMixin=a}),98);
__d("WASmaxOutAppdataPublishEncPayloadMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.encElementValue;a=d("WASmaxJsx").smax("enc",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncPayloadMixin=a}),98);
__d("WASmaxOutAppdataPublishEncTypeIndividualMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncPayloadMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encType;b=d("WASmaxOutAppdataPublishEncPayloadMixin").mergeEncPayloadMixin(d("WASmaxJsx").smax("enc",{type:d("WAWap").CUSTOM_STRING(b)}),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncTypeIndividualMixin=a}),98);
__d("WASmaxOutAppdataPublishEncVersionFutureproofMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encV;a=d("WASmaxJsx").smax("enc",{v:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncVersionFutureproofMixin=a}),98);
__d("WASmaxOutAppdataPublishPeerPeerFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncTypeIndividualMixin","WASmaxOutAppdataPublishEncVersionFutureproofMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.toJid,c=a.encVersionFutureproofMixinArgs;a=a.encTypeIndividualMixinArgs;b=d("WASmaxJsx").smax("to",{jid:d("WAWap").DEVICE_JID(b)},d("WASmaxOutAppdataPublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(d("WASmaxOutAppdataPublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(d("WASmaxJsx").smax("enc",null),c),a));return b}function i(a){var b=a.toArgs;a=a.appdataTo;a=d("WASmaxJsx").smax("appdata",{to:d("WAWap").USER_JID(a)},d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").REPEATED_CHILD(h,b,1,24)));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makePeerPeerFanoutParticipantsTo=h;g.mergePeerPeerFanoutMixin=a}),98);
__d("WASmaxOutAppdataPublishEncRetryMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encCount;a=d("WASmaxJsx").smax("enc",{count:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncRetryMixin=a}),98);
__d("WASmaxOutAppdataPublishRetryMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncRetryMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.appdataT;a=a.encRetryMixinArgs;b=d("WASmaxJsx").smax("appdata",{t:d("WAWap").INT(b)},d("WASmaxOutAppdataPublishEncRetryMixin").mergeEncRetryMixin(d("WASmaxJsx").smax("enc",null),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRetryMixin=a}),98);
__d("WASmaxOutAppdataPublishPeerPeerSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncTypeIndividualMixin","WASmaxOutAppdataPublishEncVersionFutureproofMixin","WASmaxOutAppdataPublishRetryMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.appdataTo,c=a.retryMixinArgs,e=a.encVersionFutureproofMixinArgs;a=a.encTypeIndividualMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutAppdataPublishRetryMixin").mergeRetryMixin,d("WASmaxJsx").smax("appdata",{to:d("WAWap").DEVICE_JID(b)},d("WASmaxOutAppdataPublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(d("WASmaxOutAppdataPublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(d("WASmaxJsx").smax("enc",null),e),a)),c);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePeerPeerSingleMixin=a}),98);
__d("WASmaxOutAppdataPublishPeerMsgTypes",["WASmaxMixinGroupExhaustiveError","WASmaxOutAppdataPublishPeerPeerFanoutMixin","WASmaxOutAppdataPublishPeerPeerSingleMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.peerPeerFanout)return d("WASmaxOutAppdataPublishPeerPeerFanoutMixin").mergePeerPeerFanoutMixin(a,b.peerPeerFanout);if(b.peerPeerSingle)return d("WASmaxOutAppdataPublishPeerPeerSingleMixin").mergePeerPeerSingleMixin(a,b.peerPeerSingle);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergePeerMsgTypes=a}),98);
__d("WASmaxOutAppdataPublishPeerRequest",["WASmaxAttrs","WASmaxJsx","WASmaxOutAppdataPublishBaseMixin","WASmaxOutAppdataPublishPeerMsgTypes","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=a.appdataId,c=a.appdataPushPriority,e=a.peerMsgTypesArgs;b=d("WASmaxOutAppdataPublishPeerMsgTypes").mergePeerMsgTypes(d("WASmaxOutAppdataPublishBaseMixin").mergeBaseMixin(d("WASmaxJsx").smax("appdata",{id:d("WAWap").STANZA_ID(b),category:"peer",push_priority:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,c)}),a),e);return b}g.makePeerRequest=a}),98);
__d("WASmaxAppdataPublishPeerRPC",["WAComms","WASmaxInAppdataPublishPeerResponseNegative","WASmaxInAppdataPublishPeerResponseSuccess","WASmaxOutAppdataPublishPeerRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WASmaxOutAppdataPublishPeerRequest").makePeerRequest(a);b=(yield d("WAComms").sendSmaxStanza(a,b));var c=d("WASmaxInAppdataPublishPeerResponseNegative").parsePeerResponseNegative(b,a);if(c.success)return{name:"PeerResponseNegative",value:c.value};b=d("WASmaxInAppdataPublishPeerResponseSuccess").parsePeerResponseSuccess(b,a);if(b.success)return{name:"PeerResponseSuccess",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Peer",{Negative:c,Success:b}))});return h.apply(this,arguments)}g.sendPeerRPC=a}),98);